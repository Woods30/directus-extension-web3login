import{message as e}from"@unisat/wallet-sdk";import t from"buffer";import r,{randomBytes as n}from"crypto";import{readFileSync as s}from"fs";import i,{URL as o,fileURLToPath as a}from"url";import u from"util";import c from"stream";import{webcrypto as l}from"node:crypto";var f=(e=>(e.CREATE="create",e.UPDATE="update",e.DELETE="delete",e.REVERT="revert",e.VERSION_SAVE="version_save",e.COMMENT="comment",e.UPLOAD="upload",e.LOGIN="login",e.RUN="run",e))(f||{}),p="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function h(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function d(e){if(e.__esModule)return e;var t=e.default;if("function"==typeof t){var r=function e(){return this instanceof e?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};r.prototype=t.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(e).forEach((function(t){var n=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(r,t,n.get?n:{enumerable:!0,get:function(){return e[t]}})})),r}var m=1e3,y=60*m,g=60*y,b=24*g,v=7*b,_=365.25*b,w=function(e,t){t=t||{};var r=typeof e;if("string"===r&&e.length>0)return function(e){if((e=String(e)).length>100)return;var t=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(!t)return;var r=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return r*_;case"weeks":case"week":case"w":return r*v;case"days":case"day":case"d":return r*b;case"hours":case"hour":case"hrs":case"hr":case"h":return r*g;case"minutes":case"minute":case"mins":case"min":case"m":return r*y;case"seconds":case"second":case"secs":case"sec":case"s":return r*m;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return r;default:return}}(e);if("number"===r&&isFinite(e))return t.long?function(e){var t=Math.abs(e);if(t>=b)return E(e,t,b,"day");if(t>=g)return E(e,t,g,"hour");if(t>=y)return E(e,t,y,"minute");if(t>=m)return E(e,t,m,"second");return e+" ms"}(e):function(e){var t=Math.abs(e);if(t>=b)return Math.round(e/b)+"d";if(t>=g)return Math.round(e/g)+"h";if(t>=y)return Math.round(e/y)+"m";if(t>=m)return Math.round(e/m)+"s";return e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))};function E(e,t,r,n){var s=t>=1.5*r;return Math.round(e/r)+" "+n+(s?"s":"")}var S=h(w),A=((e,t,r=500)=>class extends Error{name="DirectusError";extensions;code=e.toUpperCase();status=r;constructor(e,r){super("string"==typeof t?t:t(e),r),this.extensions=e}toString(){return`${this.name} [${this.code}]: ${this.message}`}})("INVALID_PAYLOAD",(({reason:e})=>`Invalid payload. ${e}.`),400),T={exports:{}},I=function(...e){try{return JSON.stringify(...e)}catch(e){return"[Cannot display object: "+e.message+"]"}};!function(e,t){const r=I;T.exports=class extends Error{constructor(e){super(e.filter((e=>""!==e)).map((e=>"string"==typeof e?e:e instanceof Error?e.message:r(e))).join(" ")||"Unknown error"),"function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,t.assert)}}}(0,T.exports);var O=T.exports;const k=O;var R=function(e,...t){if(!e){if(1===t.length&&t[0]instanceof Error)throw t[0];throw new k(t)}};const N=R,P={};var x=function(e,t,r){if(!1===t||null==t)return e;"string"==typeof(r=r||{})&&(r={separator:r});const n=Array.isArray(t);N(!n||!r.separator,"Separator option is not valid for array-based chain");const s=n?t:t.split(r.separator||".");let i=e;for(let e=0;e<s.length;++e){let n=s[e];const o=r.iterables&&P.iterables(i);if(Array.isArray(i)||"set"===o){const e=Number(n);Number.isInteger(e)&&(n=e<0?i.length+e:e)}if(!i||"function"==typeof i&&!1===r.functions||!o&&void 0===i[n]){N(!r.strict||e+1===s.length,"Missing segment",n,"in reach path ",t),N("object"==typeof i||!0===r.functions||"function"!=typeof i,"Invalid segment",n,"in reach path ",t),i=r.default;break}i=o?"set"===o?[...i][n]:i.get(n):i[n]}return i};P.iterables=function(e){return e instanceof Set?"set":e instanceof Map?"map":void 0};var C={exports:{}};!function(e,t){const r={};t=C.exports={array:Array.prototype,buffer:Buffer&&Buffer.prototype,date:Date.prototype,error:Error.prototype,generic:Object.prototype,map:Map.prototype,promise:Promise.prototype,regex:RegExp.prototype,set:Set.prototype,weakMap:WeakMap.prototype,weakSet:WeakSet.prototype},r.typeMap=new Map([["[object Error]",t.error],["[object Map]",t.map],["[object Promise]",t.promise],["[object Set]",t.set],["[object WeakMap]",t.weakMap],["[object WeakSet]",t.weakSet]]),t.getInternalProto=function(e){if(Array.isArray(e))return t.array;if(Buffer&&e instanceof Buffer)return t.buffer;if(e instanceof Date)return t.date;if(e instanceof RegExp)return t.regex;if(e instanceof Error)return t.error;const n=Object.prototype.toString.call(e);return r.typeMap.get(n)||t.generic}}(0,C.exports);var B=C.exports,L={keys:function(e,t={}){return!1!==t.symbols?Reflect.ownKeys(e):Object.getOwnPropertyNames(e)}};const $=x,U=B,D=L,j={needsProtoHack:new Set([U.set,U.map,U.weakSet,U.weakMap])};var M=j.clone=function(e,t={},r=null){if("object"!=typeof e||null===e)return e;let n=j.clone,s=r;if(t.shallow){if(!0!==t.shallow)return j.cloneWithShallow(e,t);n=e=>e}else if(s){const t=s.get(e);if(t)return t}else s=new Map;const i=U.getInternalProto(e);if(i===U.buffer)return Buffer&&Buffer.from(e);if(i===U.date)return new Date(e.getTime());if(i===U.regex)return new RegExp(e);const o=j.base(e,i,t);if(o===e)return e;if(s&&s.set(e,o),i===U.set)for(const r of e)o.add(n(r,t,s));else if(i===U.map)for(const[r,i]of e)o.set(r,n(i,t,s));const a=D.keys(e,t);for(const r of a){if("__proto__"===r)continue;if(i===U.array&&"length"===r){o.length=e.length;continue}const a=Object.getOwnPropertyDescriptor(e,r);a?a.get||a.set?Object.defineProperty(o,r,a):a.enumerable?o[r]=n(e[r],t,s):Object.defineProperty(o,r,{enumerable:!1,writable:!0,configurable:!0,value:n(e[r],t,s)}):Object.defineProperty(o,r,{enumerable:!0,writable:!0,configurable:!0,value:n(e[r],t,s)})}return o};j.cloneWithShallow=function(e,t){const r=t.shallow;(t=Object.assign({},t)).shallow=!1;const n=new Map;for(const t of r){const r=$(e,t);"object"!=typeof r&&"function"!=typeof r||n.set(r,r)}return j.clone(e,t,n)},j.base=function(e,t,r){if(!1===r.prototype)return j.needsProtoHack.has(t)?new t.constructor:t===U.array?[]:{};const n=Object.getPrototypeOf(e);if(n&&n.isImmutable)return e;if(t===U.array){const e=[];return n!==t&&Object.setPrototypeOf(e,n),e}if(j.needsProtoHack.has(t)){const e=new n.constructor;return n!==t&&Object.setPrototypeOf(e,n),e}return Object.create(n)};const H={};var F=function(e){if(!e)return"";let t="";for(let r=0;r<e.length;++r){const n=e.charCodeAt(r);H.isSafe(n)?t+=e[r]:t+=H.escapeHtmlChar(n)}return t};H.escapeHtmlChar=function(e){const t=H.namedHtml.get(e);if(t)return t;if(e>=256)return"&#"+e+";";return`&#x${e.toString(16).padStart(2,"0")};`},H.isSafe=function(e){return H.safeCharCodes.has(e)},H.namedHtml=new Map([[38,"&amp;"],[60,"&lt;"],[62,"&gt;"],[34,"&quot;"],[160,"&nbsp;"],[162,"&cent;"],[163,"&pound;"],[164,"&curren;"],[169,"&copy;"],[174,"&reg;"]]),H.safeCharCodes=function(){const e=new Set;for(let t=32;t<123;++t)(t>=97||t>=65&&t<=90||t>=48&&t<=57||32===t||46===t||44===t||45===t||58===t||95===t)&&e.add(t);return e}();var K,G={};const V=B,X={mismatched:null};var W=function(e,t,r){return r=Object.assign({prototype:!0},r),!!X.isDeepEqual(e,t,r,[])};X.isDeepEqual=function(e,t,r,n){if(e===t)return 0!==e||1/e==1/t;const s=typeof e;if(s!==typeof t)return!1;if(null===e||null===t)return!1;if("function"===s){if(!r.deepFunction||e.toString()!==t.toString())return!1}else if("object"!==s)return e!=e&&t!=t;const i=X.getSharedType(e,t,!!r.prototype);switch(i){case V.buffer:return Buffer&&Buffer.prototype.equals.call(e,t);case V.promise:return e===t;case V.regex:return e.toString()===t.toString();case X.mismatched:return!1}for(let r=n.length-1;r>=0;--r)if(n[r].isSame(e,t))return!0;n.push(new X.SeenEntry(e,t));try{return!!X.isDeepEqualObj(i,e,t,r,n)}finally{n.pop()}},X.getSharedType=function(e,t,r){if(r)return Object.getPrototypeOf(e)!==Object.getPrototypeOf(t)?X.mismatched:V.getInternalProto(e);const n=V.getInternalProto(e);return n!==V.getInternalProto(t)?X.mismatched:n},X.valueOf=function(e){const t=e.valueOf;if(void 0===t)return e;try{return t.call(e)}catch(e){return e}},X.hasOwnEnumerableProperty=function(e,t){return Object.prototype.propertyIsEnumerable.call(e,t)},X.isSetSimpleEqual=function(e,t){for(const r of Set.prototype.values.call(e))if(!Set.prototype.has.call(t,r))return!1;return!0},X.isDeepEqualObj=function(e,t,r,n,s){const{isDeepEqual:i,valueOf:o,hasOwnEnumerableProperty:a}=X,{keys:u,getOwnPropertySymbols:c}=Object;if(e===V.array){if(!n.part){if(t.length!==r.length)return!1;for(let e=0;e<t.length;++e)if(!i(t[e],r[e],n,s))return!1;return!0}for(const e of t)for(const t of r)if(i(e,t,n,s))return!0}else if(e===V.set){if(t.size!==r.size)return!1;if(!X.isSetSimpleEqual(t,r)){const e=new Set(Set.prototype.values.call(r));for(const r of Set.prototype.values.call(t)){if(e.delete(r))continue;let t=!1;for(const o of e)if(i(r,o,n,s)){e.delete(o),t=!0;break}if(!t)return!1}}}else if(e===V.map){if(t.size!==r.size)return!1;for(const[e,o]of Map.prototype.entries.call(t)){if(void 0===o&&!Map.prototype.has.call(r,e))return!1;if(!i(o,Map.prototype.get.call(r,e),n,s))return!1}}else if(e===V.error&&(t.name!==r.name||t.message!==r.message))return!1;const l=o(t),f=o(r);if((t!==l||r!==f)&&!i(l,f,n,s))return!1;const p=u(t);if(!n.part&&p.length!==u(r).length&&!n.skip)return!1;let h=0;for(const e of p)if(n.skip&&n.skip.includes(e))void 0===r[e]&&++h;else{if(!a(r,e))return!1;if(!i(t[e],r[e],n,s))return!1}if(!n.part&&p.length-h!==u(r).length)return!1;if(!1!==n.symbols){const e=c(t),o=new Set(c(r));for(const u of e){if(!n.skip||!n.skip.includes(u))if(a(t,u)){if(!a(r,u))return!1;if(!i(t[u],r[u],n,s))return!1}else if(a(r,u))return!1;o.delete(u)}for(const e of o)if(a(r,e))return!1}return!0},X.SeenEntry=class{constructor(e,t){this.obj=e,this.ref=t}isSame(e,t){return this.obj===e&&this.ref===t}};var q,Z={};const Y=R,z=M,J=L,Q={};var ee=Q.merge=function(e,t,r){if(Y(e&&"object"==typeof e,"Invalid target value: must be an object"),Y(null==t||"object"==typeof t,"Invalid source value: must be null, undefined, or an object"),!t)return e;if(r=Object.assign({nullOverride:!0,mergeArrays:!0},r),Array.isArray(t)){Y(Array.isArray(e),"Cannot merge array onto an object"),r.mergeArrays||(e.length=0);for(let n=0;n<t.length;++n)e.push(z(t[n],{symbols:r.symbols}));return e}const n=J.keys(t,r);for(let s=0;s<n.length;++s){const i=n[s];if("__proto__"===i||!Object.prototype.propertyIsEnumerable.call(t,i))continue;const o=t[i];if(o&&"object"==typeof o){if(e[i]===o)continue;!e[i]||"object"!=typeof e[i]||Array.isArray(e[i])!==Array.isArray(o)||o instanceof Date||Buffer&&Buffer.isBuffer(o)||o instanceof RegExp?e[i]=z(o,{symbols:r.symbols}):Q.merge(e[i],o,r)}else(null!=o||r.nullOverride)&&(e[i]=o)}return e},te=function(){};const re=R,ne=M,se=ee,ie=x,oe={};var ae=function(e,t,r={}){if(re(e&&"object"==typeof e,"Invalid defaults value: must be an object"),re(!t||!0===t||"object"==typeof t,"Invalid source value: must be true, falsy or an object"),re("object"==typeof r,"Invalid options: must be an object"),!t)return null;if(r.shallow)return oe.applyToDefaultsWithShallow(e,t,r);const n=ne(e);if(!0===t)return n;const s=void 0!==r.nullOverride&&r.nullOverride;return se(n,t,{nullOverride:s,mergeArrays:!1})};oe.applyToDefaultsWithShallow=function(e,t,r){const n=r.shallow;re(Array.isArray(n),"Invalid keys");const s=new Map,i=!0===t?null:new Set;for(let r of n){r=Array.isArray(r)?r:r.split(".");const n=ie(e,r);n&&"object"==typeof n?s.set(n,i&&ie(t,r)||n):i&&i.add(r)}const o=ne(e,{},s);if(!i)return o;for(const e of i)oe.reachCopy(o,t,e);const a=void 0!==r.nullOverride&&r.nullOverride;return se(o,t,{nullOverride:a,mergeArrays:!1})},oe.reachCopy=function(e,t,r){for(const e of r){if(!(e in t))return;const r=t[e];if("object"!=typeof r||null===r)return;t=r}const n=t;let s=e;for(let e=0;e<r.length-1;++e){const t=r[e];"object"!=typeof s[t]&&(s[t]={}),s=s[t]}s[r[r.length-1]]=n};var ue={};const ce=R,le={};ue.Sorter=class{constructor(){this._items=[],this.nodes=[]}add(e,t){const r=[].concat((t=t||{}).before||[]),n=[].concat(t.after||[]),s=t.group||"?",i=t.sort||0;ce(!r.includes(s),`Item cannot come before itself: ${s}`),ce(!r.includes("?"),"Item cannot come before unassociated items"),ce(!n.includes(s),`Item cannot come after itself: ${s}`),ce(!n.includes("?"),"Item cannot come after unassociated items"),Array.isArray(e)||(e=[e]);for(const t of e){const e={seq:this._items.length,sort:i,before:r,after:n,group:s,node:t};this._items.push(e)}if(!t.manual){const e=this._sort();ce(e,"item","?"!==s?`added into group ${s}`:"","created a dependencies error")}return this.nodes}merge(e){Array.isArray(e)||(e=[e]);for(const t of e)if(t)for(const e of t._items)this._items.push(Object.assign({},e));this._items.sort(le.mergeSort);for(let e=0;e<this._items.length;++e)this._items[e].seq=e;const t=this._sort();return ce(t,"merge created a dependencies error"),this.nodes}sort(){const e=this._sort();return ce(e,"sort created a dependencies error"),this.nodes}_sort(){const e={},t=Object.create(null),r=Object.create(null);for(const n of this._items){const s=n.seq,i=n.group;r[i]=r[i]||[],r[i].push(s),e[s]=n.before;for(const e of n.after)t[e]=t[e]||[],t[e].push(s)}for(const t in e){const n=[];for(const s in e[t]){const i=e[t][s];r[i]=r[i]||[],n.push(...r[i])}e[t]=n}for(const n in t)if(r[n])for(const s of r[n])e[s].push(...t[n]);const n={};for(const t in e){const r=e[t];for(const e of r)n[e]=n[e]||[],n[e].push(t)}const s={},i=[];for(let e=0;e<this._items.length;++e){let t=e;if(n[e]){t=null;for(let e=0;e<this._items.length;++e){if(!0===s[e])continue;n[e]||(n[e]=[]);const r=n[e].length;let i=0;for(let t=0;t<r;++t)s[n[e][t]]&&++i;if(i===r){t=e;break}}}null!==t&&(s[t]=!0,i.push(t))}if(i.length!==this._items.length)return!1;const o={};for(const e of this._items)o[e.seq]=e;this._items=[],this.nodes=[];for(const e of i){const t=o[e];this.nodes.push(t.node),this._items.push(t)}return!0}},le.mergeSort=(e,t)=>e.sort===t.sort?0:e.sort<t.sort?-1:1;var fe,pe={},he={};(fe=he).codes={EMPTY_STRING:"Address must be a non-empty string",FORBIDDEN_UNICODE:"Address contains forbidden Unicode characters",MULTIPLE_AT_CHAR:"Address cannot contain more than one @ character",MISSING_AT_CHAR:"Address must contain one @ character",EMPTY_LOCAL:"Address local part cannot be empty",ADDRESS_TOO_LONG:"Address too long",LOCAL_TOO_LONG:"Address local part too long",EMPTY_LOCAL_SEGMENT:"Address local part contains empty dot-separated segment",INVALID_LOCAL_CHARS:"Address local part contains invalid character",DOMAIN_NON_EMPTY_STRING:"Domain must be a non-empty string",DOMAIN_TOO_LONG:"Domain too long",DOMAIN_INVALID_UNICODE_CHARS:"Domain contains forbidden Unicode characters",DOMAIN_INVALID_CHARS:"Domain contains invalid character",DOMAIN_INVALID_TLDS_CHARS:"Domain contains invalid tld character",DOMAIN_SEGMENTS_COUNT:"Domain lacks the minimum required number of segments",DOMAIN_SEGMENTS_COUNT_MAX:"Domain contains too many segments",DOMAIN_FORBIDDEN_TLDS:"Domain uses forbidden TLD",DOMAIN_EMPTY_SEGMENT:"Domain contains empty dot-separated segment",DOMAIN_LONG_SEGMENT:"Domain contains dot-separated segment that is too long"},fe.code=function(e){return{code:e,error:fe.codes[e]}},function(e){const t=he,r={minDomainSegments:2,nonAsciiRx:/[^\x00-\x7f]/,domainControlRx:/[\x00-\x20@\:\/\\#!\$&\'\(\)\*\+,;=\?]/,tldSegmentRx:/^[a-zA-Z](?:[a-zA-Z0-9\-]*[a-zA-Z0-9])?$/,domainSegmentRx:/^[a-zA-Z0-9](?:[a-zA-Z0-9\-]*[a-zA-Z0-9])?$/,URL:i.URL||URL};e.analyze=function(e,n={}){if(!e)return t.code("DOMAIN_NON_EMPTY_STRING");if("string"!=typeof e)throw new Error("Invalid input: domain must be a string");if(e.length>256)return t.code("DOMAIN_TOO_LONG");if(!!r.nonAsciiRx.test(e)){if(!1===n.allowUnicode)return t.code("DOMAIN_INVALID_UNICODE_CHARS");e=e.normalize("NFC")}if(r.domainControlRx.test(e))return t.code("DOMAIN_INVALID_CHARS");e=r.punycode(e),n.allowFullyQualified&&"."===e[e.length-1]&&(e=e.slice(0,-1));const s=n.minDomainSegments||r.minDomainSegments,i=e.split(".");if(i.length<s)return t.code("DOMAIN_SEGMENTS_COUNT");if(n.maxDomainSegments&&i.length>n.maxDomainSegments)return t.code("DOMAIN_SEGMENTS_COUNT_MAX");const o=n.tlds;if(o){const e=i[i.length-1].toLowerCase();if(o.deny&&o.deny.has(e)||o.allow&&!o.allow.has(e))return t.code("DOMAIN_FORBIDDEN_TLDS")}for(let e=0;e<i.length;++e){const n=i[e];if(!n.length)return t.code("DOMAIN_EMPTY_SEGMENT");if(n.length>63)return t.code("DOMAIN_LONG_SEGMENT");if(e<i.length-1){if(!r.domainSegmentRx.test(n))return t.code("DOMAIN_INVALID_CHARS")}else if(!r.tldSegmentRx.test(n))return t.code("DOMAIN_INVALID_TLDS_CHARS")}return null},e.isValid=function(t,r){return!e.analyze(t,r)},r.punycode=function(e){e.includes("%")&&(e=e.replace(/%/g,"%25"));try{return new r.URL(`http://${e}`).host}catch(t){return e}}}(pe);var de={};const me=pe,ye=he,ge={nonAsciiRx:/[^\x00-\x7f]/,encoder:new(u.TextEncoder||TextEncoder)};de.analyze=function(e,t){return ge.email(e,t)},de.isValid=function(e,t){return!ge.email(e,t)},ge.email=function(e,t={}){if("string"!=typeof e)throw new Error("Invalid input: email must be a string");if(!e)return ye.code("EMPTY_STRING");const r=!ge.nonAsciiRx.test(e);if(!r){if(!1===t.allowUnicode)return ye.code("FORBIDDEN_UNICODE");e=e.normalize("NFC")}const n=e.split("@");if(2!==n.length)return n.length>2?ye.code("MULTIPLE_AT_CHAR"):ye.code("MISSING_AT_CHAR");const[s,i]=n;if(!s)return ye.code("EMPTY_LOCAL");if(!t.ignoreLength){if(e.length>254)return ye.code("ADDRESS_TOO_LONG");if(ge.encoder.encode(s).length>64)return ye.code("LOCAL_TOO_LONG")}return ge.local(s,r)||me.analyze(i,t)},ge.local=function(e,t){const r=e.split(".");for(const e of r){if(!e.length)return ye.code("EMPTY_LOCAL_SEGMENT");if(t){if(!ge.atextRx.test(e))return ye.code("INVALID_LOCAL_CHARS")}else for(const t of e){if(ge.atextRx.test(t))continue;const e=ge.binary(t);if(!ge.atomRx.test(e))return ye.code("INVALID_LOCAL_CHARS")}}},ge.binary=function(e){return Array.from(ge.encoder.encode(e)).map((e=>String.fromCharCode(e))).join("")},ge.atextRx=/^[\w!#\$%&'\*\+\-/=\?\^`\{\|\}~]+$/,ge.atomRx=new RegExp(["(?:[\\xc2-\\xdf][\\x80-\\xbf])","(?:\\xe0[\\xa0-\\xbf][\\x80-\\xbf])|(?:[\\xe1-\\xec][\\x80-\\xbf]{2})|(?:\\xed[\\x80-\\x9f][\\x80-\\xbf])|(?:[\\xee-\\xef][\\x80-\\xbf]{2})","(?:\\xf0[\\x90-\\xbf][\\x80-\\xbf]{2})|(?:[\\xf1-\\xf3][\\x80-\\xbf]{3})|(?:\\xf4[\\x80-\\x8f][\\x80-\\xbf]{2})"].join("|"));var be={},ve={},_e=function(e){return e.replace(/[\^\$\.\*\+\-\?\=\!\:\|\\\/\(\)\[\]\{\}\,]/g,"\\$&")};const we=R,Ee=_e,Se={generate:function(){const e={},t="\\dA-Fa-f",r="["+t+"]",n="\\w-\\.~",s="!\\$&'\\(\\)\\*\\+,;=",i="%"+t,o=n+i+s+":@",a="["+o+"]",u="(?:0{0,2}\\d|0?[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])";e.ipv4address="(?:"+u+"\\.){3}"+u;const c=r+"{1,4}",l="(?:"+c+":"+c+"|"+e.ipv4address+")",f="(?:"+c+":){6}"+l,p="::(?:"+c+":){5}"+l,h="(?:"+c+")?::(?:"+c+":){4}"+l,d="(?:(?:"+c+":){0,1}"+c+")?::(?:"+c+":){3}"+l,m="(?:(?:"+c+":){0,2}"+c+")?::(?:"+c+":){2}"+l,y="(?:(?:"+c+":){0,3}"+c+")?::"+c+":"+l,g="(?:(?:"+c+":){0,4}"+c+")?::"+l,b="(?:(?:"+c+":){0,5}"+c+")?::"+c,v="(?:(?:"+c+":){0,6}"+c+")?::";e.ipv4Cidr="(?:\\d|[1-2]\\d|3[0-2])",e.ipv6Cidr="(?:0{0,2}\\d|0?[1-9]\\d|1[01]\\d|12[0-8])",e.ipv6address="(?:"+f+"|"+p+"|"+h+"|"+d+"|"+m+"|"+y+"|"+g+"|"+b+"|"+v+")",e.ipvFuture="v"+r+"+\\.["+n+s+":]+",e.scheme="[a-zA-Z][a-zA-Z\\d+-\\.]*",e.schemeRegex=new RegExp(e.scheme);const _="["+n+i+s+":]*",w="["+n+i+s+"]{1,255}",E="(?:"+("\\[(?:"+e.ipv6address+"|"+e.ipvFuture+")\\]")+"|"+e.ipv4address+"|"+w+")",S="(?:"+_+"@)?"+E+"(?::\\d*)?",A="(?:"+_+"@)?("+E+")(?::\\d*)?",T=a+"*",I=a+"+",O="(?:\\/"+T+")*",k="\\/(?:"+I+O+")?",R=I+O,N="["+n+i+s+"@]+"+O,P="(?:\\/\\/\\/"+T+O+")";return e.hierPart="(?:(?:\\/\\/"+S+O+")|"+k+"|"+R+"|"+P+")",e.hierPartCapture="(?:(?:\\/\\/"+A+O+")|"+k+"|"+R+")",e.relativeRef="(?:(?:\\/\\/"+S+O+")|"+k+"|"+N+"|)",e.relativeRefCapture="(?:(?:\\/\\/"+A+O+")|"+k+"|"+N+"|)",e.query="["+o+"\\/\\?]*(?=#|$)",e.queryWithSquareBrackets="["+o+"\\[\\]\\/\\?]*(?=#|$)",e.fragment="["+o+"\\/\\?]*",e}};Se.rfc3986=Se.generate(),ve.ip={v4Cidr:Se.rfc3986.ipv4Cidr,v6Cidr:Se.rfc3986.ipv6Cidr,ipv4:Se.rfc3986.ipv4address,ipv6:Se.rfc3986.ipv6address,ipvfuture:Se.rfc3986.ipvFuture},Se.createRegex=function(e){const t=Se.rfc3986,r="(?:\\?"+(e.allowQuerySquareBrackets?t.queryWithSquareBrackets:t.query)+")?(?:#"+t.fragment+")?",n=e.domain?t.relativeRefCapture:t.relativeRef;if(e.relativeOnly)return Se.wrap(n+r);let s="";if(e.scheme){we(e.scheme instanceof RegExp||"string"==typeof e.scheme||Array.isArray(e.scheme),"scheme must be a RegExp, String, or Array");const r=[].concat(e.scheme);we(r.length>=1,"scheme must have at least 1 scheme specified");const n=[];for(let e=0;e<r.length;++e){const s=r[e];we(s instanceof RegExp||"string"==typeof s,"scheme at position "+e+" must be a RegExp or String"),s instanceof RegExp?n.push(s.source.toString()):(we(t.schemeRegex.test(s),"scheme at position "+e+" must be a valid scheme"),n.push(Ee(s)))}s=n.join("|")}const i="(?:"+(s?"(?:"+s+")":t.scheme)+":"+(e.domain?t.hierPartCapture:t.hierPart)+")",o=e.allowRelative?"(?:"+i+"|"+n+")":i;return Se.wrap(o+r,s)},Se.wrap=function(e,t){return{raw:e=`(?=.)(?!https?:/(?:$|[^/]))(?!https?:///)(?!https?:[^/])${e}`,regex:new RegExp(`^${e}$`),scheme:t}},Se.uriRegex=Se.createRegex({}),ve.regex=function(e={}){return e.scheme||e.allowRelative||e.relativeOnly||e.allowQuerySquareBrackets||e.domain?Se.createRegex(e):Se.uriRegex};const Ae=R,Te=ve;be.regex=function(e={}){Ae(void 0===e.cidr||"string"==typeof e.cidr,"options.cidr must be a string");const t=e.cidr?e.cidr.toLowerCase():"optional";Ae(["required","optional","forbidden"].includes(t),"options.cidr must be one of required, optional, forbidden"),Ae(void 0===e.version||"string"==typeof e.version||Array.isArray(e.version),"options.version must be a string or an array of string");let r=e.version||["ipv4","ipv6","ipvfuture"];Array.isArray(r)||(r=[r]),Ae(r.length>=1,"options.version must have at least 1 version specified");for(let e=0;e<r.length;++e)Ae("string"==typeof r[e],"options.version must only contain strings"),r[e]=r[e].toLowerCase(),Ae(["ipv4","ipv6","ipvfuture"].includes(r[e]),"options.version contains unknown version "+r[e]+" - must be one of ipv4, ipv6, ipvfuture");r=Array.from(new Set(r));const n=r.map((e=>{if("forbidden"===t)return Te.ip[e];const r=`\\/${"ipv4"===e?Te.ip.v4Cidr:Te.ip.v6Cidr}`;return"required"===t?`${Te.ip[e]}${r}`:`${Te.ip[e]}(?:${r})?`})),s=`(?:${n.join("|")})`,i=new RegExp(`^${s}$`);return{cidr:t,versions:r,regex:i,raw:s}};const Ie={tlds:["AAA","AARP","ABB","ABBOTT","ABBVIE","ABC","ABLE","ABOGADO","ABUDHABI","AC","ACADEMY","ACCENTURE","ACCOUNTANT","ACCOUNTANTS","ACO","ACTOR","AD","ADS","ADULT","AE","AEG","AERO","AETNA","AF","AFL","AFRICA","AG","AGAKHAN","AGENCY","AI","AIG","AIRBUS","AIRFORCE","AIRTEL","AKDN","AL","ALIBABA","ALIPAY","ALLFINANZ","ALLSTATE","ALLY","ALSACE","ALSTOM","AM","AMAZON","AMERICANEXPRESS","AMERICANFAMILY","AMEX","AMFAM","AMICA","AMSTERDAM","ANALYTICS","ANDROID","ANQUAN","ANZ","AO","AOL","APARTMENTS","APP","APPLE","AQ","AQUARELLE","AR","ARAB","ARAMCO","ARCHI","ARMY","ARPA","ART","ARTE","AS","ASDA","ASIA","ASSOCIATES","AT","ATHLETA","ATTORNEY","AU","AUCTION","AUDI","AUDIBLE","AUDIO","AUSPOST","AUTHOR","AUTO","AUTOS","AVIANCA","AW","AWS","AX","AXA","AZ","AZURE","BA","BABY","BAIDU","BANAMEX","BAND","BANK","BAR","BARCELONA","BARCLAYCARD","BARCLAYS","BAREFOOT","BARGAINS","BASEBALL","BASKETBALL","BAUHAUS","BAYERN","BB","BBC","BBT","BBVA","BCG","BCN","BD","BE","BEATS","BEAUTY","BEER","BENTLEY","BERLIN","BEST","BESTBUY","BET","BF","BG","BH","BHARTI","BI","BIBLE","BID","BIKE","BING","BINGO","BIO","BIZ","BJ","BLACK","BLACKFRIDAY","BLOCKBUSTER","BLOG","BLOOMBERG","BLUE","BM","BMS","BMW","BN","BNPPARIBAS","BO","BOATS","BOEHRINGER","BOFA","BOM","BOND","BOO","BOOK","BOOKING","BOSCH","BOSTIK","BOSTON","BOT","BOUTIQUE","BOX","BR","BRADESCO","BRIDGESTONE","BROADWAY","BROKER","BROTHER","BRUSSELS","BS","BT","BUILD","BUILDERS","BUSINESS","BUY","BUZZ","BV","BW","BY","BZ","BZH","CA","CAB","CAFE","CAL","CALL","CALVINKLEIN","CAM","CAMERA","CAMP","CANON","CAPETOWN","CAPITAL","CAPITALONE","CAR","CARAVAN","CARDS","CARE","CAREER","CAREERS","CARS","CASA","CASE","CASH","CASINO","CAT","CATERING","CATHOLIC","CBA","CBN","CBRE","CC","CD","CENTER","CEO","CERN","CF","CFA","CFD","CG","CH","CHANEL","CHANNEL","CHARITY","CHASE","CHAT","CHEAP","CHINTAI","CHRISTMAS","CHROME","CHURCH","CI","CIPRIANI","CIRCLE","CISCO","CITADEL","CITI","CITIC","CITY","CK","CL","CLAIMS","CLEANING","CLICK","CLINIC","CLINIQUE","CLOTHING","CLOUD","CLUB","CLUBMED","CM","CN","CO","COACH","CODES","COFFEE","COLLEGE","COLOGNE","COM","COMCAST","COMMBANK","COMMUNITY","COMPANY","COMPARE","COMPUTER","COMSEC","CONDOS","CONSTRUCTION","CONSULTING","CONTACT","CONTRACTORS","COOKING","COOL","COOP","CORSICA","COUNTRY","COUPON","COUPONS","COURSES","CPA","CR","CREDIT","CREDITCARD","CREDITUNION","CRICKET","CROWN","CRS","CRUISE","CRUISES","CU","CUISINELLA","CV","CW","CX","CY","CYMRU","CYOU","CZ","DABUR","DAD","DANCE","DATA","DATE","DATING","DATSUN","DAY","DCLK","DDS","DE","DEAL","DEALER","DEALS","DEGREE","DELIVERY","DELL","DELOITTE","DELTA","DEMOCRAT","DENTAL","DENTIST","DESI","DESIGN","DEV","DHL","DIAMONDS","DIET","DIGITAL","DIRECT","DIRECTORY","DISCOUNT","DISCOVER","DISH","DIY","DJ","DK","DM","DNP","DO","DOCS","DOCTOR","DOG","DOMAINS","DOT","DOWNLOAD","DRIVE","DTV","DUBAI","DUNLOP","DUPONT","DURBAN","DVAG","DVR","DZ","EARTH","EAT","EC","ECO","EDEKA","EDU","EDUCATION","EE","EG","EMAIL","EMERCK","ENERGY","ENGINEER","ENGINEERING","ENTERPRISES","EPSON","EQUIPMENT","ER","ERICSSON","ERNI","ES","ESQ","ESTATE","ET","EU","EUROVISION","EUS","EVENTS","EXCHANGE","EXPERT","EXPOSED","EXPRESS","EXTRASPACE","FAGE","FAIL","FAIRWINDS","FAITH","FAMILY","FAN","FANS","FARM","FARMERS","FASHION","FAST","FEDEX","FEEDBACK","FERRARI","FERRERO","FI","FIDELITY","FIDO","FILM","FINAL","FINANCE","FINANCIAL","FIRE","FIRESTONE","FIRMDALE","FISH","FISHING","FIT","FITNESS","FJ","FK","FLICKR","FLIGHTS","FLIR","FLORIST","FLOWERS","FLY","FM","FO","FOO","FOOD","FOOTBALL","FORD","FOREX","FORSALE","FORUM","FOUNDATION","FOX","FR","FREE","FRESENIUS","FRL","FROGANS","FRONTIER","FTR","FUJITSU","FUN","FUND","FURNITURE","FUTBOL","FYI","GA","GAL","GALLERY","GALLO","GALLUP","GAME","GAMES","GAP","GARDEN","GAY","GB","GBIZ","GD","GDN","GE","GEA","GENT","GENTING","GEORGE","GF","GG","GGEE","GH","GI","GIFT","GIFTS","GIVES","GIVING","GL","GLASS","GLE","GLOBAL","GLOBO","GM","GMAIL","GMBH","GMO","GMX","GN","GODADDY","GOLD","GOLDPOINT","GOLF","GOO","GOODYEAR","GOOG","GOOGLE","GOP","GOT","GOV","GP","GQ","GR","GRAINGER","GRAPHICS","GRATIS","GREEN","GRIPE","GROCERY","GROUP","GS","GT","GU","GUARDIAN","GUCCI","GUGE","GUIDE","GUITARS","GURU","GW","GY","HAIR","HAMBURG","HANGOUT","HAUS","HBO","HDFC","HDFCBANK","HEALTH","HEALTHCARE","HELP","HELSINKI","HERE","HERMES","HIPHOP","HISAMITSU","HITACHI","HIV","HK","HKT","HM","HN","HOCKEY","HOLDINGS","HOLIDAY","HOMEDEPOT","HOMEGOODS","HOMES","HOMESENSE","HONDA","HORSE","HOSPITAL","HOST","HOSTING","HOT","HOTELS","HOTMAIL","HOUSE","HOW","HR","HSBC","HT","HU","HUGHES","HYATT","HYUNDAI","IBM","ICBC","ICE","ICU","ID","IE","IEEE","IFM","IKANO","IL","IM","IMAMAT","IMDB","IMMO","IMMOBILIEN","IN","INC","INDUSTRIES","INFINITI","INFO","ING","INK","INSTITUTE","INSURANCE","INSURE","INT","INTERNATIONAL","INTUIT","INVESTMENTS","IO","IPIRANGA","IQ","IR","IRISH","IS","ISMAILI","IST","ISTANBUL","IT","ITAU","ITV","JAGUAR","JAVA","JCB","JE","JEEP","JETZT","JEWELRY","JIO","JLL","JM","JMP","JNJ","JO","JOBS","JOBURG","JOT","JOY","JP","JPMORGAN","JPRS","JUEGOS","JUNIPER","KAUFEN","KDDI","KE","KERRYHOTELS","KERRYLOGISTICS","KERRYPROPERTIES","KFH","KG","KH","KI","KIA","KIDS","KIM","KINDLE","KITCHEN","KIWI","KM","KN","KOELN","KOMATSU","KOSHER","KP","KPMG","KPN","KR","KRD","KRED","KUOKGROUP","KW","KY","KYOTO","KZ","LA","LACAIXA","LAMBORGHINI","LAMER","LANCASTER","LAND","LANDROVER","LANXESS","LASALLE","LAT","LATINO","LATROBE","LAW","LAWYER","LB","LC","LDS","LEASE","LECLERC","LEFRAK","LEGAL","LEGO","LEXUS","LGBT","LI","LIDL","LIFE","LIFEINSURANCE","LIFESTYLE","LIGHTING","LIKE","LILLY","LIMITED","LIMO","LINCOLN","LINK","LIPSY","LIVE","LIVING","LK","LLC","LLP","LOAN","LOANS","LOCKER","LOCUS","LOL","LONDON","LOTTE","LOTTO","LOVE","LPL","LPLFINANCIAL","LR","LS","LT","LTD","LTDA","LU","LUNDBECK","LUXE","LUXURY","LV","LY","MA","MADRID","MAIF","MAISON","MAKEUP","MAN","MANAGEMENT","MANGO","MAP","MARKET","MARKETING","MARKETS","MARRIOTT","MARSHALLS","MATTEL","MBA","MC","MCKINSEY","MD","ME","MED","MEDIA","MEET","MELBOURNE","MEME","MEMORIAL","MEN","MENU","MERCKMSD","MG","MH","MIAMI","MICROSOFT","MIL","MINI","MINT","MIT","MITSUBISHI","MK","ML","MLB","MLS","MM","MMA","MN","MO","MOBI","MOBILE","MODA","MOE","MOI","MOM","MONASH","MONEY","MONSTER","MORMON","MORTGAGE","MOSCOW","MOTO","MOTORCYCLES","MOV","MOVIE","MP","MQ","MR","MS","MSD","MT","MTN","MTR","MU","MUSEUM","MUSIC","MV","MW","MX","MY","MZ","NA","NAB","NAGOYA","NAME","NATURA","NAVY","NBA","NC","NE","NEC","NET","NETBANK","NETFLIX","NETWORK","NEUSTAR","NEW","NEWS","NEXT","NEXTDIRECT","NEXUS","NF","NFL","NG","NGO","NHK","NI","NICO","NIKE","NIKON","NINJA","NISSAN","NISSAY","NL","NO","NOKIA","NORTON","NOW","NOWRUZ","NOWTV","NP","NR","NRA","NRW","NTT","NU","NYC","NZ","OBI","OBSERVER","OFFICE","OKINAWA","OLAYAN","OLAYANGROUP","OLLO","OM","OMEGA","ONE","ONG","ONL","ONLINE","OOO","OPEN","ORACLE","ORANGE","ORG","ORGANIC","ORIGINS","OSAKA","OTSUKA","OTT","OVH","PA","PAGE","PANASONIC","PARIS","PARS","PARTNERS","PARTS","PARTY","PAY","PCCW","PE","PET","PF","PFIZER","PG","PH","PHARMACY","PHD","PHILIPS","PHONE","PHOTO","PHOTOGRAPHY","PHOTOS","PHYSIO","PICS","PICTET","PICTURES","PID","PIN","PING","PINK","PIONEER","PIZZA","PK","PL","PLACE","PLAY","PLAYSTATION","PLUMBING","PLUS","PM","PN","PNC","POHL","POKER","POLITIE","PORN","POST","PR","PRAMERICA","PRAXI","PRESS","PRIME","PRO","PROD","PRODUCTIONS","PROF","PROGRESSIVE","PROMO","PROPERTIES","PROPERTY","PROTECTION","PRU","PRUDENTIAL","PS","PT","PUB","PW","PWC","PY","QA","QPON","QUEBEC","QUEST","RACING","RADIO","RE","READ","REALESTATE","REALTOR","REALTY","RECIPES","RED","REDSTONE","REDUMBRELLA","REHAB","REISE","REISEN","REIT","RELIANCE","REN","RENT","RENTALS","REPAIR","REPORT","REPUBLICAN","REST","RESTAURANT","REVIEW","REVIEWS","REXROTH","RICH","RICHARDLI","RICOH","RIL","RIO","RIP","RO","ROCKS","RODEO","ROGERS","ROOM","RS","RSVP","RU","RUGBY","RUHR","RUN","RW","RWE","RYUKYU","SA","SAARLAND","SAFE","SAFETY","SAKURA","SALE","SALON","SAMSCLUB","SAMSUNG","SANDVIK","SANDVIKCOROMANT","SANOFI","SAP","SARL","SAS","SAVE","SAXO","SB","SBI","SBS","SC","SCB","SCHAEFFLER","SCHMIDT","SCHOLARSHIPS","SCHOOL","SCHULE","SCHWARZ","SCIENCE","SCOT","SD","SE","SEARCH","SEAT","SECURE","SECURITY","SEEK","SELECT","SENER","SERVICES","SEVEN","SEW","SEX","SEXY","SFR","SG","SH","SHANGRILA","SHARP","SHAW","SHELL","SHIA","SHIKSHA","SHOES","SHOP","SHOPPING","SHOUJI","SHOW","SI","SILK","SINA","SINGLES","SITE","SJ","SK","SKI","SKIN","SKY","SKYPE","SL","SLING","SM","SMART","SMILE","SN","SNCF","SO","SOCCER","SOCIAL","SOFTBANK","SOFTWARE","SOHU","SOLAR","SOLUTIONS","SONG","SONY","SOY","SPA","SPACE","SPORT","SPOT","SR","SRL","SS","ST","STADA","STAPLES","STAR","STATEBANK","STATEFARM","STC","STCGROUP","STOCKHOLM","STORAGE","STORE","STREAM","STUDIO","STUDY","STYLE","SU","SUCKS","SUPPLIES","SUPPLY","SUPPORT","SURF","SURGERY","SUZUKI","SV","SWATCH","SWISS","SX","SY","SYDNEY","SYSTEMS","SZ","TAB","TAIPEI","TALK","TAOBAO","TARGET","TATAMOTORS","TATAR","TATTOO","TAX","TAXI","TC","TCI","TD","TDK","TEAM","TECH","TECHNOLOGY","TEL","TEMASEK","TENNIS","TEVA","TF","TG","TH","THD","THEATER","THEATRE","TIAA","TICKETS","TIENDA","TIPS","TIRES","TIROL","TJ","TJMAXX","TJX","TK","TKMAXX","TL","TM","TMALL","TN","TO","TODAY","TOKYO","TOOLS","TOP","TORAY","TOSHIBA","TOTAL","TOURS","TOWN","TOYOTA","TOYS","TR","TRADE","TRADING","TRAINING","TRAVEL","TRAVELERS","TRAVELERSINSURANCE","TRUST","TRV","TT","TUBE","TUI","TUNES","TUSHU","TV","TVS","TW","TZ","UA","UBANK","UBS","UG","UK","UNICOM","UNIVERSITY","UNO","UOL","UPS","US","UY","UZ","VA","VACATIONS","VANA","VANGUARD","VC","VE","VEGAS","VENTURES","VERISIGN","VERSICHERUNG","VET","VG","VI","VIAJES","VIDEO","VIG","VIKING","VILLAS","VIN","VIP","VIRGIN","VISA","VISION","VIVA","VIVO","VLAANDEREN","VN","VODKA","VOLVO","VOTE","VOTING","VOTO","VOYAGE","VU","WALES","WALMART","WALTER","WANG","WANGGOU","WATCH","WATCHES","WEATHER","WEATHERCHANNEL","WEBCAM","WEBER","WEBSITE","WED","WEDDING","WEIBO","WEIR","WF","WHOSWHO","WIEN","WIKI","WILLIAMHILL","WIN","WINDOWS","WINE","WINNERS","WME","WOLTERSKLUWER","WOODSIDE","WORK","WORKS","WORLD","WOW","WS","WTC","WTF","XBOX","XEROX","XFINITY","XIHUAN","XIN","XN--11B4C3D","XN--1CK2E1B","XN--1QQW23A","XN--2SCRJ9C","XN--30RR7Y","XN--3BST00M","XN--3DS443G","XN--3E0B707E","XN--3HCRJ9C","XN--3PXU8K","XN--42C2D9A","XN--45BR5CYL","XN--45BRJ9C","XN--45Q11C","XN--4DBRK0CE","XN--4GBRIM","XN--54B7FTA0CC","XN--55QW42G","XN--55QX5D","XN--5SU34J936BGSG","XN--5TZM5G","XN--6FRZ82G","XN--6QQ986B3XL","XN--80ADXHKS","XN--80AO21A","XN--80AQECDR1A","XN--80ASEHDB","XN--80ASWG","XN--8Y0A063A","XN--90A3AC","XN--90AE","XN--90AIS","XN--9DBQ2A","XN--9ET52U","XN--9KRT00A","XN--B4W605FERD","XN--BCK1B9A5DRE4C","XN--C1AVG","XN--C2BR7G","XN--CCK2B3B","XN--CCKWCXETD","XN--CG4BKI","XN--CLCHC0EA0B2G2A9GCD","XN--CZR694B","XN--CZRS0T","XN--CZRU2D","XN--D1ACJ3B","XN--D1ALF","XN--E1A4C","XN--ECKVDTC9D","XN--EFVY88H","XN--FCT429K","XN--FHBEI","XN--FIQ228C5HS","XN--FIQ64B","XN--FIQS8S","XN--FIQZ9S","XN--FJQ720A","XN--FLW351E","XN--FPCRJ9C3D","XN--FZC2C9E2C","XN--FZYS8D69UVGM","XN--G2XX48C","XN--GCKR3F0F","XN--GECRJ9C","XN--GK3AT1E","XN--H2BREG3EVE","XN--H2BRJ9C","XN--H2BRJ9C8C","XN--HXT814E","XN--I1B6B1A6A2E","XN--IMR513N","XN--IO0A7I","XN--J1AEF","XN--J1AMH","XN--J6W193G","XN--JLQ480N2RG","XN--JVR189M","XN--KCRX77D1X4A","XN--KPRW13D","XN--KPRY57D","XN--KPUT3I","XN--L1ACC","XN--LGBBAT1AD8J","XN--MGB9AWBF","XN--MGBA3A3EJT","XN--MGBA3A4F16A","XN--MGBA7C0BBN0A","XN--MGBAAM7A8H","XN--MGBAB2BD","XN--MGBAH1A3HJKRD","XN--MGBAI9AZGQP6J","XN--MGBAYH7GPA","XN--MGBBH1A","XN--MGBBH1A71E","XN--MGBC0A9AZCG","XN--MGBCA7DZDO","XN--MGBCPQ6GPA1A","XN--MGBERP4A5D4AR","XN--MGBGU82A","XN--MGBI4ECEXP","XN--MGBPL2FH","XN--MGBT3DHD","XN--MGBTX2B","XN--MGBX4CD0AB","XN--MIX891F","XN--MK1BU44C","XN--MXTQ1M","XN--NGBC5AZD","XN--NGBE9E0A","XN--NGBRX","XN--NODE","XN--NQV7F","XN--NQV7FS00EMA","XN--NYQY26A","XN--O3CW4H","XN--OGBPF8FL","XN--OTU796D","XN--P1ACF","XN--P1AI","XN--PGBS0DH","XN--PSSY2U","XN--Q7CE6A","XN--Q9JYB4C","XN--QCKA1PMC","XN--QXA6A","XN--QXAM","XN--RHQV96G","XN--ROVU88B","XN--RVC1E0AM3E","XN--S9BRJ9C","XN--SES554G","XN--T60B56A","XN--TCKWE","XN--TIQ49XQYJ","XN--UNUP4Y","XN--VERMGENSBERATER-CTB","XN--VERMGENSBERATUNG-PWB","XN--VHQUV","XN--VUQ861B","XN--W4R85EL8FHU5DNRA","XN--W4RS40L","XN--WGBH1C","XN--WGBL6A","XN--XHQ521B","XN--XKC2AL3HYE2A","XN--XKC2DL3A5EE0H","XN--Y9A3AQ","XN--YFRO4I67O","XN--YGBI2AMMX","XN--ZFR164B","XXX","XYZ","YACHTS","YAHOO","YAMAXUN","YANDEX","YE","YODOBASHI","YOGA","YOKOHAMA","YOU","YOUTUBE","YT","YUN","ZA","ZAPPOS","ZARA","ZERO","ZIP","ZM","ZONE","ZUERICH","ZW"]};var Oe,ke,Re=new Set(Ie.tlds.map((e=>e.toLowerCase())));!function(e){e.assertEqual=e=>e,e.assertIs=function(e){},e.assertNever=function(e){throw new Error},e.arrayToEnum=e=>{const t={};for(const r of e)t[r]=r;return t},e.getValidEnumValues=t=>{const r=e.objectKeys(t).filter((e=>"number"!=typeof t[t[e]])),n={};for(const e of r)n[e]=t[e];return e.objectValues(n)},e.objectValues=t=>e.objectKeys(t).map((function(e){return t[e]})),e.objectKeys="function"==typeof Object.keys?e=>Object.keys(e):e=>{const t=[];for(const r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.push(r);return t},e.find=(e,t)=>{for(const r of e)if(t(r))return r},e.isInteger="function"==typeof Number.isInteger?e=>Number.isInteger(e):e=>"number"==typeof e&&isFinite(e)&&Math.floor(e)===e,e.joinValues=function(e,t=" | "){return e.map((e=>"string"==typeof e?`'${e}'`:e)).join(t)},e.jsonStringifyReplacer=(e,t)=>"bigint"==typeof t?t.toString():t}(Oe||(Oe={})),function(e){e.mergeShapes=(e,t)=>({...e,...t})}(ke||(ke={}));const Ne=Oe.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Pe=e=>{switch(typeof e){case"undefined":return Ne.undefined;case"string":return Ne.string;case"number":return isNaN(e)?Ne.nan:Ne.number;case"boolean":return Ne.boolean;case"function":return Ne.function;case"bigint":return Ne.bigint;case"symbol":return Ne.symbol;case"object":return Array.isArray(e)?Ne.array:null===e?Ne.null:e.then&&"function"==typeof e.then&&e.catch&&"function"==typeof e.catch?Ne.promise:"undefined"!=typeof Map&&e instanceof Map?Ne.map:"undefined"!=typeof Set&&e instanceof Set?Ne.set:"undefined"!=typeof Date&&e instanceof Date?Ne.date:Ne.object;default:return Ne.unknown}},xe=Oe.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class Ce extends Error{constructor(e){super(),this.issues=[],this.addIssue=e=>{this.issues=[...this.issues,e]},this.addIssues=(e=[])=>{this.issues=[...this.issues,...e]};const t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}get errors(){return this.issues}format(e){const t=e||function(e){return e.message},r={_errors:[]},n=e=>{for(const s of e.issues)if("invalid_union"===s.code)s.unionErrors.map(n);else if("invalid_return_type"===s.code)n(s.returnTypeError);else if("invalid_arguments"===s.code)n(s.argumentsError);else if(0===s.path.length)r._errors.push(t(s));else{let e=r,n=0;for(;n<s.path.length;){const r=s.path[n];n===s.path.length-1?(e[r]=e[r]||{_errors:[]},e[r]._errors.push(t(s))):e[r]=e[r]||{_errors:[]},e=e[r],n++}}};return n(this),r}toString(){return this.message}get message(){return JSON.stringify(this.issues,Oe.jsonStringifyReplacer,2)}get isEmpty(){return 0===this.issues.length}flatten(e=(e=>e.message)){const t={},r=[];for(const n of this.issues)n.path.length>0?(t[n.path[0]]=t[n.path[0]]||[],t[n.path[0]].push(e(n))):r.push(e(n));return{formErrors:r,fieldErrors:t}}get formErrors(){return this.flatten()}}Ce.create=e=>new Ce(e);const Be=(e,t)=>{let r;switch(e.code){case xe.invalid_type:r=e.received===Ne.undefined?"Required":`Expected ${e.expected}, received ${e.received}`;break;case xe.invalid_literal:r=`Invalid literal value, expected ${JSON.stringify(e.expected,Oe.jsonStringifyReplacer)}`;break;case xe.unrecognized_keys:r=`Unrecognized key(s) in object: ${Oe.joinValues(e.keys,", ")}`;break;case xe.invalid_union:r="Invalid input";break;case xe.invalid_union_discriminator:r=`Invalid discriminator value. Expected ${Oe.joinValues(e.options)}`;break;case xe.invalid_enum_value:r=`Invalid enum value. Expected ${Oe.joinValues(e.options)}, received '${e.received}'`;break;case xe.invalid_arguments:r="Invalid function arguments";break;case xe.invalid_return_type:r="Invalid function return type";break;case xe.invalid_date:r="Invalid date";break;case xe.invalid_string:"object"==typeof e.validation?"includes"in e.validation?(r=`Invalid input: must include "${e.validation.includes}"`,"number"==typeof e.validation.position&&(r=`${r} at one or more positions greater than or equal to ${e.validation.position}`)):"startsWith"in e.validation?r=`Invalid input: must start with "${e.validation.startsWith}"`:"endsWith"in e.validation?r=`Invalid input: must end with "${e.validation.endsWith}"`:Oe.assertNever(e.validation):r="regex"!==e.validation?`Invalid ${e.validation}`:"Invalid";break;case xe.too_small:r="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at least":"more than"} ${e.minimum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at least":"over"} ${e.minimum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:"date"===e.type?`Date must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(e.minimum))}`:"Invalid input";break;case xe.too_big:r="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at most":"less than"} ${e.maximum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at most":"under"} ${e.maximum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"bigint"===e.type?`BigInt must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"date"===e.type?`Date must be ${e.exact?"exactly":e.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(e.maximum))}`:"Invalid input";break;case xe.custom:r="Invalid input";break;case xe.invalid_intersection_types:r="Intersection results could not be merged";break;case xe.not_multiple_of:r=`Number must be a multiple of ${e.multipleOf}`;break;case xe.not_finite:r="Number must be finite";break;default:r=t.defaultError,Oe.assertNever(e)}return{message:r}};let Le=Be;function $e(){return Le}const Ue=e=>{const{data:t,path:r,errorMaps:n,issueData:s}=e,i=[...r,...s.path||[]],o={...s,path:i};let a="";const u=n.filter((e=>!!e)).slice().reverse();for(const e of u)a=e(o,{data:t,defaultError:a}).message;return{...s,path:i,message:s.message||a}};function De(e,t){const r=Ue({issueData:t,data:e.data,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,$e(),Be].filter((e=>!!e))});e.common.issues.push(r)}class je{constructor(){this.value="valid"}dirty(){"valid"===this.value&&(this.value="dirty")}abort(){"aborted"!==this.value&&(this.value="aborted")}static mergeArray(e,t){const r=[];for(const n of t){if("aborted"===n.status)return Me;"dirty"===n.status&&e.dirty(),r.push(n.value)}return{status:e.value,value:r}}static async mergeObjectAsync(e,t){const r=[];for(const e of t)r.push({key:await e.key,value:await e.value});return je.mergeObjectSync(e,r)}static mergeObjectSync(e,t){const r={};for(const n of t){const{key:t,value:s}=n;if("aborted"===t.status)return Me;if("aborted"===s.status)return Me;"dirty"===t.status&&e.dirty(),"dirty"===s.status&&e.dirty(),"__proto__"===t.value||void 0===s.value&&!n.alwaysSet||(r[t.value]=s.value)}return{status:e.value,value:r}}}const Me=Object.freeze({status:"aborted"}),He=e=>({status:"dirty",value:e}),Fe=e=>({status:"valid",value:e}),Ke=e=>"aborted"===e.status,Ge=e=>"dirty"===e.status,Ve=e=>"valid"===e.status,Xe=e=>"undefined"!=typeof Promise&&e instanceof Promise;var We;!function(e){e.errToObj=e=>"string"==typeof e?{message:e}:e||{},e.toString=e=>"string"==typeof e?e:null==e?void 0:e.message}(We||(We={}));class qe{constructor(e,t,r,n){this._cachedPath=[],this.parent=e,this.data=t,this._path=r,this._key=n}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const Ze=(e,t)=>{if(Ve(t))return{success:!0,data:t.value};if(!e.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const t=new Ce(e.common.issues);return this._error=t,this._error}}};function Ye(e){if(!e)return{};const{errorMap:t,invalid_type_error:r,required_error:n,description:s}=e;if(t&&(r||n))throw new Error('Can\'t use "invalid_type_error" or "required_error" in conjunction with custom error map.');if(t)return{errorMap:t,description:s};return{errorMap:(e,t)=>"invalid_type"!==e.code?{message:t.defaultError}:void 0===t.data?{message:null!=n?n:t.defaultError}:{message:null!=r?r:t.defaultError},description:s}}class ze{constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this)}get description(){return this._def.description}_getType(e){return Pe(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:Pe(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new je,ctx:{common:e.parent.common,data:e.data,parsedType:Pe(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const t=this._parse(e);if(Xe(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){const t=this._parse(e);return Promise.resolve(t)}parse(e,t){const r=this.safeParse(e,t);if(r.success)return r.data;throw r.error}safeParse(e,t){var r;const n={common:{issues:[],async:null!==(r=null==t?void 0:t.async)&&void 0!==r&&r,contextualErrorMap:null==t?void 0:t.errorMap},path:(null==t?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Pe(e)},s=this._parseSync({data:e,path:n.path,parent:n});return Ze(n,s)}async parseAsync(e,t){const r=await this.safeParseAsync(e,t);if(r.success)return r.data;throw r.error}async safeParseAsync(e,t){const r={common:{issues:[],contextualErrorMap:null==t?void 0:t.errorMap,async:!0},path:(null==t?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Pe(e)},n=this._parse({data:e,path:r.path,parent:r}),s=await(Xe(n)?n:Promise.resolve(n));return Ze(r,s)}refine(e,t){const r=e=>"string"==typeof t||void 0===t?{message:t}:"function"==typeof t?t(e):t;return this._refinement(((t,n)=>{const s=e(t),i=()=>n.addIssue({code:xe.custom,...r(t)});return"undefined"!=typeof Promise&&s instanceof Promise?s.then((e=>!!e||(i(),!1))):!!s||(i(),!1)}))}refinement(e,t){return this._refinement(((r,n)=>!!e(r)||(n.addIssue("function"==typeof t?t(r,n):t),!1)))}_refinement(e){return new jt({schema:this,typeName:zt.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}optional(){return Mt.create(this,this._def)}nullable(){return Ht.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return _t.create(this,this._def)}promise(){return Dt.create(this,this._def)}or(e){return St.create([this,e],this._def)}and(e){return Ot.create(this,e,this._def)}transform(e){return new jt({...Ye(this._def),schema:this,typeName:zt.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const t="function"==typeof e?e:()=>e;return new Ft({...Ye(this._def),innerType:this,defaultValue:t,typeName:zt.ZodDefault})}brand(){return new Xt({typeName:zt.ZodBranded,type:this,...Ye(this._def)})}catch(e){const t="function"==typeof e?e:()=>e;return new Kt({...Ye(this._def),innerType:this,catchValue:t,typeName:zt.ZodCatch})}describe(e){return new(0,this.constructor)({...this._def,description:e})}pipe(e){return Wt.create(this,e)}readonly(){return qt.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const Je=/^c[^\s-]{8,}$/i,Qe=/^[a-z][a-z0-9]*$/,et=/^[0-9A-HJKMNP-TV-Z]{26}$/,tt=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,rt=/^(?!\.)(?!.*\.\.)([A-Z0-9_+-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i;let nt;const st=/^(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))$/,it=/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/;function ot(e,t){return!("v4"!==t&&t||!st.test(e))||!("v6"!==t&&t||!it.test(e))}class at extends ze{_parse(e){this._def.coerce&&(e.data=String(e.data));if(this._getType(e)!==Ne.string){const t=this._getOrReturnCtx(e);return De(t,{code:xe.invalid_type,expected:Ne.string,received:t.parsedType}),Me}const t=new je;let r;for(const s of this._def.checks)if("min"===s.kind)e.data.length<s.value&&(r=this._getOrReturnCtx(e,r),De(r,{code:xe.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),t.dirty());else if("max"===s.kind)e.data.length>s.value&&(r=this._getOrReturnCtx(e,r),De(r,{code:xe.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),t.dirty());else if("length"===s.kind){const n=e.data.length>s.value,i=e.data.length<s.value;(n||i)&&(r=this._getOrReturnCtx(e,r),n?De(r,{code:xe.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}):i&&De(r,{code:xe.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}),t.dirty())}else if("email"===s.kind)rt.test(e.data)||(r=this._getOrReturnCtx(e,r),De(r,{validation:"email",code:xe.invalid_string,message:s.message}),t.dirty());else if("emoji"===s.kind)nt||(nt=new RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),nt.test(e.data)||(r=this._getOrReturnCtx(e,r),De(r,{validation:"emoji",code:xe.invalid_string,message:s.message}),t.dirty());else if("uuid"===s.kind)tt.test(e.data)||(r=this._getOrReturnCtx(e,r),De(r,{validation:"uuid",code:xe.invalid_string,message:s.message}),t.dirty());else if("cuid"===s.kind)Je.test(e.data)||(r=this._getOrReturnCtx(e,r),De(r,{validation:"cuid",code:xe.invalid_string,message:s.message}),t.dirty());else if("cuid2"===s.kind)Qe.test(e.data)||(r=this._getOrReturnCtx(e,r),De(r,{validation:"cuid2",code:xe.invalid_string,message:s.message}),t.dirty());else if("ulid"===s.kind)et.test(e.data)||(r=this._getOrReturnCtx(e,r),De(r,{validation:"ulid",code:xe.invalid_string,message:s.message}),t.dirty());else if("url"===s.kind)try{new URL(e.data)}catch(n){r=this._getOrReturnCtx(e,r),De(r,{validation:"url",code:xe.invalid_string,message:s.message}),t.dirty()}else if("regex"===s.kind){s.regex.lastIndex=0;s.regex.test(e.data)||(r=this._getOrReturnCtx(e,r),De(r,{validation:"regex",code:xe.invalid_string,message:s.message}),t.dirty())}else if("trim"===s.kind)e.data=e.data.trim();else if("includes"===s.kind)e.data.includes(s.value,s.position)||(r=this._getOrReturnCtx(e,r),De(r,{code:xe.invalid_string,validation:{includes:s.value,position:s.position},message:s.message}),t.dirty());else if("toLowerCase"===s.kind)e.data=e.data.toLowerCase();else if("toUpperCase"===s.kind)e.data=e.data.toUpperCase();else if("startsWith"===s.kind)e.data.startsWith(s.value)||(r=this._getOrReturnCtx(e,r),De(r,{code:xe.invalid_string,validation:{startsWith:s.value},message:s.message}),t.dirty());else if("endsWith"===s.kind)e.data.endsWith(s.value)||(r=this._getOrReturnCtx(e,r),De(r,{code:xe.invalid_string,validation:{endsWith:s.value},message:s.message}),t.dirty());else if("datetime"===s.kind){((n=s).precision?n.offset?new RegExp(`^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\\.\\d{${n.precision}}(([+-]\\d{2}(:?\\d{2})?)|Z)$`):new RegExp(`^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\\.\\d{${n.precision}}Z$`):0===n.precision?n.offset?new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(([+-]\\d{2}(:?\\d{2})?)|Z)$"):new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}Z$"):n.offset?new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(\\.\\d+)?(([+-]\\d{2}(:?\\d{2})?)|Z)$"):new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(\\.\\d+)?Z$")).test(e.data)||(r=this._getOrReturnCtx(e,r),De(r,{code:xe.invalid_string,validation:"datetime",message:s.message}),t.dirty())}else"ip"===s.kind?ot(e.data,s.version)||(r=this._getOrReturnCtx(e,r),De(r,{validation:"ip",code:xe.invalid_string,message:s.message}),t.dirty()):Oe.assertNever(s);var n;return{status:t.value,value:e.data}}_regex(e,t,r){return this.refinement((t=>e.test(t)),{validation:t,code:xe.invalid_string,...We.errToObj(r)})}_addCheck(e){return new at({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...We.errToObj(e)})}url(e){return this._addCheck({kind:"url",...We.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...We.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...We.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...We.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...We.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...We.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...We.errToObj(e)})}datetime(e){var t;return"string"==typeof e?this._addCheck({kind:"datetime",precision:null,offset:!1,message:e}):this._addCheck({kind:"datetime",precision:void 0===(null==e?void 0:e.precision)?null:null==e?void 0:e.precision,offset:null!==(t=null==e?void 0:e.offset)&&void 0!==t&&t,...We.errToObj(null==e?void 0:e.message)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...We.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:null==t?void 0:t.position,...We.errToObj(null==t?void 0:t.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...We.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...We.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...We.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...We.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...We.errToObj(t)})}nonempty(e){return this.min(1,We.errToObj(e))}trim(){return new at({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new at({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new at({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find((e=>"datetime"===e.kind))}get isEmail(){return!!this._def.checks.find((e=>"email"===e.kind))}get isURL(){return!!this._def.checks.find((e=>"url"===e.kind))}get isEmoji(){return!!this._def.checks.find((e=>"emoji"===e.kind))}get isUUID(){return!!this._def.checks.find((e=>"uuid"===e.kind))}get isCUID(){return!!this._def.checks.find((e=>"cuid"===e.kind))}get isCUID2(){return!!this._def.checks.find((e=>"cuid2"===e.kind))}get isULID(){return!!this._def.checks.find((e=>"ulid"===e.kind))}get isIP(){return!!this._def.checks.find((e=>"ip"===e.kind))}get minLength(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}function ut(e,t){const r=(e.toString().split(".")[1]||"").length,n=(t.toString().split(".")[1]||"").length,s=r>n?r:n;return parseInt(e.toFixed(s).replace(".",""))%parseInt(t.toFixed(s).replace(".",""))/Math.pow(10,s)}at.create=e=>{var t;return new at({checks:[],typeName:zt.ZodString,coerce:null!==(t=null==e?void 0:e.coerce)&&void 0!==t&&t,...Ye(e)})};class ct extends ze{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){this._def.coerce&&(e.data=Number(e.data));if(this._getType(e)!==Ne.number){const t=this._getOrReturnCtx(e);return De(t,{code:xe.invalid_type,expected:Ne.number,received:t.parsedType}),Me}let t;const r=new je;for(const n of this._def.checks)if("int"===n.kind)Oe.isInteger(e.data)||(t=this._getOrReturnCtx(e,t),De(t,{code:xe.invalid_type,expected:"integer",received:"float",message:n.message}),r.dirty());else if("min"===n.kind){(n.inclusive?e.data<n.value:e.data<=n.value)&&(t=this._getOrReturnCtx(e,t),De(t,{code:xe.too_small,minimum:n.value,type:"number",inclusive:n.inclusive,exact:!1,message:n.message}),r.dirty())}else if("max"===n.kind){(n.inclusive?e.data>n.value:e.data>=n.value)&&(t=this._getOrReturnCtx(e,t),De(t,{code:xe.too_big,maximum:n.value,type:"number",inclusive:n.inclusive,exact:!1,message:n.message}),r.dirty())}else"multipleOf"===n.kind?0!==ut(e.data,n.value)&&(t=this._getOrReturnCtx(e,t),De(t,{code:xe.not_multiple_of,multipleOf:n.value,message:n.message}),r.dirty()):"finite"===n.kind?Number.isFinite(e.data)||(t=this._getOrReturnCtx(e,t),De(t,{code:xe.not_finite,message:n.message}),r.dirty()):Oe.assertNever(n);return{status:r.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,We.toString(t))}gt(e,t){return this.setLimit("min",e,!1,We.toString(t))}lte(e,t){return this.setLimit("max",e,!0,We.toString(t))}lt(e,t){return this.setLimit("max",e,!1,We.toString(t))}setLimit(e,t,r,n){return new ct({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:We.toString(n)}]})}_addCheck(e){return new ct({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:We.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:We.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:We.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:We.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:We.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:We.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:We.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:We.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:We.toString(e)})}get minValue(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find((e=>"int"===e.kind||"multipleOf"===e.kind&&Oe.isInteger(e.value)))}get isFinite(){let e=null,t=null;for(const r of this._def.checks){if("finite"===r.kind||"int"===r.kind||"multipleOf"===r.kind)return!0;"min"===r.kind?(null===t||r.value>t)&&(t=r.value):"max"===r.kind&&(null===e||r.value<e)&&(e=r.value)}return Number.isFinite(t)&&Number.isFinite(e)}}ct.create=e=>new ct({checks:[],typeName:zt.ZodNumber,coerce:(null==e?void 0:e.coerce)||!1,...Ye(e)});class lt extends ze{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){this._def.coerce&&(e.data=BigInt(e.data));if(this._getType(e)!==Ne.bigint){const t=this._getOrReturnCtx(e);return De(t,{code:xe.invalid_type,expected:Ne.bigint,received:t.parsedType}),Me}let t;const r=new je;for(const n of this._def.checks)if("min"===n.kind){(n.inclusive?e.data<n.value:e.data<=n.value)&&(t=this._getOrReturnCtx(e,t),De(t,{code:xe.too_small,type:"bigint",minimum:n.value,inclusive:n.inclusive,message:n.message}),r.dirty())}else if("max"===n.kind){(n.inclusive?e.data>n.value:e.data>=n.value)&&(t=this._getOrReturnCtx(e,t),De(t,{code:xe.too_big,type:"bigint",maximum:n.value,inclusive:n.inclusive,message:n.message}),r.dirty())}else"multipleOf"===n.kind?e.data%n.value!==BigInt(0)&&(t=this._getOrReturnCtx(e,t),De(t,{code:xe.not_multiple_of,multipleOf:n.value,message:n.message}),r.dirty()):Oe.assertNever(n);return{status:r.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,We.toString(t))}gt(e,t){return this.setLimit("min",e,!1,We.toString(t))}lte(e,t){return this.setLimit("max",e,!0,We.toString(t))}lt(e,t){return this.setLimit("max",e,!1,We.toString(t))}setLimit(e,t,r,n){return new lt({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:We.toString(n)}]})}_addCheck(e){return new lt({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:We.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:We.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:We.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:We.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:We.toString(t)})}get minValue(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}lt.create=e=>{var t;return new lt({checks:[],typeName:zt.ZodBigInt,coerce:null!==(t=null==e?void 0:e.coerce)&&void 0!==t&&t,...Ye(e)})};class ft extends ze{_parse(e){this._def.coerce&&(e.data=Boolean(e.data));if(this._getType(e)!==Ne.boolean){const t=this._getOrReturnCtx(e);return De(t,{code:xe.invalid_type,expected:Ne.boolean,received:t.parsedType}),Me}return Fe(e.data)}}ft.create=e=>new ft({typeName:zt.ZodBoolean,coerce:(null==e?void 0:e.coerce)||!1,...Ye(e)});class pt extends ze{_parse(e){this._def.coerce&&(e.data=new Date(e.data));if(this._getType(e)!==Ne.date){const t=this._getOrReturnCtx(e);return De(t,{code:xe.invalid_type,expected:Ne.date,received:t.parsedType}),Me}if(isNaN(e.data.getTime())){return De(this._getOrReturnCtx(e),{code:xe.invalid_date}),Me}const t=new je;let r;for(const n of this._def.checks)"min"===n.kind?e.data.getTime()<n.value&&(r=this._getOrReturnCtx(e,r),De(r,{code:xe.too_small,message:n.message,inclusive:!0,exact:!1,minimum:n.value,type:"date"}),t.dirty()):"max"===n.kind?e.data.getTime()>n.value&&(r=this._getOrReturnCtx(e,r),De(r,{code:xe.too_big,message:n.message,inclusive:!0,exact:!1,maximum:n.value,type:"date"}),t.dirty()):Oe.assertNever(n);return{status:t.value,value:new Date(e.data.getTime())}}_addCheck(e){return new pt({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:We.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:We.toString(t)})}get minDate(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return null!=e?new Date(e):null}get maxDate(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return null!=e?new Date(e):null}}pt.create=e=>new pt({checks:[],coerce:(null==e?void 0:e.coerce)||!1,typeName:zt.ZodDate,...Ye(e)});class ht extends ze{_parse(e){if(this._getType(e)!==Ne.symbol){const t=this._getOrReturnCtx(e);return De(t,{code:xe.invalid_type,expected:Ne.symbol,received:t.parsedType}),Me}return Fe(e.data)}}ht.create=e=>new ht({typeName:zt.ZodSymbol,...Ye(e)});class dt extends ze{_parse(e){if(this._getType(e)!==Ne.undefined){const t=this._getOrReturnCtx(e);return De(t,{code:xe.invalid_type,expected:Ne.undefined,received:t.parsedType}),Me}return Fe(e.data)}}dt.create=e=>new dt({typeName:zt.ZodUndefined,...Ye(e)});class mt extends ze{_parse(e){if(this._getType(e)!==Ne.null){const t=this._getOrReturnCtx(e);return De(t,{code:xe.invalid_type,expected:Ne.null,received:t.parsedType}),Me}return Fe(e.data)}}mt.create=e=>new mt({typeName:zt.ZodNull,...Ye(e)});class yt extends ze{constructor(){super(...arguments),this._any=!0}_parse(e){return Fe(e.data)}}yt.create=e=>new yt({typeName:zt.ZodAny,...Ye(e)});class gt extends ze{constructor(){super(...arguments),this._unknown=!0}_parse(e){return Fe(e.data)}}gt.create=e=>new gt({typeName:zt.ZodUnknown,...Ye(e)});class bt extends ze{_parse(e){const t=this._getOrReturnCtx(e);return De(t,{code:xe.invalid_type,expected:Ne.never,received:t.parsedType}),Me}}bt.create=e=>new bt({typeName:zt.ZodNever,...Ye(e)});class vt extends ze{_parse(e){if(this._getType(e)!==Ne.undefined){const t=this._getOrReturnCtx(e);return De(t,{code:xe.invalid_type,expected:Ne.void,received:t.parsedType}),Me}return Fe(e.data)}}vt.create=e=>new vt({typeName:zt.ZodVoid,...Ye(e)});class _t extends ze{_parse(e){const{ctx:t,status:r}=this._processInputParams(e),n=this._def;if(t.parsedType!==Ne.array)return De(t,{code:xe.invalid_type,expected:Ne.array,received:t.parsedType}),Me;if(null!==n.exactLength){const e=t.data.length>n.exactLength.value,s=t.data.length<n.exactLength.value;(e||s)&&(De(t,{code:e?xe.too_big:xe.too_small,minimum:s?n.exactLength.value:void 0,maximum:e?n.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:n.exactLength.message}),r.dirty())}if(null!==n.minLength&&t.data.length<n.minLength.value&&(De(t,{code:xe.too_small,minimum:n.minLength.value,type:"array",inclusive:!0,exact:!1,message:n.minLength.message}),r.dirty()),null!==n.maxLength&&t.data.length>n.maxLength.value&&(De(t,{code:xe.too_big,maximum:n.maxLength.value,type:"array",inclusive:!0,exact:!1,message:n.maxLength.message}),r.dirty()),t.common.async)return Promise.all([...t.data].map(((e,r)=>n.type._parseAsync(new qe(t,e,t.path,r))))).then((e=>je.mergeArray(r,e)));const s=[...t.data].map(((e,r)=>n.type._parseSync(new qe(t,e,t.path,r))));return je.mergeArray(r,s)}get element(){return this._def.type}min(e,t){return new _t({...this._def,minLength:{value:e,message:We.toString(t)}})}max(e,t){return new _t({...this._def,maxLength:{value:e,message:We.toString(t)}})}length(e,t){return new _t({...this._def,exactLength:{value:e,message:We.toString(t)}})}nonempty(e){return this.min(1,e)}}function wt(e){if(e instanceof Et){const t={};for(const r in e.shape){const n=e.shape[r];t[r]=Mt.create(wt(n))}return new Et({...e._def,shape:()=>t})}return e instanceof _t?new _t({...e._def,type:wt(e.element)}):e instanceof Mt?Mt.create(wt(e.unwrap())):e instanceof Ht?Ht.create(wt(e.unwrap())):e instanceof kt?kt.create(e.items.map((e=>wt(e)))):e}_t.create=(e,t)=>new _t({type:e,minLength:null,maxLength:null,exactLength:null,typeName:zt.ZodArray,...Ye(t)});class Et extends ze{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(null!==this._cached)return this._cached;const e=this._def.shape(),t=Oe.objectKeys(e);return this._cached={shape:e,keys:t}}_parse(e){if(this._getType(e)!==Ne.object){const t=this._getOrReturnCtx(e);return De(t,{code:xe.invalid_type,expected:Ne.object,received:t.parsedType}),Me}const{status:t,ctx:r}=this._processInputParams(e),{shape:n,keys:s}=this._getCached(),i=[];if(!(this._def.catchall instanceof bt&&"strip"===this._def.unknownKeys))for(const e in r.data)s.includes(e)||i.push(e);const o=[];for(const e of s){const t=n[e],s=r.data[e];o.push({key:{status:"valid",value:e},value:t._parse(new qe(r,s,r.path,e)),alwaysSet:e in r.data})}if(this._def.catchall instanceof bt){const e=this._def.unknownKeys;if("passthrough"===e)for(const e of i)o.push({key:{status:"valid",value:e},value:{status:"valid",value:r.data[e]}});else if("strict"===e)i.length>0&&(De(r,{code:xe.unrecognized_keys,keys:i}),t.dirty());else if("strip"!==e)throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const e=this._def.catchall;for(const t of i){const n=r.data[t];o.push({key:{status:"valid",value:t},value:e._parse(new qe(r,n,r.path,t)),alwaysSet:t in r.data})}}return r.common.async?Promise.resolve().then((async()=>{const e=[];for(const t of o){const r=await t.key;e.push({key:r,value:await t.value,alwaysSet:t.alwaysSet})}return e})).then((e=>je.mergeObjectSync(t,e))):je.mergeObjectSync(t,o)}get shape(){return this._def.shape()}strict(e){return We.errToObj,new Et({...this._def,unknownKeys:"strict",...void 0!==e?{errorMap:(t,r)=>{var n,s,i,o;const a=null!==(i=null===(s=(n=this._def).errorMap)||void 0===s?void 0:s.call(n,t,r).message)&&void 0!==i?i:r.defaultError;return"unrecognized_keys"===t.code?{message:null!==(o=We.errToObj(e).message)&&void 0!==o?o:a}:{message:a}}}:{}})}strip(){return new Et({...this._def,unknownKeys:"strip"})}passthrough(){return new Et({...this._def,unknownKeys:"passthrough"})}extend(e){return new Et({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new Et({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:zt.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new Et({...this._def,catchall:e})}pick(e){const t={};return Oe.objectKeys(e).forEach((r=>{e[r]&&this.shape[r]&&(t[r]=this.shape[r])})),new Et({...this._def,shape:()=>t})}omit(e){const t={};return Oe.objectKeys(this.shape).forEach((r=>{e[r]||(t[r]=this.shape[r])})),new Et({...this._def,shape:()=>t})}deepPartial(){return wt(this)}partial(e){const t={};return Oe.objectKeys(this.shape).forEach((r=>{const n=this.shape[r];e&&!e[r]?t[r]=n:t[r]=n.optional()})),new Et({...this._def,shape:()=>t})}required(e){const t={};return Oe.objectKeys(this.shape).forEach((r=>{if(e&&!e[r])t[r]=this.shape[r];else{let e=this.shape[r];for(;e instanceof Mt;)e=e._def.innerType;t[r]=e}})),new Et({...this._def,shape:()=>t})}keyof(){return Lt(Oe.objectKeys(this.shape))}}Et.create=(e,t)=>new Et({shape:()=>e,unknownKeys:"strip",catchall:bt.create(),typeName:zt.ZodObject,...Ye(t)}),Et.strictCreate=(e,t)=>new Et({shape:()=>e,unknownKeys:"strict",catchall:bt.create(),typeName:zt.ZodObject,...Ye(t)}),Et.lazycreate=(e,t)=>new Et({shape:e,unknownKeys:"strip",catchall:bt.create(),typeName:zt.ZodObject,...Ye(t)});class St extends ze{_parse(e){const{ctx:t}=this._processInputParams(e),r=this._def.options;if(t.common.async)return Promise.all(r.map((async e=>{const r={...t,common:{...t.common,issues:[]},parent:null};return{result:await e._parseAsync({data:t.data,path:t.path,parent:r}),ctx:r}}))).then((function(e){for(const t of e)if("valid"===t.result.status)return t.result;for(const r of e)if("dirty"===r.result.status)return t.common.issues.push(...r.ctx.common.issues),r.result;const r=e.map((e=>new Ce(e.ctx.common.issues)));return De(t,{code:xe.invalid_union,unionErrors:r}),Me}));{let e;const n=[];for(const s of r){const r={...t,common:{...t.common,issues:[]},parent:null},i=s._parseSync({data:t.data,path:t.path,parent:r});if("valid"===i.status)return i;"dirty"!==i.status||e||(e={result:i,ctx:r}),r.common.issues.length&&n.push(r.common.issues)}if(e)return t.common.issues.push(...e.ctx.common.issues),e.result;const s=n.map((e=>new Ce(e)));return De(t,{code:xe.invalid_union,unionErrors:s}),Me}}get options(){return this._def.options}}St.create=(e,t)=>new St({options:e,typeName:zt.ZodUnion,...Ye(t)});const At=e=>e instanceof Ct?At(e.schema):e instanceof jt?At(e.innerType()):e instanceof Bt?[e.value]:e instanceof $t?e.options:e instanceof Ut?Object.keys(e.enum):e instanceof Ft?At(e._def.innerType):e instanceof dt?[void 0]:e instanceof mt?[null]:null;class Tt extends ze{_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==Ne.object)return De(t,{code:xe.invalid_type,expected:Ne.object,received:t.parsedType}),Me;const r=this.discriminator,n=t.data[r],s=this.optionsMap.get(n);return s?t.common.async?s._parseAsync({data:t.data,path:t.path,parent:t}):s._parseSync({data:t.data,path:t.path,parent:t}):(De(t,{code:xe.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[r]}),Me)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,r){const n=new Map;for(const r of t){const t=At(r.shape[e]);if(!t)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(const s of t){if(n.has(s))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(s)}`);n.set(s,r)}}return new Tt({typeName:zt.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:n,...Ye(r)})}}function It(e,t){const r=Pe(e),n=Pe(t);if(e===t)return{valid:!0,data:e};if(r===Ne.object&&n===Ne.object){const r=Oe.objectKeys(t),n=Oe.objectKeys(e).filter((e=>-1!==r.indexOf(e))),s={...e,...t};for(const r of n){const n=It(e[r],t[r]);if(!n.valid)return{valid:!1};s[r]=n.data}return{valid:!0,data:s}}if(r===Ne.array&&n===Ne.array){if(e.length!==t.length)return{valid:!1};const r=[];for(let n=0;n<e.length;n++){const s=It(e[n],t[n]);if(!s.valid)return{valid:!1};r.push(s.data)}return{valid:!0,data:r}}return r===Ne.date&&n===Ne.date&&+e==+t?{valid:!0,data:e}:{valid:!1}}class Ot extends ze{_parse(e){const{status:t,ctx:r}=this._processInputParams(e),n=(e,n)=>{if(Ke(e)||Ke(n))return Me;const s=It(e.value,n.value);return s.valid?((Ge(e)||Ge(n))&&t.dirty(),{status:t.value,value:s.data}):(De(r,{code:xe.invalid_intersection_types}),Me)};return r.common.async?Promise.all([this._def.left._parseAsync({data:r.data,path:r.path,parent:r}),this._def.right._parseAsync({data:r.data,path:r.path,parent:r})]).then((([e,t])=>n(e,t))):n(this._def.left._parseSync({data:r.data,path:r.path,parent:r}),this._def.right._parseSync({data:r.data,path:r.path,parent:r}))}}Ot.create=(e,t,r)=>new Ot({left:e,right:t,typeName:zt.ZodIntersection,...Ye(r)});class kt extends ze{_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==Ne.array)return De(r,{code:xe.invalid_type,expected:Ne.array,received:r.parsedType}),Me;if(r.data.length<this._def.items.length)return De(r,{code:xe.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),Me;!this._def.rest&&r.data.length>this._def.items.length&&(De(r,{code:xe.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());const n=[...r.data].map(((e,t)=>{const n=this._def.items[t]||this._def.rest;return n?n._parse(new qe(r,e,r.path,t)):null})).filter((e=>!!e));return r.common.async?Promise.all(n).then((e=>je.mergeArray(t,e))):je.mergeArray(t,n)}get items(){return this._def.items}rest(e){return new kt({...this._def,rest:e})}}kt.create=(e,t)=>{if(!Array.isArray(e))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new kt({items:e,typeName:zt.ZodTuple,rest:null,...Ye(t)})};class Rt extends ze{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==Ne.object)return De(r,{code:xe.invalid_type,expected:Ne.object,received:r.parsedType}),Me;const n=[],s=this._def.keyType,i=this._def.valueType;for(const e in r.data)n.push({key:s._parse(new qe(r,e,r.path,e)),value:i._parse(new qe(r,r.data[e],r.path,e))});return r.common.async?je.mergeObjectAsync(t,n):je.mergeObjectSync(t,n)}get element(){return this._def.valueType}static create(e,t,r){return new Rt(t instanceof ze?{keyType:e,valueType:t,typeName:zt.ZodRecord,...Ye(r)}:{keyType:at.create(),valueType:e,typeName:zt.ZodRecord,...Ye(t)})}}class Nt extends ze{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==Ne.map)return De(r,{code:xe.invalid_type,expected:Ne.map,received:r.parsedType}),Me;const n=this._def.keyType,s=this._def.valueType,i=[...r.data.entries()].map((([e,t],i)=>({key:n._parse(new qe(r,e,r.path,[i,"key"])),value:s._parse(new qe(r,t,r.path,[i,"value"]))})));if(r.common.async){const e=new Map;return Promise.resolve().then((async()=>{for(const r of i){const n=await r.key,s=await r.value;if("aborted"===n.status||"aborted"===s.status)return Me;"dirty"!==n.status&&"dirty"!==s.status||t.dirty(),e.set(n.value,s.value)}return{status:t.value,value:e}}))}{const e=new Map;for(const r of i){const n=r.key,s=r.value;if("aborted"===n.status||"aborted"===s.status)return Me;"dirty"!==n.status&&"dirty"!==s.status||t.dirty(),e.set(n.value,s.value)}return{status:t.value,value:e}}}}Nt.create=(e,t,r)=>new Nt({valueType:t,keyType:e,typeName:zt.ZodMap,...Ye(r)});class Pt extends ze{_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==Ne.set)return De(r,{code:xe.invalid_type,expected:Ne.set,received:r.parsedType}),Me;const n=this._def;null!==n.minSize&&r.data.size<n.minSize.value&&(De(r,{code:xe.too_small,minimum:n.minSize.value,type:"set",inclusive:!0,exact:!1,message:n.minSize.message}),t.dirty()),null!==n.maxSize&&r.data.size>n.maxSize.value&&(De(r,{code:xe.too_big,maximum:n.maxSize.value,type:"set",inclusive:!0,exact:!1,message:n.maxSize.message}),t.dirty());const s=this._def.valueType;function i(e){const r=new Set;for(const n of e){if("aborted"===n.status)return Me;"dirty"===n.status&&t.dirty(),r.add(n.value)}return{status:t.value,value:r}}const o=[...r.data.values()].map(((e,t)=>s._parse(new qe(r,e,r.path,t))));return r.common.async?Promise.all(o).then((e=>i(e))):i(o)}min(e,t){return new Pt({...this._def,minSize:{value:e,message:We.toString(t)}})}max(e,t){return new Pt({...this._def,maxSize:{value:e,message:We.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}Pt.create=(e,t)=>new Pt({valueType:e,minSize:null,maxSize:null,typeName:zt.ZodSet,...Ye(t)});class xt extends ze{constructor(){super(...arguments),this.validate=this.implement}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==Ne.function)return De(t,{code:xe.invalid_type,expected:Ne.function,received:t.parsedType}),Me;function r(e,r){return Ue({data:e,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,$e(),Be].filter((e=>!!e)),issueData:{code:xe.invalid_arguments,argumentsError:r}})}function n(e,r){return Ue({data:e,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,$e(),Be].filter((e=>!!e)),issueData:{code:xe.invalid_return_type,returnTypeError:r}})}const s={errorMap:t.common.contextualErrorMap},i=t.data;if(this._def.returns instanceof Dt){const e=this;return Fe((async function(...t){const o=new Ce([]),a=await e._def.args.parseAsync(t,s).catch((e=>{throw o.addIssue(r(t,e)),o})),u=await Reflect.apply(i,this,a);return await e._def.returns._def.type.parseAsync(u,s).catch((e=>{throw o.addIssue(n(u,e)),o}))}))}{const e=this;return Fe((function(...t){const o=e._def.args.safeParse(t,s);if(!o.success)throw new Ce([r(t,o.error)]);const a=Reflect.apply(i,this,o.data),u=e._def.returns.safeParse(a,s);if(!u.success)throw new Ce([n(a,u.error)]);return u.data}))}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new xt({...this._def,args:kt.create(e).rest(gt.create())})}returns(e){return new xt({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,r){return new xt({args:e||kt.create([]).rest(gt.create()),returns:t||gt.create(),typeName:zt.ZodFunction,...Ye(r)})}}class Ct extends ze{get schema(){return this._def.getter()}_parse(e){const{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}}Ct.create=(e,t)=>new Ct({getter:e,typeName:zt.ZodLazy,...Ye(t)});class Bt extends ze{_parse(e){if(e.data!==this._def.value){const t=this._getOrReturnCtx(e);return De(t,{received:t.data,code:xe.invalid_literal,expected:this._def.value}),Me}return{status:"valid",value:e.data}}get value(){return this._def.value}}function Lt(e,t){return new $t({values:e,typeName:zt.ZodEnum,...Ye(t)})}Bt.create=(e,t)=>new Bt({value:e,typeName:zt.ZodLiteral,...Ye(t)});class $t extends ze{_parse(e){if("string"!=typeof e.data){const t=this._getOrReturnCtx(e),r=this._def.values;return De(t,{expected:Oe.joinValues(r),received:t.parsedType,code:xe.invalid_type}),Me}if(-1===this._def.values.indexOf(e.data)){const t=this._getOrReturnCtx(e),r=this._def.values;return De(t,{received:t.data,code:xe.invalid_enum_value,options:r}),Me}return Fe(e.data)}get options(){return this._def.values}get enum(){const e={};for(const t of this._def.values)e[t]=t;return e}get Values(){const e={};for(const t of this._def.values)e[t]=t;return e}get Enum(){const e={};for(const t of this._def.values)e[t]=t;return e}extract(e){return $t.create(e)}exclude(e){return $t.create(this.options.filter((t=>!e.includes(t))))}}$t.create=Lt;class Ut extends ze{_parse(e){const t=Oe.getValidEnumValues(this._def.values),r=this._getOrReturnCtx(e);if(r.parsedType!==Ne.string&&r.parsedType!==Ne.number){const e=Oe.objectValues(t);return De(r,{expected:Oe.joinValues(e),received:r.parsedType,code:xe.invalid_type}),Me}if(-1===t.indexOf(e.data)){const e=Oe.objectValues(t);return De(r,{received:r.data,code:xe.invalid_enum_value,options:e}),Me}return Fe(e.data)}get enum(){return this._def.values}}Ut.create=(e,t)=>new Ut({values:e,typeName:zt.ZodNativeEnum,...Ye(t)});class Dt extends ze{unwrap(){return this._def.type}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==Ne.promise&&!1===t.common.async)return De(t,{code:xe.invalid_type,expected:Ne.promise,received:t.parsedType}),Me;const r=t.parsedType===Ne.promise?t.data:Promise.resolve(t.data);return Fe(r.then((e=>this._def.type.parseAsync(e,{path:t.path,errorMap:t.common.contextualErrorMap}))))}}Dt.create=(e,t)=>new Dt({type:e,typeName:zt.ZodPromise,...Ye(t)});class jt extends ze{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===zt.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:t,ctx:r}=this._processInputParams(e),n=this._def.effect||null,s={addIssue:e=>{De(r,e),e.fatal?t.abort():t.dirty()},get path(){return r.path}};if(s.addIssue=s.addIssue.bind(s),"preprocess"===n.type){const e=n.transform(r.data,s);return r.common.issues.length?{status:"dirty",value:r.data}:r.common.async?Promise.resolve(e).then((e=>this._def.schema._parseAsync({data:e,path:r.path,parent:r}))):this._def.schema._parseSync({data:e,path:r.path,parent:r})}if("refinement"===n.type){const e=e=>{const t=n.refinement(e,s);if(r.common.async)return Promise.resolve(t);if(t instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return e};if(!1===r.common.async){const n=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});return"aborted"===n.status?Me:("dirty"===n.status&&t.dirty(),e(n.value),{status:t.value,value:n.value})}return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then((r=>"aborted"===r.status?Me:("dirty"===r.status&&t.dirty(),e(r.value).then((()=>({status:t.value,value:r.value}))))))}if("transform"===n.type){if(!1===r.common.async){const e=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});if(!Ve(e))return e;const i=n.transform(e.value,s);if(i instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:i}}return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then((e=>Ve(e)?Promise.resolve(n.transform(e.value,s)).then((e=>({status:t.value,value:e}))):e))}Oe.assertNever(n)}}jt.create=(e,t,r)=>new jt({schema:e,typeName:zt.ZodEffects,effect:t,...Ye(r)}),jt.createWithPreprocess=(e,t,r)=>new jt({schema:t,effect:{type:"preprocess",transform:e},typeName:zt.ZodEffects,...Ye(r)});class Mt extends ze{_parse(e){return this._getType(e)===Ne.undefined?Fe(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}Mt.create=(e,t)=>new Mt({innerType:e,typeName:zt.ZodOptional,...Ye(t)});class Ht extends ze{_parse(e){return this._getType(e)===Ne.null?Fe(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}Ht.create=(e,t)=>new Ht({innerType:e,typeName:zt.ZodNullable,...Ye(t)});class Ft extends ze{_parse(e){const{ctx:t}=this._processInputParams(e);let r=t.data;return t.parsedType===Ne.undefined&&(r=this._def.defaultValue()),this._def.innerType._parse({data:r,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}Ft.create=(e,t)=>new Ft({innerType:e,typeName:zt.ZodDefault,defaultValue:"function"==typeof t.default?t.default:()=>t.default,...Ye(t)});class Kt extends ze{_parse(e){const{ctx:t}=this._processInputParams(e),r={...t,common:{...t.common,issues:[]}},n=this._def.innerType._parse({data:r.data,path:r.path,parent:{...r}});return Xe(n)?n.then((e=>({status:"valid",value:"valid"===e.status?e.value:this._def.catchValue({get error(){return new Ce(r.common.issues)},input:r.data})}))):{status:"valid",value:"valid"===n.status?n.value:this._def.catchValue({get error(){return new Ce(r.common.issues)},input:r.data})}}removeCatch(){return this._def.innerType}}Kt.create=(e,t)=>new Kt({innerType:e,typeName:zt.ZodCatch,catchValue:"function"==typeof t.catch?t.catch:()=>t.catch,...Ye(t)});class Gt extends ze{_parse(e){if(this._getType(e)!==Ne.nan){const t=this._getOrReturnCtx(e);return De(t,{code:xe.invalid_type,expected:Ne.nan,received:t.parsedType}),Me}return{status:"valid",value:e.data}}}Gt.create=e=>new Gt({typeName:zt.ZodNaN,...Ye(e)});const Vt=Symbol("zod_brand");class Xt extends ze{_parse(e){const{ctx:t}=this._processInputParams(e),r=t.data;return this._def.type._parse({data:r,path:t.path,parent:t})}unwrap(){return this._def.type}}class Wt extends ze{_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.common.async){return(async()=>{const e=await this._def.in._parseAsync({data:r.data,path:r.path,parent:r});return"aborted"===e.status?Me:"dirty"===e.status?(t.dirty(),He(e.value)):this._def.out._parseAsync({data:e.value,path:r.path,parent:r})})()}{const e=this._def.in._parseSync({data:r.data,path:r.path,parent:r});return"aborted"===e.status?Me:"dirty"===e.status?(t.dirty(),{status:"dirty",value:e.value}):this._def.out._parseSync({data:e.value,path:r.path,parent:r})}}static create(e,t){return new Wt({in:e,out:t,typeName:zt.ZodPipeline})}}class qt extends ze{_parse(e){const t=this._def.innerType._parse(e);return Ve(t)&&(t.value=Object.freeze(t.value)),t}}qt.create=(e,t)=>new qt({innerType:e,typeName:zt.ZodReadonly,...Ye(t)});const Zt=(e,t={},r)=>e?yt.create().superRefine(((n,s)=>{var i,o;if(!e(n)){const e="function"==typeof t?t(n):"string"==typeof t?{message:t}:t,a=null===(o=null!==(i=e.fatal)&&void 0!==i?i:r)||void 0===o||o,u="string"==typeof e?{message:e}:e;s.addIssue({code:"custom",...u,fatal:a})}})):yt.create(),Yt={object:Et.lazycreate};var zt;!function(e){e.ZodString="ZodString",e.ZodNumber="ZodNumber",e.ZodNaN="ZodNaN",e.ZodBigInt="ZodBigInt",e.ZodBoolean="ZodBoolean",e.ZodDate="ZodDate",e.ZodSymbol="ZodSymbol",e.ZodUndefined="ZodUndefined",e.ZodNull="ZodNull",e.ZodAny="ZodAny",e.ZodUnknown="ZodUnknown",e.ZodNever="ZodNever",e.ZodVoid="ZodVoid",e.ZodArray="ZodArray",e.ZodObject="ZodObject",e.ZodUnion="ZodUnion",e.ZodDiscriminatedUnion="ZodDiscriminatedUnion",e.ZodIntersection="ZodIntersection",e.ZodTuple="ZodTuple",e.ZodRecord="ZodRecord",e.ZodMap="ZodMap",e.ZodSet="ZodSet",e.ZodFunction="ZodFunction",e.ZodLazy="ZodLazy",e.ZodLiteral="ZodLiteral",e.ZodEnum="ZodEnum",e.ZodEffects="ZodEffects",e.ZodNativeEnum="ZodNativeEnum",e.ZodOptional="ZodOptional",e.ZodNullable="ZodNullable",e.ZodDefault="ZodDefault",e.ZodCatch="ZodCatch",e.ZodPromise="ZodPromise",e.ZodBranded="ZodBranded",e.ZodPipeline="ZodPipeline",e.ZodReadonly="ZodReadonly"}(zt||(zt={}));const Jt=at.create,Qt=ct.create,er=Gt.create,tr=lt.create,rr=ft.create,nr=pt.create,sr=ht.create,ir=dt.create,or=mt.create,ar=yt.create,ur=gt.create,cr=bt.create,lr=vt.create,fr=_t.create,pr=Et.create,hr=Et.strictCreate,dr=St.create,mr=Tt.create,yr=Ot.create,gr=kt.create,br=Rt.create,vr=Nt.create,_r=Pt.create,wr=xt.create,Er=Ct.create,Sr=Bt.create,Ar=$t.create,Tr=Ut.create,Ir=Dt.create,Or=jt.create,kr=Mt.create,Rr=Ht.create,Nr=jt.createWithPreprocess,Pr=Wt.create,xr={string:e=>at.create({...e,coerce:!0}),number:e=>ct.create({...e,coerce:!0}),boolean:e=>ft.create({...e,coerce:!0}),bigint:e=>lt.create({...e,coerce:!0}),date:e=>pt.create({...e,coerce:!0})},Cr=Me;var Br=Object.freeze({__proto__:null,defaultErrorMap:Be,setErrorMap:function(e){Le=e},getErrorMap:$e,makeIssue:Ue,EMPTY_PATH:[],addIssueToContext:De,ParseStatus:je,INVALID:Me,DIRTY:He,OK:Fe,isAborted:Ke,isDirty:Ge,isValid:Ve,isAsync:Xe,get util(){return Oe},get objectUtil(){return ke},ZodParsedType:Ne,getParsedType:Pe,ZodType:ze,ZodString:at,ZodNumber:ct,ZodBigInt:lt,ZodBoolean:ft,ZodDate:pt,ZodSymbol:ht,ZodUndefined:dt,ZodNull:mt,ZodAny:yt,ZodUnknown:gt,ZodNever:bt,ZodVoid:vt,ZodArray:_t,ZodObject:Et,ZodUnion:St,ZodDiscriminatedUnion:Tt,ZodIntersection:Ot,ZodTuple:kt,ZodRecord:Rt,ZodMap:Nt,ZodSet:Pt,ZodFunction:xt,ZodLazy:Ct,ZodLiteral:Bt,ZodEnum:$t,ZodNativeEnum:Ut,ZodPromise:Dt,ZodEffects:jt,ZodTransformer:jt,ZodOptional:Mt,ZodNullable:Ht,ZodDefault:Ft,ZodCatch:Kt,ZodNaN:Gt,BRAND:Vt,ZodBranded:Xt,ZodPipeline:Wt,ZodReadonly:qt,custom:Zt,Schema:ze,ZodSchema:ze,late:Yt,get ZodFirstPartyTypeKind(){return zt},coerce:xr,any:ar,array:fr,bigint:tr,boolean:rr,date:nr,discriminatedUnion:mr,effect:Or,enum:Ar,function:wr,instanceof:(e,t={message:`Input not instance of ${e.name}`})=>Zt((t=>t instanceof e),t),intersection:yr,lazy:Er,literal:Sr,map:vr,nan:er,nativeEnum:Tr,never:cr,null:or,nullable:Rr,number:Qt,object:pr,oboolean:()=>rr().optional(),onumber:()=>Qt().optional(),optional:kr,ostring:()=>Jt().optional(),pipeline:Pr,preprocess:Nr,promise:Ir,record:br,set:_r,strictObject:hr,string:Jt,symbol:sr,transformer:Or,tuple:gr,undefined:ir,union:dr,unknown:ur,void:lr,NEVER:Cr,ZodIssueCode:xe,quotelessJson:e=>JSON.stringify(e,null,2).replace(/"([^"]+)":/g,"$1:"),ZodError:Ce}),Lr=["interface","display","layout","module","panel","theme"],$r=["hook","endpoint"],Ur=["operation"],Dr="directus:extension",jr=Br.object({app:Br.string(),api:Br.string()}),Mr=Br.object({request:Br.optional(Br.object({urls:Br.array(Br.string()),methods:Br.array(Br.union([Br.literal("GET"),Br.literal("POST"),Br.literal("PATCH"),Br.literal("PUT"),Br.literal("DELETE")]))})),log:Br.optional(Br.object({})),sleep:Br.optional(Br.object({}))}),Hr=Br.optional(Br.object({enabled:Br.boolean(),requestedScopes:Mr})),Fr=Br.union([Br.object({type:Br.enum($r),name:Br.string(),source:Br.string()}),Br.object({type:Br.enum(Lr),name:Br.string(),source:Br.string()}),Br.object({type:Br.enum(Ur),name:Br.string(),source:jr})]),Kr=Br.object({host:Br.string(),hidden:Br.boolean().optional()}),Gr=Br.object({type:Br.enum(Lr),path:Br.string(),source:Br.string()}),Vr=Br.object({type:Br.enum($r),path:Br.string(),source:Br.string(),sandbox:Hr}),Xr=Br.object({type:Br.enum(Ur),path:jr,source:jr,sandbox:Hr}),Wr=Br.object({type:Br.literal("bundle"),partial:Br.boolean().optional(),path:jr,entries:Br.array(Fr)});Br.array(Fr);var qr=Kr.and(Br.union([Gr,Vr,Xr,Wr]));function Zr(e){const t=e.replace(/-/g,"+").replace(/_/g,"/"),r=(4-t.length%4)%4,n=t.padEnd(t.length+r,"="),s=atob(n),i=new ArrayBuffer(s.length),o=new Uint8Array(i);for(let e=0;e<s.length;e++)o[e]=s.charCodeAt(e);return i}function Yr(e){const t=new Uint8Array(e);let r="";for(let e=0;e<t.length;e++){const n=t[e];r+=String.fromCharCode(n)}return btoa(r).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function zr(e){const t=new Uint8Array(e.length/2);for(let r=0;r<e.length;r+=2)t[r/2]=parseInt(e.substring(r,r+2),16);return t.buffer}Br.object({name:Br.string(),version:Br.string(),type:Br.union([Br.literal("module"),Br.literal("commonjs")]).optional(),description:Br.string().optional(),icon:Br.string().optional(),dependencies:Br.record(Br.string()).optional(),devDependencies:Br.record(Br.string()).optional(),[Dr]:qr});var Jr="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},Qr={exports:{}};!function(e,t){var r,n="undefined"!=typeof self?self:Jr,s=function(){function e(){this.fetch=!1,this.DOMException=n.DOMException}return e.prototype=n,new e}();r=s,function(e){var t="URLSearchParams"in r,n="Symbol"in r&&"iterator"in Symbol,s="FileReader"in r&&"Blob"in r&&function(){try{return new Blob,!0}catch(e){return!1}}(),i="FormData"in r,o="ArrayBuffer"in r;if(o)var a=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],u=ArrayBuffer.isView||function(e){return e&&a.indexOf(Object.prototype.toString.call(e))>-1};function c(e){if("string"!=typeof e&&(e=String(e)),/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(e))throw new TypeError("Invalid character in header field name");return e.toLowerCase()}function l(e){return"string"!=typeof e&&(e=String(e)),e}function f(e){var t={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return n&&(t[Symbol.iterator]=function(){return t}),t}function p(e){this.map={},e instanceof p?e.forEach((function(e,t){this.append(t,e)}),this):Array.isArray(e)?e.forEach((function(e){this.append(e[0],e[1])}),this):e&&Object.getOwnPropertyNames(e).forEach((function(t){this.append(t,e[t])}),this)}function h(e){if(e.bodyUsed)return Promise.reject(new TypeError("Already read"));e.bodyUsed=!0}function d(e){return new Promise((function(t,r){e.onload=function(){t(e.result)},e.onerror=function(){r(e.error)}}))}function m(e){var t=new FileReader,r=d(t);return t.readAsArrayBuffer(e),r}function y(e){if(e.slice)return e.slice(0);var t=new Uint8Array(e.byteLength);return t.set(new Uint8Array(e)),t.buffer}function g(){return this.bodyUsed=!1,this._initBody=function(e){var r;this._bodyInit=e,e?"string"==typeof e?this._bodyText=e:s&&Blob.prototype.isPrototypeOf(e)?this._bodyBlob=e:i&&FormData.prototype.isPrototypeOf(e)?this._bodyFormData=e:t&&URLSearchParams.prototype.isPrototypeOf(e)?this._bodyText=e.toString():o&&s&&(r=e)&&DataView.prototype.isPrototypeOf(r)?(this._bodyArrayBuffer=y(e.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):o&&(ArrayBuffer.prototype.isPrototypeOf(e)||u(e))?this._bodyArrayBuffer=y(e):this._bodyText=e=Object.prototype.toString.call(e):this._bodyText="",this.headers.get("content-type")||("string"==typeof e?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):t&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},s&&(this.blob=function(){var e=h(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?h(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(m)}),this.text=function(){var e,t,r,n=h(this);if(n)return n;if(this._bodyBlob)return e=this._bodyBlob,t=new FileReader,r=d(t),t.readAsText(e),r;if(this._bodyArrayBuffer)return Promise.resolve(function(e){for(var t=new Uint8Array(e),r=new Array(t.length),n=0;n<t.length;n++)r[n]=String.fromCharCode(t[n]);return r.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},i&&(this.formData=function(){return this.text().then(_)}),this.json=function(){return this.text().then(JSON.parse)},this}p.prototype.append=function(e,t){e=c(e),t=l(t);var r=this.map[e];this.map[e]=r?r+", "+t:t},p.prototype.delete=function(e){delete this.map[c(e)]},p.prototype.get=function(e){return e=c(e),this.has(e)?this.map[e]:null},p.prototype.has=function(e){return this.map.hasOwnProperty(c(e))},p.prototype.set=function(e,t){this.map[c(e)]=l(t)},p.prototype.forEach=function(e,t){for(var r in this.map)this.map.hasOwnProperty(r)&&e.call(t,this.map[r],r,this)},p.prototype.keys=function(){var e=[];return this.forEach((function(t,r){e.push(r)})),f(e)},p.prototype.values=function(){var e=[];return this.forEach((function(t){e.push(t)})),f(e)},p.prototype.entries=function(){var e=[];return this.forEach((function(t,r){e.push([r,t])})),f(e)},n&&(p.prototype[Symbol.iterator]=p.prototype.entries);var b=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function v(e,t){var r,n,s=(t=t||{}).body;if(e instanceof v){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,t.headers||(this.headers=new p(e.headers)),this.method=e.method,this.mode=e.mode,this.signal=e.signal,s||null==e._bodyInit||(s=e._bodyInit,e.bodyUsed=!0)}else this.url=String(e);if(this.credentials=t.credentials||this.credentials||"same-origin",!t.headers&&this.headers||(this.headers=new p(t.headers)),this.method=(r=t.method||this.method||"GET",n=r.toUpperCase(),b.indexOf(n)>-1?n:r),this.mode=t.mode||this.mode||null,this.signal=t.signal||this.signal,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&s)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(s)}function _(e){var t=new FormData;return e.trim().split("&").forEach((function(e){if(e){var r=e.split("="),n=r.shift().replace(/\+/g," "),s=r.join("=").replace(/\+/g," ");t.append(decodeURIComponent(n),decodeURIComponent(s))}})),t}function w(e,t){t||(t={}),this.type="default",this.status=void 0===t.status?200:t.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in t?t.statusText:"OK",this.headers=new p(t.headers),this.url=t.url||"",this._initBody(e)}v.prototype.clone=function(){return new v(this,{body:this._bodyInit})},g.call(v.prototype),g.call(w.prototype),w.prototype.clone=function(){return new w(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new p(this.headers),url:this.url})},w.error=function(){var e=new w(null,{status:0,statusText:""});return e.type="error",e};var E=[301,302,303,307,308];w.redirect=function(e,t){if(-1===E.indexOf(t))throw new RangeError("Invalid status code");return new w(null,{status:t,headers:{location:e}})},e.DOMException=r.DOMException;try{new e.DOMException}catch(t){e.DOMException=function(e,t){this.message=e,this.name=t;var r=Error(e);this.stack=r.stack},e.DOMException.prototype=Object.create(Error.prototype),e.DOMException.prototype.constructor=e.DOMException}function S(t,r){return new Promise((function(n,i){var o=new v(t,r);if(o.signal&&o.signal.aborted)return i(new e.DOMException("Aborted","AbortError"));var a=new XMLHttpRequest;function u(){a.abort()}a.onload=function(){var e,t,r={status:a.status,statusText:a.statusText,headers:(e=a.getAllResponseHeaders()||"",t=new p,e.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach((function(e){var r=e.split(":"),n=r.shift().trim();if(n){var s=r.join(":").trim();t.append(n,s)}})),t)};r.url="responseURL"in a?a.responseURL:r.headers.get("X-Request-URL");var s="response"in a?a.response:a.responseText;n(new w(s,r))},a.onerror=function(){i(new TypeError("Network request failed"))},a.ontimeout=function(){i(new TypeError("Network request failed"))},a.onabort=function(){i(new e.DOMException("Aborted","AbortError"))},a.open(o.method,o.url,!0),"include"===o.credentials?a.withCredentials=!0:"omit"===o.credentials&&(a.withCredentials=!1),"responseType"in a&&s&&(a.responseType="blob"),o.headers.forEach((function(e,t){a.setRequestHeader(t,e)})),o.signal&&(o.signal.addEventListener("abort",u),a.onreadystatechange=function(){4===a.readyState&&o.signal.removeEventListener("abort",u)}),a.send(void 0===o._bodyInit?null:o._bodyInit)}))}S.polyfill=!0,r.fetch||(r.fetch=S,r.Headers=p,r.Request=v,r.Response=w),e.Headers=p,e.Request=v,e.Response=w,e.fetch=S,Object.defineProperty(e,"__esModule",{value:!0})}({}),s.fetch.ponyfill=!0,delete s.fetch.polyfill;var i=s;(t=i.fetch).default=i.fetch,t.fetch=i.fetch,t.Headers=i.Headers,t.Request=i.Request,t.Response=i.Response,e.exports=t}(Qr,Qr.exports);var en=(e=>(e[e.RS256=-257]="RS256",e[e.ES256=-7]="ES256",e))(en||{});const tn=async()=>{var e,t,r;if("undefined"!=typeof window&&(null==(e=window.crypto)?void 0:e.subtle))return window.crypto.subtle;if("undefined"!=typeof globalThis&&(null==(t=globalThis.crypto)?void 0:t.subtle))return globalThis.crypto.subtle;if("undefined"!=typeof process&&null!=process.versions&&null!=process.versions.node){const e="function"==typeof require?require("crypto"):await import("crypto");if(null==(r=null==e?void 0:e.webcrypto)?void 0:r.subtle)return e.webcrypto.subtle}throw new Error("SubtleCrypto is not available in this environment.")},rn=(e,t)=>{try{const r=function(e){let t="";for(let r=0;r<e.length;r+=2)t+=String.fromCharCode(parseInt(e.substr(r,2),16));return t}([...new Uint8Array(t)].map((e=>e.toString(16).padStart(2,"0"))).join(""));return JSON.parse(r).challenge===Yr(function(e){return(new TextEncoder).encode(e)}(e))}catch(e){return!1}},nn=async({message:e,signature:t,pubkey:r,challenge:n,alg:s})=>{const i=await tn();try{const o=zr(`${r}`),a=Zr(e),u=Zr(t),c=a.slice(0,37),l=a.slice(37);if(!rn(n,l))return!1;const f=function(e,t){const r=new Uint8Array(e.byteLength+t.byteLength);return r.set(new Uint8Array(e),0),r.set(new Uint8Array(t),e.byteLength),r.buffer}(c,await i.digest("SHA-256",l)),p=s===en.ES256,h=p?{kty:"EC",crv:"P-256",x:Yr(o.slice(0,32)),y:Yr(o.slice(32))}:{alg:"RS256",ext:!0,key_ops:["verify"],kty:"RSA",e:Yr(new Uint8Array(o.slice(0,3)).reverse()),n:Yr(new Uint8Array(o.slice(4)).reverse())},d=p?{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}}:{name:"RSASSA-PKCS1-v1_5",hash:"SHA-256"},m=await i.importKey("jwk",h,d,!1,["verify"]),y=await i.verify(d,m,s===en.RS256?u:function(e){const t=Array.from(new Uint8Array(e),(e=>`00${e.toString(16)}`.slice(-2))).join(""),r=2*parseInt(t.substr(6,2),16);let n=t.substr(8,r),s=t.substr(12+r);return n=n.length>64?n.substr(-64):n.padStart(64,"0"),s=s.length>64?s.substr(-64):s.padStart(64,"0"),new Uint8Array(`${n}${s}`.match(/[\da-f]{2}/gi).map((e=>parseInt(e,16))))}(u),f);return y}catch(e){return console.error(e),!1}},sn=async e=>{const{message:t,signature:r,pubkey:n,keyType:s}=e;return"main_key"===s||"sub_key"===s?nn(e):(async(e,t,r)=>{const n=await tn();try{const s="RSASSA-PKCS1-v1_5",i=zr(r),o=Zr(e),a=Zr(t),u=new Uint8Array(i.slice(0,3)).reverse(),c=new Uint8Array(i.slice(4)).reverse(),l={alg:"RS256",ext:!0,key_ops:["verify"],kty:"RSA",e:Yr(u),n:Yr(c)},f=await n.importKey("jwk",l,{name:s,hash:"SHA-256"},!1,["verify"]);return await n.verify(s,f,a,o)}catch(e){return console.error(e),!1}})(t,r,n)};var on={},an={},un={},cn={},ln={};Object.defineProperty(ln,"__esModule",{value:!0}),ln.testnet=ln.regtest=ln.bitcoin=void 0,ln.bitcoin={messagePrefix:"Bitcoin Signed Message:\n",bech32:"bc",bip32:{public:76067358,private:76066276},pubKeyHash:0,scriptHash:5,wif:128},ln.regtest={messagePrefix:"Bitcoin Signed Message:\n",bech32:"bcrt",bip32:{public:70617039,private:70615956},pubKeyHash:111,scriptHash:196,wif:239},ln.testnet={messagePrefix:"Bitcoin Signed Message:\n",bech32:"tb",bip32:{public:70617039,private:70615956},pubKeyHash:111,scriptHash:196,wif:239};var fn={},pn={},hn={},dn={};Object.defineProperty(dn,"__esModule",{value:!0}),dn.encode=dn.decode=dn.check=void 0,dn.check=function(e){if(e.length<8)return!1;if(e.length>72)return!1;if(48!==e[0])return!1;if(e[1]!==e.length-2)return!1;if(2!==e[2])return!1;const t=e[3];if(0===t)return!1;if(5+t>=e.length)return!1;if(2!==e[4+t])return!1;const r=e[5+t];return 0!==r&&(6+t+r===e.length&&(!(128&e[4])&&(!(t>1&&0===e[4]&&!(128&e[5]))&&(!(128&e[t+6])&&!(r>1&&0===e[t+6]&&!(128&e[t+7]))))))},dn.decode=function(e){if(e.length<8)throw new Error("DER sequence length is too short");if(e.length>72)throw new Error("DER sequence length is too long");if(48!==e[0])throw new Error("Expected DER sequence");if(e[1]!==e.length-2)throw new Error("DER sequence length is invalid");if(2!==e[2])throw new Error("Expected DER integer");const t=e[3];if(0===t)throw new Error("R length is zero");if(5+t>=e.length)throw new Error("R length is too long");if(2!==e[4+t])throw new Error("Expected DER integer (2)");const r=e[5+t];if(0===r)throw new Error("S length is zero");if(6+t+r!==e.length)throw new Error("S length is invalid");if(128&e[4])throw new Error("R value is negative");if(t>1&&0===e[4]&&!(128&e[5]))throw new Error("R value excessively padded");if(128&e[t+6])throw new Error("S value is negative");if(r>1&&0===e[t+6]&&!(128&e[t+7]))throw new Error("S value excessively padded");return{r:e.slice(4,4+t),s:e.slice(6+t)}},dn.encode=function(e,t){const r=e.length,n=t.length;if(0===r)throw new Error("R length is zero");if(0===n)throw new Error("S length is zero");if(r>33)throw new Error("R length is too long");if(n>33)throw new Error("S length is too long");if(128&e[0])throw new Error("R value is negative");if(128&t[0])throw new Error("S value is negative");if(r>1&&0===e[0]&&!(128&e[1]))throw new Error("R value excessively padded");if(n>1&&0===t[0]&&!(128&t[1]))throw new Error("S value excessively padded");const s=Buffer.allocUnsafe(6+r+n);return s[0]=48,s[1]=s.length-2,s[2]=2,s[3]=e.length,e.copy(s,4),s[4+r]=2,s[5+r]=t.length,t.copy(s,6+r),s};var mn={};Object.defineProperty(mn,"__esModule",{value:!0}),mn.REVERSE_OPS=mn.OPS=void 0;const yn={OP_FALSE:0,OP_0:0,OP_PUSHDATA1:76,OP_PUSHDATA2:77,OP_PUSHDATA4:78,OP_1NEGATE:79,OP_RESERVED:80,OP_TRUE:81,OP_1:81,OP_2:82,OP_3:83,OP_4:84,OP_5:85,OP_6:86,OP_7:87,OP_8:88,OP_9:89,OP_10:90,OP_11:91,OP_12:92,OP_13:93,OP_14:94,OP_15:95,OP_16:96,OP_NOP:97,OP_VER:98,OP_IF:99,OP_NOTIF:100,OP_VERIF:101,OP_VERNOTIF:102,OP_ELSE:103,OP_ENDIF:104,OP_VERIFY:105,OP_RETURN:106,OP_TOALTSTACK:107,OP_FROMALTSTACK:108,OP_2DROP:109,OP_2DUP:110,OP_3DUP:111,OP_2OVER:112,OP_2ROT:113,OP_2SWAP:114,OP_IFDUP:115,OP_DEPTH:116,OP_DROP:117,OP_DUP:118,OP_NIP:119,OP_OVER:120,OP_PICK:121,OP_ROLL:122,OP_ROT:123,OP_SWAP:124,OP_TUCK:125,OP_CAT:126,OP_SUBSTR:127,OP_LEFT:128,OP_RIGHT:129,OP_SIZE:130,OP_INVERT:131,OP_AND:132,OP_OR:133,OP_XOR:134,OP_EQUAL:135,OP_EQUALVERIFY:136,OP_RESERVED1:137,OP_RESERVED2:138,OP_1ADD:139,OP_1SUB:140,OP_2MUL:141,OP_2DIV:142,OP_NEGATE:143,OP_ABS:144,OP_NOT:145,OP_0NOTEQUAL:146,OP_ADD:147,OP_SUB:148,OP_MUL:149,OP_DIV:150,OP_MOD:151,OP_LSHIFT:152,OP_RSHIFT:153,OP_BOOLAND:154,OP_BOOLOR:155,OP_NUMEQUAL:156,OP_NUMEQUALVERIFY:157,OP_NUMNOTEQUAL:158,OP_LESSTHAN:159,OP_GREATERTHAN:160,OP_LESSTHANOREQUAL:161,OP_GREATERTHANOREQUAL:162,OP_MIN:163,OP_MAX:164,OP_WITHIN:165,OP_RIPEMD160:166,OP_SHA1:167,OP_SHA256:168,OP_HASH160:169,OP_HASH256:170,OP_CODESEPARATOR:171,OP_CHECKSIG:172,OP_CHECKSIGVERIFY:173,OP_CHECKMULTISIG:174,OP_CHECKMULTISIGVERIFY:175,OP_NOP1:176,OP_NOP2:177,OP_CHECKLOCKTIMEVERIFY:177,OP_NOP3:178,OP_CHECKSEQUENCEVERIFY:178,OP_NOP4:179,OP_NOP5:180,OP_NOP6:181,OP_NOP7:182,OP_NOP8:183,OP_NOP9:184,OP_NOP10:185,OP_CHECKSIGADD:186,OP_PUBKEYHASH:253,OP_PUBKEY:254,OP_INVALIDOPCODE:255};mn.OPS=yn;const gn={};mn.REVERSE_OPS=gn;for(const e of Object.keys(yn)){gn[yn[e]]=e}var bn={};Object.defineProperty(bn,"__esModule",{value:!0}),bn.decode=bn.encode=bn.encodingLength=void 0;const vn=mn;function _n(e){return e<vn.OPS.OP_PUSHDATA1?1:e<=255?2:e<=65535?3:5}bn.encodingLength=_n,bn.encode=function(e,t,r){const n=_n(t);return 1===n?e.writeUInt8(t,r):2===n?(e.writeUInt8(vn.OPS.OP_PUSHDATA1,r),e.writeUInt8(t,r+1)):3===n?(e.writeUInt8(vn.OPS.OP_PUSHDATA2,r),e.writeUInt16LE(t,r+1)):(e.writeUInt8(vn.OPS.OP_PUSHDATA4,r),e.writeUInt32LE(t,r+1)),n},bn.decode=function(e,t){const r=e.readUInt8(t);let n,s;if(r<vn.OPS.OP_PUSHDATA1)n=r,s=1;else if(r===vn.OPS.OP_PUSHDATA1){if(t+2>e.length)return null;n=e.readUInt8(t+1),s=2}else if(r===vn.OPS.OP_PUSHDATA2){if(t+3>e.length)return null;n=e.readUInt16LE(t+1),s=3}else{if(t+5>e.length)return null;if(r!==vn.OPS.OP_PUSHDATA4)throw new Error("Unexpected opcode");n=e.readUInt32LE(t+1),s=5}return{opcode:r,number:n,size:s}};var wn={};Object.defineProperty(wn,"__esModule",{value:!0}),wn.encode=wn.decode=void 0,wn.decode=function(e,t,r){t=t||4,r=void 0===r||r;const n=e.length;if(0===n)return 0;if(n>t)throw new TypeError("Script number overflow");if(r&&!(127&e[n-1]||!(n<=1)&&128&e[n-2]))throw new Error("Non-minimally encoded script number");if(5===n){const t=e.readUInt32LE(0),r=e.readUInt8(4);return 128&r?-(4294967296*(-129&r)+t):4294967296*r+t}let s=0;for(let t=0;t<n;++t)s|=e[t]<<8*t;return 128&e[n-1]?-(s&~(128<<8*(n-1))):s},wn.encode=function(e){let t=Math.abs(e);const r=(n=t)>2147483647?5:n>8388607?4:n>32767?3:n>127?2:n>0?1:0;var n;const s=Buffer.allocUnsafe(r),i=e<0;for(let e=0;e<r;++e)s.writeUInt8(255&t,e),t>>=8;return 128&s[r-1]?s.writeUInt8(i?128:0,r-1):i&&(s[r-1]|=128),s};var En={},Sn={},An={Array:function(e){return null!=e&&e.constructor===Array},Boolean:function(e){return"boolean"==typeof e},Function:function(e){return"function"==typeof e},Nil:function(e){return null==e},Number:function(e){return"number"==typeof e},Object:function(e){return"object"==typeof e},String:function(e){return"string"==typeof e},"":function(){return!0}};for(var Tn in An.Null=An.Nil,An)An[Tn].toJSON=function(e){return e}.bind(null,Tn);var In=An,On=In;function kn(e){return e.name||e.toString().match(/function (.*?)\s*\(/)[1]}function Rn(e){return On.Nil(e)?"":kn(e.constructor)}function Nn(e,t){Error.captureStackTrace&&Error.captureStackTrace(e,t)}function Pn(e){return On.Function(e)?e.toJSON?e.toJSON():kn(e):On.Array(e)?"Array":e&&On.Object(e)?"Object":void 0!==e?e:""}function xn(e,t,r){var n=function(e){return On.Function(e)?"":On.String(e)?JSON.stringify(e):e&&On.Object(e)?"":e}(t);return"Expected "+Pn(e)+", got"+(""!==r?" "+r:"")+(""!==n?" "+n:"")}function Cn(e,t,r){r=r||Rn(t),this.message=xn(e,t,r),Nn(this,Cn),this.__type=e,this.__value=t,this.__valueTypeName=r}function Bn(e,t,r,n,s){e?(s=s||Rn(n),this.message=function(e,t,r,n,s){var i='" of type ';return"key"===t&&(i='" with key type '),xn('property "'+Pn(r)+i+Pn(e),n,s)}(e,r,t,n,s)):this.message='Unexpected property "'+t+'"',Nn(this,Cn),this.__label=r,this.__property=t,this.__type=e,this.__value=n,this.__valueTypeName=s}Cn.prototype=Object.create(Error.prototype),Cn.prototype.constructor=Cn,Bn.prototype=Object.create(Error.prototype),Bn.prototype.constructor=Cn;var Ln,$n,Un={TfTypeError:Cn,TfPropertyTypeError:Bn,tfCustomError:function(e,t){return new Cn(e,{},t)},tfSubError:function(e,t,r){return e instanceof Bn?(t=t+"."+e.__property,e=new Bn(e.__type,t,e.__label,e.__value,e.__valueTypeName)):e instanceof Cn&&(e=new Bn(e.__type,t,r,e.__value,e.__valueTypeName)),Nn(e),e},tfJSON:Pn,getValueTypeName:Rn};var Dn=In,jn=Un.tfJSON,Mn=Un.TfTypeError,Hn=Un.TfPropertyTypeError,Fn=Un.tfSubError,Kn=Un.getValueTypeName,Gn={arrayOf:function(e,t){function r(r,n){return!!Dn.Array(r)&&(!Dn.Nil(r)&&(!(void 0!==t.minLength&&r.length<t.minLength)&&(!(void 0!==t.maxLength&&r.length>t.maxLength)&&((void 0===t.length||r.length===t.length)&&r.every((function(t,r){try{return Xn(e,t,n)}catch(e){throw Fn(e,r)}}))))))}return e=Vn(e),t=t||{},r.toJSON=function(){var r="["+jn(e)+"]";return void 0!==t.length?r+="{"+t.length+"}":void 0===t.minLength&&void 0===t.maxLength||(r+="{"+(void 0===t.minLength?0:t.minLength)+","+(void 0===t.maxLength?1/0:t.maxLength)+"}"),r},r},maybe:function e(t){function r(r,n){return Dn.Nil(r)||t(r,n,e)}return t=Vn(t),r.toJSON=function(){return"?"+jn(t)},r},map:function(e,t){function r(r,n){if(!Dn.Object(r))return!1;if(Dn.Nil(r))return!1;for(var s in r){try{t&&Xn(t,s,n)}catch(e){throw Fn(e,s,"key")}try{var i=r[s];Xn(e,i,n)}catch(e){throw Fn(e,s)}}return!0}return e=Vn(e),t&&(t=Vn(t)),r.toJSON=t?function(){return"{"+jn(t)+": "+jn(e)+"}"}:function(){return"{"+jn(e)+"}"},r},object:function(e){var t={};for(var r in e)t[r]=Vn(e[r]);function n(e,r){if(!Dn.Object(e))return!1;if(Dn.Nil(e))return!1;var n;try{for(n in t){Xn(t[n],e[n],r)}}catch(e){throw Fn(e,n)}if(r)for(n in e)if(!t[n])throw new Hn(void 0,n);return!0}return n.toJSON=function(){return jn(t)},n},anyOf:function(){var e=[].slice.call(arguments).map(Vn);function t(t,r){return e.some((function(e){try{return Xn(e,t,r)}catch(e){return!1}}))}return t.toJSON=function(){return e.map(jn).join("|")},t},allOf:function(){var e=[].slice.call(arguments).map(Vn);function t(t,r){return e.every((function(e){try{return Xn(e,t,r)}catch(e){return!1}}))}return t.toJSON=function(){return e.map(jn).join(" & ")},t},quacksLike:function(e){function t(t){return e===Kn(t)}return t.toJSON=function(){return e},t},tuple:function(){var e=[].slice.call(arguments).map(Vn);function t(t,r){return!Dn.Nil(t)&&(!Dn.Nil(t.length)&&((!r||t.length===e.length)&&e.every((function(e,n){try{return Xn(e,t[n],r)}catch(e){throw Fn(e,n)}}))))}return t.toJSON=function(){return"("+e.map(jn).join(", ")+")"},t},value:function(e){function t(t){return t===e}return t.toJSON=function(){return e},t}};function Vn(e){if(Dn.String(e))return"?"===e[0]?Gn.maybe(e.slice(1)):Dn[e]||Gn.quacksLike(e);if(e&&Dn.Object(e)){if(Dn.Array(e)){if(1!==e.length)throw new TypeError("Expected compile() parameter of type Array of length 1");return Gn.arrayOf(e[0])}return Gn.object(e)}return Dn.Function(e)?e:Gn.value(e)}function Xn(e,t,r,n){if(Dn.Function(e)){if(e(t,r))return!0;throw new Mn(n||e,t)}return Xn(Vn(e),t,r)}for(var Wn in Gn.oneOf=Gn.anyOf,Dn)Xn[Wn]=Dn[Wn];for(Wn in Gn)Xn[Wn]=Gn[Wn];var qn=function(){if($n)return Ln;$n=1;var e=In,t=Un;function r(e){return Buffer.isBuffer(e)}function n(e){return"string"==typeof e&&/^([0-9a-f]{2})+$/i.test(e)}function s(e,r){var n=e.toJSON();function s(s){if(!e(s))return!1;if(s.length===r)return!0;throw t.tfCustomError(n+"(Length: "+r+")",n+"(Length: "+s.length+")")}return s.toJSON=function(){return n},s}var i=s.bind(null,e.Array),o=s.bind(null,r),a=s.bind(null,n),u=s.bind(null,e.String),c=Math.pow(2,53)-1,l={ArrayN:i,Buffer:r,BufferN:o,Finite:function(e){return"number"==typeof e&&isFinite(e)},Hex:n,HexN:a,Int8:function(e){return e<<24>>24===e},Int16:function(e){return e<<16>>16===e},Int32:function(e){return(0|e)===e},Int53:function(e){return"number"==typeof e&&e>=-c&&e<=c&&Math.floor(e)===e},Range:function(t,r,n){function s(e,s){return n(e,s)&&e>t&&e<r}return n=n||e.Number,s.toJSON=function(){return`${n.toJSON()} between [${t}, ${r}]`},s},StringN:u,UInt8:function(e){return(255&e)===e},UInt16:function(e){return(65535&e)===e},UInt32:function(e){return e>>>0===e},UInt53:function(e){return"number"==typeof e&&e>=0&&e<=c&&Math.floor(e)===e}};for(var f in l)l[f].toJSON=function(e){return e}.bind(null,f);return Ln=l}();for(Wn in qn)Xn[Wn]=qn[Wn];Xn.compile=Vn,Xn.TfTypeError=Mn,Xn.TfPropertyTypeError=Hn;var Zn=Xn;!function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.oneOf=e.Null=e.BufferN=e.Function=e.UInt32=e.UInt8=e.tuple=e.maybe=e.Hex=e.Buffer=e.String=e.Boolean=e.Array=e.Number=e.Hash256bit=e.Hash160bit=e.Buffer256bit=e.isTaptree=e.isTapleaf=e.TAPLEAF_VERSION_MASK=e.Network=e.ECPoint=e.Satoshi=e.Signer=e.BIP32Path=e.UInt31=e.isPoint=e.typeforce=void 0;const r=t;e.typeforce=Zn;const n=r.Buffer.alloc(32,0),s=r.Buffer.from("fffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f","hex");e.isPoint=function(e){if(!r.Buffer.isBuffer(e))return!1;if(e.length<33)return!1;const t=e[0],i=e.slice(1,33);if(0===i.compare(n))return!1;if(i.compare(s)>=0)return!1;if((2===t||3===t)&&33===e.length)return!0;const o=e.slice(33);return 0!==o.compare(n)&&(!(o.compare(s)>=0)&&(4===t&&65===e.length))};const i=Math.pow(2,31)-1;function o(t){return e.typeforce.String(t)&&!!t.match(/^(m\/)?(\d+'?\/)*\d+'?$/)}e.UInt31=function(t){return e.typeforce.UInt32(t)&&t<=i},e.BIP32Path=o,o.toJSON=()=>"BIP32 derivation path",e.Signer=function(t){return(e.typeforce.Buffer(t.publicKey)||"function"==typeof t.getPublicKey)&&"function"==typeof t.sign};function a(t){return!(!t||!("output"in t))&&(!!r.Buffer.isBuffer(t.output)&&(void 0===t.version||(t.version&e.TAPLEAF_VERSION_MASK)===t.version))}e.Satoshi=function(t){return e.typeforce.UInt53(t)&&t<=21e14},e.ECPoint=e.typeforce.quacksLike("Point"),e.Network=e.typeforce.compile({messagePrefix:e.typeforce.oneOf(e.typeforce.Buffer,e.typeforce.String),bip32:{public:e.typeforce.UInt32,private:e.typeforce.UInt32},pubKeyHash:e.typeforce.UInt8,scriptHash:e.typeforce.UInt8,wif:e.typeforce.UInt8}),e.TAPLEAF_VERSION_MASK=254,e.isTapleaf=a,e.isTaptree=function t(r){return(0,e.Array)(r)?2===r.length&&r.every((e=>t(e))):a(r)},e.Buffer256bit=e.typeforce.BufferN(32),e.Hash160bit=e.typeforce.BufferN(20),e.Hash256bit=e.typeforce.BufferN(32),e.Number=e.typeforce.Number,e.Array=e.typeforce.Array,e.Boolean=e.typeforce.Boolean,e.String=e.typeforce.String,e.Buffer=e.typeforce.Buffer,e.Hex=e.typeforce.Hex,e.maybe=e.typeforce.maybe,e.tuple=e.typeforce.tuple,e.UInt8=e.typeforce.UInt8,e.UInt32=e.typeforce.UInt32,e.Function=e.typeforce.Function,e.BufferN=e.typeforce.BufferN,e.Null=e.typeforce.Null,e.oneOf=e.typeforce.oneOf}(Sn),Object.defineProperty(En,"__esModule",{value:!0}),En.encode=En.decode=void 0;const Yn=dn,zn=Sn,{typeforce:Jn}=zn,Qn=Buffer.alloc(1,0);function es(e){let t=0;for(;0===e[t];)++t;return t===e.length?Qn:128&(e=e.slice(t))[0]?Buffer.concat([Qn,e],1+e.length):e}function ts(e){0===e[0]&&(e=e.slice(1));const t=Buffer.alloc(32,0),r=Math.max(0,32-e.length);return e.copy(t,r),t}En.decode=function(e){const t=e.readUInt8(e.length-1),r=-129&t;if(r<=0||r>=4)throw new Error("Invalid hashType "+t);const n=Yn.decode(e.slice(0,-1)),s=ts(n.r),i=ts(n.s);return{signature:Buffer.concat([s,i],64),hashType:t}},En.encode=function(e,t){Jn({signature:zn.BufferN(64),hashType:zn.UInt8},{signature:e,hashType:t});const r=-129&t;if(r<=0||r>=4)throw new Error("Invalid hashType "+t);const n=Buffer.allocUnsafe(1);n.writeUInt8(t,0);const s=es(e.slice(0,32)),i=es(e.slice(32,64));return Buffer.concat([Yn.encode(s,i),n])},function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.signature=e.number=e.isCanonicalScriptSignature=e.isDefinedHashType=e.isCanonicalPubKey=e.toStack=e.fromASM=e.toASM=e.decompile=e.compile=e.countNonPushOnlyOPs=e.isPushOnly=e.OPS=void 0;const t=dn,r=mn;Object.defineProperty(e,"OPS",{enumerable:!0,get:function(){return r.OPS}});const n=bn,s=wn,i=En,o=Sn,{typeforce:a}=o,u=r.OPS.OP_RESERVED;function c(e){return o.Buffer(e)||function(e){return o.Number(e)&&(e===r.OPS.OP_0||e>=r.OPS.OP_1&&e<=r.OPS.OP_16||e===r.OPS.OP_1NEGATE)}(e)}function l(e){return o.Array(e)&&e.every(c)}function f(e){return 0===e.length?r.OPS.OP_0:1===e.length?e[0]>=1&&e[0]<=16?u+e[0]:129===e[0]?r.OPS.OP_1NEGATE:void 0:void 0}function p(e){return Buffer.isBuffer(e)}function h(e){return Buffer.isBuffer(e)}function d(e){if(p(e))return e;a(o.Array,e);const t=e.reduce(((e,t)=>h(t)?1===t.length&&void 0!==f(t)?e+1:e+n.encodingLength(t.length)+t.length:e+1),0),r=Buffer.allocUnsafe(t);let s=0;if(e.forEach((e=>{if(h(e)){const t=f(e);if(void 0!==t)return r.writeUInt8(t,s),void(s+=1);s+=n.encode(r,e.length,s),e.copy(r,s),s+=e.length}else r.writeUInt8(e,s),s+=1})),s!==r.length)throw new Error("Could not decode chunks");return r}function m(e){if(t=e,o.Array(t))return e;var t;a(o.Buffer,e);const s=[];let i=0;for(;i<e.length;){const t=e[i];if(t>r.OPS.OP_0&&t<=r.OPS.OP_PUSHDATA4){const t=n.decode(e,i);if(null===t)return null;if(i+=t.size,i+t.number>e.length)return null;const r=e.slice(i,i+t.number);i+=t.number;const o=f(r);void 0!==o?s.push(o):s.push(r)}else s.push(t),i+=1}return s}function y(e){const t=-129&e;return t>0&&t<4}e.isPushOnly=l,e.countNonPushOnlyOPs=function(e){return e.length-e.filter(c).length},e.compile=d,e.decompile=m,e.toASM=function(e){return p(e)&&(e=m(e)),e.map((e=>{if(h(e)){const t=f(e);if(void 0===t)return e.toString("hex");e=t}return r.REVERSE_OPS[e]})).join(" ")},e.fromASM=function(e){return a(o.String,e),d(e.split(" ").map((e=>void 0!==r.OPS[e]?r.OPS[e]:(a(o.Hex,e),Buffer.from(e,"hex")))))},e.toStack=function(e){return e=m(e),a(l,e),e.map((e=>h(e)?e:e===r.OPS.OP_0?Buffer.allocUnsafe(0):s.encode(e-u)))},e.isCanonicalPubKey=function(e){return o.isPoint(e)},e.isDefinedHashType=y,e.isCanonicalScriptSignature=function(e){return!!Buffer.isBuffer(e)&&(!!y(e[e.length-1])&&t.check(e.slice(0,-1)))},e.number=s,e.signature=i}(hn);var rs={};Object.defineProperty(rs,"__esModule",{value:!0}),rs.value=rs.prop=void 0,rs.prop=function(e,t,r){Object.defineProperty(e,t,{configurable:!0,enumerable:!0,get(){const e=r.call(this);return this[t]=e,e},set(e){Object.defineProperty(this,t,{configurable:!0,enumerable:!0,value:e,writable:!0})}})},rs.value=function(e){let t;return()=>(void 0!==t||(t=e()),t)},Object.defineProperty(pn,"__esModule",{value:!0}),pn.p2data=void 0;const ns=ln,ss=hn,is=Sn,os=rs,as=ss.OPS;pn.p2data=function(e,t){if(!e.data&&!e.output)throw new TypeError("Not enough data");t=Object.assign({validate:!0},t||{}),(0,is.typeforce)({network:is.typeforce.maybe(is.typeforce.Object),output:is.typeforce.maybe(is.typeforce.Buffer),data:is.typeforce.maybe(is.typeforce.arrayOf(is.typeforce.Buffer))},e);const r={name:"embed",network:e.network||ns.bitcoin};if(os.prop(r,"output",(()=>{if(e.data)return ss.compile([as.OP_RETURN].concat(e.data))})),os.prop(r,"data",(()=>{if(e.output)return ss.decompile(e.output).slice(1)})),t.validate&&e.output){const t=ss.decompile(e.output);if(t[0]!==as.OP_RETURN)throw new TypeError("Output is invalid");if(!t.slice(1).every(is.typeforce.Buffer))throw new TypeError("Output is invalid");if(e.data&&!function(e,t){return e.length===t.length&&e.every(((e,r)=>e.equals(t[r])))}(e.data,r.data))throw new TypeError("Data mismatch")}return Object.assign(r,e)};var us={};Object.defineProperty(us,"__esModule",{value:!0}),us.p2ms=void 0;const cs=ln,ls=hn,fs=Sn,ps=rs,hs=ls.OPS,ds=hs.OP_RESERVED;function ms(e,t){return e.length===t.length&&e.every(((e,r)=>e.equals(t[r])))}us.p2ms=function(e,t){if(!(e.input||e.output||e.pubkeys&&void 0!==e.m||e.signatures))throw new TypeError("Not enough data");function r(e){return ls.isCanonicalScriptSignature(e)||void 0!==(t.allowIncomplete&&e===hs.OP_0)}t=Object.assign({validate:!0},t||{}),(0,fs.typeforce)({network:fs.typeforce.maybe(fs.typeforce.Object),m:fs.typeforce.maybe(fs.typeforce.Number),n:fs.typeforce.maybe(fs.typeforce.Number),output:fs.typeforce.maybe(fs.typeforce.Buffer),pubkeys:fs.typeforce.maybe(fs.typeforce.arrayOf(fs.isPoint)),signatures:fs.typeforce.maybe(fs.typeforce.arrayOf(r)),input:fs.typeforce.maybe(fs.typeforce.Buffer)},e);const n={network:e.network||cs.bitcoin};let s=[],i=!1;function o(e){i||(i=!0,s=ls.decompile(e),n.m=s[0]-ds,n.n=s[s.length-2]-ds,n.pubkeys=s.slice(1,-2))}if(ps.prop(n,"output",(()=>{if(e.m&&n.n&&e.pubkeys)return ls.compile([].concat(ds+e.m,e.pubkeys,ds+n.n,hs.OP_CHECKMULTISIG))})),ps.prop(n,"m",(()=>{if(n.output)return o(n.output),n.m})),ps.prop(n,"n",(()=>{if(n.pubkeys)return n.pubkeys.length})),ps.prop(n,"pubkeys",(()=>{if(e.output)return o(e.output),n.pubkeys})),ps.prop(n,"signatures",(()=>{if(e.input)return ls.decompile(e.input).slice(1)})),ps.prop(n,"input",(()=>{if(e.signatures)return ls.compile([hs.OP_0].concat(e.signatures))})),ps.prop(n,"witness",(()=>{if(n.input)return[]})),ps.prop(n,"name",(()=>{if(n.m&&n.n)return`p2ms(${n.m} of ${n.n})`})),t.validate){if(e.output){if(o(e.output),!fs.typeforce.Number(s[0]))throw new TypeError("Output is invalid");if(!fs.typeforce.Number(s[s.length-2]))throw new TypeError("Output is invalid");if(s[s.length-1]!==hs.OP_CHECKMULTISIG)throw new TypeError("Output is invalid");if(n.m<=0||n.n>16||n.m>n.n||n.n!==s.length-3)throw new TypeError("Output is invalid");if(!n.pubkeys.every((e=>(0,fs.isPoint)(e))))throw new TypeError("Output is invalid");if(void 0!==e.m&&e.m!==n.m)throw new TypeError("m mismatch");if(void 0!==e.n&&e.n!==n.n)throw new TypeError("n mismatch");if(e.pubkeys&&!ms(e.pubkeys,n.pubkeys))throw new TypeError("Pubkeys mismatch")}if(e.pubkeys){if(void 0!==e.n&&e.n!==e.pubkeys.length)throw new TypeError("Pubkey count mismatch");if(n.n=e.pubkeys.length,n.n<n.m)throw new TypeError("Pubkey count cannot be less than m")}if(e.signatures){if(e.signatures.length<n.m)throw new TypeError("Not enough signatures provided");if(e.signatures.length>n.m)throw new TypeError("Too many signatures provided")}if(e.input){if(e.input[0]!==hs.OP_0)throw new TypeError("Input is invalid");if(0===n.signatures.length||!n.signatures.every(r))throw new TypeError("Input has invalid signature(s)");if(e.signatures&&!ms(e.signatures,n.signatures))throw new TypeError("Signature mismatch");if(void 0!==e.m&&e.m!==e.signatures.length)throw new TypeError("Signature count mismatch")}}return Object.assign(n,e)};var ys={};Object.defineProperty(ys,"__esModule",{value:!0}),ys.p2pk=void 0;const gs=ln,bs=hn,vs=Sn,_s=rs,ws=bs.OPS;ys.p2pk=function(e,t){if(!(e.input||e.output||e.pubkey||e.input||e.signature))throw new TypeError("Not enough data");t=Object.assign({validate:!0},t||{}),(0,vs.typeforce)({network:vs.typeforce.maybe(vs.typeforce.Object),output:vs.typeforce.maybe(vs.typeforce.Buffer),pubkey:vs.typeforce.maybe(vs.isPoint),signature:vs.typeforce.maybe(bs.isCanonicalScriptSignature),input:vs.typeforce.maybe(vs.typeforce.Buffer)},e);const r=_s.value((()=>bs.decompile(e.input))),n={name:"p2pk",network:e.network||gs.bitcoin};if(_s.prop(n,"output",(()=>{if(e.pubkey)return bs.compile([e.pubkey,ws.OP_CHECKSIG])})),_s.prop(n,"pubkey",(()=>{if(e.output)return e.output.slice(1,-1)})),_s.prop(n,"signature",(()=>{if(e.input)return r()[0]})),_s.prop(n,"input",(()=>{if(e.signature)return bs.compile([e.signature])})),_s.prop(n,"witness",(()=>{if(n.input)return[]})),t.validate){if(e.output){if(e.output[e.output.length-1]!==ws.OP_CHECKSIG)throw new TypeError("Output is invalid");if(!(0,vs.isPoint)(n.pubkey))throw new TypeError("Output pubkey is invalid");if(e.pubkey&&!e.pubkey.equals(n.pubkey))throw new TypeError("Pubkey mismatch")}if(e.signature&&e.input&&!e.input.equals(n.input))throw new TypeError("Signature mismatch");if(e.input){if(1!==r().length)throw new TypeError("Input is invalid");if(!bs.isCanonicalScriptSignature(n.signature))throw new TypeError("Input has invalid signature")}}return Object.assign(n,e)};var Es={},Ss={},As={},Ts={},Is={};function Os(e){if(!Number.isSafeInteger(e)||e<0)throw new Error(`positive integer expected, not ${e}`)}function ks(e){if("boolean"!=typeof e)throw new Error(`boolean expected, not ${e}`)}function Rs(e){return e instanceof Uint8Array||null!=e&&"object"==typeof e&&"Uint8Array"===e.constructor.name}function Ns(e,...t){if(!Rs(e))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(e.length))throw new Error(`Uint8Array expected of length ${t}, not of length=${e.length}`)}function Ps(e){if("function"!=typeof e||"function"!=typeof e.create)throw new Error("Hash should be wrapped by utils.wrapConstructor");Os(e.outputLen),Os(e.blockLen)}function xs(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function Cs(e,t){Ns(e);const r=t.outputLen;if(e.length<r)throw new Error(`digestInto() expects output buffer of length at least ${r}`)}Object.defineProperty(Is,"__esModule",{value:!0}),Is.output=Is.exists=Is.hash=Is.bytes=Is.bool=Is.number=Is.isBytes=void 0,Is.number=Os,Is.bool=ks,Is.isBytes=Rs,Is.bytes=Ns,Is.hash=Ps,Is.exists=xs,Is.output=Cs;const Bs={number:Os,bool:ks,bytes:Ns,hash:Ps,exists:xs,output:Cs};Is.default=Bs;var Ls={},$s={};Object.defineProperty($s,"__esModule",{value:!0}),$s.crypto=void 0,$s.crypto="object"==typeof globalThis&&"crypto"in globalThis?globalThis.crypto:void 0,function(e){
/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */
Object.defineProperty(e,"__esModule",{value:!0}),e.randomBytes=e.wrapXOFConstructorWithOpts=e.wrapConstructorWithOpts=e.wrapConstructor=e.checkOpts=e.Hash=e.concatBytes=e.toBytes=e.utf8ToBytes=e.asyncLoop=e.nextTick=e.hexToBytes=e.bytesToHex=e.byteSwap32=e.byteSwapIfBE=e.byteSwap=e.isLE=e.rotl=e.rotr=e.createView=e.u32=e.u8=e.isBytes=void 0;const t=$s,r=Is;e.isBytes=function(e){return e instanceof Uint8Array||null!=e&&"object"==typeof e&&"Uint8Array"===e.constructor.name};e.u8=e=>new Uint8Array(e.buffer,e.byteOffset,e.byteLength);e.u32=e=>new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4));e.createView=e=>new DataView(e.buffer,e.byteOffset,e.byteLength);e.rotr=(e,t)=>e<<32-t|e>>>t;e.rotl=(e,t)=>e<<t|e>>>32-t>>>0,e.isLE=68===new Uint8Array(new Uint32Array([287454020]).buffer)[0];e.byteSwap=e=>e<<24&4278190080|e<<8&16711680|e>>>8&65280|e>>>24&255,e.byteSwapIfBE=e.isLE?e=>e:t=>(0,e.byteSwap)(t),e.byteSwap32=function(t){for(let r=0;r<t.length;r++)t[r]=(0,e.byteSwap)(t[r])};const n=Array.from({length:256},((e,t)=>t.toString(16).padStart(2,"0")));e.bytesToHex=function(e){(0,r.bytes)(e);let t="";for(let r=0;r<e.length;r++)t+=n[e[r]];return t};const s={_0:48,_9:57,_A:65,_F:70,_a:97,_f:102};function i(e){return e>=s._0&&e<=s._9?e-s._0:e>=s._A&&e<=s._F?e-(s._A-10):e>=s._a&&e<=s._f?e-(s._a-10):void 0}e.hexToBytes=function(e){if("string"!=typeof e)throw new Error("hex string expected, got "+typeof e);const t=e.length,r=t/2;if(t%2)throw new Error("padded hex string expected, got unpadded hex of length "+t);const n=new Uint8Array(r);for(let t=0,s=0;t<r;t++,s+=2){const r=i(e.charCodeAt(s)),o=i(e.charCodeAt(s+1));if(void 0===r||void 0===o){const t=e[s]+e[s+1];throw new Error('hex string expected, got non-hex character "'+t+'" at index '+s)}n[t]=16*r+o}return n};function o(e){if("string"!=typeof e)throw new Error("utf8ToBytes expected string, got "+typeof e);return new Uint8Array((new TextEncoder).encode(e))}function a(e){return"string"==typeof e&&(e=o(e)),(0,r.bytes)(e),e}e.nextTick=async()=>{},e.asyncLoop=async function(t,r,n){let s=Date.now();for(let i=0;i<t;i++){n(i);const t=Date.now()-s;t>=0&&t<r||(await(0,e.nextTick)(),s+=t)}},e.utf8ToBytes=o,e.toBytes=a,e.concatBytes=function(...e){let t=0;for(let n=0;n<e.length;n++){const s=e[n];(0,r.bytes)(s),t+=s.length}const n=new Uint8Array(t);for(let t=0,r=0;t<e.length;t++){const s=e[t];n.set(s,r),r+=s.length}return n};e.Hash=class{clone(){return this._cloneInto()}};const u={}.toString;e.checkOpts=function(e,t){if(void 0!==t&&"[object Object]"!==u.call(t))throw new Error("Options should be object or undefined");return Object.assign(e,t)},e.wrapConstructor=function(e){const t=t=>e().update(a(t)).digest(),r=e();return t.outputLen=r.outputLen,t.blockLen=r.blockLen,t.create=()=>e(),t},e.wrapConstructorWithOpts=function(e){const t=(t,r)=>e(r).update(a(t)).digest(),r=e({});return t.outputLen=r.outputLen,t.blockLen=r.blockLen,t.create=t=>e(t),t},e.wrapXOFConstructorWithOpts=function(e){const t=(t,r)=>e(r).update(a(t)).digest(),r=e({});return t.outputLen=r.outputLen,t.blockLen=r.blockLen,t.create=t=>e(t),t},e.randomBytes=function(e=32){if(t.crypto&&"function"==typeof t.crypto.getRandomValues)return t.crypto.getRandomValues(new Uint8Array(e));throw new Error("crypto.getRandomValues must be defined")}}(Ls),Object.defineProperty(Ts,"__esModule",{value:!0}),Ts.HashMD=Ts.Maj=Ts.Chi=void 0;const Us=Is,Ds=Ls;Ts.Chi=(e,t,r)=>e&t^~e&r;Ts.Maj=(e,t,r)=>e&t^e&r^t&r;Ts.HashMD=class extends Ds.Hash{constructor(e,t,r,n){super(),this.blockLen=e,this.outputLen=t,this.padOffset=r,this.isLE=n,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=(0,Ds.createView)(this.buffer)}update(e){(0,Us.exists)(this);const{view:t,buffer:r,blockLen:n}=this,s=(e=(0,Ds.toBytes)(e)).length;for(let i=0;i<s;){const o=Math.min(n-this.pos,s-i);if(o!==n)r.set(e.subarray(i,i+o),this.pos),this.pos+=o,i+=o,this.pos===n&&(this.process(t,0),this.pos=0);else{const t=(0,Ds.createView)(e);for(;n<=s-i;i+=n)this.process(t,i)}}return this.length+=e.length,this.roundClean(),this}digestInto(e){(0,Us.exists)(this),(0,Us.output)(e,this),this.finished=!0;const{buffer:t,view:r,blockLen:n,isLE:s}=this;let{pos:i}=this;t[i++]=128,this.buffer.subarray(i).fill(0),this.padOffset>n-i&&(this.process(r,0),i=0);for(let e=i;e<n;e++)t[e]=0;!function(e,t,r,n){if("function"==typeof e.setBigUint64)return e.setBigUint64(t,r,n);const s=BigInt(32),i=BigInt(4294967295),o=Number(r>>s&i),a=Number(r&i),u=n?4:0,c=n?0:4;e.setUint32(t+u,o,n),e.setUint32(t+c,a,n)}(r,n-8,BigInt(8*this.length),s),this.process(r,0);const o=(0,Ds.createView)(e),a=this.outputLen;if(a%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const u=a/4,c=this.get();if(u>c.length)throw new Error("_sha2: outputLen bigger than state");for(let e=0;e<u;e++)o.setUint32(4*e,c[e],s)}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const r=e.slice(0,t);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:t,buffer:r,length:n,finished:s,destroyed:i,pos:o}=this;return e.length=n,e.pos=o,e.finished=s,e.destroyed=i,n%t&&e.buffer.set(r),e}},Object.defineProperty(As,"__esModule",{value:!0}),As.ripemd160=As.RIPEMD160=void 0;const js=Ts,Ms=Ls,Hs=new Uint8Array([7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8]),Fs=new Uint8Array(new Array(16).fill(0).map(((e,t)=>t)));let Ks=[Fs],Gs=[Fs.map((e=>(9*e+5)%16))];for(let e=0;e<4;e++)for(let t of[Ks,Gs])t.push(t[e].map((e=>Hs[e])));const Vs=[[11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8],[12,13,11,15,6,9,9,7,12,15,11,13,7,8,7,7],[13,15,14,11,7,7,6,8,13,14,13,12,5,5,6,9],[14,11,12,14,8,6,5,5,15,12,15,14,9,9,8,6],[15,12,13,13,9,5,8,6,14,11,12,11,8,6,5,5]].map((e=>new Uint8Array(e))),Xs=Ks.map(((e,t)=>e.map((e=>Vs[t][e])))),Ws=Gs.map(((e,t)=>e.map((e=>Vs[t][e])))),qs=new Uint32Array([0,1518500249,1859775393,2400959708,2840853838]),Zs=new Uint32Array([1352829926,1548603684,1836072691,2053994217,0]);function Ys(e,t,r,n){return 0===e?t^r^n:1===e?t&r|~t&n:2===e?(t|~r)^n:3===e?t&n|r&~n:t^(r|~n)}const zs=new Uint32Array(16);class Js extends js.HashMD{constructor(){super(64,20,8,!0),this.h0=1732584193,this.h1=-271733879,this.h2=-1732584194,this.h3=271733878,this.h4=-1009589776}get(){const{h0:e,h1:t,h2:r,h3:n,h4:s}=this;return[e,t,r,n,s]}set(e,t,r,n,s){this.h0=0|e,this.h1=0|t,this.h2=0|r,this.h3=0|n,this.h4=0|s}process(e,t){for(let r=0;r<16;r++,t+=4)zs[r]=e.getUint32(t,!0);let r=0|this.h0,n=r,s=0|this.h1,i=s,o=0|this.h2,a=o,u=0|this.h3,c=u,l=0|this.h4,f=l;for(let e=0;e<5;e++){const t=4-e,p=qs[e],h=Zs[e],d=Ks[e],m=Gs[e],y=Xs[e],g=Ws[e];for(let t=0;t<16;t++){const n=(0,Ms.rotl)(r+Ys(e,s,o,u)+zs[d[t]]+p,y[t])+l|0;r=l,l=u,u=0|(0,Ms.rotl)(o,10),o=s,s=n}for(let e=0;e<16;e++){const r=(0,Ms.rotl)(n+Ys(t,i,a,c)+zs[m[e]]+h,g[e])+f|0;n=f,f=c,c=0|(0,Ms.rotl)(a,10),a=i,i=r}}this.set(this.h1+o+c|0,this.h2+u+f|0,this.h3+l+n|0,this.h4+r+i|0,this.h0+s+a|0)}roundClean(){zs.fill(0)}destroy(){this.destroyed=!0,this.buffer.fill(0),this.set(0,0,0,0,0)}}As.RIPEMD160=Js,As.ripemd160=(0,Ms.wrapConstructor)((()=>new Js));var Qs={};Object.defineProperty(Qs,"__esModule",{value:!0}),Qs.sha1=void 0;const ei=Ts,ti=Ls,ri=new Uint32Array([1732584193,4023233417,2562383102,271733878,3285377520]),ni=new Uint32Array(80);class si extends ei.HashMD{constructor(){super(64,20,8,!1),this.A=0|ri[0],this.B=0|ri[1],this.C=0|ri[2],this.D=0|ri[3],this.E=0|ri[4]}get(){const{A:e,B:t,C:r,D:n,E:s}=this;return[e,t,r,n,s]}set(e,t,r,n,s){this.A=0|e,this.B=0|t,this.C=0|r,this.D=0|n,this.E=0|s}process(e,t){for(let r=0;r<16;r++,t+=4)ni[r]=e.getUint32(t,!1);for(let e=16;e<80;e++)ni[e]=(0,ti.rotl)(ni[e-3]^ni[e-8]^ni[e-14]^ni[e-16],1);let{A:r,B:n,C:s,D:i,E:o}=this;for(let e=0;e<80;e++){let t,a;e<20?(t=(0,ei.Chi)(n,s,i),a=1518500249):e<40?(t=n^s^i,a=1859775393):e<60?(t=(0,ei.Maj)(n,s,i),a=2400959708):(t=n^s^i,a=3395469782);const u=(0,ti.rotl)(r,5)+t+o+a+ni[e]|0;o=i,i=s,s=(0,ti.rotl)(n,30),n=r,r=u}r=r+this.A|0,n=n+this.B|0,s=s+this.C|0,i=i+this.D|0,o=o+this.E|0,this.set(r,n,s,i,o)}roundClean(){ni.fill(0)}destroy(){this.set(0,0,0,0,0),this.buffer.fill(0)}}Qs.sha1=(0,ti.wrapConstructor)((()=>new si));var ii={};Object.defineProperty(ii,"__esModule",{value:!0}),ii.sha224=ii.sha256=void 0;const oi=Ts,ai=Ls,ui=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),ci=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),li=new Uint32Array(64);class fi extends oi.HashMD{constructor(){super(64,32,8,!1),this.A=0|ci[0],this.B=0|ci[1],this.C=0|ci[2],this.D=0|ci[3],this.E=0|ci[4],this.F=0|ci[5],this.G=0|ci[6],this.H=0|ci[7]}get(){const{A:e,B:t,C:r,D:n,E:s,F:i,G:o,H:a}=this;return[e,t,r,n,s,i,o,a]}set(e,t,r,n,s,i,o,a){this.A=0|e,this.B=0|t,this.C=0|r,this.D=0|n,this.E=0|s,this.F=0|i,this.G=0|o,this.H=0|a}process(e,t){for(let r=0;r<16;r++,t+=4)li[r]=e.getUint32(t,!1);for(let e=16;e<64;e++){const t=li[e-15],r=li[e-2],n=(0,ai.rotr)(t,7)^(0,ai.rotr)(t,18)^t>>>3,s=(0,ai.rotr)(r,17)^(0,ai.rotr)(r,19)^r>>>10;li[e]=s+li[e-7]+n+li[e-16]|0}let{A:r,B:n,C:s,D:i,E:o,F:a,G:u,H:c}=this;for(let e=0;e<64;e++){const t=c+((0,ai.rotr)(o,6)^(0,ai.rotr)(o,11)^(0,ai.rotr)(o,25))+(0,oi.Chi)(o,a,u)+ui[e]+li[e]|0,l=((0,ai.rotr)(r,2)^(0,ai.rotr)(r,13)^(0,ai.rotr)(r,22))+(0,oi.Maj)(r,n,s)|0;c=u,u=a,a=o,o=i+t|0,i=s,s=n,n=r,r=t+l|0}r=r+this.A|0,n=n+this.B|0,s=s+this.C|0,i=i+this.D|0,o=o+this.E|0,a=a+this.F|0,u=u+this.G|0,c=c+this.H|0,this.set(r,n,s,i,o,a,u,c)}roundClean(){li.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}class pi extends fi{constructor(){super(),this.A=-1056596264,this.B=914150663,this.C=812702999,this.D=-150054599,this.E=-4191439,this.F=1750603025,this.G=1694076839,this.H=-1090891868,this.outputLen=28}}ii.sha256=(0,ai.wrapConstructor)((()=>new fi)),ii.sha224=(0,ai.wrapConstructor)((()=>new pi)),function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.taggedHash=e.TAGGED_HASH_PREFIXES=e.TAGS=e.hash256=e.hash160=e.sha256=e.sha1=e.ripemd160=void 0;const t=As,r=Qs,n=ii;function s(e){return Buffer.from((0,n.sha256)(Uint8Array.from(e)))}e.ripemd160=function(e){return Buffer.from((0,t.ripemd160)(Uint8Array.from(e)))},e.sha1=function(e){return Buffer.from((0,r.sha1)(Uint8Array.from(e)))},e.sha256=s,e.hash160=function(e){return Buffer.from((0,t.ripemd160)((0,n.sha256)(Uint8Array.from(e))))},e.hash256=function(e){return Buffer.from((0,n.sha256)((0,n.sha256)(Uint8Array.from(e))))},e.TAGS=["BIP0340/challenge","BIP0340/aux","BIP0340/nonce","TapLeaf","TapBranch","TapSighash","TapTweak","KeyAgg list","KeyAgg coefficient"],e.TAGGED_HASH_PREFIXES={"BIP0340/challenge":Buffer.from([123,181,45,122,159,239,88,50,62,177,191,122,64,125,179,130,210,243,242,216,27,177,34,79,73,254,81,143,109,72,211,124,123,181,45,122,159,239,88,50,62,177,191,122,64,125,179,130,210,243,242,216,27,177,34,79,73,254,81,143,109,72,211,124]),"BIP0340/aux":Buffer.from([241,239,78,94,192,99,202,218,109,148,202,250,157,152,126,160,105,38,88,57,236,193,31,151,45,119,165,46,216,193,204,144,241,239,78,94,192,99,202,218,109,148,202,250,157,152,126,160,105,38,88,57,236,193,31,151,45,119,165,46,216,193,204,144]),"BIP0340/nonce":Buffer.from([7,73,119,52,167,155,203,53,91,155,140,125,3,79,18,28,244,52,215,62,247,45,218,25,135,0,97,251,82,191,235,47,7,73,119,52,167,155,203,53,91,155,140,125,3,79,18,28,244,52,215,62,247,45,218,25,135,0,97,251,82,191,235,47]),TapLeaf:Buffer.from([174,234,143,220,66,8,152,49,5,115,75,88,8,29,30,38,56,211,95,28,181,64,8,212,211,87,202,3,190,120,233,238,174,234,143,220,66,8,152,49,5,115,75,88,8,29,30,38,56,211,95,28,181,64,8,212,211,87,202,3,190,120,233,238]),TapBranch:Buffer.from([25,65,161,242,229,110,185,95,162,169,241,148,190,92,1,247,33,111,51,237,130,176,145,70,52,144,208,91,245,22,160,21,25,65,161,242,229,110,185,95,162,169,241,148,190,92,1,247,33,111,51,237,130,176,145,70,52,144,208,91,245,22,160,21]),TapSighash:Buffer.from([244,10,72,223,75,42,112,200,180,146,75,242,101,70,97,237,61,149,253,102,163,19,235,135,35,117,151,198,40,228,160,49,244,10,72,223,75,42,112,200,180,146,75,242,101,70,97,237,61,149,253,102,163,19,235,135,35,117,151,198,40,228,160,49]),TapTweak:Buffer.from([232,15,225,99,156,156,160,80,227,175,27,57,193,67,198,62,66,156,188,235,21,217,64,251,181,197,161,244,175,87,197,233,232,15,225,99,156,156,160,80,227,175,27,57,193,67,198,62,66,156,188,235,21,217,64,251,181,197,161,244,175,87,197,233]),"KeyAgg list":Buffer.from([72,28,151,28,60,11,70,215,240,178,117,174,89,141,78,44,126,215,49,156,89,74,92,110,199,158,160,212,153,2,148,240,72,28,151,28,60,11,70,215,240,178,117,174,89,141,78,44,126,215,49,156,89,74,92,110,199,158,160,212,153,2,148,240]),"KeyAgg coefficient":Buffer.from([191,201,4,3,77,28,136,232,200,14,34,229,61,36,86,109,100,130,78,214,66,114,129,192,145,0,249,77,205,82,201,129,191,201,4,3,77,28,136,232,200,14,34,229,61,36,86,109,100,130,78,214,66,114,129,192,145,0,249,77,205,82,201,129])},e.taggedHash=function(t,r){return s(Buffer.concat([e.TAGGED_HASH_PREFIXES[t],r]))}}(Ss);var hi=function(e){if(e.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),r=0;r<t.length;r++)t[r]=255;for(var n=0;n<e.length;n++){var s=e.charAt(n),i=s.charCodeAt(0);if(255!==t[i])throw new TypeError(s+" is ambiguous");t[i]=n}var o=e.length,a=e.charAt(0),u=Math.log(o)/Math.log(256),c=Math.log(256)/Math.log(o);function l(e){if("string"!=typeof e)throw new TypeError("Expected String");if(0===e.length)return new Uint8Array;for(var r=0,n=0,s=0;e[r]===a;)n++,r++;for(var i=(e.length-r)*u+1>>>0,c=new Uint8Array(i);e[r];){var l=t[e.charCodeAt(r)];if(255===l)return;for(var f=0,p=i-1;(0!==l||f<s)&&-1!==p;p--,f++)l+=o*c[p]>>>0,c[p]=l%256>>>0,l=l/256>>>0;if(0!==l)throw new Error("Non-zero carry");s=f,r++}for(var h=i-s;h!==i&&0===c[h];)h++;for(var d=new Uint8Array(n+(i-h)),m=n;h!==i;)d[m++]=c[h++];return d}return{encode:function(t){if(t instanceof Uint8Array||(ArrayBuffer.isView(t)?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(t=Uint8Array.from(t))),!(t instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===t.length)return"";for(var r=0,n=0,s=0,i=t.length;s!==i&&0===t[s];)s++,r++;for(var u=(i-s)*c+1>>>0,l=new Uint8Array(u);s!==i;){for(var f=t[s],p=0,h=u-1;(0!==f||p<n)&&-1!==h;h--,p++)f+=256*l[h]>>>0,l[h]=f%o>>>0,f=f/o>>>0;if(0!==f)throw new Error("Non-zero carry");n=p,s++}for(var d=u-n;d!==u&&0===l[d];)d++;for(var m=a.repeat(r);d<u;++d)m+=e.charAt(l[d]);return m},decodeUnsafe:l,decode:function(e){var t=l(e);if(t)return t;throw new Error("Non-base"+o+" character")}}};var di=hi("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"),{sha256:mi}=ii,yi=function(e){function t(t){var r=t.slice(0,-4),n=t.slice(-4),s=e(r);if(!(n[0]^s[0]|n[1]^s[1]|n[2]^s[2]|n[3]^s[3]))return r}return{encode:function(t){var r=Uint8Array.from(t),n=e(r),s=r.length+4,i=new Uint8Array(s);return i.set(r,0),i.set(n.subarray(0,4),r.length),di.encode(i,s)},decode:function(e){var r=t(di.decode(e));if(!r)throw new Error("Invalid checksum");return r},decodeUnsafe:function(e){var r=di.decodeUnsafe(e);if(r)return t(r)}}};var gi=yi((function(e){return mi(mi(e))}));Object.defineProperty(Es,"__esModule",{value:!0}),Es.p2pkh=void 0;const bi=Ss,vi=ln,_i=hn,wi=Sn,Ei=rs,Si=gi,Ai=_i.OPS;Es.p2pkh=function(e,t){if(!(e.address||e.hash||e.output||e.pubkey||e.input))throw new TypeError("Not enough data");t=Object.assign({validate:!0},t||{}),(0,wi.typeforce)({network:wi.typeforce.maybe(wi.typeforce.Object),address:wi.typeforce.maybe(wi.typeforce.String),hash:wi.typeforce.maybe(wi.typeforce.BufferN(20)),output:wi.typeforce.maybe(wi.typeforce.BufferN(25)),pubkey:wi.typeforce.maybe(wi.isPoint),signature:wi.typeforce.maybe(_i.isCanonicalScriptSignature),input:wi.typeforce.maybe(wi.typeforce.Buffer)},e);const r=Ei.value((()=>{const t=Buffer.from(Si.decode(e.address));return{version:t.readUInt8(0),hash:t.slice(1)}})),n=Ei.value((()=>_i.decompile(e.input))),s=e.network||vi.bitcoin,i={name:"p2pkh",network:s};if(Ei.prop(i,"address",(()=>{if(!i.hash)return;const e=Buffer.allocUnsafe(21);return e.writeUInt8(s.pubKeyHash,0),i.hash.copy(e,1),Si.encode(e)})),Ei.prop(i,"hash",(()=>e.output?e.output.slice(3,23):e.address?r().hash:e.pubkey||i.pubkey?bi.hash160(e.pubkey||i.pubkey):void 0)),Ei.prop(i,"output",(()=>{if(i.hash)return _i.compile([Ai.OP_DUP,Ai.OP_HASH160,i.hash,Ai.OP_EQUALVERIFY,Ai.OP_CHECKSIG])})),Ei.prop(i,"pubkey",(()=>{if(e.input)return n()[1]})),Ei.prop(i,"signature",(()=>{if(e.input)return n()[0]})),Ei.prop(i,"input",(()=>{if(e.pubkey&&e.signature)return _i.compile([e.signature,e.pubkey])})),Ei.prop(i,"witness",(()=>{if(i.input)return[]})),t.validate){let t=Buffer.from([]);if(e.address){if(r().version!==s.pubKeyHash)throw new TypeError("Invalid version or Network mismatch");if(20!==r().hash.length)throw new TypeError("Invalid address");t=r().hash}if(e.hash){if(t.length>0&&!t.equals(e.hash))throw new TypeError("Hash mismatch");t=e.hash}if(e.output){if(25!==e.output.length||e.output[0]!==Ai.OP_DUP||e.output[1]!==Ai.OP_HASH160||20!==e.output[2]||e.output[23]!==Ai.OP_EQUALVERIFY||e.output[24]!==Ai.OP_CHECKSIG)throw new TypeError("Output is invalid");const r=e.output.slice(3,23);if(t.length>0&&!t.equals(r))throw new TypeError("Hash mismatch");t=r}if(e.pubkey){const r=bi.hash160(e.pubkey);if(t.length>0&&!t.equals(r))throw new TypeError("Hash mismatch");t=r}if(e.input){const r=n();if(2!==r.length)throw new TypeError("Input is invalid");if(!_i.isCanonicalScriptSignature(r[0]))throw new TypeError("Input has invalid signature");if(!(0,wi.isPoint)(r[1]))throw new TypeError("Input has invalid pubkey");if(e.signature&&!e.signature.equals(r[0]))throw new TypeError("Signature mismatch");if(e.pubkey&&!e.pubkey.equals(r[1]))throw new TypeError("Pubkey mismatch");const s=bi.hash160(r[1]);if(t.length>0&&!t.equals(s))throw new TypeError("Hash mismatch")}}return Object.assign(i,e)};var Ti={};Object.defineProperty(Ti,"__esModule",{value:!0}),Ti.p2sh=void 0;const Ii=Ss,Oi=ln,ki=hn,Ri=Sn,Ni=rs,Pi=gi,xi=ki.OPS;Ti.p2sh=function(e,t){if(!(e.address||e.hash||e.output||e.redeem||e.input))throw new TypeError("Not enough data");t=Object.assign({validate:!0},t||{}),(0,Ri.typeforce)({network:Ri.typeforce.maybe(Ri.typeforce.Object),address:Ri.typeforce.maybe(Ri.typeforce.String),hash:Ri.typeforce.maybe(Ri.typeforce.BufferN(20)),output:Ri.typeforce.maybe(Ri.typeforce.BufferN(23)),redeem:Ri.typeforce.maybe({network:Ri.typeforce.maybe(Ri.typeforce.Object),output:Ri.typeforce.maybe(Ri.typeforce.Buffer),input:Ri.typeforce.maybe(Ri.typeforce.Buffer),witness:Ri.typeforce.maybe(Ri.typeforce.arrayOf(Ri.typeforce.Buffer))}),input:Ri.typeforce.maybe(Ri.typeforce.Buffer),witness:Ri.typeforce.maybe(Ri.typeforce.arrayOf(Ri.typeforce.Buffer))},e);let r=e.network;r||(r=e.redeem&&e.redeem.network||Oi.bitcoin);const n={network:r},s=Ni.value((()=>{const t=Buffer.from(Pi.decode(e.address));return{version:t.readUInt8(0),hash:t.slice(1)}})),i=Ni.value((()=>ki.decompile(e.input))),o=Ni.value((()=>{const t=i(),n=t[t.length-1];return{network:r,output:n===xi.OP_FALSE?Buffer.from([]):n,input:ki.compile(t.slice(0,-1)),witness:e.witness||[]}}));if(Ni.prop(n,"address",(()=>{if(!n.hash)return;const e=Buffer.allocUnsafe(21);return e.writeUInt8(n.network.scriptHash,0),n.hash.copy(e,1),Pi.encode(e)})),Ni.prop(n,"hash",(()=>e.output?e.output.slice(2,22):e.address?s().hash:n.redeem&&n.redeem.output?Ii.hash160(n.redeem.output):void 0)),Ni.prop(n,"output",(()=>{if(n.hash)return ki.compile([xi.OP_HASH160,n.hash,xi.OP_EQUAL])})),Ni.prop(n,"redeem",(()=>{if(e.input)return o()})),Ni.prop(n,"input",(()=>{if(e.redeem&&e.redeem.input&&e.redeem.output)return ki.compile([].concat(ki.decompile(e.redeem.input),e.redeem.output))})),Ni.prop(n,"witness",(()=>n.redeem&&n.redeem.witness?n.redeem.witness:n.input?[]:void 0)),Ni.prop(n,"name",(()=>{const e=["p2sh"];return void 0!==n.redeem&&void 0!==n.redeem.name&&e.push(n.redeem.name),e.join("-")})),t.validate){let t=Buffer.from([]);if(e.address){if(s().version!==r.scriptHash)throw new TypeError("Invalid version or Network mismatch");if(20!==s().hash.length)throw new TypeError("Invalid address");t=s().hash}if(e.hash){if(t.length>0&&!t.equals(e.hash))throw new TypeError("Hash mismatch");t=e.hash}if(e.output){if(23!==e.output.length||e.output[0]!==xi.OP_HASH160||20!==e.output[1]||e.output[22]!==xi.OP_EQUAL)throw new TypeError("Output is invalid");const r=e.output.slice(2,22);if(t.length>0&&!t.equals(r))throw new TypeError("Hash mismatch");t=r}const n=e=>{if(e.output){const r=ki.decompile(e.output);if(!r||r.length<1)throw new TypeError("Redeem.output too short");if(e.output.byteLength>520)throw new TypeError("Redeem.output unspendable if larger than 520 bytes");if(ki.countNonPushOnlyOPs(r)>201)throw new TypeError("Redeem.output unspendable with more than 201 non-push ops");const n=Ii.hash160(e.output);if(t.length>0&&!t.equals(n))throw new TypeError("Hash mismatch");t=n}if(e.input){const t=e.input.length>0,r=e.witness&&e.witness.length>0;if(!t&&!r)throw new TypeError("Empty input");if(t&&r)throw new TypeError("Input and witness provided");if(t){const t=ki.decompile(e.input);if(!ki.isPushOnly(t))throw new TypeError("Non push-only scriptSig")}}};if(e.input){const e=i();if(!e||e.length<1)throw new TypeError("Input too short");if(!Buffer.isBuffer(o().output))throw new TypeError("Input is invalid");n(o())}if(e.redeem){if(e.redeem.network&&e.redeem.network!==r)throw new TypeError("Network mismatch");if(e.input){const t=o();if(e.redeem.output&&!e.redeem.output.equals(t.output))throw new TypeError("Redeem.output mismatch");if(e.redeem.input&&!e.redeem.input.equals(t.input))throw new TypeError("Redeem.input mismatch")}n(e.redeem)}if(e.witness&&e.redeem&&e.redeem.witness&&!function(e,t){return e.length===t.length&&e.every(((e,r)=>e.equals(t[r])))}(e.redeem.witness,e.witness))throw new TypeError("Witness and redeem.witness mismatch")}return Object.assign(n,e)};var Ci={},Bi={};Object.defineProperty(Bi,"__esModule",{value:!0}),Bi.bech32m=Bi.bech32=void 0;const Li="qpzry9x8gf2tvdw0s3jn54khce6mua7l",$i={};for(let e=0;e<32;e++){const t=Li.charAt(e);$i[t]=e}function Ui(e){const t=e>>25;return(33554431&e)<<5^996825010&-(1&t)^642813549&-(t>>1&1)^513874426&-(t>>2&1)^1027748829&-(t>>3&1)^705979059&-(t>>4&1)}function Di(e){let t=1;for(let r=0;r<e.length;++r){const n=e.charCodeAt(r);if(n<33||n>126)return"Invalid prefix ("+e+")";t=Ui(t)^n>>5}t=Ui(t);for(let r=0;r<e.length;++r){const n=e.charCodeAt(r);t=Ui(t)^31&n}return t}function ji(e,t,r,n){let s=0,i=0;const o=(1<<r)-1,a=[];for(let n=0;n<e.length;++n)for(s=s<<t|e[n],i+=t;i>=r;)i-=r,a.push(s>>i&o);if(n)i>0&&a.push(s<<r-i&o);else{if(i>=t)return"Excess padding";if(s<<r-i&o)return"Non-zero padding"}return a}function Mi(e){return ji(e,8,5,!0)}function Hi(e){const t=ji(e,5,8,!1);if(Array.isArray(t))return t}function Fi(e){const t=ji(e,5,8,!1);if(Array.isArray(t))return t;throw new Error(t)}function Ki(e){let t;function r(e,r){if(r=r||90,e.length<8)return e+" too short";if(e.length>r)return"Exceeds length limit";const n=e.toLowerCase(),s=e.toUpperCase();if(e!==n&&e!==s)return"Mixed-case string "+e;const i=(e=n).lastIndexOf("1");if(-1===i)return"No separator character for "+e;if(0===i)return"Missing prefix for "+e;const o=e.slice(0,i),a=e.slice(i+1);if(a.length<6)return"Data too short";let u=Di(o);if("string"==typeof u)return u;const c=[];for(let e=0;e<a.length;++e){const t=a.charAt(e),r=$i[t];if(void 0===r)return"Unknown character "+t;u=Ui(u)^r,e+6>=a.length||c.push(r)}return u!==t?"Invalid checksum for "+e:{prefix:o,words:c}}return t="bech32"===e?1:734539939,{decodeUnsafe:function(e,t){const n=r(e,t);if("object"==typeof n)return n},decode:function(e,t){const n=r(e,t);if("object"==typeof n)return n;throw new Error(n)},encode:function(e,r,n){if(n=n||90,e.length+7+r.length>n)throw new TypeError("Exceeds length limit");let s=Di(e=e.toLowerCase());if("string"==typeof s)throw new Error(s);let i=e+"1";for(let e=0;e<r.length;++e){const t=r[e];if(t>>5)throw new Error("Non 5-bit word");s=Ui(s)^t,i+=Li.charAt(t)}for(let e=0;e<6;++e)s=Ui(s);s^=t;for(let e=0;e<6;++e){i+=Li.charAt(s>>5*(5-e)&31)}return i},toWords:Mi,fromWordsUnsafe:Hi,fromWords:Fi}}Bi.bech32=Ki("bech32"),Bi.bech32m=Ki("bech32m"),Object.defineProperty(Ci,"__esModule",{value:!0}),Ci.p2wpkh=void 0;const Gi=Ss,Vi=ln,Xi=hn,Wi=Sn,qi=rs,Zi=Bi,Yi=Xi.OPS,zi=Buffer.alloc(0);Ci.p2wpkh=function(e,t){if(!(e.address||e.hash||e.output||e.pubkey||e.witness))throw new TypeError("Not enough data");t=Object.assign({validate:!0},t||{}),(0,Wi.typeforce)({address:Wi.typeforce.maybe(Wi.typeforce.String),hash:Wi.typeforce.maybe(Wi.typeforce.BufferN(20)),input:Wi.typeforce.maybe(Wi.typeforce.BufferN(0)),network:Wi.typeforce.maybe(Wi.typeforce.Object),output:Wi.typeforce.maybe(Wi.typeforce.BufferN(22)),pubkey:Wi.typeforce.maybe(Wi.isPoint),signature:Wi.typeforce.maybe(Xi.isCanonicalScriptSignature),witness:Wi.typeforce.maybe(Wi.typeforce.arrayOf(Wi.typeforce.Buffer))},e);const r=qi.value((()=>{const t=Zi.bech32.decode(e.address),r=t.words.shift(),n=Zi.bech32.fromWords(t.words);return{version:r,prefix:t.prefix,data:Buffer.from(n)}})),n=e.network||Vi.bitcoin,s={name:"p2wpkh",network:n};if(qi.prop(s,"address",(()=>{if(!s.hash)return;const e=Zi.bech32.toWords(s.hash);return e.unshift(0),Zi.bech32.encode(n.bech32,e)})),qi.prop(s,"hash",(()=>e.output?e.output.slice(2,22):e.address?r().data:e.pubkey||s.pubkey?Gi.hash160(e.pubkey||s.pubkey):void 0)),qi.prop(s,"output",(()=>{if(s.hash)return Xi.compile([Yi.OP_0,s.hash])})),qi.prop(s,"pubkey",(()=>e.pubkey?e.pubkey:e.witness?e.witness[1]:void 0)),qi.prop(s,"signature",(()=>{if(e.witness)return e.witness[0]})),qi.prop(s,"input",(()=>{if(s.witness)return zi})),qi.prop(s,"witness",(()=>{if(e.pubkey&&e.signature)return[e.signature,e.pubkey]})),t.validate){let t=Buffer.from([]);if(e.address){if(n&&n.bech32!==r().prefix)throw new TypeError("Invalid prefix or Network mismatch");if(0!==r().version)throw new TypeError("Invalid address version");if(20!==r().data.length)throw new TypeError("Invalid address data");t=r().data}if(e.hash){if(t.length>0&&!t.equals(e.hash))throw new TypeError("Hash mismatch");t=e.hash}if(e.output){if(22!==e.output.length||e.output[0]!==Yi.OP_0||20!==e.output[1])throw new TypeError("Output is invalid");if(t.length>0&&!t.equals(e.output.slice(2)))throw new TypeError("Hash mismatch");t=e.output.slice(2)}if(e.pubkey){const r=Gi.hash160(e.pubkey);if(t.length>0&&!t.equals(r))throw new TypeError("Hash mismatch");if(t=r,!(0,Wi.isPoint)(e.pubkey)||33!==e.pubkey.length)throw new TypeError("Invalid pubkey for p2wpkh")}if(e.witness){if(2!==e.witness.length)throw new TypeError("Witness is invalid");if(!Xi.isCanonicalScriptSignature(e.witness[0]))throw new TypeError("Witness has invalid signature");if(!(0,Wi.isPoint)(e.witness[1])||33!==e.witness[1].length)throw new TypeError("Witness has invalid pubkey");if(e.signature&&!e.signature.equals(e.witness[0]))throw new TypeError("Signature mismatch");if(e.pubkey&&!e.pubkey.equals(e.witness[1]))throw new TypeError("Pubkey mismatch");const r=Gi.hash160(e.witness[1]);if(t.length>0&&!t.equals(r))throw new TypeError("Hash mismatch")}}return Object.assign(s,e)};var Ji={};Object.defineProperty(Ji,"__esModule",{value:!0}),Ji.p2wsh=void 0;const Qi=Ss,eo=ln,to=hn,ro=Sn,no=rs,so=Bi,io=to.OPS,oo=Buffer.alloc(0);function ao(e){return!(!Buffer.isBuffer(e)||65!==e.length||4!==e[0]||!(0,ro.isPoint)(e))}Ji.p2wsh=function(e,t){if(!(e.address||e.hash||e.output||e.redeem||e.witness))throw new TypeError("Not enough data");t=Object.assign({validate:!0},t||{}),(0,ro.typeforce)({network:ro.typeforce.maybe(ro.typeforce.Object),address:ro.typeforce.maybe(ro.typeforce.String),hash:ro.typeforce.maybe(ro.typeforce.BufferN(32)),output:ro.typeforce.maybe(ro.typeforce.BufferN(34)),redeem:ro.typeforce.maybe({input:ro.typeforce.maybe(ro.typeforce.Buffer),network:ro.typeforce.maybe(ro.typeforce.Object),output:ro.typeforce.maybe(ro.typeforce.Buffer),witness:ro.typeforce.maybe(ro.typeforce.arrayOf(ro.typeforce.Buffer))}),input:ro.typeforce.maybe(ro.typeforce.BufferN(0)),witness:ro.typeforce.maybe(ro.typeforce.arrayOf(ro.typeforce.Buffer))},e);const r=no.value((()=>{const t=so.bech32.decode(e.address),r=t.words.shift(),n=so.bech32.fromWords(t.words);return{version:r,prefix:t.prefix,data:Buffer.from(n)}})),n=no.value((()=>to.decompile(e.redeem.input)));let s=e.network;s||(s=e.redeem&&e.redeem.network||eo.bitcoin);const i={network:s};if(no.prop(i,"address",(()=>{if(!i.hash)return;const e=so.bech32.toWords(i.hash);return e.unshift(0),so.bech32.encode(s.bech32,e)})),no.prop(i,"hash",(()=>e.output?e.output.slice(2):e.address?r().data:i.redeem&&i.redeem.output?Qi.sha256(i.redeem.output):void 0)),no.prop(i,"output",(()=>{if(i.hash)return to.compile([io.OP_0,i.hash])})),no.prop(i,"redeem",(()=>{if(e.witness)return{output:e.witness[e.witness.length-1],input:oo,witness:e.witness.slice(0,-1)}})),no.prop(i,"input",(()=>{if(i.witness)return oo})),no.prop(i,"witness",(()=>{if(e.redeem&&e.redeem.input&&e.redeem.input.length>0&&e.redeem.output&&e.redeem.output.length>0){const t=to.toStack(n());return i.redeem=Object.assign({witness:t},e.redeem),i.redeem.input=oo,[].concat(t,e.redeem.output)}if(e.redeem&&e.redeem.output&&e.redeem.witness)return[].concat(e.redeem.witness,e.redeem.output)})),no.prop(i,"name",(()=>{const e=["p2wsh"];return void 0!==i.redeem&&void 0!==i.redeem.name&&e.push(i.redeem.name),e.join("-")})),t.validate){let t=Buffer.from([]);if(e.address){if(r().prefix!==s.bech32)throw new TypeError("Invalid prefix or Network mismatch");if(0!==r().version)throw new TypeError("Invalid address version");if(32!==r().data.length)throw new TypeError("Invalid address data");t=r().data}if(e.hash){if(t.length>0&&!t.equals(e.hash))throw new TypeError("Hash mismatch");t=e.hash}if(e.output){if(34!==e.output.length||e.output[0]!==io.OP_0||32!==e.output[1])throw new TypeError("Output is invalid");const r=e.output.slice(2);if(t.length>0&&!t.equals(r))throw new TypeError("Hash mismatch");t=r}if(e.redeem){if(e.redeem.network&&e.redeem.network!==s)throw new TypeError("Network mismatch");if(e.redeem.input&&e.redeem.input.length>0&&e.redeem.witness&&e.redeem.witness.length>0)throw new TypeError("Ambiguous witness source");if(e.redeem.output){const r=to.decompile(e.redeem.output);if(!r||r.length<1)throw new TypeError("Redeem.output is invalid");if(e.redeem.output.byteLength>3600)throw new TypeError("Redeem.output unspendable if larger than 3600 bytes");if(to.countNonPushOnlyOPs(r)>201)throw new TypeError("Redeem.output unspendable with more than 201 non-push ops");const n=Qi.sha256(e.redeem.output);if(t.length>0&&!t.equals(n))throw new TypeError("Hash mismatch");t=n}if(e.redeem.input&&!to.isPushOnly(n()))throw new TypeError("Non push-only scriptSig");if(e.witness&&e.redeem.witness&&!function(e,t){return e.length===t.length&&e.every(((e,r)=>e.equals(t[r])))}(e.witness,e.redeem.witness))throw new TypeError("Witness and redeem.witness mismatch");if(e.redeem.input&&n().some(ao)||e.redeem.output&&(to.decompile(e.redeem.output)||[]).some(ao))throw new TypeError("redeem.input or redeem.output contains uncompressed pubkey")}if(e.witness&&e.witness.length>0){const t=e.witness[e.witness.length-1];if(e.redeem&&e.redeem.output&&!e.redeem.output.equals(t))throw new TypeError("Witness and redeem.output mismatch");if(e.witness.some(ao)||(to.decompile(t)||[]).some(ao))throw new TypeError("Witness contains uncompressed pubkey")}}return Object.assign(i,e)};var uo={},co={};Object.defineProperty(co,"__esModule",{value:!0}),co.getEccLib=co.initEccLib=void 0;const lo={};co.initEccLib=function(e){e?e!==lo.eccLib&&(!function(e){po("function"==typeof e.isXOnlyPoint),po(e.isXOnlyPoint(fo("79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798"))),po(e.isXOnlyPoint(fo("fffffffffffffffffffffffffffffffffffffffffffffffffffffffeeffffc2e"))),po(e.isXOnlyPoint(fo("f9308a019258c31049344f85f89d5229b531c845836f99b08601f113bce036f9"))),po(e.isXOnlyPoint(fo("0000000000000000000000000000000000000000000000000000000000000001"))),po(!e.isXOnlyPoint(fo("0000000000000000000000000000000000000000000000000000000000000000"))),po(!e.isXOnlyPoint(fo("fffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"))),po("function"==typeof e.xOnlyPointAddTweak),ho.forEach((t=>{const r=e.xOnlyPointAddTweak(fo(t.pubkey),fo(t.tweak));null===t.result?po(null===r):(po(null!==r),po(r.parity===t.parity),po(Buffer.from(r.xOnlyPubkey).equals(fo(t.result))))}))}(e),lo.eccLib=e):lo.eccLib=e},co.getEccLib=function(){if(!lo.eccLib)throw new Error("No ECC Library provided. You must call initEccLib() with a valid TinySecp256k1Interface instance");return lo.eccLib};const fo=e=>Buffer.from(e,"hex");function po(e){if(!e)throw new Error("ecc library invalid")}const ho=[{pubkey:"79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798",tweak:"fffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364140",parity:-1,result:null},{pubkey:"1617d38ed8d8657da4d4761e8057bc396ea9e4b9d29776d4be096016dbd2509b",tweak:"a8397a935f0dfceba6ba9618f6451ef4d80637abf4e6af2669fbc9de6a8fd2ac",parity:1,result:"e478f99dab91052ab39a33ea35fd5e6e4933f4d28023cd597c9a1f6760346adf"},{pubkey:"2c0b7cf95324a07d05398b240174dc0c2be444d96b159aa6c7f7b1e668680991",tweak:"823c3cd2142744b075a87eade7e1b8678ba308d566226a0056ca2b7a76f86b47",parity:0,result:"9534f8dc8c6deda2dc007655981c78b49c5d96c778fbf363462a11ec9dfd948c"}];var mo={},yo={},go={exports:{}};
/*! safe-buffer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */
!function(e,r){var n=t,s=n.Buffer;function i(e,t){for(var r in e)t[r]=e[r]}function o(e,t,r){return s(e,t,r)}s.from&&s.alloc&&s.allocUnsafe&&s.allocUnsafeSlow?e.exports=n:(i(n,r),r.Buffer=o),o.prototype=Object.create(s.prototype),i(s,o),o.from=function(e,t,r){if("number"==typeof e)throw new TypeError("Argument must not be a number");return s(e,t,r)},o.alloc=function(e,t,r){if("number"!=typeof e)throw new TypeError("Argument must be a number");var n=s(e);return void 0!==t?"string"==typeof r?n.fill(t,r):n.fill(t):n.fill(0),n},o.allocUnsafe=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return s(e)},o.allocUnsafeSlow=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return n.SlowBuffer(e)}}(go,go.exports);var bo=go.exports,vo=bo.Buffer,_o=9007199254740991;function wo(e){if(e<0||e>_o||e%1!=0)throw new RangeError("value out of range")}function Eo(e){return wo(e),e<253?1:e<=65535?3:e<=4294967295?5:9}var So={encode:function e(t,r,n){if(wo(t),r||(r=vo.allocUnsafe(Eo(t))),!vo.isBuffer(r))throw new TypeError("buffer must be a Buffer instance");return n||(n=0),t<253?(r.writeUInt8(t,n),e.bytes=1):t<=65535?(r.writeUInt8(253,n),r.writeUInt16LE(t,n+1),e.bytes=3):t<=4294967295?(r.writeUInt8(254,n),r.writeUInt32LE(t,n+1),e.bytes=5):(r.writeUInt8(255,n),r.writeUInt32LE(t>>>0,n+1),r.writeUInt32LE(t/4294967296|0,n+5),e.bytes=9),r},decode:function e(t,r){if(!vo.isBuffer(t))throw new TypeError("buffer must be a Buffer instance");r||(r=0);var n=t.readUInt8(r);if(n<253)return e.bytes=1,n;if(253===n)return e.bytes=3,t.readUInt16LE(r+1);if(254===n)return e.bytes=5,t.readUInt32LE(r+1);e.bytes=9;var s=t.readUInt32LE(r+1),i=4294967296*t.readUInt32LE(r+5)+s;return wo(i),i},encodingLength:Eo};Object.defineProperty(yo,"__esModule",{value:!0}),yo.BufferReader=yo.BufferWriter=yo.cloneBuffer=yo.reverseBuffer=yo.writeUInt64LE=yo.readUInt64LE=yo.varuint=void 0;const Ao=Sn,{typeforce:To}=Ao,Io=So;function Oo(e,t){if("number"!=typeof e)throw new Error("cannot write a non-number as a number");if(e<0)throw new Error("specified a negative value for writing an unsigned value");if(e>t)throw new Error("RangeError: value out of range");if(Math.floor(e)!==e)throw new Error("value has a fractional component")}function ko(e,t){const r=e.readUInt32LE(t);let n=e.readUInt32LE(t+4);return n*=4294967296,Oo(n+r,9007199254740991),n+r}function Ro(e,t,r){return Oo(t,9007199254740991),e.writeInt32LE(-1&t,r),e.writeUInt32LE(Math.floor(t/4294967296),r+4),r+8}yo.varuint=Io,yo.readUInt64LE=ko,yo.writeUInt64LE=Ro,yo.reverseBuffer=function(e){if(e.length<1)return e;let t=e.length-1,r=0;for(let n=0;n<e.length/2;n++)r=e[n],e[n]=e[t],e[t]=r,t--;return e},yo.cloneBuffer=function(e){const t=Buffer.allocUnsafe(e.length);return e.copy(t),t};class No{static withCapacity(e){return new No(Buffer.alloc(e))}constructor(e,t=0){this.buffer=e,this.offset=t,To(Ao.tuple(Ao.Buffer,Ao.UInt32),[e,t])}writeUInt8(e){this.offset=this.buffer.writeUInt8(e,this.offset)}writeInt32(e){this.offset=this.buffer.writeInt32LE(e,this.offset)}writeUInt32(e){this.offset=this.buffer.writeUInt32LE(e,this.offset)}writeUInt64(e){this.offset=Ro(this.buffer,e,this.offset)}writeVarInt(e){Io.encode(e,this.buffer,this.offset),this.offset+=Io.encode.bytes}writeSlice(e){if(this.buffer.length<this.offset+e.length)throw new Error("Cannot write slice out of bounds");this.offset+=e.copy(this.buffer,this.offset)}writeVarSlice(e){this.writeVarInt(e.length),this.writeSlice(e)}writeVector(e){this.writeVarInt(e.length),e.forEach((e=>this.writeVarSlice(e)))}end(){if(this.buffer.length===this.offset)return this.buffer;throw new Error(`buffer size ${this.buffer.length}, offset ${this.offset}`)}}yo.BufferWriter=No;yo.BufferReader=class{constructor(e,t=0){this.buffer=e,this.offset=t,To(Ao.tuple(Ao.Buffer,Ao.UInt32),[e,t])}readUInt8(){const e=this.buffer.readUInt8(this.offset);return this.offset++,e}readInt32(){const e=this.buffer.readInt32LE(this.offset);return this.offset+=4,e}readUInt32(){const e=this.buffer.readUInt32LE(this.offset);return this.offset+=4,e}readUInt64(){const e=ko(this.buffer,this.offset);return this.offset+=8,e}readVarInt(){const e=Io.decode(this.buffer,this.offset);return this.offset+=Io.decode.bytes,e}readSlice(e){if(this.buffer.length<this.offset+e)throw new Error("Cannot read slice out of bounds");const t=this.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t}readVarSlice(){return this.readSlice(this.readVarInt())}readVector(){const e=this.readVarInt(),t=[];for(let r=0;r<e;r++)t.push(this.readVarSlice());return t}},function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.tweakKey=e.tapTweakHash=e.tapleafHash=e.findScriptPath=e.toHashTree=e.rootHashFromPath=e.MAX_TAPTREE_DEPTH=e.LEAF_VERSION_TAPSCRIPT=void 0;const r=t,n=co,s=Ss,i=yo,o=Sn;e.LEAF_VERSION_TAPSCRIPT=192,e.MAX_TAPTREE_DEPTH=128;function a(t){const n=t.version||e.LEAF_VERSION_TAPSCRIPT;return s.taggedHash("TapLeaf",r.Buffer.concat([r.Buffer.from([n]),l(t.output)]))}function u(e,t){return s.taggedHash("TapTweak",r.Buffer.concat(t?[e,t]:[e]))}function c(e,t){return s.taggedHash("TapBranch",r.Buffer.concat([e,t]))}function l(e){const t=i.varuint.encodingLength(e.length),n=r.Buffer.allocUnsafe(t);return i.varuint.encode(e.length,n),r.Buffer.concat([n,e])}e.rootHashFromPath=function(e,t){if(e.length<33)throw new TypeError(`The control-block length is too small. Got ${e.length}, expected min 33.`);const r=(e.length-33)/32;let n=t;for(let t=0;t<r;t++){const r=e.slice(33+32*t,65+32*t);n=n.compare(r)<0?c(n,r):c(r,n)}return n},e.toHashTree=function e(t){if((0,o.isTapleaf)(t))return{hash:a(t)};const r=[e(t[0]),e(t[1])];r.sort(((e,t)=>e.hash.compare(t.hash)));const[n,s]=r;return{hash:c(n.hash,s.hash),left:n,right:s}},e.findScriptPath=function e(t,r){if("left"in(n=t)&&"right"in n){const n=e(t.left,r);if(void 0!==n)return[...n,t.right.hash];const s=e(t.right,r);if(void 0!==s)return[...s,t.left.hash]}else if(t.hash.equals(r))return[];var n},e.tapleafHash=a,e.tapTweakHash=u,e.tweakKey=function(e,t){if(!r.Buffer.isBuffer(e))return null;if(32!==e.length)return null;if(t&&32!==t.length)return null;const s=u(e,t),i=(0,n.getEccLib)().xOnlyPointAddTweak(e,s);return i&&null!==i.xOnlyPubkey?{parity:i.parity,x:r.Buffer.from(i.xOnlyPubkey)}:null}}(mo),Object.defineProperty(uo,"__esModule",{value:!0}),uo.p2tr=void 0;const Po=t,xo=ln,Co=hn,Bo=Sn,Lo=co,$o=mo,Uo=rs,Do=Bi,jo=Co.OPS;uo.p2tr=function(e,t){if(!(e.address||e.output||e.pubkey||e.internalPubkey||e.witness&&e.witness.length>1))throw new TypeError("Not enough data");t=Object.assign({validate:!0},t||{}),(0,Bo.typeforce)({address:Bo.typeforce.maybe(Bo.typeforce.String),input:Bo.typeforce.maybe(Bo.typeforce.BufferN(0)),network:Bo.typeforce.maybe(Bo.typeforce.Object),output:Bo.typeforce.maybe(Bo.typeforce.BufferN(34)),internalPubkey:Bo.typeforce.maybe(Bo.typeforce.BufferN(32)),hash:Bo.typeforce.maybe(Bo.typeforce.BufferN(32)),pubkey:Bo.typeforce.maybe(Bo.typeforce.BufferN(32)),signature:Bo.typeforce.maybe(Bo.typeforce.anyOf(Bo.typeforce.BufferN(64),Bo.typeforce.BufferN(65))),witness:Bo.typeforce.maybe(Bo.typeforce.arrayOf(Bo.typeforce.Buffer)),scriptTree:Bo.typeforce.maybe(Bo.isTaptree),redeem:Bo.typeforce.maybe({output:Bo.typeforce.maybe(Bo.typeforce.Buffer),redeemVersion:Bo.typeforce.maybe(Bo.typeforce.Number),witness:Bo.typeforce.maybe(Bo.typeforce.arrayOf(Bo.typeforce.Buffer))}),redeemVersion:Bo.typeforce.maybe(Bo.typeforce.Number)},e);const r=Uo.value((()=>{const t=Do.bech32m.decode(e.address),r=t.words.shift(),n=Do.bech32m.fromWords(t.words);return{version:r,prefix:t.prefix,data:Po.Buffer.from(n)}})),n=Uo.value((()=>{if(e.witness&&e.witness.length)return e.witness.length>=2&&80===e.witness[e.witness.length-1][0]?e.witness.slice(0,-1):e.witness.slice()})),s=Uo.value((()=>e.scriptTree?(0,$o.toHashTree)(e.scriptTree):e.hash?{hash:e.hash}:void 0)),i=e.network||xo.bitcoin,o={name:"p2tr",network:i};if(Uo.prop(o,"address",(()=>{if(!o.pubkey)return;const e=Do.bech32m.toWords(o.pubkey);return e.unshift(1),Do.bech32m.encode(i.bech32,e)})),Uo.prop(o,"hash",(()=>{const e=s();if(e)return e.hash;const t=n();if(t&&t.length>1){const e=t[t.length-1],r=e[0]&Bo.TAPLEAF_VERSION_MASK,n=t[t.length-2],s=(0,$o.tapleafHash)({output:n,version:r});return(0,$o.rootHashFromPath)(e,s)}return null})),Uo.prop(o,"output",(()=>{if(o.pubkey)return Co.compile([jo.OP_1,o.pubkey])})),Uo.prop(o,"redeemVersion",(()=>e.redeemVersion?e.redeemVersion:e.redeem&&void 0!==e.redeem.redeemVersion&&null!==e.redeem.redeemVersion?e.redeem.redeemVersion:$o.LEAF_VERSION_TAPSCRIPT)),Uo.prop(o,"redeem",(()=>{const e=n();if(e&&!(e.length<2))return{output:e[e.length-2],witness:e.slice(0,-2),redeemVersion:e[e.length-1][0]&Bo.TAPLEAF_VERSION_MASK}})),Uo.prop(o,"pubkey",(()=>{if(e.pubkey)return e.pubkey;if(e.output)return e.output.slice(2);if(e.address)return r().data;if(o.internalPubkey){const e=(0,$o.tweakKey)(o.internalPubkey,o.hash);if(e)return e.x}})),Uo.prop(o,"internalPubkey",(()=>{if(e.internalPubkey)return e.internalPubkey;const t=n();return t&&t.length>1?t[t.length-1].slice(1,33):void 0})),Uo.prop(o,"signature",(()=>{if(e.signature)return e.signature;const t=n();return t&&1===t.length?t[0]:void 0})),Uo.prop(o,"witness",(()=>{if(e.witness)return e.witness;const t=s();if(t&&e.redeem&&e.redeem.output&&e.internalPubkey){const r=(0,$o.tapleafHash)({output:e.redeem.output,version:o.redeemVersion}),n=(0,$o.findScriptPath)(t,r);if(!n)return;const s=(0,$o.tweakKey)(e.internalPubkey,t.hash);if(!s)return;const i=Po.Buffer.concat([Po.Buffer.from([o.redeemVersion|s.parity]),e.internalPubkey].concat(n));return[e.redeem.output,i]}return e.signature?[e.signature]:void 0})),t.validate){let t=Po.Buffer.from([]);if(e.address){if(i&&i.bech32!==r().prefix)throw new TypeError("Invalid prefix or Network mismatch");if(1!==r().version)throw new TypeError("Invalid address version");if(32!==r().data.length)throw new TypeError("Invalid address data");t=r().data}if(e.pubkey){if(t.length>0&&!t.equals(e.pubkey))throw new TypeError("Pubkey mismatch");t=e.pubkey}if(e.output){if(34!==e.output.length||e.output[0]!==jo.OP_1||32!==e.output[1])throw new TypeError("Output is invalid");if(t.length>0&&!t.equals(e.output.slice(2)))throw new TypeError("Pubkey mismatch");t=e.output.slice(2)}if(e.internalPubkey){const r=(0,$o.tweakKey)(e.internalPubkey,o.hash);if(t.length>0&&!t.equals(r.x))throw new TypeError("Pubkey mismatch");t=r.x}if(t&&t.length&&!(0,Lo.getEccLib)().isXOnlyPoint(t))throw new TypeError("Invalid pubkey for p2tr");const a=s();if(e.hash&&a&&!e.hash.equals(a.hash))throw new TypeError("Hash mismatch");if(e.redeem&&e.redeem.output&&a){const t=(0,$o.tapleafHash)({output:e.redeem.output,version:o.redeemVersion});if(!(0,$o.findScriptPath)(a,t))throw new TypeError("Redeem script not in tree")}const u=n();if(e.redeem&&o.redeem){if(e.redeem.redeemVersion&&e.redeem.redeemVersion!==o.redeem.redeemVersion)throw new TypeError("Redeem.redeemVersion and witness mismatch");if(e.redeem.output){if(0===Co.decompile(e.redeem.output).length)throw new TypeError("Redeem.output is invalid");if(o.redeem.output&&!e.redeem.output.equals(o.redeem.output))throw new TypeError("Redeem.output and witness mismatch")}if(e.redeem.witness&&o.redeem.witness&&!function(e,t){return e.length===t.length&&e.every(((e,r)=>e.equals(t[r])))}(e.redeem.witness,o.redeem.witness))throw new TypeError("Redeem.witness and witness mismatch")}if(u&&u.length)if(1===u.length){if(e.signature&&!e.signature.equals(u[0]))throw new TypeError("Signature mismatch")}else{const r=u[u.length-1];if(r.length<33)throw new TypeError(`The control-block length is too small. Got ${r.length}, expected min 33.`);if((r.length-33)%32!=0)throw new TypeError(`The control-block length of ${r.length} is incorrect!`);const n=(r.length-33)/32;if(n>128)throw new TypeError(`The script path is too long. Got ${n}, expected max 128.`);const s=r.slice(1,33);if(e.internalPubkey&&!e.internalPubkey.equals(s))throw new TypeError("Internal pubkey mismatch");if(!(0,Lo.getEccLib)().isXOnlyPoint(s))throw new TypeError("Invalid internalPubkey for p2tr witness");const i=r[0]&Bo.TAPLEAF_VERSION_MASK,o=u[u.length-2],a=(0,$o.tapleafHash)({output:o,version:i}),c=(0,$o.rootHashFromPath)(r,a),l=(0,$o.tweakKey)(s,c);if(!l)throw new TypeError("Invalid outputKey for p2tr witness");if(t.length&&!t.equals(l.x))throw new TypeError("Pubkey mismatch for p2tr witness");if(l.parity!==(1&r[0]))throw new Error("Incorrect parity")}}return Object.assign(o,e)},function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.p2tr=e.p2wsh=e.p2wpkh=e.p2sh=e.p2pkh=e.p2pk=e.p2ms=e.embed=void 0;const t=pn;Object.defineProperty(e,"embed",{enumerable:!0,get:function(){return t.p2data}});const r=us;Object.defineProperty(e,"p2ms",{enumerable:!0,get:function(){return r.p2ms}});const n=ys;Object.defineProperty(e,"p2pk",{enumerable:!0,get:function(){return n.p2pk}});const s=Es;Object.defineProperty(e,"p2pkh",{enumerable:!0,get:function(){return s.p2pkh}});const i=Ti;Object.defineProperty(e,"p2sh",{enumerable:!0,get:function(){return i.p2sh}});const o=Ci;Object.defineProperty(e,"p2wpkh",{enumerable:!0,get:function(){return o.p2wpkh}});const a=Ji;Object.defineProperty(e,"p2wsh",{enumerable:!0,get:function(){return a.p2wsh}});const u=uo;Object.defineProperty(e,"p2tr",{enumerable:!0,get:function(){return u.p2tr}})}(fn),Object.defineProperty(cn,"__esModule",{value:!0}),cn.toOutputScript=cn.fromOutputScript=cn.toBech32=cn.toBase58Check=cn.fromBech32=cn.fromBase58Check=void 0;const Mo=ln,Ho=fn,Fo=hn,Ko=Sn,Go=Bi,Vo=gi,Xo=40,Wo=2,qo=16,Zo=2,Yo=80,zo="WARNING: Sending to a future segwit version address can lead to loss of funds. End users MUST be warned carefully in the GUI and asked if they wish to proceed with caution. Wallets should verify the segwit version from the output of fromBech32, then decide when it is safe to use which version of segwit.";function Jo(e){const t=Buffer.from(Vo.decode(e));if(t.length<21)throw new TypeError(e+" is too short");if(t.length>21)throw new TypeError(e+" is too long");return{version:t.readUInt8(0),hash:t.slice(1)}}function Qo(e){let t,r;try{t=Go.bech32.decode(e)}catch(e){}if(t){if(r=t.words[0],0!==r)throw new TypeError(e+" uses wrong encoding")}else if(t=Go.bech32m.decode(e),r=t.words[0],0===r)throw new TypeError(e+" uses wrong encoding");const n=Go.bech32.fromWords(t.words.slice(1));return{version:r,prefix:t.prefix,data:Buffer.from(n)}}function ea(e,t,r){const n=Go.bech32.toWords(e);return n.unshift(t),0===t?Go.bech32.encode(r,n):Go.bech32m.encode(r,n)}cn.fromBase58Check=Jo,cn.fromBech32=Qo,cn.toBase58Check=function(e,t){(0,Ko.typeforce)((0,Ko.tuple)(Ko.Hash160bit,Ko.UInt8),arguments);const r=Buffer.allocUnsafe(21);return r.writeUInt8(t,0),e.copy(r,1),Vo.encode(r)},cn.toBech32=ea,cn.fromOutputScript=function(e,t){t=t||Mo.bitcoin;try{return Ho.p2pkh({output:e,network:t}).address}catch(e){}try{return Ho.p2sh({output:e,network:t}).address}catch(e){}try{return Ho.p2wpkh({output:e,network:t}).address}catch(e){}try{return Ho.p2wsh({output:e,network:t}).address}catch(e){}try{return Ho.p2tr({output:e,network:t}).address}catch(e){}try{return function(e,t){const r=e.slice(2);if(r.length<Wo||r.length>Xo)throw new TypeError("Invalid program length for segwit address");const n=e[0]-Yo;if(n<Zo||n>qo)throw new TypeError("Invalid version for segwit address");if(e[1]!==r.length)throw new TypeError("Invalid script for segwit address");return console.warn(zo),ea(r,n,t.bech32)}(e,t)}catch(e){}throw new Error(Fo.toASM(e)+" has no matching Address")},cn.toOutputScript=function(e,t){let r,n;t=t||Mo.bitcoin;try{r=Jo(e)}catch(e){}if(r){if(r.version===t.pubKeyHash)return Ho.p2pkh({hash:r.hash}).output;if(r.version===t.scriptHash)return Ho.p2sh({hash:r.hash}).output}else{try{n=Qo(e)}catch(e){}if(n){if(n.prefix!==t.bech32)throw new Error(e+" has an invalid prefix");if(0===n.version){if(20===n.data.length)return Ho.p2wpkh({hash:n.data}).output;if(32===n.data.length)return Ho.p2wsh({hash:n.data}).output}else if(1===n.version){if(32===n.data.length)return Ho.p2tr({pubkey:n.data}).output}else if(n.version>=Zo&&n.version<=qo&&n.data.length>=Wo&&n.data.length<=Xo)return console.warn(zo),Fo.compile([n.version+Yo,n.data])}}throw new Error(e+" has no matching Script")};var ta={},ra={};Object.defineProperty(ra,"__esModule",{value:!0}),ra.fastMerkleRoot=void 0,ra.fastMerkleRoot=function(e,t){if(!Array.isArray(e))throw TypeError("Expected values Array");if("function"!=typeof t)throw TypeError("Expected digest Function");let r=e.length;const n=e.concat();for(;r>1;){let e=0;for(let s=0;s<r;s+=2,++e){const i=n[s],o=s+1===r?i:n[s+1],a=Buffer.concat([i,o]);n[e]=t(a)}r=e}return n[0]};var na={};Object.defineProperty(na,"__esModule",{value:!0}),na.Transaction=void 0;const sa=yo,ia=Ss,oa=hn,aa=hn,ua=Sn,{typeforce:ca}=ua;function la(e){const t=e.length;return sa.varuint.encodingLength(t)+t}const fa=Buffer.allocUnsafe(0),pa=[],ha=Buffer.from("0000000000000000000000000000000000000000000000000000000000000000","hex"),da=Buffer.from("0000000000000000000000000000000000000000000000000000000000000001","hex"),ma=Buffer.from("ffffffffffffffff","hex"),ya={script:fa,valueBuffer:ma};class ga{constructor(){this.version=1,this.locktime=0,this.ins=[],this.outs=[]}static fromBuffer(e,t){const r=new sa.BufferReader(e),n=new ga;n.version=r.readInt32();const s=r.readUInt8(),i=r.readUInt8();let o=!1;s===ga.ADVANCED_TRANSACTION_MARKER&&i===ga.ADVANCED_TRANSACTION_FLAG?o=!0:r.offset-=2;const a=r.readVarInt();for(let e=0;e<a;++e)n.ins.push({hash:r.readSlice(32),index:r.readUInt32(),script:r.readVarSlice(),sequence:r.readUInt32(),witness:pa});const u=r.readVarInt();for(let e=0;e<u;++e)n.outs.push({value:r.readUInt64(),script:r.readVarSlice()});if(o){for(let e=0;e<a;++e)n.ins[e].witness=r.readVector();if(!n.hasWitnesses())throw new Error("Transaction has superfluous witness data")}if(n.locktime=r.readUInt32(),t)return n;if(r.offset!==e.length)throw new Error("Transaction has unexpected data");return n}static fromHex(e){return ga.fromBuffer(Buffer.from(e,"hex"),!1)}static isCoinbaseHash(e){ca(ua.Hash256bit,e);for(let t=0;t<32;++t)if(0!==e[t])return!1;return!0}isCoinbase(){return 1===this.ins.length&&ga.isCoinbaseHash(this.ins[0].hash)}addInput(e,t,r,n){return ca(ua.tuple(ua.Hash256bit,ua.UInt32,ua.maybe(ua.UInt32),ua.maybe(ua.Buffer)),arguments),ua.Null(r)&&(r=ga.DEFAULT_SEQUENCE),this.ins.push({hash:e,index:t,script:n||fa,sequence:r,witness:pa})-1}addOutput(e,t){return ca(ua.tuple(ua.Buffer,ua.Satoshi),arguments),this.outs.push({script:e,value:t})-1}hasWitnesses(){return this.ins.some((e=>0!==e.witness.length))}weight(){return 3*this.byteLength(!1)+this.byteLength(!0)}virtualSize(){return Math.ceil(this.weight()/4)}byteLength(e=!0){const t=e&&this.hasWitnesses();return(t?10:8)+sa.varuint.encodingLength(this.ins.length)+sa.varuint.encodingLength(this.outs.length)+this.ins.reduce(((e,t)=>e+40+la(t.script)),0)+this.outs.reduce(((e,t)=>e+8+la(t.script)),0)+(t?this.ins.reduce(((e,t)=>e+function(e){const t=e.length;return sa.varuint.encodingLength(t)+e.reduce(((e,t)=>e+la(t)),0)}(t.witness)),0):0)}clone(){const e=new ga;return e.version=this.version,e.locktime=this.locktime,e.ins=this.ins.map((e=>({hash:e.hash,index:e.index,script:e.script,sequence:e.sequence,witness:e.witness}))),e.outs=this.outs.map((e=>({script:e.script,value:e.value}))),e}hashForSignature(e,t,r){if(ca(ua.tuple(ua.UInt32,ua.Buffer,ua.Number),arguments),e>=this.ins.length)return da;const n=oa.compile(oa.decompile(t).filter((e=>e!==aa.OPS.OP_CODESEPARATOR))),s=this.clone();if((31&r)===ga.SIGHASH_NONE)s.outs=[],s.ins.forEach(((t,r)=>{r!==e&&(t.sequence=0)}));else if((31&r)===ga.SIGHASH_SINGLE){if(e>=this.outs.length)return da;s.outs.length=e+1;for(let t=0;t<e;t++)s.outs[t]=ya;s.ins.forEach(((t,r)=>{r!==e&&(t.sequence=0)}))}r&ga.SIGHASH_ANYONECANPAY?(s.ins=[s.ins[e]],s.ins[0].script=n):(s.ins.forEach((e=>{e.script=fa})),s.ins[e].script=n);const i=Buffer.allocUnsafe(s.byteLength(!1)+4);return i.writeInt32LE(r,i.length-4),s.__toBuffer(i,0,!1),ia.hash256(i)}hashForWitnessV1(e,t,r,n,s,i){if(ca(ua.tuple(ua.UInt32,ca.arrayOf(ua.Buffer),ca.arrayOf(ua.Satoshi),ua.UInt32),arguments),r.length!==this.ins.length||t.length!==this.ins.length)throw new Error("Must supply prevout script and value for all inputs");const o=n===ga.SIGHASH_DEFAULT?ga.SIGHASH_ALL:n&ga.SIGHASH_OUTPUT_MASK,a=(n&ga.SIGHASH_INPUT_MASK)===ga.SIGHASH_ANYONECANPAY,u=o===ga.SIGHASH_NONE,c=o===ga.SIGHASH_SINGLE;let l=fa,f=fa,p=fa,h=fa,d=fa;if(!a){let e=sa.BufferWriter.withCapacity(36*this.ins.length);this.ins.forEach((t=>{e.writeSlice(t.hash),e.writeUInt32(t.index)})),l=ia.sha256(e.end()),e=sa.BufferWriter.withCapacity(8*this.ins.length),r.forEach((t=>e.writeUInt64(t))),f=ia.sha256(e.end()),e=sa.BufferWriter.withCapacity(t.map(la).reduce(((e,t)=>e+t))),t.forEach((t=>e.writeVarSlice(t))),p=ia.sha256(e.end()),e=sa.BufferWriter.withCapacity(4*this.ins.length),this.ins.forEach((t=>e.writeUInt32(t.sequence))),h=ia.sha256(e.end())}if(u||c){if(c&&e<this.outs.length){const t=this.outs[e],r=sa.BufferWriter.withCapacity(8+la(t.script));r.writeUInt64(t.value),r.writeVarSlice(t.script),d=ia.sha256(r.end())}}else{const e=this.outs.map((e=>8+la(e.script))).reduce(((e,t)=>e+t)),t=sa.BufferWriter.withCapacity(e);this.outs.forEach((e=>{t.writeUInt64(e.value),t.writeVarSlice(e.script)})),d=ia.sha256(t.end())}const m=(s?2:0)+(i?1:0),y=174-(a?49:0)-(u?32:0)+(i?32:0)+(s?37:0),g=sa.BufferWriter.withCapacity(y);if(g.writeUInt8(n),g.writeInt32(this.version),g.writeUInt32(this.locktime),g.writeSlice(l),g.writeSlice(f),g.writeSlice(p),g.writeSlice(h),u||c||g.writeSlice(d),g.writeUInt8(m),a){const n=this.ins[e];g.writeSlice(n.hash),g.writeUInt32(n.index),g.writeUInt64(r[e]),g.writeVarSlice(t[e]),g.writeUInt32(n.sequence)}else g.writeUInt32(e);if(i){const e=sa.BufferWriter.withCapacity(la(i));e.writeVarSlice(i),g.writeSlice(ia.sha256(e.end()))}return c&&g.writeSlice(d),s&&(g.writeSlice(s),g.writeUInt8(0),g.writeUInt32(4294967295)),ia.taggedHash("TapSighash",Buffer.concat([Buffer.from([0]),g.end()]))}hashForWitnessV0(e,t,r,n){ca(ua.tuple(ua.UInt32,ua.Buffer,ua.Satoshi,ua.UInt32),arguments);let s,i=Buffer.from([]),o=ha,a=ha,u=ha;if(n&ga.SIGHASH_ANYONECANPAY||(i=Buffer.allocUnsafe(36*this.ins.length),s=new sa.BufferWriter(i,0),this.ins.forEach((e=>{s.writeSlice(e.hash),s.writeUInt32(e.index)})),a=ia.hash256(i)),n&ga.SIGHASH_ANYONECANPAY||(31&n)===ga.SIGHASH_SINGLE||(31&n)===ga.SIGHASH_NONE||(i=Buffer.allocUnsafe(4*this.ins.length),s=new sa.BufferWriter(i,0),this.ins.forEach((e=>{s.writeUInt32(e.sequence)})),u=ia.hash256(i)),(31&n)!==ga.SIGHASH_SINGLE&&(31&n)!==ga.SIGHASH_NONE){const e=this.outs.reduce(((e,t)=>e+8+la(t.script)),0);i=Buffer.allocUnsafe(e),s=new sa.BufferWriter(i,0),this.outs.forEach((e=>{s.writeUInt64(e.value),s.writeVarSlice(e.script)})),o=ia.hash256(i)}else if((31&n)===ga.SIGHASH_SINGLE&&e<this.outs.length){const t=this.outs[e];i=Buffer.allocUnsafe(8+la(t.script)),s=new sa.BufferWriter(i,0),s.writeUInt64(t.value),s.writeVarSlice(t.script),o=ia.hash256(i)}i=Buffer.allocUnsafe(156+la(t)),s=new sa.BufferWriter(i,0);const c=this.ins[e];return s.writeInt32(this.version),s.writeSlice(a),s.writeSlice(u),s.writeSlice(c.hash),s.writeUInt32(c.index),s.writeVarSlice(t),s.writeUInt64(r),s.writeUInt32(c.sequence),s.writeSlice(o),s.writeUInt32(this.locktime),s.writeUInt32(n),ia.hash256(i)}getHash(e){return e&&this.isCoinbase()?Buffer.alloc(32,0):ia.hash256(this.__toBuffer(void 0,void 0,e))}getId(){return(0,sa.reverseBuffer)(this.getHash(!1)).toString("hex")}toBuffer(e,t){return this.__toBuffer(e,t,!0)}toHex(){return this.toBuffer(void 0,void 0).toString("hex")}setInputScript(e,t){ca(ua.tuple(ua.Number,ua.Buffer),arguments),this.ins[e].script=t}setWitness(e,t){ca(ua.tuple(ua.Number,[ua.Buffer]),arguments),this.ins[e].witness=t}__toBuffer(e,t,r=!1){e||(e=Buffer.allocUnsafe(this.byteLength(r)));const n=new sa.BufferWriter(e,t||0);n.writeInt32(this.version);const s=r&&this.hasWitnesses();return s&&(n.writeUInt8(ga.ADVANCED_TRANSACTION_MARKER),n.writeUInt8(ga.ADVANCED_TRANSACTION_FLAG)),n.writeVarInt(this.ins.length),this.ins.forEach((e=>{n.writeSlice(e.hash),n.writeUInt32(e.index),n.writeVarSlice(e.script),n.writeUInt32(e.sequence)})),n.writeVarInt(this.outs.length),this.outs.forEach((e=>{void 0!==e.value?n.writeUInt64(e.value):n.writeSlice(e.valueBuffer),n.writeVarSlice(e.script)})),s&&this.ins.forEach((e=>{n.writeVector(e.witness)})),n.writeUInt32(this.locktime),void 0!==t?e.slice(t,n.offset):e}}na.Transaction=ga,ga.DEFAULT_SEQUENCE=4294967295,ga.SIGHASH_DEFAULT=0,ga.SIGHASH_ALL=1,ga.SIGHASH_NONE=2,ga.SIGHASH_SINGLE=3,ga.SIGHASH_ANYONECANPAY=128,ga.SIGHASH_OUTPUT_MASK=3,ga.SIGHASH_INPUT_MASK=128,ga.ADVANCED_TRANSACTION_MARKER=0,ga.ADVANCED_TRANSACTION_FLAG=1,Object.defineProperty(ta,"__esModule",{value:!0}),ta.Block=void 0;const ba=yo,va=Ss,_a=ra,wa=na,Ea=Sn,{typeforce:Sa}=Ea,Aa=new TypeError("Cannot compute merkle root for zero transactions"),Ta=new TypeError("Cannot compute witness commit for non-segwit block");class Ia{constructor(){this.version=1,this.prevHash=void 0,this.merkleRoot=void 0,this.timestamp=0,this.witnessCommit=void 0,this.bits=0,this.nonce=0,this.transactions=void 0}static fromBuffer(e){if(e.length<80)throw new Error("Buffer too small (< 80 bytes)");const t=new ba.BufferReader(e),r=new Ia;if(r.version=t.readInt32(),r.prevHash=t.readSlice(32),r.merkleRoot=t.readSlice(32),r.timestamp=t.readUInt32(),r.bits=t.readUInt32(),r.nonce=t.readUInt32(),80===e.length)return r;const n=()=>{const e=wa.Transaction.fromBuffer(t.buffer.slice(t.offset),!0);return t.offset+=e.byteLength(),e},s=t.readVarInt();r.transactions=[];for(let e=0;e<s;++e){const e=n();r.transactions.push(e)}const i=r.getWitnessCommit();return i&&(r.witnessCommit=i),r}static fromHex(e){return Ia.fromBuffer(Buffer.from(e,"hex"))}static calculateTarget(e){const t=((4278190080&e)>>24)-3,r=8388607&e,n=Buffer.alloc(32,0);return n.writeUIntBE(r,29-t,3),n}static calculateMerkleRoot(e,t){if(Sa([{getHash:Ea.Function}],e),0===e.length)throw Aa;if(t&&!Oa(e))throw Ta;const r=e.map((e=>e.getHash(t))),n=(0,_a.fastMerkleRoot)(r,va.hash256);return t?va.hash256(Buffer.concat([n,e[0].ins[0].witness[0]])):n}getWitnessCommit(){if(!Oa(this.transactions))return null;const e=this.transactions[0].outs.filter((e=>e.script.slice(0,6).equals(Buffer.from("6a24aa21a9ed","hex")))).map((e=>e.script.slice(6,38)));if(0===e.length)return null;const t=e[e.length-1];return t instanceof Buffer&&32===t.length?t:null}hasWitnessCommit(){return this.witnessCommit instanceof Buffer&&32===this.witnessCommit.length||null!==this.getWitnessCommit()}hasWitness(){return(e=this.transactions)instanceof Array&&e.some((e=>"object"==typeof e&&e.ins instanceof Array&&e.ins.some((e=>"object"==typeof e&&e.witness instanceof Array&&e.witness.length>0))));var e}weight(){return 3*this.byteLength(!1,!1)+this.byteLength(!1,!0)}byteLength(e,t=!0){return e||!this.transactions?80:80+ba.varuint.encodingLength(this.transactions.length)+this.transactions.reduce(((e,r)=>e+r.byteLength(t)),0)}getHash(){return va.hash256(this.toBuffer(!0))}getId(){return(0,ba.reverseBuffer)(this.getHash()).toString("hex")}getUTCDate(){const e=new Date(0);return e.setUTCSeconds(this.timestamp),e}toBuffer(e){const t=Buffer.allocUnsafe(this.byteLength(e)),r=new ba.BufferWriter(t);return r.writeInt32(this.version),r.writeSlice(this.prevHash),r.writeSlice(this.merkleRoot),r.writeUInt32(this.timestamp),r.writeUInt32(this.bits),r.writeUInt32(this.nonce),e||!this.transactions||(ba.varuint.encode(this.transactions.length,t,r.offset),r.offset+=ba.varuint.encode.bytes,this.transactions.forEach((e=>{const n=e.byteLength();e.toBuffer(t,r.offset),r.offset+=n}))),t}toHex(e){return this.toBuffer(e).toString("hex")}checkTxRoots(){const e=this.hasWitnessCommit();return!(!e&&this.hasWitness())&&(this.__checkMerkleRoot()&&(!e||this.__checkWitnessCommit()))}checkProofOfWork(){const e=(0,ba.reverseBuffer)(this.getHash()),t=Ia.calculateTarget(this.bits);return e.compare(t)<=0}__checkMerkleRoot(){if(!this.transactions)throw Aa;const e=Ia.calculateMerkleRoot(this.transactions);return 0===this.merkleRoot.compare(e)}__checkWitnessCommit(){if(!this.transactions)throw Aa;if(!this.hasWitnessCommit())throw Ta;const e=Ia.calculateMerkleRoot(this.transactions,!0);return 0===this.witnessCommit.compare(e)}}function Oa(e){return e instanceof Array&&e[0]&&e[0].ins&&e[0].ins instanceof Array&&e[0].ins[0]&&e[0].ins[0].witness&&e[0].ins[0].witness instanceof Array&&e[0].ins[0].witness.length>0}ta.Block=Ia;var ka={},Ra={},Na={},Pa={},xa={},Ca={},Ba={};!function(e){var t,r,n;Object.defineProperty(e,"__esModule",{value:!0}),(t=e.GlobalTypes||(e.GlobalTypes={}))[t.UNSIGNED_TX=0]="UNSIGNED_TX",t[t.GLOBAL_XPUB=1]="GLOBAL_XPUB",e.GLOBAL_TYPE_NAMES=["unsignedTx","globalXpub"],(r=e.InputTypes||(e.InputTypes={}))[r.NON_WITNESS_UTXO=0]="NON_WITNESS_UTXO",r[r.WITNESS_UTXO=1]="WITNESS_UTXO",r[r.PARTIAL_SIG=2]="PARTIAL_SIG",r[r.SIGHASH_TYPE=3]="SIGHASH_TYPE",r[r.REDEEM_SCRIPT=4]="REDEEM_SCRIPT",r[r.WITNESS_SCRIPT=5]="WITNESS_SCRIPT",r[r.BIP32_DERIVATION=6]="BIP32_DERIVATION",r[r.FINAL_SCRIPTSIG=7]="FINAL_SCRIPTSIG",r[r.FINAL_SCRIPTWITNESS=8]="FINAL_SCRIPTWITNESS",r[r.POR_COMMITMENT=9]="POR_COMMITMENT",r[r.TAP_KEY_SIG=19]="TAP_KEY_SIG",r[r.TAP_SCRIPT_SIG=20]="TAP_SCRIPT_SIG",r[r.TAP_LEAF_SCRIPT=21]="TAP_LEAF_SCRIPT",r[r.TAP_BIP32_DERIVATION=22]="TAP_BIP32_DERIVATION",r[r.TAP_INTERNAL_KEY=23]="TAP_INTERNAL_KEY",r[r.TAP_MERKLE_ROOT=24]="TAP_MERKLE_ROOT",e.INPUT_TYPE_NAMES=["nonWitnessUtxo","witnessUtxo","partialSig","sighashType","redeemScript","witnessScript","bip32Derivation","finalScriptSig","finalScriptWitness","porCommitment","tapKeySig","tapScriptSig","tapLeafScript","tapBip32Derivation","tapInternalKey","tapMerkleRoot"],(n=e.OutputTypes||(e.OutputTypes={}))[n.REDEEM_SCRIPT=0]="REDEEM_SCRIPT",n[n.WITNESS_SCRIPT=1]="WITNESS_SCRIPT",n[n.BIP32_DERIVATION=2]="BIP32_DERIVATION",n[n.TAP_INTERNAL_KEY=5]="TAP_INTERNAL_KEY",n[n.TAP_TREE=6]="TAP_TREE",n[n.TAP_BIP32_DERIVATION=7]="TAP_BIP32_DERIVATION",e.OUTPUT_TYPE_NAMES=["redeemScript","witnessScript","bip32Derivation","tapInternalKey","tapTree","tapBip32Derivation"]}(Ba);var La={};Object.defineProperty(La,"__esModule",{value:!0});const $a=Ba;La.decode=function(e){if(e.key[0]!==$a.GlobalTypes.GLOBAL_XPUB)throw new Error("Decode Error: could not decode globalXpub with key 0x"+e.key.toString("hex"));if(79!==e.key.length||![2,3].includes(e.key[46]))throw new Error("Decode Error: globalXpub has invalid extended pubkey in key 0x"+e.key.toString("hex"));if(e.value.length/4%1!=0)throw new Error("Decode Error: Global GLOBAL_XPUB value length should be multiple of 4");const t=e.key.slice(1),r={masterFingerprint:e.value.slice(0,4),extendedPubkey:t,path:"m"};for(const t of(n=e.value.length/4-1,[...Array(n).keys()])){const n=e.value.readUInt32LE(4*t+4),s=!!(2147483648&n),i=2147483647&n;r.path+="/"+i.toString(10)+(s?"'":"")}var n;return r},La.encode=function(e){const t=Buffer.from([$a.GlobalTypes.GLOBAL_XPUB]),r=Buffer.concat([t,e.extendedPubkey]),n=e.path.split("/"),s=Buffer.allocUnsafe(4*n.length);e.masterFingerprint.copy(s,0);let i=4;return n.slice(1).forEach((e=>{const t="'"===e.slice(-1);let r=2147483647&parseInt(t?e.slice(0,-1):e,10);t&&(r+=2147483648),s.writeUInt32LE(r,i),i+=4})),{key:r,value:s}},La.expected="{ masterFingerprint: Buffer; extendedPubkey: Buffer; path: string; }",La.check=function(e){const t=e.extendedPubkey,r=e.masterFingerprint,n=e.path;return Buffer.isBuffer(t)&&78===t.length&&[2,3].indexOf(t[45])>-1&&Buffer.isBuffer(r)&&4===r.length&&"string"==typeof n&&!!n.match(/^m(\/\d+'?)*$/)},La.canAddToArray=function(e,t,r){const n=t.extendedPubkey.toString("hex");return!r.has(n)&&(r.add(n),0===e.filter((e=>e.extendedPubkey.equals(t.extendedPubkey))).length)};var Ua={};Object.defineProperty(Ua,"__esModule",{value:!0});const Da=Ba;Ua.encode=function(e){return{key:Buffer.from([Da.GlobalTypes.UNSIGNED_TX]),value:e.toBuffer()}};var ja={};Object.defineProperty(ja,"__esModule",{value:!0});const Ma=Ba;ja.decode=function(e){if(e.key[0]!==Ma.InputTypes.FINAL_SCRIPTSIG)throw new Error("Decode Error: could not decode finalScriptSig with key 0x"+e.key.toString("hex"));return e.value},ja.encode=function(e){return{key:Buffer.from([Ma.InputTypes.FINAL_SCRIPTSIG]),value:e}},ja.expected="Buffer",ja.check=function(e){return Buffer.isBuffer(e)},ja.canAdd=function(e,t){return!!e&&!!t&&void 0===e.finalScriptSig};var Ha={};Object.defineProperty(Ha,"__esModule",{value:!0});const Fa=Ba;Ha.decode=function(e){if(e.key[0]!==Fa.InputTypes.FINAL_SCRIPTWITNESS)throw new Error("Decode Error: could not decode finalScriptWitness with key 0x"+e.key.toString("hex"));return e.value},Ha.encode=function(e){return{key:Buffer.from([Fa.InputTypes.FINAL_SCRIPTWITNESS]),value:e}},Ha.expected="Buffer",Ha.check=function(e){return Buffer.isBuffer(e)},Ha.canAdd=function(e,t){return!!e&&!!t&&void 0===e.finalScriptWitness};var Ka={};Object.defineProperty(Ka,"__esModule",{value:!0});const Ga=Ba;Ka.decode=function(e){if(e.key[0]!==Ga.InputTypes.NON_WITNESS_UTXO)throw new Error("Decode Error: could not decode nonWitnessUtxo with key 0x"+e.key.toString("hex"));return e.value},Ka.encode=function(e){return{key:Buffer.from([Ga.InputTypes.NON_WITNESS_UTXO]),value:e}},Ka.expected="Buffer",Ka.check=function(e){return Buffer.isBuffer(e)},Ka.canAdd=function(e,t){return!!e&&!!t&&void 0===e.nonWitnessUtxo};var Va={};Object.defineProperty(Va,"__esModule",{value:!0});const Xa=Ba;Va.decode=function(e){if(e.key[0]!==Xa.InputTypes.PARTIAL_SIG)throw new Error("Decode Error: could not decode partialSig with key 0x"+e.key.toString("hex"));if(34!==e.key.length&&66!==e.key.length||![2,3,4].includes(e.key[1]))throw new Error("Decode Error: partialSig has invalid pubkey in key 0x"+e.key.toString("hex"));return{pubkey:e.key.slice(1),signature:e.value}},Va.encode=function(e){const t=Buffer.from([Xa.InputTypes.PARTIAL_SIG]);return{key:Buffer.concat([t,e.pubkey]),value:e.signature}},Va.expected="{ pubkey: Buffer; signature: Buffer; }",Va.check=function(e){return Buffer.isBuffer(e.pubkey)&&Buffer.isBuffer(e.signature)&&[33,65].includes(e.pubkey.length)&&[2,3,4].includes(e.pubkey[0])&&function(e){if(!Buffer.isBuffer(e)||e.length<9)return!1;if(48!==e[0])return!1;if(e.length!==e[1]+3)return!1;if(2!==e[2])return!1;const t=e[3];if(t>33||t<1)return!1;if(2!==e[3+t+1])return!1;const r=e[3+t+2];return!(r>33||r<1)&&e.length===3+t+2+r+2}(e.signature)},Va.canAddToArray=function(e,t,r){const n=t.pubkey.toString("hex");return!r.has(n)&&(r.add(n),0===e.filter((e=>e.pubkey.equals(t.pubkey))).length)};var Wa={};Object.defineProperty(Wa,"__esModule",{value:!0});const qa=Ba;Wa.decode=function(e){if(e.key[0]!==qa.InputTypes.POR_COMMITMENT)throw new Error("Decode Error: could not decode porCommitment with key 0x"+e.key.toString("hex"));return e.value.toString("utf8")},Wa.encode=function(e){return{key:Buffer.from([qa.InputTypes.POR_COMMITMENT]),value:Buffer.from(e,"utf8")}},Wa.expected="string",Wa.check=function(e){return"string"==typeof e},Wa.canAdd=function(e,t){return!!e&&!!t&&void 0===e.porCommitment};var Za={};Object.defineProperty(Za,"__esModule",{value:!0});const Ya=Ba;Za.decode=function(e){if(e.key[0]!==Ya.InputTypes.SIGHASH_TYPE)throw new Error("Decode Error: could not decode sighashType with key 0x"+e.key.toString("hex"));return e.value.readUInt32LE(0)},Za.encode=function(e){const t=Buffer.from([Ya.InputTypes.SIGHASH_TYPE]),r=Buffer.allocUnsafe(4);return r.writeUInt32LE(e,0),{key:t,value:r}},Za.expected="number",Za.check=function(e){return"number"==typeof e},Za.canAdd=function(e,t){return!!e&&!!t&&void 0===e.sighashType};var za={};Object.defineProperty(za,"__esModule",{value:!0});const Ja=Ba;function Qa(e){return Buffer.isBuffer(e)&&(64===e.length||65===e.length)}za.decode=function(e){if(e.key[0]!==Ja.InputTypes.TAP_KEY_SIG||1!==e.key.length)throw new Error("Decode Error: could not decode tapKeySig with key 0x"+e.key.toString("hex"));if(!Qa(e.value))throw new Error("Decode Error: tapKeySig not a valid 64-65-byte BIP340 signature");return e.value},za.encode=function(e){return{key:Buffer.from([Ja.InputTypes.TAP_KEY_SIG]),value:e}},za.expected="Buffer",za.check=Qa,za.canAdd=function(e,t){return!!e&&!!t&&void 0===e.tapKeySig};var eu={};Object.defineProperty(eu,"__esModule",{value:!0});const tu=Ba;eu.decode=function(e){if(e.key[0]!==tu.InputTypes.TAP_LEAF_SCRIPT)throw new Error("Decode Error: could not decode tapLeafScript with key 0x"+e.key.toString("hex"));if((e.key.length-2)%32!=0)throw new Error("Decode Error: tapLeafScript has invalid control block in key 0x"+e.key.toString("hex"));const t=e.value[e.value.length-1];if((254&e.key[1])!==t)throw new Error("Decode Error: tapLeafScript bad leaf version in key 0x"+e.key.toString("hex"));const r=e.value.slice(0,-1);return{controlBlock:e.key.slice(1),script:r,leafVersion:t}},eu.encode=function(e){const t=Buffer.from([tu.InputTypes.TAP_LEAF_SCRIPT]),r=Buffer.from([e.leafVersion]);return{key:Buffer.concat([t,e.controlBlock]),value:Buffer.concat([e.script,r])}},eu.expected="{ controlBlock: Buffer; leafVersion: number, script: Buffer; }",eu.check=function(e){return Buffer.isBuffer(e.controlBlock)&&(e.controlBlock.length-1)%32==0&&(254&e.controlBlock[0])===e.leafVersion&&Buffer.isBuffer(e.script)},eu.canAddToArray=function(e,t,r){const n=t.controlBlock.toString("hex");return!r.has(n)&&(r.add(n),0===e.filter((e=>e.controlBlock.equals(t.controlBlock))).length)};var ru={};Object.defineProperty(ru,"__esModule",{value:!0});const nu=Ba;function su(e){return Buffer.isBuffer(e)&&32===e.length}ru.decode=function(e){if(e.key[0]!==nu.InputTypes.TAP_MERKLE_ROOT||1!==e.key.length)throw new Error("Decode Error: could not decode tapMerkleRoot with key 0x"+e.key.toString("hex"));if(!su(e.value))throw new Error("Decode Error: tapMerkleRoot not a 32-byte hash");return e.value},ru.encode=function(e){return{key:Buffer.from([nu.InputTypes.TAP_MERKLE_ROOT]),value:e}},ru.expected="Buffer",ru.check=su,ru.canAdd=function(e,t){return!!e&&!!t&&void 0===e.tapMerkleRoot};var iu={};Object.defineProperty(iu,"__esModule",{value:!0});const ou=Ba;iu.decode=function(e){if(e.key[0]!==ou.InputTypes.TAP_SCRIPT_SIG)throw new Error("Decode Error: could not decode tapScriptSig with key 0x"+e.key.toString("hex"));if(65!==e.key.length)throw new Error("Decode Error: tapScriptSig has invalid key 0x"+e.key.toString("hex"));if(64!==e.value.length&&65!==e.value.length)throw new Error("Decode Error: tapScriptSig has invalid signature in key 0x"+e.key.toString("hex"));return{pubkey:e.key.slice(1,33),leafHash:e.key.slice(33),signature:e.value}},iu.encode=function(e){const t=Buffer.from([ou.InputTypes.TAP_SCRIPT_SIG]);return{key:Buffer.concat([t,e.pubkey,e.leafHash]),value:e.signature}},iu.expected="{ pubkey: Buffer; leafHash: Buffer; signature: Buffer; }",iu.check=function(e){return Buffer.isBuffer(e.pubkey)&&Buffer.isBuffer(e.leafHash)&&Buffer.isBuffer(e.signature)&&32===e.pubkey.length&&32===e.leafHash.length&&(64===e.signature.length||65===e.signature.length)},iu.canAddToArray=function(e,t,r){const n=t.pubkey.toString("hex")+t.leafHash.toString("hex");return!r.has(n)&&(r.add(n),0===e.filter((e=>e.pubkey.equals(t.pubkey)&&e.leafHash.equals(t.leafHash))).length)};var au={},uu={},cu={};Object.defineProperty(cu,"__esModule",{value:!0});const lu=9007199254740991;function fu(e){if(e<0||e>lu||e%1!=0)throw new RangeError("value out of range")}function pu(e){return fu(e),e<253?1:e<=65535?3:e<=4294967295?5:9}cu.encode=function e(t,r,n){if(fu(t),r||(r=Buffer.allocUnsafe(pu(t))),!Buffer.isBuffer(r))throw new TypeError("buffer must be a Buffer instance");return n||(n=0),t<253?(r.writeUInt8(t,n),Object.assign(e,{bytes:1})):t<=65535?(r.writeUInt8(253,n),r.writeUInt16LE(t,n+1),Object.assign(e,{bytes:3})):t<=4294967295?(r.writeUInt8(254,n),r.writeUInt32LE(t,n+1),Object.assign(e,{bytes:5})):(r.writeUInt8(255,n),r.writeUInt32LE(t>>>0,n+1),r.writeUInt32LE(t/4294967296|0,n+5),Object.assign(e,{bytes:9})),r},cu.decode=function e(t,r){if(!Buffer.isBuffer(t))throw new TypeError("buffer must be a Buffer instance");r||(r=0);const n=t.readUInt8(r);if(n<253)return Object.assign(e,{bytes:1}),n;if(253===n)return Object.assign(e,{bytes:3}),t.readUInt16LE(r+1);if(254===n)return Object.assign(e,{bytes:5}),t.readUInt32LE(r+1);{Object.assign(e,{bytes:9});const n=t.readUInt32LE(r+1),s=4294967296*t.readUInt32LE(r+5)+n;return fu(s),s}},cu.encodingLength=pu,Object.defineProperty(uu,"__esModule",{value:!0});const hu=cu;function du(e){const t=e.key.length,r=e.value.length,n=hu.encodingLength(t),s=hu.encodingLength(r),i=Buffer.allocUnsafe(n+t+s+r);return hu.encode(t,i,0),e.key.copy(i,n),hu.encode(r,i,n+t),e.value.copy(i,n+t+s),i}function mu(e,t){if("number"!=typeof e)throw new Error("cannot write a non-number as a number");if(e<0)throw new Error("specified a negative value for writing an unsigned value");if(e>t)throw new Error("RangeError: value out of range");if(Math.floor(e)!==e)throw new Error("value has a fractional component")}uu.range=e=>[...Array(e).keys()],uu.reverseBuffer=function(e){if(e.length<1)return e;let t=e.length-1,r=0;for(let n=0;n<e.length/2;n++)r=e[n],e[n]=e[t],e[t]=r,t--;return e},uu.keyValsToBuffer=function(e){const t=e.map(du);return t.push(Buffer.from([0])),Buffer.concat(t)},uu.keyValToBuffer=du,uu.readUInt64LE=function(e,t){const r=e.readUInt32LE(t);let n=e.readUInt32LE(t+4);return n*=4294967296,mu(n+r,9007199254740991),n+r},uu.writeUInt64LE=function(e,t,r){return mu(t,9007199254740991),e.writeInt32LE(-1&t,r),e.writeUInt32LE(Math.floor(t/4294967296),r+4),r+8},Object.defineProperty(au,"__esModule",{value:!0});const yu=Ba,gu=uu,bu=cu;au.decode=function(e){if(e.key[0]!==yu.InputTypes.WITNESS_UTXO)throw new Error("Decode Error: could not decode witnessUtxo with key 0x"+e.key.toString("hex"));const t=gu.readUInt64LE(e.value,0);let r=8;const n=bu.decode(e.value,r);r+=bu.encodingLength(n);const s=e.value.slice(r);if(s.length!==n)throw new Error("Decode Error: WITNESS_UTXO script is not proper length");return{script:s,value:t}},au.encode=function(e){const{script:t,value:r}=e,n=bu.encodingLength(t.length),s=Buffer.allocUnsafe(8+n+t.length);return gu.writeUInt64LE(s,r,0),bu.encode(t.length,s,8),t.copy(s,8+n),{key:Buffer.from([yu.InputTypes.WITNESS_UTXO]),value:s}},au.expected="{ script: Buffer; value: number; }",au.check=function(e){return Buffer.isBuffer(e.script)&&"number"==typeof e.value},au.canAdd=function(e,t){return!!e&&!!t&&void 0===e.witnessUtxo};var vu={};Object.defineProperty(vu,"__esModule",{value:!0});const _u=Ba,wu=cu;vu.decode=function(e){if(e.key[0]!==_u.OutputTypes.TAP_TREE||1!==e.key.length)throw new Error("Decode Error: could not decode tapTree with key 0x"+e.key.toString("hex"));let t=0;const r=[];for(;t<e.value.length;){const n=e.value[t++],s=e.value[t++],i=wu.decode(e.value,t);t+=wu.encodingLength(i),r.push({depth:n,leafVersion:s,script:e.value.slice(t,t+i)}),t+=i}return{leaves:r}},vu.encode=function(e){const t=Buffer.from([_u.OutputTypes.TAP_TREE]),r=[].concat(...e.leaves.map((e=>[Buffer.of(e.depth,e.leafVersion),wu.encode(e.script.length),e.script])));return{key:t,value:Buffer.concat(r)}},vu.expected="{ leaves: [{ depth: number; leafVersion: number, script: Buffer; }] }",vu.check=function(e){return Array.isArray(e.leaves)&&e.leaves.every((e=>e.depth>=0&&e.depth<=128&&(254&e.leafVersion)===e.leafVersion&&Buffer.isBuffer(e.script)))},vu.canAdd=function(e,t){return!!e&&!!t&&void 0===e.tapTree};var Eu={};Object.defineProperty(Eu,"__esModule",{value:!0});const Su=e=>33===e.length&&[2,3].includes(e[0])||65===e.length&&4===e[0];Eu.makeConverter=function(e,t=Su){return{decode:function(r){if(r.key[0]!==e)throw new Error("Decode Error: could not decode bip32Derivation with key 0x"+r.key.toString("hex"));const n=r.key.slice(1);if(!t(n))throw new Error("Decode Error: bip32Derivation has invalid pubkey in key 0x"+r.key.toString("hex"));if(r.value.length/4%1!=0)throw new Error("Decode Error: Input BIP32_DERIVATION value length should be multiple of 4");const s={masterFingerprint:r.value.slice(0,4),pubkey:n,path:"m"};for(const e of(i=r.value.length/4-1,[...Array(i).keys()])){const t=r.value.readUInt32LE(4*e+4),n=!!(2147483648&t),i=2147483647&t;s.path+="/"+i.toString(10)+(n?"'":"")}var i;return s},encode:function(t){const r=Buffer.from([e]),n=Buffer.concat([r,t.pubkey]),s=t.path.split("/"),i=Buffer.allocUnsafe(4*s.length);t.masterFingerprint.copy(i,0);let o=4;return s.slice(1).forEach((e=>{const t="'"===e.slice(-1);let r=2147483647&parseInt(t?e.slice(0,-1):e,10);t&&(r+=2147483648),i.writeUInt32LE(r,o),o+=4})),{key:n,value:i}},check:function(e){return Buffer.isBuffer(e.pubkey)&&Buffer.isBuffer(e.masterFingerprint)&&"string"==typeof e.path&&t(e.pubkey)&&4===e.masterFingerprint.length},expected:"{ masterFingerprint: Buffer; pubkey: Buffer; path: string; }",canAddToArray:function(e,t,r){const n=t.pubkey.toString("hex");return!r.has(n)&&(r.add(n),0===e.filter((e=>e.pubkey.equals(t.pubkey))).length)}}};var Au={};Object.defineProperty(Au,"__esModule",{value:!0}),Au.makeChecker=function(e){return function(t){let r;if(e.includes(t.key[0])&&(r=t.key.slice(1),33!==r.length&&65!==r.length||![2,3,4].includes(r[0])))throw new Error("Format Error: invalid pubkey in key 0x"+t.key.toString("hex"));return r}};var Tu={};Object.defineProperty(Tu,"__esModule",{value:!0}),Tu.makeConverter=function(e){return{decode:function(t){if(t.key[0]!==e)throw new Error("Decode Error: could not decode redeemScript with key 0x"+t.key.toString("hex"));return t.value},encode:function(t){return{key:Buffer.from([e]),value:t}},check:function(e){return Buffer.isBuffer(e)},expected:"Buffer",canAdd:function(e,t){return!!e&&!!t&&void 0===e.redeemScript}}};var Iu={};Object.defineProperty(Iu,"__esModule",{value:!0});const Ou=cu,ku=Eu,Ru=e=>32===e.length;Iu.makeConverter=function(e){const t=ku.makeConverter(e,Ru);return{decode:function(e){const r=Ou.decode(e.value),n=Ou.encodingLength(r),s=t.decode({key:e.key,value:e.value.slice(n+32*r)}),i=new Array(r);for(let t=0,s=n;t<r;t++,s+=32)i[t]=e.value.slice(s,s+32);return Object.assign({},s,{leafHashes:i})},encode:function(e){const r=t.encode(e),n=Ou.encodingLength(e.leafHashes.length),s=Buffer.allocUnsafe(n);Ou.encode(e.leafHashes.length,s);const i=Buffer.concat([s,...e.leafHashes,r.value]);return Object.assign({},r,{value:i})},check:function(e){return Array.isArray(e.leafHashes)&&e.leafHashes.every((e=>Buffer.isBuffer(e)&&32===e.length))&&t.check(e)},expected:"{ masterFingerprint: Buffer; pubkey: Buffer; path: string; leafHashes: Buffer[]; }",canAddToArray:t.canAddToArray}};var Nu={};Object.defineProperty(Nu,"__esModule",{value:!0}),Nu.makeConverter=function(e){return{decode:function(t){if(t.key[0]!==e||1!==t.key.length)throw new Error("Decode Error: could not decode tapInternalKey with key 0x"+t.key.toString("hex"));if(32!==t.value.length)throw new Error("Decode Error: tapInternalKey not a 32-byte x-only pubkey");return t.value},encode:function(t){return{key:Buffer.from([e]),value:t}},check:function(e){return Buffer.isBuffer(e)&&32===e.length},expected:"Buffer",canAdd:function(e,t){return!!e&&!!t&&void 0===e.tapInternalKey}}};var Pu={};Object.defineProperty(Pu,"__esModule",{value:!0}),Pu.makeConverter=function(e){return{decode:function(t){if(t.key[0]!==e)throw new Error("Decode Error: could not decode witnessScript with key 0x"+t.key.toString("hex"));return t.value},encode:function(t){return{key:Buffer.from([e]),value:t}},check:function(e){return Buffer.isBuffer(e)},expected:"Buffer",canAdd:function(e,t){return!!e&&!!t&&void 0===e.witnessScript}}},Object.defineProperty(Ca,"__esModule",{value:!0});const xu=Ba,Cu=ja,Bu=Ha,Lu=Ka,$u=Va,Uu=Wa,Du=Za,ju=za,Mu=eu,Hu=ru,Fu=iu,Ku=au,Gu=vu,Vu=Eu,Xu=Au,Wu=Tu,qu=Iu,Zu=Nu,Yu=Pu,zu={unsignedTx:Ua,globalXpub:La,checkPubkey:Xu.makeChecker([])};Ca.globals=zu;const Ju={nonWitnessUtxo:Lu,partialSig:$u,sighashType:Du,finalScriptSig:Cu,finalScriptWitness:Bu,porCommitment:Uu,witnessUtxo:Ku,bip32Derivation:Vu.makeConverter(xu.InputTypes.BIP32_DERIVATION),redeemScript:Wu.makeConverter(xu.InputTypes.REDEEM_SCRIPT),witnessScript:Yu.makeConverter(xu.InputTypes.WITNESS_SCRIPT),checkPubkey:Xu.makeChecker([xu.InputTypes.PARTIAL_SIG,xu.InputTypes.BIP32_DERIVATION]),tapKeySig:ju,tapScriptSig:Fu,tapLeafScript:Mu,tapBip32Derivation:qu.makeConverter(xu.InputTypes.TAP_BIP32_DERIVATION),tapInternalKey:Zu.makeConverter(xu.InputTypes.TAP_INTERNAL_KEY),tapMerkleRoot:Hu};Ca.inputs=Ju;const Qu={bip32Derivation:Vu.makeConverter(xu.OutputTypes.BIP32_DERIVATION),redeemScript:Wu.makeConverter(xu.OutputTypes.REDEEM_SCRIPT),witnessScript:Yu.makeConverter(xu.OutputTypes.WITNESS_SCRIPT),checkPubkey:Xu.makeChecker([xu.OutputTypes.BIP32_DERIVATION]),tapBip32Derivation:qu.makeConverter(xu.OutputTypes.TAP_BIP32_DERIVATION),tapTree:Gu,tapInternalKey:Zu.makeConverter(xu.OutputTypes.TAP_INTERNAL_KEY)};Ca.outputs=Qu,Object.defineProperty(xa,"__esModule",{value:!0});const ec=Ca,tc=uu,rc=cu,nc=Ba;function sc(e,t,r){if(!t.equals(Buffer.from([r])))throw new Error(`Format Error: Invalid ${e} key: ${t.toString("hex")}`)}function ic(e,{globalMapKeyVals:t,inputKeyVals:r,outputKeyVals:n}){const s={unsignedTx:e};let i=0;for(const e of t)switch(e.key[0]){case nc.GlobalTypes.UNSIGNED_TX:if(sc("global",e.key,nc.GlobalTypes.UNSIGNED_TX),i>0)throw new Error("Format Error: GlobalMap has multiple UNSIGNED_TX");i++;break;case nc.GlobalTypes.GLOBAL_XPUB:void 0===s.globalXpub&&(s.globalXpub=[]),s.globalXpub.push(ec.globals.globalXpub.decode(e));break;default:s.unknownKeyVals||(s.unknownKeyVals=[]),s.unknownKeyVals.push(e)}const o=r.length,a=n.length,u=[],c=[];for(const e of tc.range(o)){const t={};for(const n of r[e])switch(ec.inputs.checkPubkey(n),n.key[0]){case nc.InputTypes.NON_WITNESS_UTXO:if(sc("input",n.key,nc.InputTypes.NON_WITNESS_UTXO),void 0!==t.nonWitnessUtxo)throw new Error("Format Error: Input has multiple NON_WITNESS_UTXO");t.nonWitnessUtxo=ec.inputs.nonWitnessUtxo.decode(n);break;case nc.InputTypes.WITNESS_UTXO:if(sc("input",n.key,nc.InputTypes.WITNESS_UTXO),void 0!==t.witnessUtxo)throw new Error("Format Error: Input has multiple WITNESS_UTXO");t.witnessUtxo=ec.inputs.witnessUtxo.decode(n);break;case nc.InputTypes.PARTIAL_SIG:void 0===t.partialSig&&(t.partialSig=[]),t.partialSig.push(ec.inputs.partialSig.decode(n));break;case nc.InputTypes.SIGHASH_TYPE:if(sc("input",n.key,nc.InputTypes.SIGHASH_TYPE),void 0!==t.sighashType)throw new Error("Format Error: Input has multiple SIGHASH_TYPE");t.sighashType=ec.inputs.sighashType.decode(n);break;case nc.InputTypes.REDEEM_SCRIPT:if(sc("input",n.key,nc.InputTypes.REDEEM_SCRIPT),void 0!==t.redeemScript)throw new Error("Format Error: Input has multiple REDEEM_SCRIPT");t.redeemScript=ec.inputs.redeemScript.decode(n);break;case nc.InputTypes.WITNESS_SCRIPT:if(sc("input",n.key,nc.InputTypes.WITNESS_SCRIPT),void 0!==t.witnessScript)throw new Error("Format Error: Input has multiple WITNESS_SCRIPT");t.witnessScript=ec.inputs.witnessScript.decode(n);break;case nc.InputTypes.BIP32_DERIVATION:void 0===t.bip32Derivation&&(t.bip32Derivation=[]),t.bip32Derivation.push(ec.inputs.bip32Derivation.decode(n));break;case nc.InputTypes.FINAL_SCRIPTSIG:sc("input",n.key,nc.InputTypes.FINAL_SCRIPTSIG),t.finalScriptSig=ec.inputs.finalScriptSig.decode(n);break;case nc.InputTypes.FINAL_SCRIPTWITNESS:sc("input",n.key,nc.InputTypes.FINAL_SCRIPTWITNESS),t.finalScriptWitness=ec.inputs.finalScriptWitness.decode(n);break;case nc.InputTypes.POR_COMMITMENT:sc("input",n.key,nc.InputTypes.POR_COMMITMENT),t.porCommitment=ec.inputs.porCommitment.decode(n);break;case nc.InputTypes.TAP_KEY_SIG:sc("input",n.key,nc.InputTypes.TAP_KEY_SIG),t.tapKeySig=ec.inputs.tapKeySig.decode(n);break;case nc.InputTypes.TAP_SCRIPT_SIG:void 0===t.tapScriptSig&&(t.tapScriptSig=[]),t.tapScriptSig.push(ec.inputs.tapScriptSig.decode(n));break;case nc.InputTypes.TAP_LEAF_SCRIPT:void 0===t.tapLeafScript&&(t.tapLeafScript=[]),t.tapLeafScript.push(ec.inputs.tapLeafScript.decode(n));break;case nc.InputTypes.TAP_BIP32_DERIVATION:void 0===t.tapBip32Derivation&&(t.tapBip32Derivation=[]),t.tapBip32Derivation.push(ec.inputs.tapBip32Derivation.decode(n));break;case nc.InputTypes.TAP_INTERNAL_KEY:sc("input",n.key,nc.InputTypes.TAP_INTERNAL_KEY),t.tapInternalKey=ec.inputs.tapInternalKey.decode(n);break;case nc.InputTypes.TAP_MERKLE_ROOT:sc("input",n.key,nc.InputTypes.TAP_MERKLE_ROOT),t.tapMerkleRoot=ec.inputs.tapMerkleRoot.decode(n);break;default:t.unknownKeyVals||(t.unknownKeyVals=[]),t.unknownKeyVals.push(n)}u.push(t)}for(const e of tc.range(a)){const t={};for(const r of n[e])switch(ec.outputs.checkPubkey(r),r.key[0]){case nc.OutputTypes.REDEEM_SCRIPT:if(sc("output",r.key,nc.OutputTypes.REDEEM_SCRIPT),void 0!==t.redeemScript)throw new Error("Format Error: Output has multiple REDEEM_SCRIPT");t.redeemScript=ec.outputs.redeemScript.decode(r);break;case nc.OutputTypes.WITNESS_SCRIPT:if(sc("output",r.key,nc.OutputTypes.WITNESS_SCRIPT),void 0!==t.witnessScript)throw new Error("Format Error: Output has multiple WITNESS_SCRIPT");t.witnessScript=ec.outputs.witnessScript.decode(r);break;case nc.OutputTypes.BIP32_DERIVATION:void 0===t.bip32Derivation&&(t.bip32Derivation=[]),t.bip32Derivation.push(ec.outputs.bip32Derivation.decode(r));break;case nc.OutputTypes.TAP_INTERNAL_KEY:sc("output",r.key,nc.OutputTypes.TAP_INTERNAL_KEY),t.tapInternalKey=ec.outputs.tapInternalKey.decode(r);break;case nc.OutputTypes.TAP_TREE:sc("output",r.key,nc.OutputTypes.TAP_TREE),t.tapTree=ec.outputs.tapTree.decode(r);break;case nc.OutputTypes.TAP_BIP32_DERIVATION:void 0===t.tapBip32Derivation&&(t.tapBip32Derivation=[]),t.tapBip32Derivation.push(ec.outputs.tapBip32Derivation.decode(r));break;default:t.unknownKeyVals||(t.unknownKeyVals=[]),t.unknownKeyVals.push(r)}c.push(t)}return{globalMap:s,inputs:u,outputs:c}}xa.psbtFromBuffer=function(e,t){let r=0;function n(){const t=rc.decode(e,r);r+=rc.encodingLength(t);const n=e.slice(r,r+t);return r+=t,n}function s(){return{key:n(),value:n()}}function i(){if(r>=e.length)throw new Error("Format Error: Unexpected End of PSBT");const t=0===e.readUInt8(r);return t&&r++,t}if(1886610036!==function(){const t=e.readUInt32BE(r);return r+=4,t}())throw new Error("Format Error: Invalid Magic Number");if(255!==function(){const t=e.readUInt8(r);return r+=1,t}())throw new Error("Format Error: Magic Number must be followed by 0xff separator");const o=[],a={};for(;!i();){const e=s(),t=e.key.toString("hex");if(a[t])throw new Error("Format Error: Keys must be unique for global keymap: key "+t);a[t]=1,o.push(e)}const u=o.filter((e=>e.key[0]===nc.GlobalTypes.UNSIGNED_TX));if(1!==u.length)throw new Error("Format Error: Only one UNSIGNED_TX allowed");const c=t(u[0].value),{inputCount:l,outputCount:f}=c.getInputOutputCounts(),p=[],h=[];for(const e of tc.range(l)){const t={},r=[];for(;!i();){const n=s(),i=n.key.toString("hex");if(t[i])throw new Error("Format Error: Keys must be unique for each input: input index "+e+" key "+i);t[i]=1,r.push(n)}p.push(r)}for(const e of tc.range(f)){const t={},r=[];for(;!i();){const n=s(),i=n.key.toString("hex");if(t[i])throw new Error("Format Error: Keys must be unique for each output: output index "+e+" key "+i);t[i]=1,r.push(n)}h.push(r)}return ic(c,{globalMapKeyVals:o,inputKeyVals:p,outputKeyVals:h})},xa.checkKeyBuffer=sc,xa.psbtFromKeyVals=ic;var oc={};Object.defineProperty(oc,"__esModule",{value:!0});const ac=Ca,uc=uu;oc.psbtToBuffer=function({globalMap:e,inputs:t,outputs:r}){const{globalKeyVals:n,inputKeyVals:s,outputKeyVals:i}=fc({globalMap:e,inputs:t,outputs:r}),o=uc.keyValsToBuffer(n),a=e=>0===e.length?[Buffer.from([0])]:e.map(uc.keyValsToBuffer),u=a(s),c=a(i),l=Buffer.allocUnsafe(5);return l.writeUIntBE(482972169471,0,5),Buffer.concat([l,o].concat(u,c))};const cc=(e,t)=>e.key.compare(t.key);function lc(e,t){const r=new Set,n=Object.entries(e).reduce(((e,[n,s])=>{if("unknownKeyVals"===n)return e;const i=t[n];if(void 0===i)return e;const o=(Array.isArray(s)?s:[s]).map(i.encode);return o.map((e=>e.key.toString("hex"))).forEach((e=>{if(r.has(e))throw new Error("Serialize Error: Duplicate key: "+e);r.add(e)})),e.concat(o)}),[]),s=e.unknownKeyVals?e.unknownKeyVals.filter((e=>!r.has(e.key.toString("hex")))):[];return n.concat(s).sort(cc)}function fc({globalMap:e,inputs:t,outputs:r}){return{globalKeyVals:lc(e,ac.globals),inputKeyVals:t.map((e=>lc(e,ac.inputs))),outputKeyVals:r.map((e=>lc(e,ac.outputs)))}}oc.psbtToKeyVals=fc,function(e){function t(t){for(var r in t)e.hasOwnProperty(r)||(e[r]=t[r])}Object.defineProperty(e,"__esModule",{value:!0}),t(xa),t(oc)}(Pa),Object.defineProperty(Na,"__esModule",{value:!0});const pc=Pa;function hc(e,t,r){return n=>{if(e.has(n))return;const s=r.filter((e=>e.key.toString("hex")===n))[0];t.push(s),e.add(n)}}function dc(e){return e.globalMap.unsignedTx}function mc(e){const t=new Set;return e.forEach((e=>{const r=e.key.toString("hex");if(t.has(r))throw new Error("Combine: KeyValue Map keys should be unique");t.add(r)})),t}Na.combine=function(e){const t=e[0],r=pc.psbtToKeyVals(t),n=e.slice(1);if(0===n.length)throw new Error("Combine: Nothing to combine");const s=dc(t);if(void 0===s)throw new Error("Combine: Self missing transaction");const i=mc(r.globalKeyVals),o=r.inputKeyVals.map(mc),a=r.outputKeyVals.map(mc);for(const e of n){const t=dc(e);if(void 0===t||!t.toBuffer().equals(s.toBuffer()))throw new Error("Combine: One of the Psbts does not have the same transaction.");const n=pc.psbtToKeyVals(e);mc(n.globalKeyVals).forEach(hc(i,r.globalKeyVals,n.globalKeyVals));n.inputKeyVals.map(mc).forEach(((e,t)=>e.forEach(hc(o[t],r.inputKeyVals[t],n.inputKeyVals[t]))));n.outputKeyVals.map(mc).forEach(((e,t)=>e.forEach(hc(a[t],r.outputKeyVals[t],n.outputKeyVals[t]))))}return pc.psbtFromKeyVals(s,{globalMapKeyVals:r.globalKeyVals,inputKeyVals:r.inputKeyVals,outputKeyVals:r.outputKeyVals})};var yc={};!function(e){Object.defineProperty(e,"__esModule",{value:!0});const t=Ca;function r(e,t){const r=e[t];if(void 0===r)throw new Error(`No input #${t}`);return r}function n(e,t){const r=e[t];if(void 0===r)throw new Error(`No output #${t}`);return r}function s(e,t,r,n){throw new Error(`Data for ${e} key ${t} is incorrect: Expected ${r} and got ${JSON.stringify(n)}`)}function i(e){return(r,n)=>{for(const i of Object.keys(r)){const o=r[i],{canAdd:a,canAddToArray:u,check:c,expected:l}=t[e+"s"][i]||{};if(c)if(!!u){if(!Array.isArray(o)||n[i]&&!Array.isArray(n[i]))throw new Error(`Key type ${i} must be an array`);o.every(c)||s(e,i,l,o);const t=n[i]||[],r=new Set;if(!o.every((e=>u(t,e,r))))throw new Error("Can not add duplicate data to array");n[i]=t.concat(o)}else{if(c(o)||s(e,i,l,o),!a(n,o))throw new Error(`Can not add duplicate data to ${e}`);n[i]=o}}}}e.checkForInput=r,e.checkForOutput=n,e.checkHasKey=function(e,t,r){if(e.key[0]<r)throw new Error("Use the method for your specific key instead of addUnknownKeyVal*");if(t&&0!==t.filter((t=>t.key.equals(e.key))).length)throw new Error(`Duplicate Key: ${e.key.toString("hex")}`)},e.getEnumLength=function(e){let t=0;return Object.keys(e).forEach((e=>{Number(isNaN(Number(e)))&&t++})),t},e.inputCheckUncleanFinalized=function(e,t){let r=!1;if(t.nonWitnessUtxo||t.witnessUtxo){const e=!!t.redeemScript,n=!!t.witnessScript,s=!e||!!t.finalScriptSig,i=!n||!!t.finalScriptWitness,o=!!t.finalScriptSig||!!t.finalScriptWitness;r=s&&i&&o}if(!1===r)throw new Error(`Input #${e} has too much or too little data to clean`)},e.updateGlobal=i("global"),e.updateInput=i("input"),e.updateOutput=i("output"),e.addInputAttributes=function(t,n){const s=r(t,t.length-1);e.updateInput(n,s)},e.addOutputAttributes=function(t,r){const s=n(t,t.length-1);e.updateOutput(r,s)},e.defaultVersionSetter=function(e,t){if(!Buffer.isBuffer(t)||t.length<4)throw new Error("Set Version: Invalid Transaction");return t.writeUInt32LE(e,0),t},e.defaultLocktimeSetter=function(e,t){if(!Buffer.isBuffer(t)||t.length<4)throw new Error("Set Locktime: Invalid Transaction");return t.writeUInt32LE(e,t.length-4),t}}(yc),Object.defineProperty(Ra,"__esModule",{value:!0});const gc=Na,bc=Pa,vc=Ba,_c=yc;Ra.Psbt=class{constructor(e){this.inputs=[],this.outputs=[],this.globalMap={unsignedTx:e}}static fromBase64(e,t){const r=Buffer.from(e,"base64");return this.fromBuffer(r,t)}static fromHex(e,t){const r=Buffer.from(e,"hex");return this.fromBuffer(r,t)}static fromBuffer(e,t){const r=bc.psbtFromBuffer(e,t),n=new this(r.globalMap.unsignedTx);return Object.assign(n,r),n}toBase64(){return this.toBuffer().toString("base64")}toHex(){return this.toBuffer().toString("hex")}toBuffer(){return bc.psbtToBuffer(this)}updateGlobal(e){return _c.updateGlobal(e,this.globalMap),this}updateInput(e,t){const r=_c.checkForInput(this.inputs,e);return _c.updateInput(t,r),this}updateOutput(e,t){const r=_c.checkForOutput(this.outputs,e);return _c.updateOutput(t,r),this}addUnknownKeyValToGlobal(e){return _c.checkHasKey(e,this.globalMap.unknownKeyVals,_c.getEnumLength(vc.GlobalTypes)),this.globalMap.unknownKeyVals||(this.globalMap.unknownKeyVals=[]),this.globalMap.unknownKeyVals.push(e),this}addUnknownKeyValToInput(e,t){const r=_c.checkForInput(this.inputs,e);return _c.checkHasKey(t,r.unknownKeyVals,_c.getEnumLength(vc.InputTypes)),r.unknownKeyVals||(r.unknownKeyVals=[]),r.unknownKeyVals.push(t),this}addUnknownKeyValToOutput(e,t){const r=_c.checkForOutput(this.outputs,e);return _c.checkHasKey(t,r.unknownKeyVals,_c.getEnumLength(vc.OutputTypes)),r.unknownKeyVals||(r.unknownKeyVals=[]),r.unknownKeyVals.push(t),this}addInput(e){this.globalMap.unsignedTx.addInput(e),this.inputs.push({unknownKeyVals:[]});const t=e.unknownKeyVals||[],r=this.inputs.length-1;if(!Array.isArray(t))throw new Error("unknownKeyVals must be an Array");return t.forEach((e=>this.addUnknownKeyValToInput(r,e))),_c.addInputAttributes(this.inputs,e),this}addOutput(e){this.globalMap.unsignedTx.addOutput(e),this.outputs.push({unknownKeyVals:[]});const t=e.unknownKeyVals||[],r=this.outputs.length-1;if(!Array.isArray(t))throw new Error("unknownKeyVals must be an Array");return t.forEach((e=>this.addUnknownKeyValToOutput(r,e))),_c.addOutputAttributes(this.outputs,e),this}clearFinalizedInput(e){const t=_c.checkForInput(this.inputs,e);_c.inputCheckUncleanFinalized(e,t);for(const e of Object.keys(t))["witnessUtxo","nonWitnessUtxo","finalScriptSig","finalScriptWitness","unknownKeyVals"].includes(e)||delete t[e];return this}combine(...e){const t=gc.combine([this].concat(e));return Object.assign(this,t),this}getTransaction(){return this.globalMap.unsignedTx.toBuffer()}};var wc={},Ec={};Object.defineProperty(Ec,"__esModule",{value:!0}),Ec.signatureBlocksAction=Ec.checkInputForSig=Ec.pubkeyInScript=Ec.pubkeyPositionInScript=Ec.witnessStackToScriptWitness=Ec.isP2TR=Ec.isP2SHScript=Ec.isP2WSHScript=Ec.isP2WPKH=Ec.isP2PKH=Ec.isP2PK=Ec.isP2MS=void 0;const Sc=cu,Ac=hn,Tc=na,Ic=Ss,Oc=fn;function kc(e){return t=>{try{return e({output:t}),!0}catch(e){return!1}}}function Rc(e,t){const r=(0,Ic.hash160)(e),n=e.slice(1,33),s=Ac.decompile(t);if(null===s)throw new Error("Unknown script error");return s.findIndex((t=>"number"!=typeof t&&(t.equals(e)||t.equals(r)||t.equals(n))))}function Nc(e,t,r){const{hashType:n}=t(e),s=[];n&Tc.Transaction.SIGHASH_ANYONECANPAY&&s.push("addInput");switch(31&n){case Tc.Transaction.SIGHASH_ALL:break;case Tc.Transaction.SIGHASH_SINGLE:case Tc.Transaction.SIGHASH_NONE:s.push("addOutput"),s.push("setInputSequence")}return-1===s.indexOf(r)}Ec.isP2MS=kc(Oc.p2ms),Ec.isP2PK=kc(Oc.p2pk),Ec.isP2PKH=kc(Oc.p2pkh),Ec.isP2WPKH=kc(Oc.p2wpkh),Ec.isP2WSHScript=kc(Oc.p2wsh),Ec.isP2SHScript=kc(Oc.p2sh),Ec.isP2TR=kc(Oc.p2tr),Ec.witnessStackToScriptWitness=function(e){let t=Buffer.allocUnsafe(0);function r(e){const r=t.length,n=Sc.encodingLength(e);t=Buffer.concat([t,Buffer.allocUnsafe(n)]),Sc.encode(e,t,r)}function n(e){r(e.length),function(e){t=Buffer.concat([t,Buffer.from(e)])}(e)}var s;return r((s=e).length),s.forEach(n),t},Ec.pubkeyPositionInScript=Rc,Ec.pubkeyInScript=function(e,t){return-1!==Rc(e,t)},Ec.checkInputForSig=function(e,t){return function(e){let t=[];if(0===(e.partialSig||[]).length){if(!e.finalScriptSig&&!e.finalScriptWitness)return[];t=function(e){const t=e.finalScriptSig&&Ac.decompile(e.finalScriptSig)||[],r=e.finalScriptWitness&&Ac.decompile(e.finalScriptWitness)||[];return t.concat(r).filter((e=>Buffer.isBuffer(e)&&Ac.isCanonicalScriptSignature(e))).map((e=>({signature:e})))}(e)}else t=e.partialSig;return t.map((e=>e.signature))}(e).some((e=>Nc(e,Ac.signature.decode,t)))},Ec.signatureBlocksAction=Nc,Object.defineProperty(wc,"__esModule",{value:!0}),wc.checkTaprootInputForSigs=wc.tapTreeFromList=wc.tapTreeToList=wc.tweakInternalPubKey=wc.checkTaprootOutputFields=wc.checkTaprootInputFields=wc.isTaprootOutput=wc.isTaprootInput=wc.serializeTaprootSignature=wc.tapScriptFinalizer=wc.toXOnly=void 0;const Pc=Sn,xc=na,Cc=Ec,Bc=mo,Lc=fn,$c=Ec;function Uc(e){return e&&!!(e.tapInternalKey||e.tapMerkleRoot||e.tapLeafScript&&e.tapLeafScript.length||e.tapBip32Derivation&&e.tapBip32Derivation.length||e.witnessUtxo&&(0,Cc.isP2TR)(e.witnessUtxo.script))}function Dc(e,t){return e&&!!(e.tapInternalKey||e.tapTree||e.tapBip32Derivation&&e.tapBip32Derivation.length||t&&(0,Cc.isP2TR)(t))}function jc(e=[]){return 1===e.length&&0===e[0].depth?{output:e[0].script,version:e[0].leafVersion}:function(e){let t;for(const r of e)if(t=Fc(r,t),!t)throw new Error("No room left to insert tapleaf in tree");return t}(e)}function Mc(e){return{signature:e.slice(0,64),hashType:e.slice(64)[0]||xc.Transaction.SIGHASH_DEFAULT}}function Hc(e,t=[],r=0){if(r>Bc.MAX_TAPTREE_DEPTH)throw new Error("Max taptree depth exceeded.");return e?(0,Pc.isTapleaf)(e)?(t.push({depth:r,leafVersion:e.version||Bc.LEAF_VERSION_TAPSCRIPT,script:e.output}),t):(e[0]&&Hc(e[0],t,r+1),e[1]&&Hc(e[1],t,r+1),t):[]}function Fc(e,t,r=0){if(r>Bc.MAX_TAPTREE_DEPTH)throw new Error("Max taptree depth exceeded.");if(e.depth===r)return t?void 0:{output:e.script,version:e.leafVersion};if((0,Pc.isTapleaf)(t))return;const n=Fc(e,t&&t[0],r+1);if(n)return[n,t&&t[1]];const s=Fc(e,t&&t[1],r+1);return s?[t&&t[0],s]:void 0}function Kc(e,t){if(!t)return!0;const r=(0,Bc.tapleafHash)({output:e.script,version:e.leafVersion});return(0,Bc.rootHashFromPath)(e.controlBlock,r).equals(t)}function Gc(e){return e&&!!(e.redeemScript||e.witnessScript||e.bip32Derivation&&e.bip32Derivation.length)}wc.toXOnly=e=>32===e.length?e:e.slice(1,33),wc.tapScriptFinalizer=function(e,t,r){const n=function(e,t,r){if(!e.tapScriptSig||!e.tapScriptSig.length)throw new Error(`Can not finalize taproot input #${t}. No tapleaf script signature provided.`);const n=(e.tapLeafScript||[]).sort(((e,t)=>e.controlBlock.length-t.controlBlock.length)).find((t=>function(e,t,r){const n=(0,Bc.tapleafHash)({output:e.script,version:e.leafVersion}),s=!r||r.equals(n);return s&&void 0!==t.find((e=>e.leafHash.equals(n)))}(t,e.tapScriptSig,r)));if(!n)throw new Error(`Can not finalize taproot input #${t}. Signature for tapleaf script not found.`);return n}(t,e,r);try{const e=function(e,t){const r=(0,Bc.tapleafHash)({output:t.script,version:t.leafVersion});return(e.tapScriptSig||[]).filter((e=>e.leafHash.equals(r))).map((e=>function(e,t){return Object.assign({positionInScript:(0,Cc.pubkeyPositionInScript)(t.pubkey,e)},t)}(t.script,e))).sort(((e,t)=>t.positionInScript-e.positionInScript)).map((e=>e.signature))}(t,n),r=e.concat(n.script).concat(n.controlBlock);return{finalScriptWitness:(0,Cc.witnessStackToScriptWitness)(r)}}catch(t){throw new Error(`Can not finalize taproot input #${e}: ${t}`)}},wc.serializeTaprootSignature=function(e,t){const r=t?Buffer.from([t]):Buffer.from([]);return Buffer.concat([e,r])},wc.isTaprootInput=Uc,wc.isTaprootOutput=Dc,wc.checkTaprootInputFields=function(e,t,r){!function(e,t,r){const n=Uc(e)&&Gc(t),s=Gc(e)&&Uc(t),i=e===t&&Uc(t)&&Gc(t);if(n||s||i)throw new Error(`Invalid arguments for Psbt.${r}. Cannot use both taproot and non-taproot fields.`)}(e,t,r),function(e,t,r){if(t.tapMerkleRoot){const n=(t.tapLeafScript||[]).every((e=>Kc(e,t.tapMerkleRoot))),s=(e.tapLeafScript||[]).every((e=>Kc(e,t.tapMerkleRoot)));if(!n||!s)throw new Error(`Invalid arguments for Psbt.${r}. Tapleaf not part of taptree.`)}else if(e.tapMerkleRoot){if(!(t.tapLeafScript||[]).every((t=>Kc(t,e.tapMerkleRoot))))throw new Error(`Invalid arguments for Psbt.${r}. Tapleaf not part of taptree.`)}}(e,t,r)},wc.checkTaprootOutputFields=function(e,t,r){!function(e,t,r){const n=Dc(e)&&Gc(t),s=Gc(e)&&Dc(t),i=e===t&&Dc(t)&&Gc(t);if(n||s||i)throw new Error(`Invalid arguments for Psbt.${r}. Cannot use both taproot and non-taproot fields.`)}(e,t,r),function(e,t){if(!t.tapTree&&!t.tapInternalKey)return;const r=t.tapInternalKey||e.tapInternalKey,n=t.tapTree||e.tapTree;if(r){const{script:t}=e,s=function(e,t){const r=t&&jc(t.leaves),{output:n}=(0,Lc.p2tr)({internalPubkey:e,scriptTree:r});return n}(r,n);if(t&&!t.equals(s))throw new Error("Error adding output. Script or address missmatch.")}}(e,t)},wc.tweakInternalPubKey=function(e,t){const r=t.tapInternalKey,n=r&&(0,Bc.tweakKey)(r,t.tapMerkleRoot);if(!n)throw new Error(`Cannot tweak tap internal key for input #${e}. Public key: ${r&&r.toString("hex")}`);return n.x},wc.tapTreeToList=function(e){if(!(0,Pc.isTaptree)(e))throw new Error("Cannot convert taptree to tapleaf list. Expecting a tapree structure.");return Hc(e)},wc.tapTreeFromList=jc,wc.checkTaprootInputForSigs=function(e,t){const r=function(e){const t=[];e.tapKeySig&&t.push(e.tapKeySig);e.tapScriptSig&&t.push(...e.tapScriptSig.map((e=>e.signature)));if(!t.length){const r=function(e){if(!e)return;const t=e.slice(2);if(64===t.length||65===t.length)return t}(e.finalScriptWitness);r&&t.push(r)}return t}(e);return r.some((e=>(0,$c.signatureBlocksAction)(e,Mc,t)))},Object.defineProperty(ka,"__esModule",{value:!0}),ka.Psbt=void 0;const Vc=Ra,Xc=cu,Wc=yc,qc=cn,Zc=yo,Yc=fn,zc=mo,Jc=hn,Qc=na,el=wc,tl=Ec,rl={network:ln.bitcoin,maximumFeeRate:5e3};class nl{static fromBase64(e,t={}){const r=Buffer.from(e,"base64");return this.fromBuffer(r,t)}static fromHex(e,t={}){const r=Buffer.from(e,"hex");return this.fromBuffer(r,t)}static fromBuffer(e,t={}){const r=Vc.Psbt.fromBuffer(e,sl),n=new nl(t,r);return function(e,t){e.ins.forEach((e=>{hl(t,e)}))}(n.__CACHE.__TX,n.__CACHE),n}constructor(e={},t=new Vc.Psbt(new il)){this.data=t,this.opts=Object.assign({},rl,e),this.__CACHE={__NON_WITNESS_UTXO_TX_CACHE:[],__NON_WITNESS_UTXO_BUF_CACHE:[],__TX_IN_CACHE:{},__TX:this.data.globalMap.unsignedTx.tx,__UNSAFE_SIGN_NONSEGWIT:!1},0===this.data.inputs.length&&this.setVersion(2);const r=(e,t,r,n)=>Object.defineProperty(e,t,{enumerable:r,writable:n});r(this,"__CACHE",!1,!0),r(this,"opts",!1,!0)}get inputCount(){return this.data.inputs.length}get version(){return this.__CACHE.__TX.version}set version(e){this.setVersion(e)}get locktime(){return this.__CACHE.__TX.locktime}set locktime(e){this.setLocktime(e)}get txInputs(){return this.__CACHE.__TX.ins.map((e=>({hash:(0,Zc.cloneBuffer)(e.hash),index:e.index,sequence:e.sequence})))}get txOutputs(){return this.__CACHE.__TX.outs.map((e=>{let t;try{t=(0,qc.fromOutputScript)(e.script,this.opts.network)}catch(e){}return{script:(0,Zc.cloneBuffer)(e.script),value:e.value,address:t}}))}combine(...e){return this.data.combine(...e.map((e=>e.data))),this}clone(){const e=nl.fromBuffer(this.data.toBuffer());return e.opts=JSON.parse(JSON.stringify(this.opts)),e}setMaximumFeeRate(e){ll(e),this.opts.maximumFeeRate=e}setVersion(e){ll(e),fl(this.data.inputs,"setVersion");const t=this.__CACHE;return t.__TX.version=e,t.__EXTRACTED_TX=void 0,this}setLocktime(e){ll(e),fl(this.data.inputs,"setLocktime");const t=this.__CACHE;return t.__TX.locktime=e,t.__EXTRACTED_TX=void 0,this}setInputSequence(e,t){ll(t),fl(this.data.inputs,"setInputSequence");const r=this.__CACHE;if(r.__TX.ins.length<=e)throw new Error("Input index too high");return r.__TX.ins[e].sequence=t,r.__EXTRACTED_TX=void 0,this}addInputs(e){return e.forEach((e=>this.addInput(e))),this}addInput(e){if(arguments.length>1||!e||void 0===e.hash||void 0===e.index)throw new Error("Invalid arguments for Psbt.addInput. Requires single object with at least [hash] and [index]");(0,el.checkTaprootInputFields)(e,e,"addInput"),fl(this.data.inputs,"addInput"),e.witnessScript&&Bl(e.witnessScript);const t=this.__CACHE;this.data.addInput(e);hl(t,t.__TX.ins[t.__TX.ins.length-1]);const r=this.data.inputs.length-1,n=this.data.inputs[r];return n.nonWitnessUtxo&&Ol(this.__CACHE,n,r),t.__FEE=void 0,t.__FEE_RATE=void 0,t.__EXTRACTED_TX=void 0,this}addOutputs(e){return e.forEach((e=>this.addOutput(e))),this}addOutput(e){if(arguments.length>1||!e||void 0===e.value||void 0===e.address&&void 0===e.script)throw new Error("Invalid arguments for Psbt.addOutput. Requires single object with at least [script or address] and [value]");fl(this.data.inputs,"addOutput");const{address:t}=e;if("string"==typeof t){const{network:r}=this.opts,n=(0,qc.toOutputScript)(t,r);e=Object.assign(e,{script:n})}(0,el.checkTaprootOutputFields)(e,e,"addOutput");const r=this.__CACHE;return this.data.addOutput(e),r.__FEE=void 0,r.__FEE_RATE=void 0,r.__EXTRACTED_TX=void 0,this}extractTransaction(e){if(!this.data.inputs.every(ul))throw new Error("Not finalized");const t=this.__CACHE;if(e||function(e,t,r){const n=t.__FEE_RATE||e.getFeeRate(),s=t.__EXTRACTED_TX.virtualSize(),i=n*s;if(n>=r.maximumFeeRate)throw new Error(`Warning: You are paying around ${(i/1e8).toFixed(8)} in fees, which is ${n} satoshi per byte for a transaction with a VSize of ${s} bytes (segwit counted as 0.25 byte per byte). Use setMaximumFeeRate method to raise your threshold, or pass true to the first arg of extractTransaction.`)}(this,t,this.opts),t.__EXTRACTED_TX)return t.__EXTRACTED_TX;const r=t.__TX.clone();return kl(this.data.inputs,r,t,!0),r}getFeeRate(){return gl("__FEE_RATE","fee rate",this.data.inputs,this.__CACHE)}getFee(){return gl("__FEE","fee",this.data.inputs,this.__CACHE)}finalizeAllInputs(){return(0,Wc.checkForInput)(this.data.inputs,0),$l(this.data.inputs.length).forEach((e=>this.finalizeInput(e))),this}finalizeInput(e,t){const r=(0,Wc.checkForInput)(this.data.inputs,e);return(0,el.isTaprootInput)(r)?this._finalizeTaprootInput(e,r,void 0,t):this._finalizeInput(e,r,t)}finalizeTaprootInput(e,t,r=el.tapScriptFinalizer){const n=(0,Wc.checkForInput)(this.data.inputs,e);if((0,el.isTaprootInput)(n))return this._finalizeTaprootInput(e,n,t,r);throw new Error(`Cannot finalize input #${e}. Not Taproot.`)}_finalizeInput(e,t,r=bl){const{script:n,isP2SH:s,isP2WSH:i,isSegwit:o}=function(e,t,r){const n=r.__TX,s={script:null,isSegwit:!1,isP2SH:!1,isP2WSH:!1};if(s.isP2SH=!!t.redeemScript,s.isP2WSH=!!t.witnessScript,t.witnessScript)s.script=t.witnessScript;else if(t.redeemScript)s.script=t.redeemScript;else if(t.nonWitnessUtxo){const i=Rl(r,t,e),o=n.ins[e].index;s.script=i.outs[o].script}else t.witnessUtxo&&(s.script=t.witnessUtxo.script);(t.witnessScript||(0,tl.isP2WPKH)(s.script))&&(s.isSegwit=!0);return s}(e,t,this.__CACHE);if(!n)throw new Error(`No script found for input #${e}`);!function(e){if(!e.sighashType||!e.partialSig)return;const{partialSig:t,sighashType:r}=e;t.forEach((e=>{const{hashType:t}=Jc.signature.decode(e.signature);if(r!==t)throw new Error("Signature sighash does not match input sighash type")}))}(t);const{finalScriptSig:a,finalScriptWitness:u}=r(e,t,n,o,s,i);if(a&&this.data.updateInput(e,{finalScriptSig:a}),u&&this.data.updateInput(e,{finalScriptWitness:u}),!a&&!u)throw new Error(`Unknown error finalizing input #${e}`);return this.data.clearFinalizedInput(e),this}_finalizeTaprootInput(e,t,r,n=el.tapScriptFinalizer){if(!t.witnessUtxo)throw new Error(`Cannot finalize input #${e}. Missing withness utxo.`);if(t.tapKeySig){const r=Yc.p2tr({output:t.witnessUtxo.script,signature:t.tapKeySig}),n=(0,tl.witnessStackToScriptWitness)(r.witness);this.data.updateInput(e,{finalScriptWitness:n})}else{const{finalScriptWitness:s}=n(e,t,r);this.data.updateInput(e,{finalScriptWitness:s})}return this.data.clearFinalizedInput(e),this}getInputType(e){const t=(0,Wc.checkForInput)(this.data.inputs,e),r=Cl(Nl(e,t,this.__CACHE),e,"input",t.redeemScript||function(e){if(!e)return;const t=Jc.decompile(e);if(!t)return;const r=t[t.length-1];if(!Buffer.isBuffer(r)||xl(r)||(n=r,Jc.isCanonicalScriptSignature(n)))return;var n;if(!Jc.decompile(r))return;return r}(t.finalScriptSig),t.witnessScript||function(e){if(!e)return;const t=Il(e),r=t[t.length-1];if(xl(r))return;if(!Jc.decompile(r))return;return r}(t.finalScriptWitness));return("raw"===r.type?"":r.type+"-")+Ll(r.meaningfulScript)}inputHasPubkey(e,t){return function(e,t,r,n){const s=Nl(r,t,n),{meaningfulScript:i}=Cl(s,r,"input",t.redeemScript,t.witnessScript);return(0,tl.pubkeyInScript)(e,i)}(t,(0,Wc.checkForInput)(this.data.inputs,e),e,this.__CACHE)}inputHasHDKey(e,t){const r=(0,Wc.checkForInput)(this.data.inputs,e),n=cl(t);return!!r.bip32Derivation&&r.bip32Derivation.some(n)}outputHasPubkey(e,t){return function(e,t,r,n){const s=n.__TX.outs[r].script,{meaningfulScript:i}=Cl(s,r,"output",t.redeemScript,t.witnessScript);return(0,tl.pubkeyInScript)(e,i)}(t,(0,Wc.checkForOutput)(this.data.outputs,e),e,this.__CACHE)}outputHasHDKey(e,t){const r=(0,Wc.checkForOutput)(this.data.outputs,e),n=cl(t);return!!r.bip32Derivation&&r.bip32Derivation.some(n)}validateSignaturesOfAllInputs(e){(0,Wc.checkForInput)(this.data.inputs,0);return $l(this.data.inputs.length).map((t=>this.validateSignaturesOfInput(t,e))).reduce(((e,t)=>!0===t&&e),!0)}validateSignaturesOfInput(e,t,r){const n=this.data.inputs[e];return(0,el.isTaprootInput)(n)?this.validateSignaturesOfTaprootInput(e,t,r):this._validateSignaturesOfInput(e,t,r)}_validateSignaturesOfInput(e,t,r){const n=this.data.inputs[e],s=(n||{}).partialSig;if(!n||!s||s.length<1)throw new Error("No signatures to validate");if("function"!=typeof t)throw new Error("Need validator function to validate signatures");const i=r?s.filter((e=>e.pubkey.equals(r))):s;if(i.length<1)throw new Error("No signatures for this pubkey");const o=[];let a,u,c;for(const r of i){const s=Jc.signature.decode(r.signature),{hash:i,script:l}=c!==s.hashType?_l(e,Object.assign({},n,{sighashType:s.hashType}),this.__CACHE,!0):{hash:a,script:u};c=s.hashType,a=i,u=l,pl(r.pubkey,l,"verify"),o.push(t(r.pubkey,i,s.signature))}return o.every((e=>!0===e))}validateSignaturesOfTaprootInput(e,t,r){const n=this.data.inputs[e],s=(n||{}).tapKeySig,i=(n||{}).tapScriptSig;if(!n&&!s&&(!i||i.length))throw new Error("No signatures to validate");if("function"!=typeof t)throw new Error("Need validator function to validate signatures");const o=(r=r&&(0,el.toXOnly)(r))?Sl(e,n,this.data.inputs,r,this.__CACHE):function(e,t,r,n){const s=[];if(t.tapInternalKey){const r=wl(e,t,n);r&&s.push(r)}if(t.tapScriptSig){const e=t.tapScriptSig.map((e=>e.pubkey));s.push(...e)}const i=s.map((s=>Sl(e,t,r,s,n)));return i.flat()}(e,n,this.data.inputs,this.__CACHE);if(!o.length)throw new Error("No signatures for this pubkey");const a=o.find((e=>!e.leafHash));let u=0;if(s&&a){if(!t(a.pubkey,a.hash,El(s)))return!1;u++}if(i)for(const e of i){const r=o.find((t=>e.pubkey.equals(t.pubkey)));if(r){if(!t(e.pubkey,r.hash,El(e.signature)))return!1;u++}}return u>0}signAllInputsHD(e,t=[Qc.Transaction.SIGHASH_ALL]){if(!e||!e.publicKey||!e.fingerprint)throw new Error("Need HDSigner to sign input");const r=[];for(const n of $l(this.data.inputs.length))try{this.signInputHD(n,e,t),r.push(!0)}catch(e){r.push(!1)}if(r.every((e=>!1===e)))throw new Error("No inputs were signed");return this}signAllInputsHDAsync(e,t=[Qc.Transaction.SIGHASH_ALL]){return new Promise(((r,n)=>{if(!e||!e.publicKey||!e.fingerprint)return n(new Error("Need HDSigner to sign input"));const s=[],i=[];for(const r of $l(this.data.inputs.length))i.push(this.signInputHDAsync(r,e,t).then((()=>{s.push(!0)}),(()=>{s.push(!1)})));return Promise.all(i).then((()=>{if(s.every((e=>!1===e)))return n(new Error("No inputs were signed"));r()}))}))}signInputHD(e,t,r=[Qc.Transaction.SIGHASH_ALL]){if(!t||!t.publicKey||!t.fingerprint)throw new Error("Need HDSigner to sign input");return Tl(e,this.data.inputs,t).forEach((t=>this.signInput(e,t,r))),this}signInputHDAsync(e,t,r=[Qc.Transaction.SIGHASH_ALL]){return new Promise(((n,s)=>{if(!t||!t.publicKey||!t.fingerprint)return s(new Error("Need HDSigner to sign input"));const i=Tl(e,this.data.inputs,t).map((t=>this.signInputAsync(e,t,r)));return Promise.all(i).then((()=>{n()})).catch(s)}))}signAllInputs(e,t){if(!e||!e.publicKey)throw new Error("Need Signer to sign input");const r=[];for(const n of $l(this.data.inputs.length))try{this.signInput(n,e,t),r.push(!0)}catch(e){r.push(!1)}if(r.every((e=>!1===e)))throw new Error("No inputs were signed");return this}signAllInputsAsync(e,t){return new Promise(((r,n)=>{if(!e||!e.publicKey)return n(new Error("Need Signer to sign input"));const s=[],i=[];for(const[r]of this.data.inputs.entries())i.push(this.signInputAsync(r,e,t).then((()=>{s.push(!0)}),(()=>{s.push(!1)})));return Promise.all(i).then((()=>{if(s.every((e=>!1===e)))return n(new Error("No inputs were signed"));r()}))}))}signInput(e,t,r){if(!t||!t.publicKey)throw new Error("Need Signer to sign input");const n=(0,Wc.checkForInput)(this.data.inputs,e);return(0,el.isTaprootInput)(n)?this._signTaprootInput(e,n,t,void 0,r):this._signInput(e,t,r)}signTaprootInput(e,t,r,n){if(!t||!t.publicKey)throw new Error("Need Signer to sign input");const s=(0,Wc.checkForInput)(this.data.inputs,e);if((0,el.isTaprootInput)(s))return this._signTaprootInput(e,s,t,r,n);throw new Error(`Input #${e} is not of type Taproot.`)}_signInput(e,t,r=[Qc.Transaction.SIGHASH_ALL]){const{hash:n,sighashType:s}=vl(this.data.inputs,e,t.publicKey,this.__CACHE,r),i=[{pubkey:t.publicKey,signature:Jc.signature.encode(t.sign(n),s)}];return this.data.updateInput(e,{partialSig:i}),this}_signTaprootInput(e,t,r,n,s=[Qc.Transaction.SIGHASH_DEFAULT]){const i=this.checkTaprootHashesForSig(e,t,r,n,s),o=i.filter((e=>!e.leafHash)).map((e=>(0,el.serializeTaprootSignature)(r.signSchnorr(e.hash),t.sighashType)))[0],a=i.filter((e=>!!e.leafHash)).map((e=>({pubkey:(0,el.toXOnly)(r.publicKey),signature:(0,el.serializeTaprootSignature)(r.signSchnorr(e.hash),t.sighashType),leafHash:e.leafHash})));return o&&this.data.updateInput(e,{tapKeySig:o}),a.length&&this.data.updateInput(e,{tapScriptSig:a}),this}signInputAsync(e,t,r){return Promise.resolve().then((()=>{if(!t||!t.publicKey)throw new Error("Need Signer to sign input");const n=(0,Wc.checkForInput)(this.data.inputs,e);return(0,el.isTaprootInput)(n)?this._signTaprootInputAsync(e,n,t,void 0,r):this._signInputAsync(e,t,r)}))}signTaprootInputAsync(e,t,r,n){return Promise.resolve().then((()=>{if(!t||!t.publicKey)throw new Error("Need Signer to sign input");const s=(0,Wc.checkForInput)(this.data.inputs,e);if((0,el.isTaprootInput)(s))return this._signTaprootInputAsync(e,s,t,r,n);throw new Error(`Input #${e} is not of type Taproot.`)}))}_signInputAsync(e,t,r=[Qc.Transaction.SIGHASH_ALL]){const{hash:n,sighashType:s}=vl(this.data.inputs,e,t.publicKey,this.__CACHE,r);return Promise.resolve(t.sign(n)).then((r=>{const n=[{pubkey:t.publicKey,signature:Jc.signature.encode(r,s)}];this.data.updateInput(e,{partialSig:n})}))}async _signTaprootInputAsync(e,t,r,n,s=[Qc.Transaction.SIGHASH_DEFAULT]){const i=this.checkTaprootHashesForSig(e,t,r,n,s),o=[],a=i.filter((e=>!e.leafHash))[0];if(a){const e=Promise.resolve(r.signSchnorr(a.hash)).then((e=>({tapKeySig:(0,el.serializeTaprootSignature)(e,t.sighashType)})));o.push(e)}const u=i.filter((e=>!!e.leafHash));if(u.length){const e=u.map((e=>Promise.resolve(r.signSchnorr(e.hash)).then((n=>({tapScriptSig:[{pubkey:(0,el.toXOnly)(r.publicKey),signature:(0,el.serializeTaprootSignature)(n,t.sighashType),leafHash:e.leafHash}]})))));o.push(...e)}return Promise.all(o).then((t=>{t.forEach((t=>this.data.updateInput(e,t)))}))}checkTaprootHashesForSig(e,t,r,n,s){if("function"!=typeof r.signSchnorr)throw new Error(`Need Schnorr Signer to sign taproot input #${e}.`);const i=Sl(e,t,this.data.inputs,r.publicKey,this.__CACHE,n,s);if(!i||!i.length)throw new Error(`Can not sign for input #${e} with the key ${r.publicKey.toString("hex")}`);return i}toBuffer(){return ol(this.__CACHE),this.data.toBuffer()}toHex(){return ol(this.__CACHE),this.data.toHex()}toBase64(){return ol(this.__CACHE),this.data.toBase64()}updateGlobal(e){return this.data.updateGlobal(e),this}updateInput(e,t){return t.witnessScript&&Bl(t.witnessScript),(0,el.checkTaprootInputFields)(this.data.inputs[e],t,"updateInput"),this.data.updateInput(e,t),t.nonWitnessUtxo&&Ol(this.__CACHE,this.data.inputs[e],e),this}updateOutput(e,t){const r=this.data.outputs[e];return(0,el.checkTaprootOutputFields)(r,t,"updateOutput"),this.data.updateOutput(e,t),this}addUnknownKeyValToGlobal(e){return this.data.addUnknownKeyValToGlobal(e),this}addUnknownKeyValToInput(e,t){return this.data.addUnknownKeyValToInput(e,t),this}addUnknownKeyValToOutput(e,t){return this.data.addUnknownKeyValToOutput(e,t),this}clearFinalizedInput(e){return this.data.clearFinalizedInput(e),this}}ka.Psbt=nl;const sl=e=>new il(e);class il{constructor(e=Buffer.from([2,0,0,0,0,0,0,0,0,0])){this.tx=Qc.Transaction.fromBuffer(e),function(e){if(!e.ins.every((e=>e.script&&0===e.script.length&&e.witness&&0===e.witness.length)))throw new Error("Format Error: Transaction ScriptSigs are not empty")}(this.tx),Object.defineProperty(this,"tx",{enumerable:!1,writable:!0})}getInputOutputCounts(){return{inputCount:this.tx.ins.length,outputCount:this.tx.outs.length}}addInput(e){if(void 0===e.hash||void 0===e.index||!Buffer.isBuffer(e.hash)&&"string"!=typeof e.hash||"number"!=typeof e.index)throw new Error("Error adding input.");const t="string"==typeof e.hash?(0,Zc.reverseBuffer)(Buffer.from(e.hash,"hex")):e.hash;this.tx.addInput(t,e.index,e.sequence)}addOutput(e){if(void 0===e.script||void 0===e.value||!Buffer.isBuffer(e.script)||"number"!=typeof e.value)throw new Error("Error adding output.");this.tx.addOutput(e.script,e.value)}toBuffer(){return this.tx.toBuffer()}}function ol(e){if(!1!==e.__UNSAFE_SIGN_NONSEGWIT)throw new Error("Not BIP174 compliant, can not export")}function al(e,t,r){if(!t)return!1;let n;if(n=r?r.map((e=>{const r=function(e){if(65===e.length){const t=1&e[64],r=e.slice(0,33);return r[0]=2|t,r}return e.slice()}(e);return t.find((e=>e.pubkey.equals(r)))})).filter((e=>!!e)):t,n.length>e)throw new Error("Too many signatures");return n.length===e}function ul(e){return!!e.finalScriptSig||!!e.finalScriptWitness}function cl(e){return t=>!!t.masterFingerprint.equals(e.fingerprint)&&!!e.derivePath(t.path).publicKey.equals(t.pubkey)}function ll(e){if("number"!=typeof e||e!==Math.floor(e)||e>4294967295||e<0)throw new Error("Invalid 32 bit integer")}function fl(e,t){e.forEach((e=>{if((0,el.isTaprootInput)(e)?(0,el.checkTaprootInputForSigs)(e,t):(0,tl.checkInputForSig)(e,t))throw new Error("Can not modify transaction, signatures exist.")}))}function pl(e,t,r){if(!(0,tl.pubkeyInScript)(e,t))throw new Error(`Can not ${r} for this input with the key ${e.toString("hex")}`)}function hl(e,t){const r=(0,Zc.reverseBuffer)(Buffer.from(t.hash)).toString("hex")+":"+t.index;if(e.__TX_IN_CACHE[r])throw new Error("Duplicate input detected.");e.__TX_IN_CACHE[r]=1}function dl(e,t){return(r,n,s,i)=>{const o=e({redeem:{output:s}}).output;if(!n.equals(o))throw new Error(`${t} for ${i} #${r} doesn't match the scriptPubKey in the prevout`)}}const ml=dl(Yc.p2sh,"Redeem script"),yl=dl(Yc.p2wsh,"Witness script");function gl(e,t,r,n){if(!r.every(ul))throw new Error(`PSBT must be finalized to calculate ${t}`);if("__FEE_RATE"===e&&n.__FEE_RATE)return n.__FEE_RATE;if("__FEE"===e&&n.__FEE)return n.__FEE;let s,i=!0;return n.__EXTRACTED_TX?(s=n.__EXTRACTED_TX,i=!1):s=n.__TX.clone(),kl(r,s,n,i),"__FEE_RATE"===e?n.__FEE_RATE:"__FEE"===e?n.__FEE:void 0}function bl(e,t,r,n,s,i){const o=Ll(r);if(!function(e,t,r){switch(r){case"pubkey":case"pubkeyhash":case"witnesspubkeyhash":return al(1,e.partialSig);case"multisig":const r=Yc.p2ms({output:t});return al(r.m,e.partialSig,r.pubkeys);default:return!1}}(t,r,o))throw new Error(`Can not finalize input #${e}`);return function(e,t,r,n,s,i){let o,a;const u=function(e,t,r){let n;switch(t){case"multisig":const t=function(e,t){const r=Yc.p2ms({output:e});return r.pubkeys.map((e=>(t.filter((t=>t.pubkey.equals(e)))[0]||{}).signature)).filter((e=>!!e))}(e,r);n=Yc.p2ms({output:e,signatures:t});break;case"pubkey":n=Yc.p2pk({output:e,signature:r[0].signature});break;case"pubkeyhash":n=Yc.p2pkh({output:e,pubkey:r[0].pubkey,signature:r[0].signature});break;case"witnesspubkeyhash":n=Yc.p2wpkh({output:e,pubkey:r[0].pubkey,signature:r[0].signature})}return n}(e,t,r),c=i?Yc.p2wsh({redeem:u}):null,l=s?Yc.p2sh({redeem:c||u}):null;n?(a=c?(0,tl.witnessStackToScriptWitness)(c.witness):(0,tl.witnessStackToScriptWitness)(u.witness),l&&(o=l.input)):o=l?l.input:u.input;return{finalScriptSig:o,finalScriptWitness:a}}(r,o,t.partialSig,n,s,i)}function vl(e,t,r,n,s){const i=(0,Wc.checkForInput)(e,t),{hash:o,sighashType:a,script:u}=_l(t,i,n,!1,s);return pl(r,u,"sign"),{hash:o,sighashType:a}}function _l(e,t,r,n,s){const i=r.__TX,o=t.sighashType||Qc.Transaction.SIGHASH_ALL;let a,u;if(Al(o,s),t.nonWitnessUtxo){const n=Rl(r,t,e),s=i.ins[e].hash,o=n.getHash();if(!s.equals(o))throw new Error(`Non-witness UTXO hash for input #${e} doesn't match the hash specified in the prevout`);const a=i.ins[e].index;u=n.outs[a]}else{if(!t.witnessUtxo)throw new Error("Need a Utxo input item for signing");u=t.witnessUtxo}const{meaningfulScript:c,type:l}=Cl(u.script,e,"input",t.redeemScript,t.witnessScript);if(["p2sh-p2wsh","p2wsh"].indexOf(l)>=0)a=i.hashForWitnessV0(e,c,u.value,o);else if((0,tl.isP2WPKH)(c)){const t=Yc.p2pkh({hash:c.slice(2)}).output;a=i.hashForWitnessV0(e,t,u.value,o)}else{if(void 0===t.nonWitnessUtxo&&!1===r.__UNSAFE_SIGN_NONSEGWIT)throw new Error(`Input #${e} has witnessUtxo but non-segwit script: ${c.toString("hex")}`);n||!1===r.__UNSAFE_SIGN_NONSEGWIT||console.warn("Warning: Signing non-segwit inputs without the full parent transaction means there is a chance that a miner could feed you incorrect information to trick you into paying large fees. This behavior is the same as Psbt's predecesor (TransactionBuilder - now removed) when signing non-segwit scripts. You are not able to export this Psbt with toBuffer|toBase64|toHex since it is not BIP174 compliant.\n*********************\nPROCEED WITH CAUTION!\n*********************"),a=i.hashForSignature(e,c,o)}return{script:c,sighashType:o,hash:a}}function wl(e,t,r){const{script:n}=Pl(e,t,r);return(0,tl.isP2TR)(n)?n.subarray(2,34):null}function El(e){return 64===e.length?e:e.subarray(0,64)}function Sl(e,t,r,n,s,i,o){const a=s.__TX,u=t.sighashType||Qc.Transaction.SIGHASH_DEFAULT;Al(u,o);const c=r.map(((e,t)=>Pl(t,e,s))),l=c.map((e=>e.script)),f=c.map((e=>e.value)),p=[];if(t.tapInternalKey&&!i){const r=wl(e,t,s)||Buffer.from([]);if((0,el.toXOnly)(n).equals(r)){const t=a.hashForWitnessV1(e,l,f,u);p.push({pubkey:n,hash:t})}}const h=(t.tapLeafScript||[]).filter((e=>(0,tl.pubkeyInScript)(n,e.script))).map((e=>{const t=(0,zc.tapleafHash)({output:e.script,version:e.leafVersion});return Object.assign({hash:t},e)})).filter((e=>!i||i.equals(e.hash))).map((t=>{const r=a.hashForWitnessV1(e,l,f,Qc.Transaction.SIGHASH_DEFAULT,t.hash);return{pubkey:n,hash:r,leafHash:t.hash}}));return p.concat(h)}function Al(e,t){if(t&&t.indexOf(e)<0){const t=function(e){let t=e&Qc.Transaction.SIGHASH_ANYONECANPAY?"SIGHASH_ANYONECANPAY | ":"";switch(31&e){case Qc.Transaction.SIGHASH_ALL:t+="SIGHASH_ALL";break;case Qc.Transaction.SIGHASH_SINGLE:t+="SIGHASH_SINGLE";break;case Qc.Transaction.SIGHASH_NONE:t+="SIGHASH_NONE"}return t}(e);throw new Error(`Sighash type is not allowed. Retry the sign method passing the sighashTypes array of whitelisted types. Sighash type: ${t}`)}}function Tl(e,t,r){const n=(0,Wc.checkForInput)(t,e);if(!n.bip32Derivation||0===n.bip32Derivation.length)throw new Error("Need bip32Derivation to sign with HD");const s=n.bip32Derivation.map((e=>e.masterFingerprint.equals(r.fingerprint)?e:void 0)).filter((e=>!!e));if(0===s.length)throw new Error("Need one bip32Derivation masterFingerprint to match the HDSigner fingerprint");return s.map((e=>{const t=r.derivePath(e.path);if(!e.pubkey.equals(t.publicKey))throw new Error("pubkey did not match bip32Derivation");return t}))}function Il(e){let t=0;function r(){const r=Xc.decode(e,t);return t+=Xc.decode.bytes,r}function n(){return n=r(),t+=n,e.slice(t-n,t);var n}return function(){const e=r(),t=[];for(let r=0;r<e;r++)t.push(n());return t}()}function Ol(e,t,r){e.__NON_WITNESS_UTXO_BUF_CACHE[r]=t.nonWitnessUtxo;const n=Qc.Transaction.fromBuffer(t.nonWitnessUtxo);e.__NON_WITNESS_UTXO_TX_CACHE[r]=n;const s=e,i=r;delete t.nonWitnessUtxo,Object.defineProperty(t,"nonWitnessUtxo",{enumerable:!0,get(){const e=s.__NON_WITNESS_UTXO_BUF_CACHE[i],t=s.__NON_WITNESS_UTXO_TX_CACHE[i];if(void 0!==e)return e;{const e=t.toBuffer();return s.__NON_WITNESS_UTXO_BUF_CACHE[i]=e,e}},set(e){s.__NON_WITNESS_UTXO_BUF_CACHE[i]=e}})}function kl(e,t,r,n){let s=0;e.forEach(((e,i)=>{if(n&&e.finalScriptSig&&(t.ins[i].script=e.finalScriptSig),n&&e.finalScriptWitness&&(t.ins[i].witness=Il(e.finalScriptWitness)),e.witnessUtxo)s+=e.witnessUtxo.value;else if(e.nonWitnessUtxo){const n=Rl(r,e,i),o=t.ins[i].index,a=n.outs[o];s+=a.value}}));const i=t.outs.reduce(((e,t)=>e+t.value),0),o=s-i;if(o<0)throw new Error("Outputs are spending more than Inputs");const a=t.virtualSize();r.__FEE=o,r.__EXTRACTED_TX=t,r.__FEE_RATE=Math.floor(o/a)}function Rl(e,t,r){const n=e.__NON_WITNESS_UTXO_TX_CACHE;return n[r]||Ol(e,t,r),n[r]}function Nl(e,t,r){const{script:n}=Pl(e,t,r);return n}function Pl(e,t,r){if(void 0!==t.witnessUtxo)return{script:t.witnessUtxo.script,value:t.witnessUtxo.value};if(void 0!==t.nonWitnessUtxo){const n=Rl(r,t,e).outs[r.__TX.ins[e].index];return{script:n.script,value:n.value}}throw new Error("Can't find pubkey in input without Utxo data")}function xl(e){return 33===e.length&&Jc.isCanonicalPubKey(e)}function Cl(e,t,r,n,s){const i=(0,tl.isP2SHScript)(e),o=i&&n&&(0,tl.isP2WSHScript)(n),a=(0,tl.isP2WSHScript)(e);if(i&&void 0===n)throw new Error("scriptPubkey is P2SH but redeemScript missing");if((a||o)&&void 0===s)throw new Error("scriptPubkey or redeemScript is P2WSH but witnessScript missing");let u;return o?(u=s,ml(t,e,n,r),yl(t,n,s,r),Bl(u)):a?(u=s,yl(t,e,s,r),Bl(u)):i?(u=n,ml(t,e,n,r)):u=e,{meaningfulScript:u,type:o?"p2sh-p2wsh":i?"p2sh":a?"p2wsh":"raw"}}function Bl(e){if((0,tl.isP2WPKH)(e)||(0,tl.isP2SHScript)(e))throw new Error("P2WPKH or P2SH can not be contained within P2WSH")}function Ll(e){return(0,tl.isP2WPKH)(e)?"witnesspubkeyhash":(0,tl.isP2PKH)(e)?"pubkeyhash":(0,tl.isP2MS)(e)?"multisig":(0,tl.isP2PK)(e)?"pubkey":"nonstandard"}function $l(e){return[...Array(e).keys()]}!function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.initEccLib=e.Transaction=e.opcodes=e.Psbt=e.Block=e.script=e.payments=e.networks=e.crypto=e.address=void 0;const t=cn;e.address=t;const r=Ss;e.crypto=r;const n=ln;e.networks=n;const s=fn;e.payments=s;const i=hn;e.script=i;var o=ta;Object.defineProperty(e,"Block",{enumerable:!0,get:function(){return o.Block}});var a=ka;Object.defineProperty(e,"Psbt",{enumerable:!0,get:function(){return a.Psbt}});var u=mn;Object.defineProperty(e,"opcodes",{enumerable:!0,get:function(){return u.OPS}});var c=na;Object.defineProperty(e,"Transaction",{enumerable:!0,get:function(){return c.Transaction}});var l=co;Object.defineProperty(e,"initEccLib",{enumerable:!0,get:function(){return l.initEccLib}})}(un);var Ul={},Dl={},jl={};Object.defineProperty(jl,"__esModule",{value:!0}),jl.testnet=jl.bitcoin=void 0,jl.bitcoin={messagePrefix:"Bitcoin Signed Message:\n",bech32:"bc",bip32:{public:76067358,private:76066276},pubKeyHash:0,scriptHash:5,wif:128},jl.testnet={messagePrefix:"Bitcoin Signed Message:\n",bech32:"tb",bip32:{public:70617039,private:70615956},pubKeyHash:111,scriptHash:196,wif:239};var Ml={};!function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.maybe=e.Boolean=e.Array=e.Buffer256bit=e.Network=e.typeforce=void 0,e.typeforce=Zn,e.Network=e.typeforce.compile({messagePrefix:e.typeforce.oneOf(e.typeforce.Buffer,e.typeforce.String),bip32:{public:e.typeforce.UInt32,private:e.typeforce.UInt32},pubKeyHash:e.typeforce.UInt8,scriptHash:e.typeforce.UInt8,wif:e.typeforce.UInt8}),e.Buffer256bit=e.typeforce.BufferN(32),e.Array=e.typeforce.Array,e.Boolean=e.typeforce.Boolean,e.maybe=e.typeforce.maybe}(Ml);var Hl=r.randomBytes,Fl=r.createHash,Kl=bo.Buffer;var Gl=function(e){if(e.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),r=0;r<t.length;r++)t[r]=255;for(var n=0;n<e.length;n++){var s=e.charAt(n),i=s.charCodeAt(0);if(255!==t[i])throw new TypeError(s+" is ambiguous");t[i]=n}var o=e.length,a=e.charAt(0),u=Math.log(o)/Math.log(256),c=Math.log(256)/Math.log(o);function l(e){if("string"!=typeof e)throw new TypeError("Expected String");if(0===e.length)return Kl.alloc(0);for(var r=0,n=0,s=0;e[r]===a;)n++,r++;for(var i=(e.length-r)*u+1>>>0,c=new Uint8Array(i);e[r];){var l=t[e.charCodeAt(r)];if(255===l)return;for(var f=0,p=i-1;(0!==l||f<s)&&-1!==p;p--,f++)l+=o*c[p]>>>0,c[p]=l%256>>>0,l=l/256>>>0;if(0!==l)throw new Error("Non-zero carry");s=f,r++}for(var h=i-s;h!==i&&0===c[h];)h++;var d=Kl.allocUnsafe(n+(i-h));d.fill(0,0,n);for(var m=n;h!==i;)d[m++]=c[h++];return d}return{encode:function(t){if((Array.isArray(t)||t instanceof Uint8Array)&&(t=Kl.from(t)),!Kl.isBuffer(t))throw new TypeError("Expected Buffer");if(0===t.length)return"";for(var r=0,n=0,s=0,i=t.length;s!==i&&0===t[s];)s++,r++;for(var u=(i-s)*c+1>>>0,l=new Uint8Array(u);s!==i;){for(var f=t[s],p=0,h=u-1;(0!==f||p<n)&&-1!==h;h--,p++)f+=256*l[h]>>>0,l[h]=f%o>>>0,f=f/o>>>0;if(0!==f)throw new Error("Non-zero carry");n=p,s++}for(var d=u-n;d!==u&&0===l[d];)d++;for(var m=a.repeat(r);d<u;++d)m+=e.charAt(l[d]);return m},decodeUnsafe:l,decode:function(e){var t=l(e);if(t)return t;throw new Error("Non-base"+o+" character")}}},Vl=Gl("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"),Xl=bo.Buffer,Wl=Fl,ql=function(e){function t(t){var r=t.slice(0,-4),n=t.slice(-4),s=e(r);if(!(n[0]^s[0]|n[1]^s[1]|n[2]^s[2]|n[3]^s[3]))return r}return{encode:function(t){var r=e(t);return Vl.encode(Xl.concat([t,r],t.length+4))},decode:function(e){var r=t(Vl.decode(e));if(!r)throw new Error("Invalid checksum");return r},decodeUnsafe:function(e){var r=Vl.decodeUnsafe(e);if(r)return t(r)}}};var Zl=ql((function(e){var t=Wl("sha256").update(e).digest();return Wl("sha256").update(t).digest()}));function Yl(e,t){if(void 0!==t&&e[0]!==t)throw new Error("Invalid network version");if(33===e.length)return{version:e[0],privateKey:e.slice(1,33),compressed:!1};if(34!==e.length)throw new Error("Invalid WIF length");if(1!==e[33])throw new Error("Invalid compression flag");return{version:e[0],privateKey:e.slice(1,33),compressed:!0}}function zl(e,t,r){var n=new Buffer(r?34:33);return n.writeUInt8(e,0),t.copy(n,1),r&&(n[33]=1),n}var Jl={decode:function(e,t){return Yl(Zl.decode(e),t)},decodeRaw:Yl,encode:function(e,t,r){return"number"==typeof e?Zl.encode(zl(e,t,r)):Zl.encode(zl(e.version,e.privateKey,e.compressed))},encodeRaw:zl},Ql={};Object.defineProperty(Ql,"__esModule",{value:!0}),Ql.testEcc=void 0;const ef=e=>Buffer.from(e,"hex");function tf(e){if(!e)throw new Error("ecc library invalid")}Ql.testEcc=function(e){tf(e.isPoint(ef("0279be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798"))),tf(!e.isPoint(ef("030000000000000000000000000000000000000000000000000000000000000005"))),tf(e.isPrivate(ef("79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798"))),tf(e.isPrivate(ef("fffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364140"))),tf(!e.isPrivate(ef("0000000000000000000000000000000000000000000000000000000000000000"))),tf(!e.isPrivate(ef("fffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"))),tf(!e.isPrivate(ef("fffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364142"))),tf(Buffer.from(e.privateAdd(ef("0000000000000000000000000000000000000000000000000000000000000001"),ef("0000000000000000000000000000000000000000000000000000000000000000"))).equals(ef("0000000000000000000000000000000000000000000000000000000000000001"))),tf(null===e.privateAdd(ef("fffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd036413e"),ef("0000000000000000000000000000000000000000000000000000000000000003"))),tf(Buffer.from(e.privateAdd(ef("e211078564db65c3ce7704f08262b1f38f1ef412ad15b5ac2d76657a63b2c500"),ef("b51fbb69051255d1becbd683de5848242a89c229348dd72896a87ada94ae8665"))).equals(ef("9730c2ee69edbb958d42db7460bafa18fef9d955325aec99044c81c8282b0a24"))),tf(Buffer.from(e.privateNegate(ef("0000000000000000000000000000000000000000000000000000000000000001"))).equals(ef("fffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364140"))),tf(Buffer.from(e.privateNegate(ef("fffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd036413e"))).equals(ef("0000000000000000000000000000000000000000000000000000000000000003"))),tf(Buffer.from(e.privateNegate(ef("b1121e4088a66a28f5b6b0f5844943ecd9f610196d7bb83b25214b60452c09af"))).equals(ef("4eede1bf775995d70a494f0a7bb6bc11e0b8cccd41cce8009ab1132c8b0a3792"))),tf(Buffer.from(e.pointCompress(ef("0479be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8"),!0)).equals(ef("0279be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798"))),tf(Buffer.from(e.pointCompress(ef("0479be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8"),!1)).equals(ef("0479be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8"))),tf(Buffer.from(e.pointCompress(ef("0279be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798"),!0)).equals(ef("0279be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798"))),tf(Buffer.from(e.pointCompress(ef("0279be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798"),!1)).equals(ef("0479be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8"))),tf(Buffer.from(e.pointFromScalar(ef("b1121e4088a66a28f5b6b0f5844943ecd9f610196d7bb83b25214b60452c09af"))).equals(ef("02b07ba9dca9523b7ef4bd97703d43d20399eb698e194704791a25ce77a400df99"))),tf(null===e.xOnlyPointAddTweak(ef("79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798"),ef("fffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364140")));let t=e.xOnlyPointAddTweak(ef("1617d38ed8d8657da4d4761e8057bc396ea9e4b9d29776d4be096016dbd2509b"),ef("a8397a935f0dfceba6ba9618f6451ef4d80637abf4e6af2669fbc9de6a8fd2ac"));tf(Buffer.from(t.xOnlyPubkey).equals(ef("e478f99dab91052ab39a33ea35fd5e6e4933f4d28023cd597c9a1f6760346adf"))&&1===t.parity),t=e.xOnlyPointAddTweak(ef("2c0b7cf95324a07d05398b240174dc0c2be444d96b159aa6c7f7b1e668680991"),ef("823c3cd2142744b075a87eade7e1b8678ba308d566226a0056ca2b7a76f86b47")),tf(Buffer.from(t.xOnlyPubkey).equals(ef("9534f8dc8c6deda2dc007655981c78b49c5d96c778fbf363462a11ec9dfd948c"))&&0===t.parity),tf(Buffer.from(e.sign(ef("5e9f0a0d593efdcf78ac923bc3313e4e7d408d574354ee2b3288c0da9fbba6ed"),ef("fffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364140"))).equals(ef("54c4a33c6423d689378f160a7ff8b61330444abb58fb470f96ea16d99d4a2fed07082304410efa6b2943111b6a4e0aaa7b7db55a07e9861d1fb3cb1f421044a5"))),tf(e.verify(ef("5e9f0a0d593efdcf78ac923bc3313e4e7d408d574354ee2b3288c0da9fbba6ed"),ef("0379be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798"),ef("54c4a33c6423d689378f160a7ff8b61330444abb58fb470f96ea16d99d4a2fed07082304410efa6b2943111b6a4e0aaa7b7db55a07e9861d1fb3cb1f421044a5"))),e.signSchnorr&&tf(Buffer.from(e.signSchnorr(ef("7e2d58d8b3bcdf1abadec7829054f90dda9805aab56c77333024b9d0a508b75c"),ef("c90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b14e5c9"),ef("c87aa53824b4d7ae2eb035a2b5bbbccc080e76cdc6d1692c4b0b62d798e6d906"))).equals(ef("5831aaeed7b44bb74e5eab94ba9d4294c49bcf2a60728d8b4c200f50dd313c1bab745879a5ad954a72c45a91c3a51d3c7adea98d82f8481e0e1e03674a6f3fb7"))),e.verifySchnorr&&tf(e.verifySchnorr(ef("7e2d58d8b3bcdf1abadec7829054f90dda9805aab56c77333024b9d0a508b75c"),ef("dd308afec5777e13121fa72b9cc1b7cc0139715309b086c960e18fd969774eb8"),ef("5831aaeed7b44bb74e5eab94ba9d4294c49bcf2a60728d8b4c200f50dd313c1bab745879a5ad954a72c45a91c3a51d3c7adea98d82f8481e0e1e03674a6f3fb7")))},Object.defineProperty(Dl,"__esModule",{value:!0}),Dl.ECPairFactory=Dl.networks=void 0;const rf=jl;Dl.networks=rf;const nf=Ml,sf=Hl,of=Jl,af=Ql,uf=nf.typeforce.maybe(nf.typeforce.compile({compressed:nf.maybe(nf.Boolean),network:nf.maybe(nf.Network)}));Dl.ECPairFactory=function(e){function t(t,r){if(nf.typeforce(nf.Buffer256bit,t),!e.isPrivate(t))throw new TypeError("Private key not in range [1, n)");return nf.typeforce(uf,r),new n(t,void 0,r)}function r(t,r){return nf.typeforce(e.isPoint,t),nf.typeforce(uf,r),new n(void 0,t,r)}(0,af.testEcc)(e);class n{__D;__Q;compressed;network;lowR;constructor(t,r,n){this.__D=t,this.__Q=r,this.lowR=!1,void 0===n&&(n={}),this.compressed=void 0===n.compressed||n.compressed,this.network=n.network||rf.bitcoin,void 0!==r&&(this.__Q=Buffer.from(e.pointCompress(r,this.compressed)))}get privateKey(){return this.__D}get publicKey(){if(!this.__Q){const t=e.pointFromScalar(this.__D,this.compressed);this.__Q=Buffer.from(t)}return this.__Q}toWIF(){if(!this.__D)throw new Error("Missing private key");return of.encode(this.network.wif,this.__D,this.compressed)}tweak(e){return this.privateKey?this.tweakFromPrivateKey(e):this.tweakFromPublicKey(e)}sign(t,r){if(!this.__D)throw new Error("Missing private key");if(void 0===r&&(r=this.lowR),!1===r)return Buffer.from(e.sign(t,this.__D));{let r=e.sign(t,this.__D);const n=Buffer.alloc(32,0);let s=0;for(;r[0]>127;)s++,n.writeUIntLE(s,0,6),r=e.sign(t,this.__D,n);return Buffer.from(r)}}signSchnorr(t){if(!this.privateKey)throw new Error("Missing private key");if(!e.signSchnorr)throw new Error("signSchnorr not supported by ecc library");return Buffer.from(e.signSchnorr(t,this.privateKey))}verify(t,r){return e.verify(t,this.publicKey,r)}verifySchnorr(t,r){if(!e.verifySchnorr)throw new Error("verifySchnorr not supported by ecc library");return e.verifySchnorr(t,this.publicKey.subarray(1,33),r)}tweakFromPublicKey(t){const n=32===(s=this.publicKey).length?s:s.slice(1,33);var s;const i=e.xOnlyPointAddTweak(n,t);if(!i||null===i.xOnlyPubkey)throw new Error("Cannot tweak public key!");const o=Buffer.from([0===i.parity?2:3]);return r(Buffer.concat([o,i.xOnlyPubkey]),{network:this.network,compressed:this.compressed})}tweakFromPrivateKey(r){const n=3===this.publicKey[0]||4===this.publicKey[0]&&!(1&~this.publicKey[64])?e.privateNegate(this.privateKey):this.privateKey,s=e.privateAdd(n,r);if(!s)throw new Error("Invalid tweaked private key!");return t(Buffer.from(s),{network:this.network,compressed:this.compressed})}}return{isPoint:function(t){return e.isPoint(t)},fromPrivateKey:t,fromPublicKey:r,fromWIF:function(e,r){const n=of.decode(e),s=n.version;if(nf.Array(r)){if(!(r=r.filter((e=>s===e.wif)).pop()))throw new Error("Unknown network version")}else if(r=r||rf.bitcoin,s!==r.wif)throw new Error("Invalid network version");return t(n.privateKey,{compressed:n.compressed,network:r})},makeRandom:function(r){nf.typeforce(uf,r),void 0===r&&(r={});const n=r.rng||sf;let s;do{s=n(32),nf.typeforce(nf.Buffer256bit,s)}while(!e.isPrivate(s));return t(s,r)}}},function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.networks=e.ECPairFactory=e.default=void 0;var t=Dl;Object.defineProperty(e,"default",{enumerable:!0,get:function(){return t.ECPairFactory}}),Object.defineProperty(e,"ECPairFactory",{enumerable:!0,get:function(){return t.ECPairFactory}}),Object.defineProperty(e,"networks",{enumerable:!0,get:function(){return t.networks}})}(Ul);const cf="0123456789abcdefABCDEF";cf.split("").map((e=>e.codePointAt(0))),Array(256).fill(!0).map(((e,t)=>{const r=String.fromCodePoint(t),n=cf.indexOf(r);return n<0?void 0:n<16?n:n-6})),new TextEncoder,new TextDecoder("ascii");const lf=0,ff=1,pf=2,hf=3,df=4,mf=5,yf=6,gf=7,bf={[lf.toString()]:"Expected Private",[ff.toString()]:"Expected Point",[pf.toString()]:"Expected Tweak",[hf.toString()]:"Expected Hash",[df.toString()]:"Expected Signature",[mf.toString()]:"Expected Extra Data (32 bytes)",[yf.toString()]:"Expected Parity (1 | 0)",[gf.toString()]:"Bad Recovery Id"};function vf(e){const t=bf[e.toString()]||`Unknow error code: ${e}`;throw new TypeError(t)}var _f=Object.freeze({__proto__:null,ERROR_BAD_EXTRA_DATA:mf,ERROR_BAD_HASH:hf,ERROR_BAD_PARITY:yf,ERROR_BAD_POINT:ff,ERROR_BAD_PRIVATE:lf,ERROR_BAD_RECOVERY_ID:gf,ERROR_BAD_SIGNATURE:df,ERROR_BAD_TWEAK:pf,throwError:vf});const wf=32,Ef=33,Sf=65,Af=32,Tf=32,If=32,Of=32,kf=new Uint8Array(32),Rf=new Uint8Array([255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,254,186,174,220,230,175,72,160,59,191,210,94,140,208,54,65,65]),Nf=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,69,81,35,25,80,183,95,196,64,45,161,114,47,201,186,238]);function Pf(e){return e instanceof Uint8Array}function xf(e,t){for(let r=0;r<32;++r)if(e[r]!==t[r])return e[r]<t[r]?-1:1;return 0}function Cf(e){return 0===xf(e,kf)}function Bf(e){return Pf(e)&&e.length===wf&&xf(e,kf)>0&&xf(e,Rf)<0}function Lf(e){return Pf(e)&&e.length===Af}function $f(e){Bf(e)||vf(lf)}function Uf(e){(function(e){return Pf(e)&&(e.length===Ef||e.length===Sf||e.length===Af)})(e)||vf(ff)}function Df(e){Lf(e)||vf(ff)}function jf(e){(function(e){return Pf(e)&&e.length===Tf&&xf(e,Rf)<0})(e)||vf(pf)}function Mf(e){(function(e){return Pf(e)&&e.length===If})(e)||vf(hf)}function Hf(e){(function(e){return void 0===e||Pf(e)&&e.length===Of})(e)||vf(mf)}function Ff(e){(function(e){return Pf(e)&&64===e.length&&xf(e.subarray(0,32),Rf)<0&&xf(e.subarray(32,64),Rf)<0})(e)||vf(df)}function Kf(e){(function(e){return Pf(e)&&64===e.length&&xf(e.subarray(0,32),Nf)<0})(e)||vf(gf)}var Gf=Object.freeze({__proto__:null,generateInt32:function(){return n(4).readInt32BE(0)}});const Vf=s(function(e){const t=new o(e,import.meta.url);return a(t)}("secp256k1.wasm")),Xf={"./rand.js":Gf,"./validate_error.js":_f},Wf=new WebAssembly.Module(Vf);var qf=new WebAssembly.Instance(Wf,Xf).exports;const Zf=new Uint8Array(qf.memory.buffer),Yf=qf.PRIVATE_INPUT.value,zf=qf.PUBLIC_KEY_INPUT.value,Jf=qf.PUBLIC_KEY_INPUT2.value,Qf=qf.X_ONLY_PUBLIC_KEY_INPUT.value,ep=qf.X_ONLY_PUBLIC_KEY_INPUT2.value,tp=qf.TWEAK_INPUT.value,rp=qf.HASH_INPUT.value,np=qf.EXTRA_DATA_INPUT.value,sp=qf.SIGNATURE_INPUT.value,ip=Zf.subarray(Yf,Yf+wf),op=Zf.subarray(zf,zf+Sf),ap=Zf.subarray(Jf,Jf+Sf),up=Zf.subarray(Qf,Qf+Af),cp=Zf.subarray(ep,ep+Af),lp=Zf.subarray(tp,tp+Tf),fp=Zf.subarray(rp,rp+If),pp=Zf.subarray(np,np+Of),hp=Zf.subarray(sp,sp+64);function dp(e,t){return void 0===e?void 0!==t?t.length:Ef:e?Ef:Sf}function mp(e){try{return op.set(e),1===qf.isPoint(e.length)}finally{op.fill(0)}}function yp(e){return Lf(e)&&mp(e)}var gp=Object.freeze({__proto__:null,__initializeContext:function(){qf.initializeContext()},isPoint:function(e){return function(e){return Pf(e)&&(e.length===Ef||e.length===Sf)}(e)&&mp(e)},isPointCompressed:function(e){return function(e){return Pf(e)&&e.length===Ef}(e)&&mp(e)},isPrivate:function(e){return Bf(e)},isXOnlyPoint:yp,pointAdd:function(e,t,r){Uf(e),Uf(t);const n=dp(r,e);try{return op.set(e),ap.set(t),1===qf.pointAdd(e.length,t.length,n)?op.slice(0,n):null}finally{op.fill(0),ap.fill(0)}},pointAddScalar:function(e,t,r){Uf(e),jf(t);const n=dp(r,e);try{return op.set(e),lp.set(t),1===qf.pointAddScalar(e.length,n)?op.slice(0,n):null}finally{op.fill(0),lp.fill(0)}},pointCompress:function(e,t){Uf(e);const r=dp(t,e);try{return op.set(e),qf.pointCompress(e.length,r),op.slice(0,r)}finally{op.fill(0)}},pointFromScalar:function(e,t){$f(e);const r=dp(t);try{return ip.set(e),1===qf.pointFromScalar(r)?op.slice(0,r):null}finally{ip.fill(0),op.fill(0)}},pointMultiply:function(e,t,r){Uf(e),jf(t);const n=dp(r,e);try{return op.set(e),lp.set(t),1===qf.pointMultiply(e.length,n)?op.slice(0,n):null}finally{op.fill(0),lp.fill(0)}},privateAdd:function(e,t){$f(e),jf(t);try{return ip.set(e),lp.set(t),1===qf.privateAdd()?ip.slice(0,wf):null}finally{ip.fill(0),lp.fill(0)}},privateNegate:function(e){$f(e);try{return ip.set(e),qf.privateNegate(),ip.slice(0,wf)}finally{ip.fill(0)}},privateSub:function(e,t){if($f(e),jf(t),Cf(t))return new Uint8Array(e);try{return ip.set(e),lp.set(t),1===qf.privateSub()?ip.slice(0,wf):null}finally{ip.fill(0),lp.fill(0)}},recover:function(e,t,r,n=!1){Mf(e),Ff(t),function(e){Cf(e.subarray(0,32))&&vf(df),Cf(e.subarray(32,64))&&vf(df)}(t),2&r&&Kf(t),(()=>yp(t.subarray(0,32)))()||vf(df);const s=dp(n);try{return fp.set(e),hp.set(t),1===qf.recover(s,r)?op.slice(0,s):null}finally{fp.fill(0),hp.fill(0),op.fill(0)}},sign:function(e,t,r){Mf(e),$f(t),Hf(r);try{return fp.set(e),ip.set(t),void 0!==r&&pp.set(r),qf.sign(void 0===r?0:1),hp.slice(0,64)}finally{fp.fill(0),ip.fill(0),void 0!==r&&pp.fill(0),hp.fill(0)}},signRecoverable:function(e,t,r){Mf(e),$f(t),Hf(r);try{fp.set(e),ip.set(t),void 0!==r&&pp.set(r);const n=qf.signRecoverable(void 0===r?0:1);return{signature:hp.slice(0,64),recoveryId:n}}finally{fp.fill(0),ip.fill(0),void 0!==r&&pp.fill(0),hp.fill(0)}},signSchnorr:function(e,t,r){Mf(e),$f(t),Hf(r);try{return fp.set(e),ip.set(t),void 0!==r&&pp.set(r),qf.signSchnorr(void 0===r?0:1),hp.slice(0,64)}finally{fp.fill(0),ip.fill(0),void 0!==r&&pp.fill(0),hp.fill(0)}},verify:function(e,t,r,n=!1){Mf(e),Uf(t),Ff(r);try{return fp.set(e),op.set(t),hp.set(r),1===qf.verify(t.length,!0===n?1:0)}finally{fp.fill(0),op.fill(0),hp.fill(0)}},verifySchnorr:function(e,t,r){Mf(e),Df(t),Ff(r);try{return fp.set(e),up.set(t),hp.set(r),1===qf.verifySchnorr()}finally{fp.fill(0),up.fill(0),hp.fill(0)}},xOnlyPointAddTweak:function(e,t){Df(e),jf(t);try{up.set(e),lp.set(t);const r=qf.xOnlyPointAddTweak();return-1!==r?{parity:r,xOnlyPubkey:up.slice(0,Af)}:null}finally{up.fill(0),lp.fill(0)}},xOnlyPointAddTweakCheck:function(e,t,r,n){Df(e),Df(r),jf(t);const s=void 0!==n;var i;s&&(0!==(i=n)&&1!==i&&vf(yf));try{if(up.set(e),cp.set(r),lp.set(t),s)return 1===qf.xOnlyPointAddTweakCheck(n);qf.xOnlyPointAddTweak();return 0===function(e,t){const r=Math.min(e.length,t.length);for(let n=0;n<r;++n)if(e[n]!==t[n])return e[n]<t[n]?-1:1;return e.length===t.length?0:e.length>t.length?1:-1}(up.slice(0,Af),r)}finally{up.fill(0),cp.fill(0),lp.fill(0)}},xOnlyPointFromPoint:function(e){Uf(e);try{return op.set(e),qf.xOnlyPointFromPoint(e.length),up.slice(0,Af)}finally{op.fill(0),up.fill(0)}},xOnlyPointFromScalar:function(e){$f(e);try{return ip.set(e),qf.xOnlyPointFromScalar(),up.slice(0,Af)}finally{ip.fill(0),up.fill(0)}}}),bp=d(gp),vp=p&&p.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var s=Object.getOwnPropertyDescriptor(t,r);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,s)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),_p=p&&p.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),wp=p&&p.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&vp(t,e,r);return _p(t,e),t},Ep=p&&p.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(an,"__esModule",{value:!0}),an.ecc=an.bitcoin=an.ECPair=void 0;const Sp=wp(un);an.bitcoin=Sp;const Ap=Ep(Ul),Tp=wp(bp);an.ecc=Tp,Sp.initEccLib(Tp);const Ip=(0,Ap.default)(Tp);an.ECPair=Ip,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.toNetworkType=e.toPsbtNetwork=e.NetworkType=void 0;const t=an;var r;!function(e){e[e.MAINNET=0]="MAINNET",e[e.TESTNET=1]="TESTNET",e[e.REGTEST=2]="REGTEST"}(r=e.NetworkType||(e.NetworkType={})),e.toPsbtNetwork=function(e){return e===r.MAINNET?t.bitcoin.networks.bitcoin:e===r.TESTNET?t.bitcoin.networks.testnet:t.bitcoin.networks.regtest},e.toNetworkType=function(e){return e.bech32==t.bitcoin.networks.bitcoin.bech32?r.MAINNET:e.bech32==t.bitcoin.networks.testnet.bech32?r.TESTNET:r.REGTEST}}(on);var Op,kp={},Rp={},Np={name:"joi",description:"Object schema validation",version:"17.13.1",repository:"git://github.com/hapijs/joi",main:"lib/index.js",types:"lib/index.d.ts",browser:"dist/joi-browser.min.js",files:["lib/**/*","dist/*"],keywords:["schema","validation"],dependencies:{"@hapi/hoek":"^9.3.0","@hapi/topo":"^5.1.0","@sideway/address":"^4.1.5","@sideway/formula":"^3.0.1","@sideway/pinpoint":"^2.0.0"},devDependencies:{"@hapi/bourne":"2.x.x","@hapi/code":"8.x.x","@hapi/joi-legacy-test":"npm:@hapi/joi@15.x.x","@hapi/lab":"^25.1.3","@types/node":"^14.18.63",typescript:"4.3.x"},scripts:{prepublishOnly:"cd browser && npm install && npm run build",test:"lab -t 100 -a @hapi/code -L -Y","test-cov-html":"lab -r html -o coverage.html -a @hapi/code"},license:"BSD-3-Clause"},Pp={};function xp(){if(Op)return Pp;Op=1;const e=cd(),t={};return t.wrap=e.string().min(1).max(2).allow(!1),Pp.preferences=e.object({allowUnknown:e.boolean(),abortEarly:e.boolean(),artifacts:e.boolean(),cache:e.boolean(),context:e.object(),convert:e.boolean(),dateFormat:e.valid("date","iso","string","time","utc"),debug:e.boolean(),errors:{escapeHtml:e.boolean(),label:e.valid("path","key",!1),language:[e.string(),e.object().ref()],render:e.boolean(),stack:e.boolean(),wrap:{label:t.wrap,array:t.wrap,string:t.wrap}},externals:e.boolean(),messages:e.object(),noDefaults:e.boolean(),nonEnumerables:e.boolean(),presence:e.valid("required","optional","forbidden"),skipFunctions:e.boolean(),stripUnknown:e.object({arrays:e.boolean(),objects:e.boolean()}).or("arrays","objects").allow(!0,!1),warnings:e.boolean()}).strict(),t.nameRx=/^[a-zA-Z0-9]\w*$/,t.rule=e.object({alias:e.array().items(e.string().pattern(t.nameRx)).single(),args:e.array().items(e.string(),e.object({name:e.string().pattern(t.nameRx).required(),ref:e.boolean(),assert:e.alternatives([e.function(),e.object().schema()]).conditional("ref",{is:!0,then:e.required()}),normalize:e.function(),message:e.string().when("assert",{is:e.function(),then:e.required()})})),convert:e.boolean(),manifest:e.boolean(),method:e.function().allow(!1),multi:e.boolean(),validate:e.function()}),Pp.extension=e.object({type:e.alternatives([e.string(),e.object().regex()]).required(),args:e.function(),cast:e.object().pattern(t.nameRx,e.object({from:e.function().maxArity(1).required(),to:e.function().minArity(1).maxArity(2).required()})),base:e.object().schema().when("type",{is:e.object().regex(),then:e.forbidden()}),coerce:[e.function().maxArity(3),e.object({method:e.function().maxArity(3).required(),from:e.array().items(e.string()).single()})],flags:e.object().pattern(t.nameRx,e.object({setter:e.string(),default:e.any()})),manifest:{build:e.function().arity(2)},messages:[e.object(),e.string()],modifiers:e.object().pattern(t.nameRx,e.function().minArity(1).maxArity(2)),overrides:e.object().pattern(t.nameRx,e.function()),prepare:e.function().maxArity(3),rebuild:e.function().arity(1),rules:e.object().pattern(t.nameRx,t.rule),terms:e.object().pattern(t.nameRx,e.object({init:e.array().allow(null).required(),manifest:e.object().pattern(/.+/,[e.valid("schema","single"),e.object({mapped:e.object({from:e.string().required(),to:e.string().required()}).required()})])})),validate:e.function().maxArity(3)}).strict(),Pp.extensions=e.array().items(e.object(),e.function().arity(1)).strict(),t.desc={buffer:e.object({buffer:e.string()}),func:e.object({function:e.function().required(),options:{literal:!0}}),override:e.object({override:!0}),ref:e.object({ref:e.object({type:e.valid("value","global","local"),path:e.array().required(),separator:e.string().length(1).allow(!1),ancestor:e.number().min(0).integer().allow("root"),map:e.array().items(e.array().length(2)).min(1),adjust:e.function(),iterables:e.boolean(),in:e.boolean(),render:e.boolean()}).required()}),regex:e.object({regex:e.string().min(3)}),special:e.object({special:e.valid("deep").required()}),template:e.object({template:e.string().required(),options:e.object()}),value:e.object({value:e.alternatives([e.object(),e.array()]).required()})},t.desc.entity=e.alternatives([e.array().items(e.link("...")),e.boolean(),e.function(),e.number(),e.string(),t.desc.buffer,t.desc.func,t.desc.ref,t.desc.regex,t.desc.special,t.desc.template,t.desc.value,e.link("/")]),t.desc.values=e.array().items(null,e.boolean(),e.function(),e.number().allow(1/0,-1/0),e.string().allow(""),e.symbol(),t.desc.buffer,t.desc.func,t.desc.override,t.desc.ref,t.desc.regex,t.desc.template,t.desc.value),t.desc.messages=e.object().pattern(/.+/,[e.string(),t.desc.template,e.object().pattern(/.+/,[e.string(),t.desc.template])]),Pp.description=e.object({type:e.string().required(),flags:e.object({cast:e.string(),default:e.any(),description:e.string(),empty:e.link("/"),failover:t.desc.entity,id:e.string(),label:e.string(),only:!0,presence:["optional","required","forbidden"],result:["raw","strip"],strip:e.boolean(),unit:e.string()}).unknown(),preferences:{allowUnknown:e.boolean(),abortEarly:e.boolean(),artifacts:e.boolean(),cache:e.boolean(),convert:e.boolean(),dateFormat:["date","iso","string","time","utc"],errors:{escapeHtml:e.boolean(),label:["path","key"],language:[e.string(),t.desc.ref],wrap:{label:t.wrap,array:t.wrap}},externals:e.boolean(),messages:t.desc.messages,noDefaults:e.boolean(),nonEnumerables:e.boolean(),presence:["required","optional","forbidden"],skipFunctions:e.boolean(),stripUnknown:e.object({arrays:e.boolean(),objects:e.boolean()}).or("arrays","objects").allow(!0,!1),warnings:e.boolean()},allow:t.desc.values,invalid:t.desc.values,rules:e.array().min(1).items({name:e.string().required(),args:e.object().min(1),keep:e.boolean(),message:[e.string(),t.desc.messages],warn:e.boolean()}),keys:e.object().pattern(/.*/,e.link("/")),link:t.desc.ref}).pattern(/^[a-z]\w*$/,e.any()),Pp}var Cp,Bp,Lp={},$p={exports:{}},Up={},Dp={};function jp(){if(Cp)return Dp;Cp=1;const e=M,t=Yp(),r={annotations:Symbol("annotations")};return Dp.error=function(n){if(!this._original||"object"!=typeof this._original)return this.details[0].message;const s=n?"":"[31m",i=n?"":"[41m",o=n?"":"[0m",a=e(this._original);for(let e=this.details.length-1;e>=0;--e){const n=e+1,s=this.details[e],i=s.path;let o=a;for(let e=0;;++e){const a=i[e];if(t.isSchema(o)&&(o=o.clone()),!(e+1<i.length&&"string"!=typeof o[a])){const e=o[r.annotations]||{errors:{},missing:{}};o[r.annotations]=e;const t=a||s.context.key;void 0!==o[a]?(e.errors[t]=e.errors[t]||[],e.errors[t].push(n)):e.missing[t]=n;break}o=o[a]}}const u=/_\$key\$_([, \d]+)_\$end\$_"/g,c=/"_\$miss\$_([^|]+)\|(\d+)_\$end\$_": "__missing__"/g,l=/\s*"_\$idx\$_([, \d]+)_\$end\$_",?\n(.*)/g,f=/"\[(NaN|Symbol.*|-?Infinity|function.*|\(.*)]"/g;let p=r.safeStringify(a,2).replace(u,((e,t)=>`" ${s}[${t}]${o}`)).replace(c,((e,t,r)=>`${i}"${t}"${o}${s} [${r}]: -- missing --${o}`)).replace(l,((e,t,r)=>`\n${r} ${s}[${t}]${o}`)).replace(f,((e,t)=>t));p=`${p}\n${s}`;for(let e=0;e<this.details.length;++e){p=`${p}\n[${e+1}] ${this.details[e].message}`}return p+=o,p},r.safeStringify=function(e,t){return JSON.stringify(e,r.serializer(),t)},r.serializer=function(){const e=[],t=[],n=(r,n)=>t[0]===n?"[Circular ~]":"[Circular ~."+e.slice(0,t.indexOf(n)).join(".")+"]";return function(s,i){if(t.length>0){const r=t.indexOf(this);~r?(t.length=r+1,e.length=r+1,e[r]=s):(t.push(this),e.push(s)),~t.indexOf(i)&&(i=n.call(this,s,i))}else t.push(i);if(i){const e=i[r.annotations];if(e){if(Array.isArray(i)){const t=[];for(let r=0;r<i.length;++r)e.errors[r]&&t.push(`_$idx$_${e.errors[r].sort().join(", ")}_$end$_`),t.push(i[r]);i=t}else{for(const t in e.errors)i[`${t}_$key$_${e.errors[t].sort().join(", ")}_$end$_`]=i[t],i[t]=void 0;for(const t in e.missing)i[`_$miss$_${t}|${e.missing[t]}_$end$_`]="__missing__"}return i}}return i===1/0||i===-1/0||Number.isNaN(i)||"function"==typeof i||"symbol"==typeof i?"["+i.toString()+"]":i}},Dp}function Mp(){return Bp||(Bp=1,function(e){const t=jp(),r=Yp(),n=qp();e.Report=class{constructor(t,r,n,s,i,o,a){if(this.code=t,this.flags=s,this.messages=i,this.path=o.path,this.prefs=a,this.state=o,this.value=r,this.message=null,this.template=null,this.local=n||{},this.local.label=e.label(this.flags,this.state,this.prefs,this.messages),void 0===this.value||this.local.hasOwnProperty("value")||(this.local.value=this.value),this.path.length){const e=this.path[this.path.length-1];"object"!=typeof e&&(this.local.key=e)}}_setTemplate(e){if(this.template=e,!this.flags.label&&0===this.path.length){const e=this._template(this.template,"root");e&&(this.local.label=e)}}toString(){if(this.message)return this.message;const e=this.code;if(!this.prefs.errors.render)return this.code;const t=this._template(this.template)||this._template(this.prefs.messages)||this._template(this.messages);return void 0===t?`Error code "${e}" is not defined, your custom type is missing the correct messages definition`:(this.message=t.render(this.value,this.state,this.prefs,this.local,{errors:this.prefs.errors,messages:[this.prefs.messages,this.messages]}),this.prefs.errors.label||(this.message=this.message.replace(/^"" /,"").trim()),this.message)}_template(t,r){return e.template(this.value,t,r||this.code,this.state,this.prefs)}},e.path=function(e){let t="";for(const r of e)"object"!=typeof r&&("string"==typeof r?(t&&(t+="."),t+=r):t+=`[${r}]`);return t},e.template=function(e,t,s,i,o){if(!t)return;if(n.isTemplate(t))return"root"!==s?t:null;let a=o.errors.language;if(r.isResolvable(a)&&(a=a.resolve(e,i,o)),a&&t[a]){if(void 0!==t[a][s])return t[a][s];if(void 0!==t[a]["*"])return t[a]["*"]}return t[s]?t[s]:t["*"]},e.label=function(t,r,n,s){if(!n.errors.label)return"";if(t.label)return t.label;let i=r.path;"key"===n.errors.label&&r.path.length>1&&(i=r.path.slice(-1));const o=e.path(i);return o||(e.template(null,n.messages,"root",r,n)||s&&e.template(null,s,"root",r,n)||"value")},e.process=function(t,r,n){if(!t)return null;const{override:s,message:i,details:o}=e.details(t);if(s)return s;if(n.errors.stack)return new e.ValidationError(i,o,r);const a=Error.stackTraceLimit;Error.stackTraceLimit=0;const u=new e.ValidationError(i,o,r);return Error.stackTraceLimit=a,u},e.details=function(e,t={}){let r=[];const n=[];for(const s of e){if(s instanceof Error){if(!1!==t.override)return{override:s};const e=s.toString();r.push(e),n.push({message:e,type:"override",context:{error:s}});continue}const e=s.toString();r.push(e),n.push({message:e,path:s.path.filter((e=>"object"!=typeof e)),type:s.code,context:s.local})}return r.length>1&&(r=[...new Set(r)]),{message:r.join(". "),details:n}},e.ValidationError=class extends Error{constructor(e,t,r){super(e),this._original=r,this.details=t}static isError(t){return t instanceof e.ValidationError}},e.ValidationError.prototype.isJoi=!0,e.ValidationError.prototype.name="ValidationError",e.ValidationError.prototype.annotate=t.error}(Up)),Up}var Hp,Fp,Kp,Gp,Vp,Xp={};function Wp(){return Hp||(Hp=1,function(e){const t=R,r=M,n=x,s=Yp();let i;const o={symbol:Symbol("ref"),defaults:{adjust:null,in:!1,iterables:null,map:null,separator:".",type:"value"}};e.create=function(e,r={}){t("string"==typeof e,"Invalid reference key:",e),s.assertOptions(r,["adjust","ancestor","in","iterables","map","prefix","render","separator"]),t(!r.prefix||"object"==typeof r.prefix,"options.prefix must be of type object");const n=Object.assign({},o.defaults,r);delete n.prefix;const i=n.separator,a=o.context(e,i,r.prefix);if(n.type=a.type,e=a.key,"value"===n.type)if(a.root&&(t(!i||e[0]!==i,"Cannot specify relative path with root prefix"),n.ancestor="root",e||(e=null)),i&&i===e)e=null,n.ancestor=0;else if(void 0!==n.ancestor)t(!i||!e||e[0]!==i,"Cannot combine prefix with ancestor option");else{const[t,r]=o.ancestor(e,i);r&&""===(e=e.slice(r))&&(e=null),n.ancestor=t}return n.path=i?null===e?[]:e.split(i):[e],new o.Ref(n)},e.in=function(t,r={}){return e.create(t,{...r,in:!0})},e.isRef=function(e){return!!e&&!!e[s.symbols.ref]},o.Ref=class{constructor(e){t("object"==typeof e,"Invalid reference construction"),s.assertOptions(e,["adjust","ancestor","in","iterables","map","path","render","separator","type","depth","key","root","display"]),t([!1,void 0].includes(e.separator)||"string"==typeof e.separator&&1===e.separator.length,"Invalid separator"),t(!e.adjust||"function"==typeof e.adjust,"options.adjust must be a function"),t(!e.map||Array.isArray(e.map),"options.map must be an array"),t(!e.map||!e.adjust,"Cannot set both map and adjust options"),Object.assign(this,o.defaults,e),t("value"===this.type||void 0===this.ancestor,"Non-value references cannot reference ancestors"),Array.isArray(this.map)&&(this.map=new Map(this.map)),this.depth=this.path.length,this.key=this.path.length?this.path.join(this.separator):null,this.root=this.path[0],this.updateDisplay()}resolve(e,r,n,s,i={}){return t(!this.in||i.in,"Invalid in() reference usage"),"global"===this.type?this._resolve(n.context,r,i):"local"===this.type?this._resolve(s,r,i):this.ancestor?"root"===this.ancestor?this._resolve(r.ancestors[r.ancestors.length-1],r,i):(t(this.ancestor<=r.ancestors.length,"Invalid reference exceeds the schema root:",this.display),this._resolve(r.ancestors[this.ancestor-1],r,i)):this._resolve(e,r,i)}_resolve(e,t,r){let s;if("value"===this.type&&t.mainstay.shadow&&!1!==r.shadow&&(s=t.mainstay.shadow.get(this.absolute(t))),void 0===s&&(s=n(e,this.path,{iterables:this.iterables,functions:!0})),this.adjust&&(s=this.adjust(s)),this.map){const e=this.map.get(s);void 0!==e&&(s=e)}return t.mainstay&&t.mainstay.tracer.resolve(t,this,s),s}toString(){return this.display}absolute(e){return[...e.path.slice(0,-this.ancestor),...this.path]}clone(){return new o.Ref(this)}describe(){const e={path:this.path};"value"!==this.type&&(e.type=this.type),"."!==this.separator&&(e.separator=this.separator),"value"===this.type&&1!==this.ancestor&&(e.ancestor=this.ancestor),this.map&&(e.map=[...this.map]);for(const t of["adjust","iterables","render"])null!==this[t]&&void 0!==this[t]&&(e[t]=this[t]);return!1!==this.in&&(e.in=!0),{ref:e}}updateDisplay(){const e=null!==this.key?this.key:"";if("value"!==this.type)return void(this.display=`ref:${this.type}:${e}`);if(!this.separator)return void(this.display=`ref:${e}`);if(!this.ancestor)return void(this.display=`ref:${this.separator}${e}`);if("root"===this.ancestor)return void(this.display=`ref:root:${e}`);if(1===this.ancestor)return void(this.display=`ref:${e||".."}`);const t=new Array(this.ancestor+1).fill(this.separator).join("");this.display=`ref:${t}${e||""}`}},o.Ref.prototype[s.symbols.ref]=!0,e.build=function(e){return"value"===(e=Object.assign({},o.defaults,e)).type&&void 0===e.ancestor&&(e.ancestor=1),new o.Ref(e)},o.context=function(e,t,r={}){if(e=e.trim(),r){const n=void 0===r.global?"$":r.global;if(n!==t&&e.startsWith(n))return{key:e.slice(n.length),type:"global"};const s=void 0===r.local?"#":r.local;if(s!==t&&e.startsWith(s))return{key:e.slice(s.length),type:"local"};const i=void 0===r.root?"/":r.root;if(i!==t&&e.startsWith(i))return{key:e.slice(i.length),type:"value",root:!0}}return{key:e,type:"value"}},o.ancestor=function(e,t){if(!t)return[1,0];if(e[0]!==t)return[1,0];if(e[1]!==t)return[0,1];let r=2;for(;e[r]===t;)++r;return[r-1,r]},e.toSibling=0,e.toParent=1,e.Manager=class{constructor(){this.refs=[]}register(t,r){if(t)if(r=void 0===r?e.toParent:r,Array.isArray(t))for(const e of t)this.register(e,r);else if(s.isSchema(t))for(const e of t._refs.refs)e.ancestor-r>=0&&this.refs.push({ancestor:e.ancestor-r,root:e.root});else e.isRef(t)&&"value"===t.type&&t.ancestor-r>=0&&this.refs.push({ancestor:t.ancestor-r,root:t.root}),i=i||qp(),i.isTemplate(t)&&this.register(t.refs(),r)}get length(){return this.refs.length}clone(){const t=new e.Manager;return t.refs=r(this.refs),t}reset(){this.refs=[]}roots(){return this.refs.filter((e=>!e.ancestor)).map((e=>e.root))}}}(Xp)),Xp}function qp(){return Fp||(Fp=1,function(e,t){const r=R,n=M,s=F,i=(K||(K=1,function(e){const t={operators:["!","^","*","/","%","+","-","<","<=",">",">=","==","!=","&&","||","??"],operatorCharacters:["!","^","*","/","%","+","-","<","=",">","&","|","?"],operatorsOrder:[["^"],["*","/","%"],["+","-"],["<","<=",">",">="],["==","!="],["&&"],["||","??"]],operatorsPrefix:["!","n"],literals:{'"':'"',"`":"`","'":"'","[":"]"},numberRx:/^(?:[0-9]*(\.[0-9]*)?){1}$/,tokenRx:/^[\w\$\#\.\@\:\{\}]+$/,symbol:Symbol("formula"),settings:Symbol("settings")};e.Parser=class{constructor(e,r={}){if(!r[t.settings]&&r.constants)for(const e in r.constants){const t=r.constants[e];if(null!==t&&!["boolean","number","string"].includes(typeof t))throw new Error(`Formula constant ${e} contains invalid ${typeof t} value type`)}this.settings=r[t.settings]?r:Object.assign({[t.settings]:!0,constants:{},functions:{}},r),this.single=null,this._parts=null,this._parse(e)}_parse(r){let n=[],s="",i=0,o=!1;const a=r=>{if(i)throw new Error("Formula missing closing parenthesis");const a=n.length?n[n.length-1]:null;if(o||s||r){if(a&&"reference"===a.type&&")"===r)return a.type="function",a.value=this._subFormula(s,a.value),void(s="");if(")"===r){const t=new e.Parser(s,this.settings);n.push({type:"segment",value:t})}else if(o){if("]"===o)return n.push({type:"reference",value:s}),void(s="");n.push({type:"literal",value:s})}else if(t.operatorCharacters.includes(s))a&&"operator"===a.type&&t.operators.includes(a.value+s)?a.value+=s:n.push({type:"operator",value:s});else if(s.match(t.numberRx))n.push({type:"constant",value:parseFloat(s)});else if(void 0!==this.settings.constants[s])n.push({type:"constant",value:this.settings.constants[s]});else{if(!s.match(t.tokenRx))throw new Error(`Formula contains invalid token: ${s}`);n.push({type:"reference",value:s})}s=""}};for(const e of r)o?e===o?(a(),o=!1):s+=e:i?"("===e?(s+=e,++i):")"===e?(--i,i?s+=e:a(e)):s+=e:e in t.literals?o=t.literals[e]:"("===e?(a(),++i):t.operatorCharacters.includes(e)?(a(),s=e,a()):" "!==e?s+=e:a();a(),n=n.map(((e,t)=>"operator"!==e.type||"-"!==e.value||t&&"operator"!==n[t-1].type?e:{type:"operator",value:"n"}));let u=!1;for(const e of n){if("operator"===e.type){if(t.operatorsPrefix.includes(e.value))continue;if(!u)throw new Error("Formula contains an operator in invalid position");if(!t.operators.includes(e.value))throw new Error(`Formula contains an unknown operator ${e.value}`)}else if(u)throw new Error("Formula missing expected operator");u=!u}if(!u)throw new Error("Formula contains invalid trailing operator");1===n.length&&["reference","literal","constant"].includes(n[0].type)&&(this.single={type:"reference"===n[0].type?"reference":"value",value:n[0].value}),this._parts=n.map((e=>{if("operator"===e.type)return t.operatorsPrefix.includes(e.value)?e:e.value;if("reference"!==e.type)return e.value;if(this.settings.tokenRx&&!this.settings.tokenRx.test(e.value))throw new Error(`Formula contains invalid reference ${e.value}`);return this.settings.reference?this.settings.reference(e.value):t.reference(e.value)}))}_subFormula(r,n){const s=this.settings.functions[n];if("function"!=typeof s)throw new Error(`Formula contains unknown function ${n}`);let i=[];if(r){let e="",s=0,o=!1;const a=()=>{if(!e)throw new Error(`Formula contains function ${n} with invalid arguments ${r}`);i.push(e),e=""};for(let n=0;n<r.length;++n){const i=r[n];o?(e+=i,i===o&&(o=!1)):i in t.literals&&!s?(e+=i,o=t.literals[i]):","!==i||s?(e+=i,"("===i?++s:")"===i&&--s):a()}a()}return i=i.map((t=>new e.Parser(t,this.settings))),function(e){const t=[];for(const r of i)t.push(r.evaluate(e));return s.call(e,...t)}}evaluate(e){const r=this._parts.slice();for(let n=r.length-2;n>=0;--n){const s=r[n];if(s&&"operator"===s.type){const i=r[n+1];r.splice(n+1,1);const o=t.evaluate(i,e);r[n]=t.single(s.value,o)}}return t.operatorsOrder.forEach((n=>{for(let s=1;s<r.length-1;)if(n.includes(r[s])){const n=r[s],i=t.evaluate(r[s-1],e),o=t.evaluate(r[s+1],e);r.splice(s,2);const a=t.calculate(n,i,o);r[s-1]=0===a?0:a}else s+=2})),t.evaluate(r[0],e)}},e.Parser.prototype[t.symbol]=!0,t.reference=function(e){return function(t){return t&&void 0!==t[e]?t[e]:null}},t.evaluate=function(e,r){return null===e?null:"function"==typeof e?e(r):e[t.symbol]?e.evaluate(r):e},t.single=function(e,t){if("!"===e)return!t;const r=-t;return 0===r?0:r},t.calculate=function(e,r,n){if("??"===e)return t.exists(r)?r:n;if("string"==typeof r||"string"==typeof n){if("+"===e)return(r=t.exists(r)?r:"")+(t.exists(n)?n:"")}else switch(e){case"^":return Math.pow(r,n);case"*":return r*n;case"/":return r/n;case"%":return r%n;case"+":return r+n;case"-":return r-n}switch(e){case"<":return r<n;case"<=":return r<=n;case">":return r>n;case">=":return r>=n;case"==":return r===n;case"!=":return r!==n;case"&&":return r&&n;case"||":return r||n}return null},t.exists=function(e){return null!=e}}(G)),G),o=Yp(),a=Mp(),u=Wp(),c={symbol:Symbol("template"),opens:new Array(1e3).join("\0"),closes:new Array(1e3).join(""),dateFormat:{date:Date.prototype.toDateString,iso:Date.prototype.toISOString,string:Date.prototype.toString,time:Date.prototype.toTimeString,utc:Date.prototype.toUTCString}};e.exports=c.Template=class{constructor(e,t){if(r("string"==typeof e,"Template source must be a string"),r(!e.includes("\0")&&!e.includes(""),"Template source cannot contain reserved control characters"),this.source=e,this.rendered=e,this._template=null,t){const{functions:e,...s}=t;this._settings=Object.keys(s).length?n(s):void 0,this._functions=e,this._functions&&(r(Object.keys(this._functions).every((e=>"string"==typeof e)),"Functions keys must be strings"),r(Object.values(this._functions).every((e=>"function"==typeof e)),"Functions values must be functions"))}else this._settings=void 0,this._functions=void 0;this._parse()}_parse(){if(!this.source.includes("{"))return;const e=c.encode(this.source),t=c.split(e);let r=!1;const n=[],s=t.shift();s&&n.push(s);for(const e of t){const t="{"!==e[0],s=t?"}":"}}",i=e.indexOf(s);if(-1===i||"{"===e[1]){n.push(`{${c.decode(e)}`);continue}let o=e.slice(t?0:1,i);const a=":"===o[0];a&&(o=o.slice(1));const u=this._ref(c.decode(o),{raw:t,wrapped:a});n.push(u),"string"!=typeof u&&(r=!0);const l=e.slice(i+s.length);l&&n.push(c.decode(l))}r?this._template=n:this.rendered=n.join("")}static date(e,t){return c.dateFormat[t.dateFormat].call(e)}describe(e={}){if(!this._settings&&e.compact)return this.source;const t={template:this.source};return this._settings&&(t.options=this._settings),this._functions&&(t.functions=this._functions),t}static build(e){return new c.Template(e.template,e.options||e.functions?{...e.options,functions:e.functions}:void 0)}isDynamic(){return!!this._template}static isTemplate(e){return!!e&&!!e[o.symbols.template]}refs(){if(!this._template)return;const e=[];for(const t of this._template)"string"!=typeof t&&e.push(...t.refs);return e}resolve(e,t,r,n){return this._template&&1===this._template.length?this._part(this._template[0],e,t,r,n,{}):this.render(e,t,r,n)}_part(e,...t){return e.ref?e.ref.resolve(...t):e.formula.evaluate(t)}render(e,t,r,n,i={}){if(!this.isDynamic())return this.rendered;const o=[];for(const a of this._template)if("string"==typeof a)o.push(a);else{const u=this._part(a,e,t,r,n,i),l=c.stringify(u,e,t,r,n,i);if(void 0!==l){const e=a.raw||!1===(i.errors&&i.errors.escapeHtml)?l:s(l);o.push(c.wrap(e,a.wrapped&&r.errors.wrap.label))}}return o.join("")}_ref(e,{raw:t,wrapped:r}){const n=[],s=e=>{const t=u.create(e,this._settings);return n.push(t),e=>{const r=t.resolve(...e);return void 0!==r?r:null}};try{const t=this._functions?{...c.functions,...this._functions}:c.functions;var o=new i.Parser(e,{reference:s,functions:t,constants:c.constants})}catch(t){throw t.message=`Invalid template variable "${e}" fails due to: ${t.message}`,t}if(o.single){if("reference"===o.single.type){const e=n[0];return{ref:e,raw:t,refs:n,wrapped:r||"local"===e.type&&"label"===e.key}}return c.stringify(o.single.value)}return{formula:o,raw:t,refs:n}}toString(){return this.source}},c.Template.prototype[o.symbols.template]=!0,c.Template.prototype.isImmutable=!0,c.encode=function(e){return e.replace(/\\(\{+)/g,((e,t)=>c.opens.slice(0,t.length))).replace(/\\(\}+)/g,((e,t)=>c.closes.slice(0,t.length)))},c.decode=function(e){return e.replace(/\u0000/g,"{").replace(/\u0001/g,"}")},c.split=function(e){const t=[];let r="";for(let n=0;n<e.length;++n){const s=e[n];if("{"===s){let s="";for(;n+1<e.length&&"{"===e[n+1];)s+="{",++n;t.push(r),r=s}else r+=s}return t.push(r),t},c.wrap=function(e,t){return t?1===t.length?`${t}${e}${t}`:`${t[0]}${e}${t[1]}`:e},c.stringify=function(e,t,r,n,s,i={}){const o=typeof e,a=n&&n.errors&&n.errors.wrap||{};let l=!1;if(u.isRef(e)&&e.render&&(l=e.in,e=e.resolve(t,r,n,s,{in:e.in,...i})),null===e)return"null";if("string"===o)return c.wrap(e,i.arrayItems&&a.string);if("number"===o||"function"===o||"symbol"===o)return e.toString();if("object"!==o)return JSON.stringify(e);if(e instanceof Date)return c.Template.date(e,n);if(e instanceof Map){const t=[];for(const[r,n]of e.entries())t.push(`${r.toString()} -> ${n.toString()}`);e=t}if(!Array.isArray(e))return e.toString();const f=[];for(const o of e)f.push(c.stringify(o,t,r,n,s,{arrayItems:!0,...i}));return c.wrap(f.join(", "),!l&&a.array)},c.constants={true:!0,false:!1,null:null,second:1e3,minute:6e4,hour:36e5,day:864e5},c.functions={if:(e,t,r)=>e?t:r,length:e=>"string"==typeof e?e.length:e&&"object"==typeof e?Array.isArray(e)?e.length:Object.keys(e).length:null,msg(e){const[t,r,n,s,i]=this,o=i.messages;if(!o)return"";const u=a.template(t,o[0],e,r,n)||a.template(t,o[1],e,r,n);return u?u.render(t,r,n,s,i):""},number:e=>"number"==typeof e?e:"string"==typeof e?parseFloat(e):"boolean"==typeof e?e?1:0:e instanceof Date?e.getTime():null}}($p)),$p.exports}function Zp(){return Kp||(Kp=1,function(e){const t=R,r=M,n=qp();e.compile=function(e,s){if("string"==typeof e)return t(!s,"Cannot set single message string"),new n(e);if(n.isTemplate(e))return t(!s,"Cannot set single message template"),e;t("object"==typeof e&&!Array.isArray(e),"Invalid message options"),s=s?r(s):{};for(let r in e){const i=e[r];if("root"===r||n.isTemplate(i)){s[r]=i;continue}if("string"==typeof i){s[r]=new n(i);continue}t("object"==typeof i&&!Array.isArray(i),"Invalid message for",r);const o=r;for(r in s[o]=s[o]||{},i){const e=i[r];"root"===r||n.isTemplate(e)?s[o][r]=e:(t("string"==typeof e,"Invalid message for",r,"in",o),s[o][r]=new n(e))}}return s},e.decompile=function(e){const t={};for(let r in e){const s=e[r];if("root"===r){t.root=s;continue}if(n.isTemplate(s)){t[r]=s.describe({compact:!0});continue}const i=r;for(r in t[i]={},s){const e=s[r];"root"!==r?t[i][r]=e.describe({compact:!0}):t[i].root=e}}return t},e.merge=function(s,i){if(!s)return e.compile(i);if(!i)return s;if("string"==typeof i)return new n(i);if(n.isTemplate(i))return i;const o=r(s);for(let e in i){const r=i[e];if("root"===e||n.isTemplate(r)){o[e]=r;continue}if("string"==typeof r){o[e]=new n(r);continue}t("object"==typeof r&&!Array.isArray(r),"Invalid message for",e);const s=e;for(e in o[s]=o[s]||{},r){const i=r[e];"root"===e||n.isTemplate(i)?o[s][e]=i:(t("string"==typeof i,"Invalid message for",e,"in",s),o[s][e]=new n(i))}}return o}}(Lp)),Lp}function Yp(){return Gp||(Gp=1,function(e){const t=R,r=O,n=Np;let s,i;const o={isoDate:/^(?:[-+]\d{2})?(?:\d{4}(?!\d{2}\b))(?:(-?)(?:(?:0[1-9]|1[0-2])(?:\1(?:[12]\d|0[1-9]|3[01]))?|W(?:[0-4]\d|5[0-2])(?:-?[1-7])?|(?:00[1-9]|0[1-9]\d|[12]\d{2}|3(?:[0-5]\d|6[1-6])))(?![T]$|[T][\d]+Z$)(?:[T\s](?:(?:(?:[01]\d|2[0-3])(?:(:?)[0-5]\d)?|24\:?00)(?:[.,]\d+(?!:))?)(?:\2[0-5]\d(?:[.,]\d+)?)?(?:[Z]|(?:[+-])(?:[01]\d|2[0-3])(?::?[0-5]\d)?)?)?)?$/};e.version=n.version,e.defaults={abortEarly:!0,allowUnknown:!1,artifacts:!1,cache:!0,context:null,convert:!0,dateFormat:"iso",errors:{escapeHtml:!1,label:"path",language:null,render:!0,stack:!1,wrap:{label:'"',array:"[]"}},externals:!0,messages:{},nonEnumerables:!1,noDefaults:!1,presence:"optional",skipFunctions:!1,stripUnknown:!1,warnings:!1},e.symbols={any:Symbol.for("@hapi/joi/schema"),arraySingle:Symbol("arraySingle"),deepDefault:Symbol("deepDefault"),errors:Symbol("errors"),literal:Symbol("literal"),override:Symbol("override"),parent:Symbol("parent"),prefs:Symbol("prefs"),ref:Symbol("ref"),template:Symbol("template"),values:Symbol("values")},e.assertOptions=function(e,r,n="Options"){t(e&&"object"==typeof e&&!Array.isArray(e),"Options must be of type object");const s=Object.keys(e).filter((e=>!r.includes(e)));t(0===s.length,`${n} contain unknown keys: ${s}`)},e.checkPreferences=function(e){i=i||xp();const t=i.preferences.validate(e);if(t.error)throw new r([t.error.details[0].message])},e.compare=function(e,t,r){switch(r){case"=":return e===t;case">":return e>t;case"<":return e<t;case">=":return e>=t;case"<=":return e<=t}},e.default=function(e,t){return void 0===e?t:e},e.isIsoDate=function(e){return o.isoDate.test(e)},e.isNumber=function(e){return"number"==typeof e&&!isNaN(e)},e.isResolvable=function(t){return!!t&&(t[e.symbols.ref]||t[e.symbols.template])},e.isSchema=function(r,n={}){const s=r&&r[e.symbols.any];return!!s&&(t(n.legacy||s.version===e.version,"Cannot mix different versions of joi schemas"),!0)},e.isValues=function(t){return t[e.symbols.values]},e.limit=function(e){return Number.isSafeInteger(e)&&e>=0},e.preferences=function(t,r){s=s||Zp(),t=t||{},r=r||{};const n=Object.assign({},t,r);return r.errors&&t.errors&&(n.errors=Object.assign({},t.errors,r.errors),n.errors.wrap=Object.assign({},t.errors.wrap,r.errors.wrap)),r.messages&&(n.messages=s.compile(r.messages,t.messages)),delete n[e.symbols.prefs],n},e.tryWithPath=function(e,t,r={}){try{return e()}catch(e){throw void 0!==e.path?e.path=t+"."+e.path:e.path=t,r.append&&(e.message=`${e.message} (${e.path})`),e}},e.validateArg=function(t,r,{assert:n,message:s}){if(e.isSchema(n)){const e=n.validate(t);if(!e.error)return;return e.error.message}if(!n(t))return r?`${r} ${s}`:s},e.verifyFlat=function(e,r){for(const n of e)t(!Array.isArray(n),"Method no longer accepts array arguments:",r)}}(Rp)),Rp}function zp(){if(Vp)return kp;Vp=1;const e=R,t=M,r=Yp(),n={max:1e3,supported:new Set(["undefined","boolean","number","string"])};return kp.provider={provision:e=>new n.Cache(e)},n.Cache=class{constructor(t={}){r.assertOptions(t,["max"]),e(void 0===t.max||t.max&&t.max>0&&isFinite(t.max),"Invalid max cache size"),this._max=t.max||n.max,this._map=new Map,this._list=new n.List}get length(){return this._map.size}set(e,t){if(null!==e&&!n.supported.has(typeof e))return;let r=this._map.get(e);if(r)return r.value=t,void this._list.first(r);r=this._list.unshift({key:e,value:t}),this._map.set(e,r),this._compact()}get(e){const r=this._map.get(e);if(r)return this._list.first(r),t(r.value)}_compact(){if(this._map.size>this._max){const e=this._list.pop();this._map.delete(e.key)}}},n.List=class{constructor(){this.tail=null,this.head=null}unshift(e){return e.next=null,e.prev=this.head,this.head&&(this.head.next=e),this.head=e,this.tail||(this.tail=e),e}first(e){e!==this.head&&(this._remove(e),this.unshift(e))}pop(){return this._remove(this.tail)}_remove(e){const{next:t,prev:r}=e;return t.prev=r,r&&(r.next=t),e===this.tail&&(this.tail=t),e.prev=null,e.next=null,e}},kp}var Jp,Qp={};function eh(){return Jp||(Jp=1,function(e){const t=R,r=Yp(),n=Wp(),s={};e.schema=function(e,t,n={}){r.assertOptions(n,["appendPath","override"]);try{return s.schema(e,t,n)}catch(e){throw n.appendPath&&void 0!==e.path&&(e.message=`${e.message} (${e.path})`),e}},s.schema=function(e,n,i){t(void 0!==n,"Invalid undefined schema"),Array.isArray(n)&&(t(n.length,"Invalid empty array schema"),1===n.length&&(n=n[0]));const o=(t,...r)=>!1!==i.override?t.valid(e.override,...r):t.valid(...r);if(s.simple(n))return o(e,n);if("function"==typeof n)return e.custom(n);if(t("object"==typeof n,"Invalid schema content:",typeof n),r.isResolvable(n))return o(e,n);if(r.isSchema(n))return n;if(Array.isArray(n)){for(const t of n)if(!s.simple(t))return e.alternatives().try(...n);return o(e,...n)}return n instanceof RegExp?e.string().regex(n):n instanceof Date?o(e.date(),n):(t(Object.getPrototypeOf(n)===Object.getPrototypeOf({}),"Schema can only contain plain objects"),e.object().keys(n))},e.ref=function(e,t){return n.isRef(e)?e:n.create(e,t)},e.compile=function(n,i,o={}){r.assertOptions(o,["legacy"]);const a=i&&i[r.symbols.any];if(a)return t(o.legacy||a.version===r.version,"Cannot mix different versions of joi schemas:",a.version,r.version),i;if("object"!=typeof i||!o.legacy)return e.schema(n,i,{appendPath:!0});const u=s.walk(i);return u?u.compile(u.root,i):e.schema(n,i,{appendPath:!0})},s.walk=function(e){if("object"!=typeof e)return null;if(Array.isArray(e)){for(const t of e){const e=s.walk(t);if(e)return e}return null}const n=e[r.symbols.any];if(n)return{root:e[n.root],compile:n.compile};t(Object.getPrototypeOf(e)===Object.getPrototypeOf({}),"Schema can only contain plain objects");for(const t in e){const r=s.walk(e[t]);if(r)return r}return null},s.simple=function(e){return null===e||["boolean","string","number"].includes(typeof e)},e.when=function(i,o,a){if(void 0===a&&(t(o&&"object"==typeof o,"Missing options"),a=o,o=n.create(".")),Array.isArray(a)&&(a={switch:a}),r.assertOptions(a,["is","not","then","otherwise","switch","break"]),r.isSchema(o))return t(void 0===a.is,'"is" can not be used with a schema condition'),t(void 0===a.not,'"not" can not be used with a schema condition'),t(void 0===a.switch,'"switch" can not be used with a schema condition'),s.condition(i,{is:o,then:a.then,otherwise:a.otherwise,break:a.break});if(t(n.isRef(o)||"string"==typeof o,"Invalid condition:",o),t(void 0===a.not||void 0===a.is,'Cannot combine "is" with "not"'),void 0===a.switch){let u=a;void 0!==a.not&&(u={is:a.not,then:a.otherwise,otherwise:a.then,break:a.break});let c=void 0!==u.is?i.$_compile(u.is):i.$_root.invalid(null,!1,0,"").required();return t(void 0!==u.then||void 0!==u.otherwise,'options must have at least one of "then", "otherwise", or "switch"'),t(void 0===u.break||void 0===u.then||void 0===u.otherwise,"Cannot specify then, otherwise, and break all together"),void 0===a.is||n.isRef(a.is)||r.isSchema(a.is)||(c=c.required()),s.condition(i,{ref:e.ref(o),is:c,then:u.then,otherwise:u.otherwise,break:u.break})}t(Array.isArray(a.switch),'"switch" must be an array'),t(void 0===a.is,'Cannot combine "switch" with "is"'),t(void 0===a.not,'Cannot combine "switch" with "not"'),t(void 0===a.then,'Cannot combine "switch" with "then"');const u={ref:e.ref(o),switch:[],break:a.break};for(let e=0;e<a.switch.length;++e){const s=a.switch[e],o=e===a.switch.length-1;r.assertOptions(s,o?["is","then","otherwise"]:["is","then"]),t(void 0!==s.is,'Switch statement missing "is"'),t(void 0!==s.then,'Switch statement missing "then"');const c={is:i.$_compile(s.is),then:i.$_compile(s.then)};if(n.isRef(s.is)||r.isSchema(s.is)||(c.is=c.is.required()),o){t(void 0===a.otherwise||void 0===s.otherwise,'Cannot specify "otherwise" inside and outside a "switch"');const e=void 0!==a.otherwise?a.otherwise:s.otherwise;void 0!==e&&(t(void 0===u.break,"Cannot specify both otherwise and break"),c.otherwise=i.$_compile(e))}u.switch.push(c)}return u},s.condition=function(e,t){for(const r of["then","otherwise"])void 0===t[r]?delete t[r]:t[r]=e.$_compile(t[r]);return t}}(Qp)),Qp}var th,rh={};function nh(){if(th)return rh;th=1;const e=R,t=M,r=Yp(),n=Zp(),s={};return rh.type=function(i,o){const a=Object.getPrototypeOf(i),u=t(a),c=i._assign(Object.create(u)),l=Object.assign({},o);delete l.base,u._definition=l;const f=a._definition||{};l.messages=n.merge(f.messages,l.messages),l.properties=Object.assign({},f.properties,l.properties),c.type=l.type,l.flags=Object.assign({},f.flags,l.flags);const p=Object.assign({},f.terms);if(l.terms)for(const t in l.terms){const r=l.terms[t];e(void 0===c.$_terms[t],"Invalid term override for",l.type,t),c.$_terms[t]=r.init,p[t]=r}l.terms=p,l.args||(l.args=f.args),l.prepare=s.prepare(l.prepare,f.prepare),l.coerce&&("function"==typeof l.coerce&&(l.coerce={method:l.coerce}),l.coerce.from&&!Array.isArray(l.coerce.from)&&(l.coerce={method:l.coerce.method,from:[].concat(l.coerce.from)})),l.coerce=s.coerce(l.coerce,f.coerce),l.validate=s.validate(l.validate,f.validate);const h=Object.assign({},f.rules);if(l.rules)for(const t in l.rules){const n=l.rules[t];e("object"==typeof n,"Invalid rule definition for",l.type,t);let s=n.method;if(void 0===s&&(s=function(){return this.$_addRule(t)}),s&&(e(!u[t],"Rule conflict in",l.type,t),u[t]=s),e(!h[t],"Rule conflict in",l.type,t),h[t]=n,n.alias){const e=[].concat(n.alias);for(const t of e)u[t]=n.method}n.args&&(n.argsByName=new Map,n.args=n.args.map((t=>("string"==typeof t&&(t={name:t}),e(!n.argsByName.has(t.name),"Duplicated argument name",t.name),r.isSchema(t.assert)&&(t.assert=t.assert.strict().label(t.name)),n.argsByName.set(t.name,t),t))))}l.rules=h;const d=Object.assign({},f.modifiers);if(l.modifiers)for(const t in l.modifiers){e(!u[t],"Rule conflict in",l.type,t);const r=l.modifiers[t];e("function"==typeof r,"Invalid modifier definition for",l.type,t);const n=function(e){return this.rule({[t]:e})};u[t]=n,d[t]=r}if(l.modifiers=d,l.overrides){u._super=a,c.$_super={};for(const t in l.overrides)e(a[t],"Cannot override missing",t),l.overrides[t][r.symbols.parent]=a[t],c.$_super[t]=a[t].bind(c);Object.assign(u,l.overrides)}l.cast=Object.assign({},f.cast,l.cast);const m=Object.assign({},f.manifest,l.manifest);return m.build=s.build(l.manifest&&l.manifest.build,f.manifest&&f.manifest.build),l.manifest=m,l.rebuild=s.rebuild(l.rebuild,f.rebuild),c},s.build=function(e,t){return e&&t?function(r,n){return t(e(r,n),n)}:e||t},s.coerce=function(e,t){return e&&t?{from:e.from&&t.from?[...new Set([...e.from,...t.from])]:null,method(r,n){let s;if((!t.from||t.from.includes(typeof r))&&(s=t.method(r,n),s)){if(s.errors||void 0===s.value)return s;r=s.value}if(!e.from||e.from.includes(typeof r)){const t=e.method(r,n);if(t)return t}return s}}:e||t},s.prepare=function(e,t){return e&&t?function(r,n){const s=e(r,n);if(s){if(s.errors||void 0===s.value)return s;r=s.value}return t(r,n)||s}:e||t},s.rebuild=function(e,t){return e&&t?function(r){t(r),e(r)}:e||t},s.validate=function(e,t){return e&&t?function(r,n){const s=t(r,n);if(s){if(s.errors&&(!Array.isArray(s.errors)||s.errors.length))return s;r=s.value}return e(r,n)||s}:e||t},rh}var sh,ih={};function oh(){if(sh)return ih;sh=1;const e=R,t=M,r=Yp(),n=Zp(),s=Wp(),i=qp();let o;const a={};return ih.describe=function(s){const i=s._definition,o={type:s.type,flags:{},rules:[]};for(const e in s._flags)"_"!==e[0]&&(o.flags[e]=a.describe(s._flags[e]));Object.keys(o.flags).length||delete o.flags,s._preferences&&(o.preferences=t(s._preferences,{shallow:["messages"]}),delete o.preferences[r.symbols.prefs],o.preferences.messages&&(o.preferences.messages=n.decompile(o.preferences.messages))),s._valids&&(o.allow=s._valids.describe()),s._invalids&&(o.invalid=s._invalids.describe());for(const e of s._rules){if(!1===i.rules[e.name].manifest)continue;const t={name:e.name};for(const r in i.modifiers)void 0!==e[r]&&(t[r]=a.describe(e[r]));if(e.args){t.args={};for(const r in e.args){const n=e.args[r];("options"!==r||Object.keys(n).length)&&(t.args[r]=a.describe(n,{assign:r}))}Object.keys(t.args).length||delete t.args}o.rules.push(t)}o.rules.length||delete o.rules;for(const t in s.$_terms){if("_"===t[0])continue;e(!o[t],"Cannot describe schema due to internal name conflict with",t);const n=s.$_terms[t];if(!n)continue;if(n instanceof Map){n.size&&(o[t]=[...n.entries()]);continue}if(r.isValues(n)){o[t]=n.describe();continue}e(i.terms[t],"Term",t,"missing configuration");const u=i.terms[t].manifest,c="object"==typeof u;if(!n.length&&!c)continue;const l=[];for(const e of n)l.push(a.describe(e));if(c){const{from:e,to:r}=u.mapped;o[t]={};for(const n of l)o[t][n[r]]=n[e]}else"single"!==u?o[t]=l:(e(1===l.length,"Term",t,"contains more than one item"),o[t]=l[0])}return a.validate(s.$_root,o),o},a.describe=function(e,n={}){if(Array.isArray(e))return e.map(a.describe);if(e===r.symbols.deepDefault)return{special:"deep"};if("object"!=typeof e||null===e)return e;if("options"===n.assign)return t(e);if(Buffer&&Buffer.isBuffer(e))return{buffer:e.toString("binary")};if(e instanceof Date)return e.toISOString();if(e instanceof Error)return e;if(e instanceof RegExp)return"regex"===n.assign?e.toString():{regex:e.toString()};if(e[r.symbols.literal])return{function:e.literal};if("function"==typeof e.describe)return"ref"===n.assign?e.describe().ref:e.describe();const s={};for(const t in e){const r=e[t];void 0!==r&&(s[t]=a.describe(r,{assign:t}))}return s},ih.build=function(e,t){return new a.Builder(e).parse(t)},a.Builder=class{constructor(e){this.joi=e}parse(t){a.validate(this.joi,t);let r=this.joi[t.type]()._bare();const n=r._definition;if(t.flags)for(const s in t.flags){const i=n.flags[s]&&n.flags[s].setter||s;e("function"==typeof r[i],"Invalid flag",s,"for type",t.type),r=r[i](this.build(t.flags[s]))}if(t.preferences&&(r=r.preferences(this.build(t.preferences))),t.allow&&(r=r.allow(...this.build(t.allow))),t.invalid&&(r=r.invalid(...this.build(t.invalid))),t.rules)for(const s of t.rules){e("function"==typeof r[s.name],"Invalid rule",s.name,"for type",t.type);const i=[];if(s.args){const r={};for(const e in s.args)r[e]=this.build(s.args[e],{assign:e});const o=Object.keys(r),a=n.rules[s.name].args;if(a){e(o.length<=a.length,"Invalid number of arguments for",t.type,s.name,"(expected up to",a.length,", found",o.length,")");for(const{name:e}of a)i.push(r[e])}else e(1===o.length,"Invalid number of arguments for",t.type,s.name,"(expected up to 1, found",o.length,")"),i.push(r[o[0]])}r=r[s.name](...i);const o={};for(const e in n.modifiers)void 0!==s[e]&&(o[e]=this.build(s[e]));Object.keys(o).length&&(r=r.rule(o))}const s={};for(const r in t){if(["allow","flags","invalid","whens","preferences","rules","type"].includes(r))continue;e(n.terms[r],"Term",r,"missing configuration");const i=n.terms[r].manifest;if("schema"!==i)if("values"!==i)if("single"!==i)if("object"!=typeof i)s[r]=this.build(t[r]);else{s[r]={};for(const e in t[r]){const n=t[r][e];s[r][e]=this.parse(n)}}else s[r]=this.build(t[r]);else s[r]=t[r].map((e=>this.build(e)));else s[r]=t[r].map((e=>this.parse(e)))}return t.whens&&(s.whens=t.whens.map((e=>this.build(e)))),r=n.manifest.build(r,s),r.$_temp.ruleset=!1,r}build(n,o={}){if(null===n)return null;if(Array.isArray(n))return n.map((e=>this.build(e)));if(n instanceof Error)return n;if("options"===o.assign)return t(n);if("regex"===o.assign)return a.regex(n);if("ref"===o.assign)return s.build(n);if("object"!=typeof n)return n;if(1===Object.keys(n).length){if(n.buffer)return e(Buffer,"Buffers are not supported"),Buffer&&Buffer.from(n.buffer,"binary");if(n.function)return{[r.symbols.literal]:!0,literal:n.function};if(n.override)return r.symbols.override;if(n.ref)return s.build(n.ref);if(n.regex)return a.regex(n.regex);if(n.special)return e(["deep"].includes(n.special),"Unknown special value",n.special),r.symbols.deepDefault;if(n.value)return t(n.value)}if(n.type)return this.parse(n);if(n.template)return i.build(n);const u={};for(const e in n)u[e]=this.build(n[e],{assign:e});return u}},a.regex=function(e){const t=e.lastIndexOf("/"),r=e.slice(1,t),n=e.slice(t+1);return new RegExp(r,n)},a.validate=function(e,t){o=o||xp(),e.assert(t,o.description)},ih}var ah,uh={};function ch(){if(ah)return uh;ah=1;const e=W,t=(q||(q=1,Z.location=function(e=0){const t=Error.prepareStackTrace;Error.prepareStackTrace=(e,t)=>t;const r={};Error.captureStackTrace(r,this);const n=r.stack[e+1];return Error.prepareStackTrace=t,{filename:n.getFileName(),line:n.getLineNumber()}}),Z),r=Mp(),n={codes:{error:1,pass:2,full:3},labels:{0:"never used",1:"always error",2:"always pass"}};return uh.setup=function(e){const t=function(){return e._tracer=e._tracer||new n.Tracer,e._tracer};e.trace=t,e[Symbol.for("@hapi/lab/coverage/initialize")]=t,e.untrace=()=>{e._tracer=null}},uh.location=function(e){return e.$_setFlag("_tracerLocation",t.location(2))},n.Tracer=class{constructor(){this.name="Joi",this._schemas=new Map}_register(e){const r=this._schemas.get(e);if(r)return r.store;const s=new n.Store(e),{filename:i,line:o}=e._flags._tracerLocation||t.location(5);return this._schemas.set(e,{filename:i,line:o,store:s}),s}_combine(e,t){for(const{store:r}of this._schemas.values())r._combine(e,t)}report(e){const t=[];for(const{filename:r,line:s,store:i}of this._schemas.values()){if(e&&e!==r)continue;const o=[],a=[];for(const[e,t]of i._sources.entries()){if(n.sub(t.paths,a))continue;if(!t.entry){o.push({status:"never reached",paths:[...t.paths]}),a.push(...t.paths);continue}for(const r of["valid","invalid"]){const n=e[`_${r}s`];if(!n)continue;const s=new Set(n._values),i=new Set(n._refs);for(const{value:e,ref:n}of t[r])s.delete(e),i.delete(n);(s.size||i.size)&&o.push({status:[...s,...[...i].map((e=>e.display))],rule:`${r}s`})}const r=e._rules.map((e=>e.name));for(const t of["default","failover"])void 0!==e._flags[t]&&r.push(t);for(const e of r){const r=n.labels[t.rule[e]||0];if(r){const n={rule:e,status:r};t.paths.size&&(n.paths=[...t.paths]),o.push(n)}}}o.length&&t.push({filename:r,line:s,missing:o,severity:"error",message:`Schema missing tests for ${o.map(n.message).join(", ")}`})}return t.length?t:null}},n.Store=class{constructor(e){this.active=!0,this._sources=new Map,this._combos=new Map,this._scan(e)}debug(e,t,r,n){e.mainstay.debug&&e.mainstay.debug.push({type:t,name:r,result:n,path:e.path})}entry(e,t){n.debug(t,{type:"entry"}),this._record(e,(e=>{e.entry=!0}))}filter(e,t,r,s){n.debug(t,{type:r,...s}),this._record(e,(e=>{e[r].add(s)}))}log(e,t,r,s,i){n.debug(t,{type:r,name:s,result:"full"===i?"pass":i}),this._record(e,(e=>{e[r][s]=e[r][s]||0,e[r][s]|=n.codes[i]}))}resolve(e,t,r){if(!e.mainstay.debug)return;const n={type:"resolve",ref:t.display,to:r,path:e.path};e.mainstay.debug.push(n)}value(t,r,n,s,i){if(!t.mainstay.debug||e(n,s))return;const o={type:"value",by:r,from:n,to:s,path:t.path};i&&(o.name=i),t.mainstay.debug.push(o)}_record(e,t){const r=this._sources.get(e);if(r)return void t(r);const n=this._combos.get(e);for(const e of n)this._record(e,t)}_scan(e,t){const r=t||[];let s=this._sources.get(e);s||(s={paths:new Set,entry:!1,rule:{},valid:new Set,invalid:new Set},this._sources.set(e,s)),r.length&&s.paths.add(r);e.$_modify({each:(e,t)=>{const s=n.id(e,t);this._scan(e,r.concat(s))},ref:!1})}_combine(e,t){this._combos.set(e,t)}},n.message=function(e){return`${e.paths?r.path(e.paths[0])+(e.rule?":":""):""}${e.rule||""} (${e.status})`},n.id=function(e,{source:t,name:r,path:n,key:s}){return e._flags.id?e._flags.id:s||(r=`@${r}`,"terms"===t?[r,n[Math.min(n.length-1,1)]]:r)},n.sub=function(t,r){for(const n of t)for(const t of r)if(e(n.slice(0,t.length),t))return!0;return!1},n.debug=function(e,t){e.mainstay.debug&&(t.path=e.debug?[...e.path,e.debug]:e.path,e.mainstay.debug.push(t))},uh}var lh,fh={};var ph,hh,dh,mh,yh,gh,bh,vh,_h,wh,Eh,Sh,Ah,Th,Ih,Oh,kh,Rh,Nh,Ph,xh,Ch,Bh,Lh,$h,Uh,Dh,jh,Mh,Hh,Fh,Kh,Gh,Vh,Xh,Wh={};function qh(){return dh||(dh=1,function(e){const t=R,r=M,n=te,s=x,i=Yp(),o=Mp(),a=function(){if(hh)return ph;hh=1;const e=M,t=x,r=Yp(),n={value:Symbol("value")};return ph=n.State=class{constructor(e,t,r){this.path=e,this.ancestors=t,this.mainstay=r.mainstay,this.schemas=r.schemas,this.debug=null}localize(e,t=null,r=null){const s=new n.State(e,t,this);return r&&s.schemas&&(s.schemas=[n.schemas(r),...s.schemas]),s}nest(e,t){const r=new n.State(this.path,this.ancestors,this);return r.schemas=r.schemas&&[n.schemas(e),...r.schemas],r.debug=t,r}shadow(e,t){this.mainstay.shadow=this.mainstay.shadow||new n.Shadow,this.mainstay.shadow.set(this.path,e,t)}snapshot(){this.mainstay.shadow&&(this._snapshot=e(this.mainstay.shadow.node(this.path))),this.mainstay.snapshot()}restore(){this.mainstay.shadow&&(this.mainstay.shadow.override(this.path,this._snapshot),this._snapshot=void 0),this.mainstay.restore()}commit(){this.mainstay.shadow&&(this.mainstay.shadow.override(this.path,this._snapshot),this._snapshot=void 0),this.mainstay.commit()}},n.schemas=function(e){return r.isSchema(e)?{schema:e}:e},n.Shadow=class{constructor(){this._values=null}set(e,t,r){if(!e.length)return;if("strip"===r&&"number"==typeof e[e.length-1])return;this._values=this._values||new Map;let s=this._values;for(let t=0;t<e.length;++t){const r=e[t];let n=s.get(r);n||(n=new Map,s.set(r,n)),s=n}s[n.value]=t}get(e){const t=this.node(e);if(t)return t[n.value]}node(e){if(this._values)return t(this._values,e,{iterables:!0})}override(e,r){if(!this._values)return;const n=e.slice(0,-1),s=e[e.length-1],i=t(this._values,n,{iterables:!0});r?i.set(s,r):i&&i.delete(s)}},ph}(),u={result:Symbol("result")};e.entry=function(e,r,n){let s=i.defaults;n&&(t(void 0===n.warnings,"Cannot override warnings preference in synchronous validation"),t(void 0===n.artifacts,"Cannot override artifacts preference in synchronous validation"),s=i.preferences(i.defaults,n));const a=u.entry(e,r,s);t(!a.mainstay.externals.length,"Schema with external rules must use validateAsync()");const c={value:a.value};return a.error&&(c.error=a.error),a.mainstay.warnings.length&&(c.warning=o.details(a.mainstay.warnings)),a.mainstay.debug&&(c.debug=a.mainstay.debug),a.mainstay.artifacts&&(c.artifacts=a.mainstay.artifacts),c},e.entryAsync=async function(e,t,r){let n=i.defaults;r&&(n=i.preferences(i.defaults,r));const a=u.entry(e,t,n),c=a.mainstay;if(a.error)throw c.debug&&(a.error.debug=c.debug),a.error;if(c.externals.length){let t=a.value;const l=[];for(const a of c.externals){const f=a.state.path,p="link"===a.schema.type?c.links.get(a.schema):null;let h,d,m=t;const y=f.length?[t]:[],g=f.length?s(e,f):e;if(f.length){h=f[f.length-1];let e=t;for(const t of f.slice(0,-1))e=e[t],y.unshift(e);d=y[0],m=d[h]}try{const e=(e,t)=>(p||a.schema).$_createError(e,m,t,a.state,n),s=await a.method(m,{schema:a.schema,linked:p,state:a.state,prefs:r,original:g,error:e,errorsArray:u.errorsArray,warn:(e,t)=>c.warnings.push((p||a.schema).$_createError(e,m,t,a.state,n)),message:(e,t)=>(p||a.schema).$_createError("external",m,t,a.state,n,{messages:e})});if(void 0===s||s===m)continue;if(s instanceof o.Report){if(c.tracer.log(a.schema,a.state,"rule","external","error"),l.push(s),n.abortEarly)break;continue}if(Array.isArray(s)&&s[i.symbols.errors]){if(c.tracer.log(a.schema,a.state,"rule","external","error"),l.push(...s),n.abortEarly)break;continue}d?(c.tracer.value(a.state,"rule",m,s,"external"),d[h]=s):(c.tracer.value(a.state,"rule",t,s,"external"),t=s)}catch(e){throw n.errors.label&&(e.message+=` (${a.label})`),e}}if(a.value=t,l.length)throw a.error=o.process(l,e,n),c.debug&&(a.error.debug=c.debug),a.error}if(!n.warnings&&!n.debug&&!n.artifacts)return a.value;const l={value:a.value};return c.warnings.length&&(l.warning=o.details(c.warnings)),c.debug&&(l.debug=c.debug),c.artifacts&&(l.artifacts=c.artifacts),l},u.Mainstay=class{constructor(e,t,r){this.externals=[],this.warnings=[],this.tracer=e,this.debug=t,this.links=r,this.shadow=null,this.artifacts=null,this._snapshots=[]}snapshot(){this._snapshots.push({externals:this.externals.slice(),warnings:this.warnings.slice()})}restore(){const e=this._snapshots.pop();this.externals=e.externals,this.warnings=e.warnings}commit(){this._snapshots.pop()}},u.entry=function(t,r,n){const{tracer:s,cleanup:i}=u.tracer(r,n),c=n.debug?[]:null,l=r._ids._schemaChain?new Map:null,f=new u.Mainstay(s,c,l),p=r._ids._schemaChain?[{schema:r}]:null,h=new a([],[],{mainstay:f,schemas:p}),d=e.validate(t,r,h,n);i&&r.$_root.untrace();const m=o.process(d.errors,t,n);return{value:d.value,error:m,mainstay:f}},u.tracer=function(e,r){return e.$_root._tracer?{tracer:e.$_root._tracer._register(e)}:r.debug?(t(e.$_root.trace,"Debug mode not supported"),{tracer:e.$_root.trace()._register(e),cleanup:!0}):{tracer:u.ignore}},e.validate=function(e,t,r,n,s={}){if(t.$_terms.whens&&(t=t._generate(e,r,n).schema),t._preferences&&(n=u.prefs(t,n)),t._cache&&n.cache){const n=t._cache.get(e);if(r.mainstay.tracer.debug(r,"validate","cached",!!n),n)return n}const o=(s,i,o)=>t.$_createError(s,e,i,o||r,n),a={original:e,prefs:n,schema:t,state:r,error:o,errorsArray:u.errorsArray,warn:(e,t,n)=>r.mainstay.warnings.push(o(e,t,n)),message:(s,i)=>t.$_createError("custom",e,i,r,n,{messages:s})};r.mainstay.tracer.entry(t,r);const c=t._definition;if(c.prepare&&void 0!==e&&n.convert){const t=c.prepare(e,a);if(t){if(r.mainstay.tracer.value(r,"prepare",e,t.value),t.errors)return u.finalize(t.value,[].concat(t.errors),a);e=t.value}}if(c.coerce&&void 0!==e&&n.convert&&(!c.coerce.from||c.coerce.from.includes(typeof e))){const t=c.coerce.method(e,a);if(t){if(r.mainstay.tracer.value(r,"coerced",e,t.value),t.errors)return u.finalize(t.value,[].concat(t.errors),a);e=t.value}}const l=t._flags.empty;l&&l.$_match(u.trim(e,t),r.nest(l),i.defaults)&&(r.mainstay.tracer.value(r,"empty",e,void 0),e=void 0);const f=s.presence||t._flags.presence||(t._flags._endedSwitch?null:n.presence);if(void 0===e){if("forbidden"===f)return u.finalize(e,null,a);if("required"===f)return u.finalize(e,[t.$_createError("any.required",e,null,r,n)],a);if("optional"===f){if(t._flags.default!==i.symbols.deepDefault)return u.finalize(e,null,a);r.mainstay.tracer.value(r,"default",e,{}),e={}}}else if("forbidden"===f)return u.finalize(e,[t.$_createError("any.unknown",e,null,r,n)],a);const p=[];if(t._valids){const s=t._valids.get(e,r,n,t._flags.insensitive);if(s)return n.convert&&(r.mainstay.tracer.value(r,"valids",e,s.value),e=s.value),r.mainstay.tracer.filter(t,r,"valid",s),u.finalize(e,null,a);if(t._flags.only){const s=t.$_createError("any.only",e,{valids:t._valids.values({display:!0})},r,n);if(n.abortEarly)return u.finalize(e,[s],a);p.push(s)}}if(t._invalids){const s=t._invalids.get(e,r,n,t._flags.insensitive);if(s){r.mainstay.tracer.filter(t,r,"invalid",s);const i=t.$_createError("any.invalid",e,{invalids:t._invalids.values({display:!0})},r,n);if(n.abortEarly)return u.finalize(e,[i],a);p.push(i)}}if(c.validate){const t=c.validate(e,a);if(t&&(r.mainstay.tracer.value(r,"base",e,t.value),e=t.value,t.errors)){if(!Array.isArray(t.errors))return p.push(t.errors),u.finalize(e,p,a);if(t.errors.length)return p.push(...t.errors),u.finalize(e,p,a)}}return t._rules.length?u.rules(e,p,a):u.finalize(e,p,a)},u.rules=function(e,t,r){const{schema:n,state:s,prefs:o}=r;for(const a of n._rules){const c=n._definition.rules[a.method];if(c.convert&&o.convert){s.mainstay.tracer.log(n,s,"rule",a.name,"full");continue}let l,f=a.args;if(a._resolve.length){f=Object.assign({},f);for(const t of a._resolve){const r=c.argsByName.get(t),a=f[t].resolve(e,s,o),u=r.normalize?r.normalize(a):a,p=i.validateArg(u,null,r);if(p){l=n.$_createError("any.ref",a,{arg:t,ref:f[t],reason:p},s,o);break}f[t]=u}}l=l||c.validate(e,r,f,a);const p=u.rule(l,a);if(p.errors){if(s.mainstay.tracer.log(n,s,"rule",a.name,"error"),a.warn){s.mainstay.warnings.push(...p.errors);continue}if(o.abortEarly)return u.finalize(e,p.errors,r);t.push(...p.errors)}else s.mainstay.tracer.log(n,s,"rule",a.name,"pass"),s.mainstay.tracer.value(s,"rule",e,p.value,a.name),e=p.value}return u.finalize(e,t,r)},u.rule=function(e,t){return e instanceof o.Report?(u.error(e,t),{errors:[e],value:null}):Array.isArray(e)&&e[i.symbols.errors]?(e.forEach((e=>u.error(e,t))),{errors:e,value:null}):{errors:null,value:e}},u.error=function(e,t){return t.message&&e._setTemplate(t.message),e},u.finalize=function(e,r,n){r=r||[];const{schema:s,state:i,prefs:a}=n;if(r.length){const t=u.default("failover",void 0,r,n);void 0!==t&&(i.mainstay.tracer.value(i,"failover",e,t),e=t,r=[])}if(r.length&&s._flags.error)if("function"==typeof s._flags.error){r=s._flags.error(r),Array.isArray(r)||(r=[r]);for(const e of r)t(e instanceof Error||e instanceof o.Report,"error() must return an Error object")}else r=[s._flags.error];if(void 0===e){const t=u.default("default",e,r,n);i.mainstay.tracer.value(i,"default",e,t),e=t}if(s._flags.cast&&void 0!==e){const t=s._definition.cast[s._flags.cast];if(t.from(e)){const r=t.to(e,n);i.mainstay.tracer.value(i,"cast",e,r,s._flags.cast),e=r}}if(s.$_terms.externals&&a.externals&&!1!==a._externals)for(const{method:e}of s.$_terms.externals)i.mainstay.externals.push({method:e,schema:s,state:i,label:o.label(s._flags,i,a)});const c={value:e,errors:r.length?r:null};return s._flags.result&&(c.value="strip"===s._flags.result?void 0:n.original,i.mainstay.tracer.value(i,s._flags.result,e,c.value),i.shadow(e,s._flags.result)),s._cache&&!1!==a.cache&&!s._refs.length&&s._cache.set(n.original,c),void 0===e||c.errors||void 0===s._flags.artifact||(i.mainstay.artifacts=i.mainstay.artifacts||new Map,i.mainstay.artifacts.has(s._flags.artifact)||i.mainstay.artifacts.set(s._flags.artifact,[]),i.mainstay.artifacts.get(s._flags.artifact).push(i.path)),c},u.prefs=function(e,t){const r=t===i.defaults;return r&&e._preferences[i.symbols.prefs]?e._preferences[i.symbols.prefs]:(t=i.preferences(t,e._preferences),r&&(e._preferences[i.symbols.prefs]=t),t)},u.default=function(e,t,n,s){const{schema:o,state:a,prefs:u}=s,c=o._flags[e];if(u.noDefaults||void 0===c)return t;if(a.mainstay.tracer.log(o,a,"rule",e,"full"),!c)return c;if("function"==typeof c){const t=c.length?[r(a.ancestors[0]),s]:[];try{return c(...t)}catch(t){return void n.push(o.$_createError(`any.${e}`,null,{error:t},a,u))}}return"object"!=typeof c?c:c[i.symbols.literal]?c.literal:i.isResolvable(c)?c.resolve(t,a,u):r(c)},u.trim=function(e,t){if("string"!=typeof e)return e;const r=t.$_getRule("trim");return r&&r.args.enabled?e.trim():e},u.ignore={active:!1,debug:n,entry:n,filter:n,log:n,resolve:n,value:n},u.errorsArray=function(){const e=[];return e[i.symbols.errors]=!0,e}}(Wh)),Wh}function Zh(){if(yh)return mh;yh=1;const e=R,t=W,r=Yp(),n={};return mh=n.Values=class{constructor(e,t){this._values=new Set(e),this._refs=new Set(t),this._lowercase=n.lowercases(e),this._override=!1}get length(){return this._values.size+this._refs.size}add(e,t){r.isResolvable(e)?this._refs.has(e)||(this._refs.add(e),t&&t.register(e)):this.has(e,null,null,!1)||(this._values.add(e),"string"==typeof e&&this._lowercase.set(e.toLowerCase(),e))}static merge(e,t,r){if(e=e||new n.Values,t){if(t._override)return t.clone();for(const r of[...t._values,...t._refs])e.add(r)}if(r)for(const t of[...r._values,...r._refs])e.remove(t);return e.length?e:null}remove(e){r.isResolvable(e)?this._refs.delete(e):(this._values.delete(e),"string"==typeof e&&this._lowercase.delete(e.toLowerCase()))}has(e,t,r,n){return!!this.get(e,t,r,n)}get(e,r,n,s){if(!this.length)return!1;if(this._values.has(e))return{value:e};if("string"==typeof e&&e&&s){const t=this._lowercase.get(e.toLowerCase());if(t)return{value:t}}if(!this._refs.size&&"object"!=typeof e)return!1;if("object"==typeof e)for(const r of this._values)if(t(r,e))return{value:r};if(r)for(const i of this._refs){const o=i.resolve(e,r,n,null,{in:!0});if(void 0===o)continue;const a=i.in&&"object"==typeof o?Array.isArray(o)?o:Object.keys(o):[o];for(const r of a)if(typeof r==typeof e)if(s&&e&&"string"==typeof e){if(r.toLowerCase()===e.toLowerCase())return{value:r,ref:i}}else if(t(r,e))return{value:r,ref:i}}return!1}override(){this._override=!0}values(e){if(e&&e.display){const e=[];for(const t of[...this._values,...this._refs])void 0!==t&&e.push(t);return e}return Array.from([...this._values,...this._refs])}clone(){const e=new n.Values(this._values,this._refs);return e._override=this._override,e}concat(t){e(!t._override,"Cannot concat override set of values");const r=new n.Values([...this._values,...t._values],[...this._refs,...t._refs]);return r._override=this._override,r}describe(){const e=[];this._override&&e.push({override:!0});for(const t of this._values.values())e.push(t&&"object"==typeof t?{value:t}:t);for(const t of this._refs.values())e.push(t.describe());return e}},n.Values.prototype[r.symbols.values]=!0,n.Values.prototype.slice=n.Values.prototype.clone,n.lowercases=function(e){const t=new Map;if(e)for(const r of e)"string"==typeof r&&t.set(r.toLowerCase(),r);return t},mh}function Yh(){if(bh)return gh;bh=1;const e=R,t=M,r=W,n=ee,s=zp(),i=Yp(),o=eh(),a=Mp(),u=nh(),c=oh(),l=Zp(),f=(lh||(lh=1,function(e){const t=R,r=Yp(),n=Wp(),s={};e.Ids=s.Ids=class{constructor(){this._byId=new Map,this._byKey=new Map,this._schemaChain=!1}clone(){const e=new s.Ids;return e._byId=new Map(this._byId),e._byKey=new Map(this._byKey),e._schemaChain=this._schemaChain,e}concat(e){e._schemaChain&&(this._schemaChain=!0);for(const[r,n]of e._byId.entries())t(!this._byKey.has(r),"Schema id conflicts with existing key:",r),this._byId.set(r,n);for(const[r,n]of e._byKey.entries())t(!this._byId.has(r),"Schema key conflicts with existing id:",r),this._byKey.set(r,n)}fork(e,n,i){const o=this._collect(e);o.push({schema:i});const a=o.shift();let u={id:a.id,schema:n(a.schema)};t(r.isSchema(u.schema),"adjuster function failed to return a joi schema type");for(const e of o)u={id:e.id,schema:s.fork(e.schema,u.id,u.schema)};return u.schema}labels(e,t=[]){const r=e[0],n=this._get(r);if(!n)return[...t,...e].join(".");const s=e.slice(1);return t=[...t,n.schema._flags.label||r],s.length?n.schema._ids.labels(s,t):t.join(".")}reach(e,r=[]){const n=e[0],s=this._get(n);t(s,"Schema does not contain path",[...r,...e].join("."));const i=e.slice(1);return i.length?s.schema._ids.reach(i,[...r,n]):s.schema}register(e,{key:n}={}){if(!e||!r.isSchema(e))return;(e.$_property("schemaChain")||e._ids._schemaChain)&&(this._schemaChain=!0);const s=e._flags.id;if(s){const r=this._byId.get(s);t(!r||r.schema===e,"Cannot add different schemas with the same id:",s),t(!this._byKey.has(s),"Schema id conflicts with existing key:",s),this._byId.set(s,{schema:e,id:s})}n&&(t(!this._byKey.has(n),"Schema already contains key:",n),t(!this._byId.has(n),"Schema key conflicts with existing id:",n),this._byKey.set(n,{schema:e,id:n}))}reset(){this._byId=new Map,this._byKey=new Map,this._schemaChain=!1}_collect(e,r=[],n=[]){const s=e[0],i=this._get(s);t(i,"Schema does not contain path",[...r,...e].join(".")),n=[i,...n];const o=e.slice(1);return o.length?i.schema._ids._collect(o,[...r,s],n):n}_get(e){return this._byId.get(e)||this._byKey.get(e)}},s.fork=function(t,r,n){const s=e.schema(t,{each:(e,{key:t})=>{if(r===(e._flags.id||t))return n},ref:!1});return s?s.$_mutateRebuild():t},e.schema=function(e,t){let r;for(const n in e._flags){if("_"===n[0])continue;const i=s.scan(e._flags[n],{source:"flags",name:n},t);void 0!==i&&(r=r||e.clone(),r._flags[n]=i)}for(let n=0;n<e._rules.length;++n){const i=e._rules[n],o=s.scan(i.args,{source:"rules",name:i.name},t);if(void 0!==o){r=r||e.clone();const t=Object.assign({},i);t.args=o,r._rules[n]=t,r._singleRules.get(i.name)===i&&r._singleRules.set(i.name,t)}}for(const n in e.$_terms){if("_"===n[0])continue;const i=s.scan(e.$_terms[n],{source:"terms",name:n},t);void 0!==i&&(r=r||e.clone(),r.$_terms[n]=i)}return r},s.scan=function(e,t,i,o,a){const u=o||[];if(null===e||"object"!=typeof e)return;let c;if(Array.isArray(e)){for(let r=0;r<e.length;++r){const n="terms"===t.source&&"keys"===t.name&&e[r].key,o=s.scan(e[r],t,i,[r,...u],n);void 0!==o&&(c=c||e.slice(),c[r]=o)}return c}if(!1!==i.schema&&r.isSchema(e)||!1!==i.ref&&n.isRef(e)){const r=i.each(e,{...t,path:u,key:a});if(r===e)return;return r}for(const r in e){if("_"===r[0])continue;const n=s.scan(e[r],t,i,[r,...u],a);void 0!==n&&(c=c||Object.assign({},e),c[r]=n)}return c}}(fh)),fh),p=Wp(),h=ch(),d=qh(),m=Zh(),y={Base:class{constructor(e){this.type=e,this.$_root=null,this._definition={},this._reset()}_reset(){this._ids=new f.Ids,this._preferences=null,this._refs=new p.Manager,this._cache=null,this._valids=null,this._invalids=null,this._flags={},this._rules=[],this._singleRules=new Map,this.$_terms={},this.$_temp={ruleset:null,whens:{}}}describe(){return e("function"==typeof c.describe,"Manifest functionality disabled"),c.describe(this)}allow(...e){return i.verifyFlat(e,"allow"),this._values(e,"_valids")}alter(t){e(t&&"object"==typeof t&&!Array.isArray(t),"Invalid targets argument"),e(!this._inRuleset(),"Cannot set alterations inside a ruleset");const r=this.clone();r.$_terms.alterations=r.$_terms.alterations||[];for(const n in t){const s=t[n];e("function"==typeof s,"Alteration adjuster for",n,"must be a function"),r.$_terms.alterations.push({target:n,adjuster:s})}return r.$_temp.ruleset=!1,r}artifact(t){return e(void 0!==t,"Artifact cannot be undefined"),e(!this._cache,"Cannot set an artifact with a rule cache"),this.$_setFlag("artifact",t)}cast(t){return e(!1===t||"string"==typeof t,"Invalid to value"),e(!1===t||this._definition.cast[t],"Type",this.type,"does not support casting to",t),this.$_setFlag("cast",!1===t?void 0:t)}default(e,t){return this._default("default",e,t)}description(t){return e(t&&"string"==typeof t,"Description must be a non-empty string"),this.$_setFlag("description",t)}empty(e){const t=this.clone();return void 0!==e&&(e=t.$_compile(e,{override:!1})),t.$_setFlag("empty",e,{clone:!1})}error(t){return e(t,"Missing error"),e(t instanceof Error||"function"==typeof t,"Must provide a valid Error object or a function"),this.$_setFlag("error",t)}example(t,r={}){return e(void 0!==t,"Missing example"),i.assertOptions(r,["override"]),this._inner("examples",t,{single:!0,override:r.override})}external(t,r){return"object"==typeof t&&(e(!r,"Cannot combine options with description"),r=t.description,t=t.method),e("function"==typeof t,"Method must be a function"),e(void 0===r||r&&"string"==typeof r,"Description must be a non-empty string"),this._inner("externals",{method:t,description:r},{single:!0})}failover(e,t){return this._default("failover",e,t)}forbidden(){return this.presence("forbidden")}id(t){return t?(e("string"==typeof t,"id must be a non-empty string"),e(/^[^\.]+$/.test(t),"id cannot contain period character"),this.$_setFlag("id",t)):this.$_setFlag("id",void 0)}invalid(...e){return this._values(e,"_invalids")}label(t){return e(t&&"string"==typeof t,"Label name must be a non-empty string"),this.$_setFlag("label",t)}meta(t){return e(void 0!==t,"Meta cannot be undefined"),this._inner("metas",t,{single:!0})}note(...t){e(t.length,"Missing notes");for(const r of t)e(r&&"string"==typeof r,"Notes must be non-empty strings");return this._inner("notes",t)}only(t=!0){return e("boolean"==typeof t,"Invalid mode:",t),this.$_setFlag("only",t)}optional(){return this.presence("optional")}prefs(t){e(t,"Missing preferences"),e(void 0===t.context,"Cannot override context"),e(void 0===t.externals,"Cannot override externals"),e(void 0===t.warnings,"Cannot override warnings"),e(void 0===t.debug,"Cannot override debug"),i.checkPreferences(t);const r=this.clone();return r._preferences=i.preferences(r._preferences,t),r}presence(t){return e(["optional","required","forbidden"].includes(t),"Unknown presence mode",t),this.$_setFlag("presence",t)}raw(e=!0){return this.$_setFlag("result",e?"raw":void 0)}result(t){return e(["raw","strip"].includes(t),"Unknown result mode",t),this.$_setFlag("result",t)}required(){return this.presence("required")}strict(e){const t=this.clone(),r=void 0!==e&&!e;return t._preferences=i.preferences(t._preferences,{convert:r}),t}strip(e=!0){return this.$_setFlag("result",e?"strip":void 0)}tag(...t){e(t.length,"Missing tags");for(const r of t)e(r&&"string"==typeof r,"Tags must be non-empty strings");return this._inner("tags",t)}unit(t){return e(t&&"string"==typeof t,"Unit name must be a non-empty string"),this.$_setFlag("unit",t)}valid(...e){i.verifyFlat(e,"valid");const t=this.allow(...e);return t.$_setFlag("only",!!t._valids,{clone:!1}),t}when(t,r){const n=this.clone();n.$_terms.whens||(n.$_terms.whens=[]);const s=o.when(n,t,r);if(!["any","link"].includes(n.type)){const t=s.is?[s]:s.switch;for(const r of t)e(!r.then||"any"===r.then.type||r.then.type===n.type,"Cannot combine",n.type,"with",r.then&&r.then.type),e(!r.otherwise||"any"===r.otherwise.type||r.otherwise.type===n.type,"Cannot combine",n.type,"with",r.otherwise&&r.otherwise.type)}return n.$_terms.whens.push(s),n.$_mutateRebuild()}cache(t){e(!this._inRuleset(),"Cannot set caching inside a ruleset"),e(!this._cache,"Cannot override schema cache"),e(void 0===this._flags.artifact,"Cannot cache a rule with an artifact");const r=this.clone();return r._cache=t||s.provider.provision(),r.$_temp.ruleset=!1,r}clone(){const e=Object.create(Object.getPrototypeOf(this));return this._assign(e)}concat(t){e(i.isSchema(t),"Invalid schema object"),e("any"===this.type||"any"===t.type||t.type===this.type,"Cannot merge type",this.type,"with another type:",t.type),e(!this._inRuleset(),"Cannot concatenate onto a schema with open ruleset"),e(!t._inRuleset(),"Cannot concatenate a schema with open ruleset");let r=this.clone();if("any"===this.type&&"any"!==t.type){const e=t.clone();for(const t of Object.keys(r))"type"!==t&&(e[t]=r[t]);r=e}r._ids.concat(t._ids),r._refs.register(t,p.toSibling),r._preferences=r._preferences?i.preferences(r._preferences,t._preferences):t._preferences,r._valids=m.merge(r._valids,t._valids,t._invalids),r._invalids=m.merge(r._invalids,t._invalids,t._valids);for(const e of t._singleRules.keys())r._singleRules.has(e)&&(r._rules=r._rules.filter((t=>t.keep||t.name!==e)),r._singleRules.delete(e));for(const e of t._rules)t._definition.rules[e.method].multi||r._singleRules.set(e.name,e),r._rules.push(e);if(r._flags.empty&&t._flags.empty){r._flags.empty=r._flags.empty.concat(t._flags.empty);const e=Object.assign({},t._flags);delete e.empty,n(r._flags,e)}else if(t._flags.empty){r._flags.empty=t._flags.empty;const e=Object.assign({},t._flags);delete e.empty,n(r._flags,e)}else n(r._flags,t._flags);for(const e in t.$_terms){const n=t.$_terms[e];n?r.$_terms[e]?r.$_terms[e]=r.$_terms[e].concat(n):r.$_terms[e]=n.slice():r.$_terms[e]||(r.$_terms[e]=n)}return this.$_root._tracer&&this.$_root._tracer._combine(r,[this,t]),r.$_mutateRebuild()}extend(t){return e(!t.base,"Cannot extend type with another base"),u.type(this,t)}extract(e){return e=Array.isArray(e)?e:e.split("."),this._ids.reach(e)}fork(t,r){e(!this._inRuleset(),"Cannot fork inside a ruleset");let n=this;for(let e of[].concat(t))e=Array.isArray(e)?e:e.split("."),n=n._ids.fork(e,r,n);return n.$_temp.ruleset=!1,n}rule(r){const n=this._definition;i.assertOptions(r,Object.keys(n.modifiers)),e(!1!==this.$_temp.ruleset,"Cannot apply rules to empty ruleset or the last rule added does not support rule properties");const s=null===this.$_temp.ruleset?this._rules.length-1:this.$_temp.ruleset;e(s>=0&&s<this._rules.length,"Cannot apply rules to empty ruleset");const o=this.clone();for(let i=s;i<o._rules.length;++i){const s=o._rules[i],a=t(s);for(const t in r)n.modifiers[t](a,r[t]),e(a.name===s.name,"Cannot change rule name");o._rules[i]=a,o._singleRules.get(a.name)===s&&o._singleRules.set(a.name,a)}return o.$_temp.ruleset=!1,o.$_mutateRebuild()}get ruleset(){e(!this._inRuleset(),"Cannot start a new ruleset without closing the previous one");const t=this.clone();return t.$_temp.ruleset=t._rules.length,t}get $(){return this.ruleset}tailor(t){t=[].concat(t),e(!this._inRuleset(),"Cannot tailor inside a ruleset");let r=this;if(this.$_terms.alterations)for(const{target:n,adjuster:s}of this.$_terms.alterations)t.includes(n)&&(r=s(r),e(i.isSchema(r),"Alteration adjuster for",n,"failed to return a schema object"));return r=r.$_modify({each:e=>e.tailor(t),ref:!1}),r.$_temp.ruleset=!1,r.$_mutateRebuild()}tracer(){return h.location?h.location(this):this}validate(e,t){return d.entry(e,this,t)}validateAsync(e,t){return d.entryAsync(e,this,t)}$_addRule(t){"string"==typeof t&&(t={name:t}),e(t&&"object"==typeof t,"Invalid options"),e(t.name&&"string"==typeof t.name,"Invalid rule name");for(const r in t)e("_"!==r[0],"Cannot set private rule properties");const r=Object.assign({},t);r._resolve=[],r.method=r.method||r.name;const n=this._definition.rules[r.method],s=r.args;e(n,"Unknown rule",r.method);const o=this.clone();if(s){e(1===Object.keys(s).length||Object.keys(s).length===this._definition.rules[r.name].args.length,"Invalid rule definition for",this.type,r.name);for(const t in s){let a=s[t];if(n.argsByName){const u=n.argsByName.get(t);if(u.ref&&i.isResolvable(a))r._resolve.push(t),o.$_mutateRegister(a);else if(u.normalize&&(a=u.normalize(a),s[t]=a),u.assert){const r=i.validateArg(a,t,u);e(!r,r,"or reference")}}void 0!==a?s[t]=a:delete s[t]}}return n.multi||(o._ruleRemove(r.name,{clone:!1}),o._singleRules.set(r.name,r)),!1===o.$_temp.ruleset&&(o.$_temp.ruleset=null),n.priority?o._rules.unshift(r):o._rules.push(r),o}$_compile(e,t){return o.schema(this.$_root,e,t)}$_createError(e,t,r,n,s,i={}){const o=!1!==i.flags?this._flags:{},u=i.messages?l.merge(this._definition.messages,i.messages):this._definition.messages;return new a.Report(e,t,r,o,u,n,s)}$_getFlag(e){return this._flags[e]}$_getRule(e){return this._singleRules.get(e)}$_mapLabels(e){return e=Array.isArray(e)?e:e.split("."),this._ids.labels(e)}$_match(e,t,r,n){(r=Object.assign({},r)).abortEarly=!0,r._externals=!1,t.snapshot();const s=!d.validate(e,this,t,r,n).errors;return t.restore(),s}$_modify(e){return i.assertOptions(e,["each","once","ref","schema"]),f.schema(this,e)||this}$_mutateRebuild(){e(!this._inRuleset(),"Cannot add this rule inside a ruleset"),this._refs.reset(),this._ids.reset();return this.$_modify({each:(e,{source:t,name:r,path:n,key:s})=>{const i=this._definition[t][r]&&this._definition[t][r].register;!1!==i&&this.$_mutateRegister(e,{family:i,key:s})}}),this._definition.rebuild&&this._definition.rebuild(this),this.$_temp.ruleset=!1,this}$_mutateRegister(e,{family:t,key:r}={}){this._refs.register(e,t),this._ids.register(e,{key:r})}$_property(e){return this._definition.properties[e]}$_reach(e){return this._ids.reach(e)}$_rootReferences(){return this._refs.roots()}$_setFlag(t,n,s={}){e("_"===t[0]||!this._inRuleset(),"Cannot set flag inside a ruleset");const i=this._definition.flags[t]||{};if(r(n,i.default)&&(n=void 0),r(n,this._flags[t]))return this;const o=!1!==s.clone?this.clone():this;return void 0!==n?(o._flags[t]=n,o.$_mutateRegister(n)):delete o._flags[t],"_"!==t[0]&&(o.$_temp.ruleset=!1),o}$_parent(e,...t){return this[e][i.symbols.parent].call(this,...t)}$_validate(e,t,r){return d.validate(e,this,t,r)}_assign(e){e.type=this.type,e.$_root=this.$_root,e.$_temp=Object.assign({},this.$_temp),e.$_temp.whens={},e._ids=this._ids.clone(),e._preferences=this._preferences,e._valids=this._valids&&this._valids.clone(),e._invalids=this._invalids&&this._invalids.clone(),e._rules=this._rules.slice(),e._singleRules=t(this._singleRules,{shallow:!0}),e._refs=this._refs.clone(),e._flags=Object.assign({},this._flags),e._cache=null,e.$_terms={};for(const t in this.$_terms)e.$_terms[t]=this.$_terms[t]?this.$_terms[t].slice():null;e.$_super={};for(const t in this.$_super)e.$_super[t]=this._super[t].bind(e);return e}_bare(){const e=this.clone();e._reset();const t=e._definition.terms;for(const r in t){const n=t[r];e.$_terms[r]=n.init}return e.$_mutateRebuild()}_default(t,r,n={}){i.assertOptions(n,"literal"),e(void 0!==r,"Missing",t,"value"),e("function"==typeof r||!n.literal,"Only function value supports literal option"),"function"==typeof r&&n.literal&&(r={[i.symbols.literal]:!0,literal:r});return this.$_setFlag(t,r)}_generate(e,t,r){if(!this.$_terms.whens)return{schema:this};const n=[],s=[];for(let i=0;i<this.$_terms.whens.length;++i){const o=this.$_terms.whens[i];if(o.concat){n.push(o.concat),s.push(`${i}.concat`);continue}const a=o.ref?o.ref.resolve(e,t,r):e,u=o.is?[o]:o.switch,c=s.length;for(let c=0;c<u.length;++c){const{is:l,then:f,otherwise:p}=u[c],h=`${i}${o.switch?"."+c:""}`;if(l.$_match(a,t.nest(l,`${h}.is`),r)){if(f){const i=t.localize([...t.path,`${h}.then`],t.ancestors,t.schemas),{schema:o,id:a}=f._generate(e,i,r);n.push(o),s.push(`${h}.then${a?`(${a})`:""}`);break}}else if(p){const i=t.localize([...t.path,`${h}.otherwise`],t.ancestors,t.schemas),{schema:o,id:a}=p._generate(e,i,r);n.push(o),s.push(`${h}.otherwise${a?`(${a})`:""}`);break}}if(o.break&&s.length>c)break}const i=s.join(", ");if(t.mainstay.tracer.debug(t,"rule","when",i),!i)return{schema:this};if(!t.mainstay.tracer.active&&this.$_temp.whens[i])return{schema:this.$_temp.whens[i],id:i};let o=this;this._definition.generate&&(o=this._definition.generate(this,e,t,r));for(const e of n)o=o.concat(e);return this.$_root._tracer&&this.$_root._tracer._combine(o,[this,...n]),this.$_temp.whens[i]=o,{schema:o,id:i}}_inner(t,r,n={}){e(!this._inRuleset(),`Cannot set ${t} inside a ruleset`);const s=this.clone();return s.$_terms[t]&&!n.override||(s.$_terms[t]=[]),n.single?s.$_terms[t].push(r):s.$_terms[t].push(...r),s.$_temp.ruleset=!1,s}_inRuleset(){return null!==this.$_temp.ruleset&&!1!==this.$_temp.ruleset}_ruleRemove(e,t={}){if(!this._singleRules.has(e))return this;const r=!1!==t.clone?this.clone():this;r._singleRules.delete(e);const n=[];for(let t=0;t<r._rules.length;++t){const s=r._rules[t];s.name!==e||s.keep?n.push(s):r._inRuleset()&&t<r.$_temp.ruleset&&--r.$_temp.ruleset}return r._rules=n,r}_values(t,r){i.verifyFlat(t,r.slice(1,-1));const n=this.clone(),s=t[0]===i.symbols.override;if(s&&(t=t.slice(1)),!n[r]&&t.length?n[r]=new m:s&&(n[r]=t.length?new m:null,n.$_mutateRebuild()),!n[r])return n;s&&n[r].override();for(const s of t){e(void 0!==s,"Cannot call allow/valid/invalid with undefined"),e(s!==i.symbols.override,"Override must be the first value");const t="_invalids"===r?"_valids":"_invalids";n[t]&&(n[t].remove(s),n[t].length||(e("_valids"===r||!n._flags.only,"Setting invalid value",s,"leaves schema rejecting all values due to previous valid rule"),n[t]=null)),n[r].add(s,n._refs)}return n}}};return y.Base.prototype[i.symbols.any]={version:i.version,compile:o.compile,root:"$_root"},y.Base.prototype.isImmutable=!0,y.Base.prototype.deny=y.Base.prototype.invalid,y.Base.prototype.disallow=y.Base.prototype.invalid,y.Base.prototype.equal=y.Base.prototype.valid,y.Base.prototype.exist=y.Base.prototype.required,y.Base.prototype.not=y.Base.prototype.invalid,y.Base.prototype.options=y.Base.prototype.prefs,y.Base.prototype.preferences=y.Base.prototype.prefs,gh=new y.Base}function zh(){if(_h)return vh;_h=1;const e=R,t=Yh(),r=Yp(),n=Zp();return vh=t.extend({type:"any",flags:{only:{default:!1}},terms:{alterations:{init:null},examples:{init:null},externals:{init:null},metas:{init:[]},notes:{init:[]},shared:{init:null},tags:{init:[]},whens:{init:null}},rules:{custom:{method(t,r){return e("function"==typeof t,"Method must be a function"),e(void 0===r||r&&"string"==typeof r,"Description must be a non-empty string"),this.$_addRule({name:"custom",args:{method:t,description:r}})},validate(e,t,{method:r}){try{return r(e,t)}catch(e){return t.error("any.custom",{error:e})}},args:["method","description"],multi:!0},messages:{method(e){return this.prefs({messages:e})}},shared:{method(t){e(r.isSchema(t)&&t._flags.id,"Schema must be a schema with an id");const n=this.clone();return n.$_terms.shared=n.$_terms.shared||[],n.$_terms.shared.push(t),n.$_mutateRegister(t),n}},warning:{method(t,r){return e(t&&"string"==typeof t,"Invalid warning code"),this.$_addRule({name:"warning",args:{code:t,local:r},warn:!0})},validate:(e,t,{code:r,local:n})=>t.error(r,n),args:["code","local"],multi:!0}},modifiers:{keep(e,t=!0){e.keep=t},message(e,t){e.message=n.compile(t)},warn(e,t=!0){e.warn=t}},manifest:{build(e,t){for(const r in t){const n=t[r];if(["examples","externals","metas","notes","tags"].includes(r))for(const t of n)e=e[r.slice(0,-1)](t);else if("alterations"!==r)if("whens"!==r){if("shared"===r)for(const t of n)e=e.shared(t)}else for(const t of n){const{ref:r,is:n,not:s,then:i,otherwise:o,concat:a}=t;e=a?e.concat(a):r?e.when(r,{is:n,not:s,then:i,otherwise:o,switch:t.switch,break:t.break}):e.when(n,{then:i,otherwise:o,break:t.break})}else{const t={};for(const{target:e,adjuster:r}of n)t[e]=r;e=e.alter(t)}}return e}},messages:{"any.custom":"{{#label}} failed custom validation because {{#error.message}}","any.default":"{{#label}} threw an error when running default method","any.failover":"{{#label}} threw an error when running failover method","any.invalid":"{{#label}} contains an invalid value","any.only":'{{#label}} must be {if(#valids.length == 1, "", "one of ")}{{#valids}}',"any.ref":"{{#label}} {{#arg}} references {{:#ref}} which {{#reason}}","any.required":"{{#label}} is required","any.unknown":"{{#label}} is not allowed"}}),vh}function Jh(){if(Eh)return wh;Eh=1;const e=R,t=ee,r=zh(),n=Yp(),s=eh(),i=Mp(),o=Wp(),a={};return wh=r.extend({type:"alternatives",flags:{match:{default:"any"}},terms:{matches:{init:[],register:o.toSibling}},args:(e,...t)=>1===t.length&&Array.isArray(t[0])?e.try(...t[0]):e.try(...t),validate(e,r){const{schema:n,error:s,state:o,prefs:u}=r;if(n._flags.match){const r=[],a=[];for(let t=0;t<n.$_terms.matches.length;++t){const s=n.$_terms.matches[t],i=o.nest(s.schema,`match.${t}`);i.snapshot();const c=s.schema.$_validate(e,i,u);c.errors?(a.push(c.errors),i.restore()):(r.push(c.value),i.commit())}if(0===r.length){const e={details:a.map((e=>i.details(e,{override:!1})))};return{errors:s("alternatives.any",e)}}if("one"===n._flags.match)return 1===r.length?{value:r[0]}:{errors:s("alternatives.one")};if(r.length!==n.$_terms.matches.length){const e={details:a.map((e=>i.details(e,{override:!1})))};return{errors:s("alternatives.all",e)}}const c=e=>e.$_terms.matches.some((e=>"object"===e.schema.type||"alternatives"===e.schema.type&&c(e.schema)));return c(n)?{value:r.reduce(((e,r)=>t(e,r,{mergeArrays:!1})))}:{value:r[r.length-1]}}const c=[];for(let t=0;t<n.$_terms.matches.length;++t){const r=n.$_terms.matches[t];if(r.schema){const n=o.nest(r.schema,`match.${t}`);n.snapshot();const s=r.schema.$_validate(e,n,u);if(!s.errors)return n.commit(),s;n.restore(),c.push({schema:r.schema,reports:s.errors});continue}const s=r.ref?r.ref.resolve(e,o,u):e,i=r.is?[r]:r.switch;for(let n=0;n<i.length;++n){const a=i[n],{is:c,then:l,otherwise:f}=a,p=`match.${t}${r.switch?"."+n:""}`;if(c.$_match(s,o.nest(c,`${p}.is`),u)){if(l)return l.$_validate(e,o.nest(l,`${p}.then`),u)}else if(f)return f.$_validate(e,o.nest(f,`${p}.otherwise`),u)}}return a.errors(c,r)},rules:{conditional:{method(t,r){e(!this._flags._endedSwitch,"Unreachable condition"),e(!this._flags.match,"Cannot combine match mode",this._flags.match,"with conditional rule"),e(void 0===r.break,"Cannot use break option with alternatives conditional");const n=this.clone(),i=s.when(n,t,r),o=i.is?[i]:i.switch;for(const e of o)if(e.then&&e.otherwise){n.$_setFlag("_endedSwitch",!0,{clone:!1});break}return n.$_terms.matches.push(i),n.$_mutateRebuild()}},match:{method(t){if(e(["any","one","all"].includes(t),"Invalid alternatives match mode",t),"any"!==t)for(const r of this.$_terms.matches)e(r.schema,"Cannot combine match mode",t,"with conditional rules");return this.$_setFlag("match",t)}},try:{method(...t){e(t.length,"Missing alternative schemas"),n.verifyFlat(t,"try"),e(!this._flags._endedSwitch,"Unreachable condition");const r=this.clone();for(const e of t)r.$_terms.matches.push({schema:r.$_compile(e)});return r.$_mutateRebuild()}}},overrides:{label(e){return this.$_parent("label",e).$_modify({each:(t,r)=>"is"!==r.path[0]&&"string"!=typeof t._flags.label?t.label(e):void 0,ref:!1})}},rebuild(e){e.$_modify({each:t=>{n.isSchema(t)&&"array"===t.type&&e.$_setFlag("_arrayItems",!0,{clone:!1})}})},manifest:{build(e,t){if(t.matches)for(const r of t.matches){const{schema:t,ref:n,is:s,not:i,then:o,otherwise:a}=r;e=t?e.try(t):n?e.conditional(n,{is:s,then:o,not:i,otherwise:a,switch:r.switch}):e.conditional(s,{then:o,otherwise:a})}return e}},messages:{"alternatives.all":"{{#label}} does not match all of the required types","alternatives.any":"{{#label}} does not match any of the allowed types","alternatives.match":"{{#label}} does not match any of the allowed types","alternatives.one":"{{#label}} matches more than one allowed type","alternatives.types":"{{#label}} must be one of {{#types}}"}}),a.errors=function(e,{error:t,state:r}){if(!e.length)return{errors:t("alternatives.any")};if(1===e.length)return{errors:e[0].reports};const n=new Set,s=[];for(const{reports:o,schema:u}of e){if(o.length>1)return a.unmatched(e,t);const c=o[0];if(c instanceof i.Report==!1)return a.unmatched(e,t);if(c.state.path.length!==r.path.length){s.push({type:u.type,report:c});continue}if("any.only"===c.code){for(const e of c.local.valids)n.add(e);continue}const[l,f]=c.code.split(".");"base"===f?n.add(l):s.push({type:u.type,report:c})}return s.length?1===s.length?{errors:s[0].report}:a.unmatched(e,t):{errors:t("alternatives.types",{types:[...n]})}},a.unmatched=function(e,t){const r=[];for(const t of e)r.push(...t.reports);return{errors:t("alternatives.match",i.details(r,{override:!1}))}},wh}function Qh(){if(Ah)return Sh;Ah=1;const e=R,t=W,r=x,n=zh(),s=Yp(),i=eh(),o={};return Sh=n.extend({type:"array",flags:{single:{default:!1},sparse:{default:!1}},terms:{items:{init:[],manifest:"schema"},ordered:{init:[],manifest:"schema"},_exclusions:{init:[]},_inclusions:{init:[]},_requireds:{init:[]}},coerce:{from:"object",method(e,{schema:t,state:r,prefs:n}){if(!Array.isArray(e))return;const s=t.$_getRule("sort");return s?o.sort(t,e,s.args.options,r,n):void 0}},validate(e,{schema:t,error:r}){if(!Array.isArray(e)){if(t._flags.single){const t=[e];return t[s.symbols.arraySingle]=!0,{value:t}}return{errors:r("array.base")}}if(t.$_getRule("items")||t.$_terms.externals)return{value:e.slice()}},rules:{has:{method(e){e=this.$_compile(e,{appendPath:!0});const t=this.$_addRule({name:"has",args:{schema:e}});return t.$_mutateRegister(e),t},validate(e,{state:t,prefs:r,error:n},{schema:s}){const i=[e,...t.ancestors];for(let n=0;n<e.length;++n){const o=t.localize([...t.path,n],i,s);if(s.$_match(e[n],o,r))return e}const o=s._flags.label;return o?n("array.hasKnown",{patternLabel:o}):n("array.hasUnknown",null)},multi:!0},items:{method(...e){s.verifyFlat(e,"items");const t=this.$_addRule("items");for(let r=0;r<e.length;++r){const n=s.tryWithPath((()=>this.$_compile(e[r])),r,{append:!0});t.$_terms.items.push(n)}return t.$_mutateRebuild()},validate(e,{schema:t,error:r,state:n,prefs:i,errorsArray:a}){const u=t.$_terms._requireds.slice(),c=t.$_terms.ordered.slice(),l=[...t.$_terms._inclusions,...u],f=!e[s.symbols.arraySingle];delete e[s.symbols.arraySingle];const p=a();let h=e.length;for(let s=0;s<h;++s){const a=e[s];let d=!1,m=!1;const y=f?s:new Number(s),g=[...n.path,y];if(!t._flags.sparse&&void 0===a){if(p.push(r("array.sparse",{key:y,path:g,pos:s,value:void 0},n.localize(g))),i.abortEarly)return p;c.shift();continue}const b=[e,...n.ancestors];for(const e of t.$_terms._exclusions)if(e.$_match(a,n.localize(g,b,e),i,{presence:"ignore"})){if(p.push(r("array.excludes",{pos:s,value:a},n.localize(g))),i.abortEarly)return p;d=!0,c.shift();break}if(d)continue;if(t.$_terms.ordered.length){if(c.length){const u=c.shift(),l=u.$_validate(a,n.localize(g,b,u),i);if(l.errors){if(p.push(...l.errors),i.abortEarly)return p}else if("strip"===u._flags.result)o.fastSplice(e,s),--s,--h;else{if(!t._flags.sparse&&void 0===l.value){if(p.push(r("array.sparse",{key:y,path:g,pos:s,value:void 0},n.localize(g))),i.abortEarly)return p;continue}e[s]=l.value}continue}if(!t.$_terms.items.length){if(p.push(r("array.orderedLength",{pos:s,limit:t.$_terms.ordered.length})),i.abortEarly)return p;break}}const v=[];let _=u.length;for(let c=0;c<_;++c){const l=n.localize(g,b,u[c]);l.snapshot();const f=u[c].$_validate(a,l,i);if(v[c]=f,!f.errors){if(l.commit(),e[s]=f.value,m=!0,o.fastSplice(u,c),--c,--_,!t._flags.sparse&&void 0===f.value&&(p.push(r("array.sparse",{key:y,path:g,pos:s,value:void 0},n.localize(g))),i.abortEarly))return p;break}l.restore()}if(m)continue;const w=i.stripUnknown&&!!i.stripUnknown.arrays||!1;_=l.length;for(const c of l){let l;const f=u.indexOf(c);if(-1!==f)l=v[f];else{const u=n.localize(g,b,c);if(u.snapshot(),l=c.$_validate(a,u,i),!l.errors){u.commit(),"strip"===c._flags.result?(o.fastSplice(e,s),--s,--h):t._flags.sparse||void 0!==l.value?e[s]=l.value:(p.push(r("array.sparse",{key:y,path:g,pos:s,value:void 0},n.localize(g))),d=!0),m=!0;break}u.restore()}if(1===_){if(w){o.fastSplice(e,s),--s,--h,m=!0;break}if(p.push(...l.errors),i.abortEarly)return p;d=!0;break}}if(!d&&((t.$_terms._inclusions.length||t.$_terms._requireds.length)&&!m)){if(w){o.fastSplice(e,s),--s,--h;continue}if(p.push(r("array.includes",{pos:s,value:a},n.localize(g))),i.abortEarly)return p}}return u.length&&o.fillMissedErrors(t,p,u,e,n,i),c.length&&(o.fillOrderedErrors(t,p,c,e,n,i),p.length||o.fillDefault(c,e,n,i)),p.length?p:e},priority:!0,manifest:!1},length:{method(e){return this.$_addRule({name:"length",args:{limit:e},operator:"="})},validate:(e,t,{limit:r},{name:n,operator:i,args:o})=>s.compare(e.length,r,i)?e:t.error("array."+n,{limit:o.limit,value:e}),args:[{name:"limit",ref:!0,assert:s.limit,message:"must be a positive integer"}]},max:{method(e){return this.$_addRule({name:"max",method:"length",args:{limit:e},operator:"<="})}},min:{method(e){return this.$_addRule({name:"min",method:"length",args:{limit:e},operator:">="})}},ordered:{method(...e){s.verifyFlat(e,"ordered");const t=this.$_addRule("items");for(let r=0;r<e.length;++r){const n=s.tryWithPath((()=>this.$_compile(e[r])),r,{append:!0});o.validateSingle(n,t),t.$_mutateRegister(n),t.$_terms.ordered.push(n)}return t.$_mutateRebuild()}},single:{method(t){const r=void 0===t||!!t;return e(!r||!this._flags._arrayItems,"Cannot specify single rule when array has array items"),this.$_setFlag("single",r)}},sort:{method(t={}){s.assertOptions(t,["by","order"]);const r={order:t.order||"ascending"};return t.by&&(r.by=i.ref(t.by,{ancestor:0}),e(!r.by.ancestor,"Cannot sort by ancestor")),this.$_addRule({name:"sort",args:{options:r}})},validate(e,{error:t,state:r,prefs:n,schema:s},{options:i}){const{value:a,errors:u}=o.sort(s,e,i,r,n);if(u)return u;for(let r=0;r<e.length;++r)if(e[r]!==a[r])return t("array.sort",{order:i.order,by:i.by?i.by.key:"value"});return e},convert:!0},sparse:{method(e){const t=void 0===e||!!e;if(this._flags.sparse===t)return this;return(t?this.clone():this.$_addRule("items")).$_setFlag("sparse",t,{clone:!1})}},unique:{method(t,r={}){e(!t||"function"==typeof t||"string"==typeof t,"comparator must be a function or a string"),s.assertOptions(r,["ignoreUndefined","separator"]);const n={name:"unique",args:{options:r,comparator:t}};if(t)if("string"==typeof t){const e=s.default(r.separator,".");n.path=e?t.split(e):[t]}else n.comparator=t;return this.$_addRule(n)},validate(n,{state:s,error:i,schema:o},{comparator:a,options:u},{comparator:c,path:l}){const f={string:Object.create(null),number:Object.create(null),undefined:Object.create(null),boolean:Object.create(null),bigint:Object.create(null),object:new Map,function:new Map,custom:new Map},p=c||t,h=u.ignoreUndefined;for(let t=0;t<n.length;++t){const o=l?r(n[t],l):n[t],u=c?f.custom:f[typeof o];if(e(u,"Failed to find unique map container for type",typeof o),u instanceof Map){const e=u.entries();let r;for(;!(r=e.next()).done;)if(p(r.value[0],o)){const e=s.localize([...s.path,t],[n,...s.ancestors]),o={pos:t,value:n[t],dupePos:r.value[1],dupeValue:n[r.value[1]]};return l&&(o.path=a),i("array.unique",o,e)}u.set(o,t)}else{if((!h||void 0!==o)&&void 0!==u[o]){const e={pos:t,value:n[t],dupePos:u[o],dupeValue:n[u[o]]};l&&(e.path=a);return i("array.unique",e,s.localize([...s.path,t],[n,...s.ancestors]))}u[o]=t}}return n},args:["comparator","options"],multi:!0}},cast:{set:{from:Array.isArray,to:(e,t)=>new Set(e)}},rebuild(e){e.$_terms._inclusions=[],e.$_terms._exclusions=[],e.$_terms._requireds=[];for(const t of e.$_terms.items)o.validateSingle(t,e),"required"===t._flags.presence?e.$_terms._requireds.push(t):"forbidden"===t._flags.presence?e.$_terms._exclusions.push(t):e.$_terms._inclusions.push(t);for(const t of e.$_terms.ordered)o.validateSingle(t,e)},manifest:{build:(e,t)=>(t.items&&(e=e.items(...t.items)),t.ordered&&(e=e.ordered(...t.ordered)),e)},messages:{"array.base":"{{#label}} must be an array","array.excludes":"{{#label}} contains an excluded value","array.hasKnown":"{{#label}} does not contain at least one required match for type {:#patternLabel}","array.hasUnknown":"{{#label}} does not contain at least one required match","array.includes":"{{#label}} does not match any of the allowed types","array.includesRequiredBoth":"{{#label}} does not contain {{#knownMisses}} and {{#unknownMisses}} other required value(s)","array.includesRequiredKnowns":"{{#label}} does not contain {{#knownMisses}}","array.includesRequiredUnknowns":"{{#label}} does not contain {{#unknownMisses}} required value(s)","array.length":"{{#label}} must contain {{#limit}} items","array.max":"{{#label}} must contain less than or equal to {{#limit}} items","array.min":"{{#label}} must contain at least {{#limit}} items","array.orderedLength":"{{#label}} must contain at most {{#limit}} items","array.sort":"{{#label}} must be sorted in {#order} order by {{#by}}","array.sort.mismatching":"{{#label}} cannot be sorted due to mismatching types","array.sort.unsupported":"{{#label}} cannot be sorted due to unsupported type {#type}","array.sparse":"{{#label}} must not be a sparse array item","array.unique":"{{#label}} contains a duplicate value"}}),o.fillMissedErrors=function(e,t,r,n,s,i){const o=[];let a=0;for(const e of r){const t=e._flags.label;t?o.push(t):++a}o.length?a?t.push(e.$_createError("array.includesRequiredBoth",n,{knownMisses:o,unknownMisses:a},s,i)):t.push(e.$_createError("array.includesRequiredKnowns",n,{knownMisses:o},s,i)):t.push(e.$_createError("array.includesRequiredUnknowns",n,{unknownMisses:a},s,i))},o.fillOrderedErrors=function(e,t,r,n,s,i){const a=[];for(const e of r)"required"===e._flags.presence&&a.push(e);a.length&&o.fillMissedErrors(e,t,a,n,s,i)},o.fillDefault=function(e,t,r,n){const s=[];let i=!0;for(let o=e.length-1;o>=0;--o){const a=e[o],u=[t,...r.ancestors],c=a.$_validate(void 0,r.localize(r.path,u,a),n).value;if(i){if(void 0===c)continue;i=!1}s.unshift(c)}s.length&&t.push(...s)},o.fastSplice=function(e,t){let r=t;for(;r<e.length;)e[r++]=e[r];--e.length},o.validateSingle=function(t,r){("array"===t.type||t._flags._arrayItems)&&(e(!r._flags.single,"Cannot specify array item with single rule enabled"),r.$_setFlag("_arrayItems",!0,{clone:!1}))},o.sort=function(e,t,r,n,s){const i="ascending"===r.order?1:-1,a=-1*i,u=i,c=(c,l)=>{let f=o.compare(c,l,a,u);if(null!==f)return f;if(r.by&&(c=r.by.resolve(c,n,s),l=r.by.resolve(l,n,s)),f=o.compare(c,l,a,u),null!==f)return f;const p=typeof c;if(p!==typeof l)throw e.$_createError("array.sort.mismatching",t,null,n,s);if("number"!==p&&"string"!==p)throw e.$_createError("array.sort.unsupported",t,{type:p},n,s);return"number"===p?(c-l)*i:c<l?a:u};try{return{value:t.slice().sort(c)}}catch(e){return{errors:e}}},o.compare=function(e,t,r,n){return e===t?0:void 0===e?1:void 0===t?-1:null===e?n:null===t?r:null},Sh}function ed(){if(Ih)return Th;Ih=1;const e=R,t=zh(),r=Yp(),n=Zh(),s={isBool:function(e){return"boolean"==typeof e}};return Th=t.extend({type:"boolean",flags:{sensitive:{default:!1}},terms:{falsy:{init:null,manifest:"values"},truthy:{init:null,manifest:"values"}},coerce(e,{schema:t}){if("boolean"!=typeof e){if("string"==typeof e){const r=t._flags.sensitive?e:e.toLowerCase();e="true"===r||"false"!==r&&e}return"boolean"!=typeof e&&(e=t.$_terms.truthy&&t.$_terms.truthy.has(e,null,null,!t._flags.sensitive)||(!t.$_terms.falsy||!t.$_terms.falsy.has(e,null,null,!t._flags.sensitive))&&e),{value:e}}},validate(e,{error:t}){if("boolean"!=typeof e)return{value:e,errors:t("boolean.base")}},rules:{truthy:{method(...t){r.verifyFlat(t,"truthy");const s=this.clone();s.$_terms.truthy=s.$_terms.truthy||new n;for(let r=0;r<t.length;++r){const n=t[r];e(void 0!==n,"Cannot call truthy with undefined"),s.$_terms.truthy.add(n)}return s}},falsy:{method(...t){r.verifyFlat(t,"falsy");const s=this.clone();s.$_terms.falsy=s.$_terms.falsy||new n;for(let r=0;r<t.length;++r){const n=t[r];e(void 0!==n,"Cannot call falsy with undefined"),s.$_terms.falsy.add(n)}return s}},sensitive:{method(e=!0){return this.$_setFlag("sensitive",e)}}},cast:{number:{from:s.isBool,to:(e,t)=>e?1:0},string:{from:s.isBool,to:(e,t)=>e?"true":"false"}},manifest:{build:(e,t)=>(t.truthy&&(e=e.truthy(...t.truthy)),t.falsy&&(e=e.falsy(...t.falsy)),e)},messages:{"boolean.base":"{{#label}} must be a boolean"}}),Th}function td(){if(kh)return Oh;kh=1;const e=R,t=zh(),r=Yp(),n=qp(),s={isDate:function(e){return e instanceof Date}};return Oh=t.extend({type:"date",coerce:{from:["number","string"],method:(e,{schema:t})=>({value:s.parse(e,t._flags.format)||e})},validate(e,{schema:t,error:r,prefs:n}){if(e instanceof Date&&!isNaN(e.getTime()))return;const s=t._flags.format;return n.convert&&s&&"string"==typeof e?{value:e,errors:r("date.format",{format:s})}:{value:e,errors:r("date.base")}},rules:{compare:{method:!1,validate(e,t,{date:n},{name:s,operator:i,args:o}){const a="now"===n?Date.now():n.getTime();return r.compare(e.getTime(),a,i)?e:t.error("date."+s,{limit:o.date,value:e})},args:[{name:"date",ref:!0,normalize:e=>"now"===e?e:s.parse(e),assert:e=>null!==e,message:"must have a valid date format"}]},format:{method(t){return e(["iso","javascript","unix"].includes(t),"Unknown date format",t),this.$_setFlag("format",t)}},greater:{method(e){return this.$_addRule({name:"greater",method:"compare",args:{date:e},operator:">"})}},iso:{method(){return this.format("iso")}},less:{method(e){return this.$_addRule({name:"less",method:"compare",args:{date:e},operator:"<"})}},max:{method(e){return this.$_addRule({name:"max",method:"compare",args:{date:e},operator:"<="})}},min:{method(e){return this.$_addRule({name:"min",method:"compare",args:{date:e},operator:">="})}},timestamp:{method(t="javascript"){return e(["javascript","unix"].includes(t),'"type" must be one of "javascript, unix"'),this.format(t)}}},cast:{number:{from:s.isDate,to:(e,t)=>e.getTime()},string:{from:s.isDate,to:(e,{prefs:t})=>n.date(e,t)}},messages:{"date.base":"{{#label}} must be a valid date","date.format":'{{#label}} must be in {msg("date.format." + #format) || #format} format',"date.greater":"{{#label}} must be greater than {{:#limit}}","date.less":"{{#label}} must be less than {{:#limit}}","date.max":"{{#label}} must be less than or equal to {{:#limit}}","date.min":"{{#label}} must be greater than or equal to {{:#limit}}","date.format.iso":"ISO 8601 date","date.format.javascript":"timestamp or number of milliseconds","date.format.unix":"timestamp or number of seconds"}}),s.parse=function(e,t){if(e instanceof Date)return e;if("string"!=typeof e&&(isNaN(e)||!isFinite(e)))return null;if(/^\s*$/.test(e))return null;if("iso"===t)return r.isIsoDate(e)?s.date(e.toString()):null;const n=e;if("string"==typeof e&&/^[+-]?\d+(\.\d+)?$/.test(e)&&(e=parseFloat(e)),t){if("javascript"===t)return s.date(1*e);if("unix"===t)return s.date(1e3*e);if("string"==typeof n)return null}return s.date(e)},s.date=function(e){const t=new Date(e);return isNaN(t.getTime())?null:t},Oh}function rd(){if(Nh)return Rh;Nh=1;const e=ae,t=R,r=M,n=ue,s=zh(),i=Yp(),o=eh(),a=Mp(),u=Wp(),c=qp(),l={renameDefaults:{alias:!1,multiple:!1,override:!1}};return Rh=s.extend({type:"_keys",properties:{typeof:"object"},flags:{unknown:{default:!1}},terms:{dependencies:{init:null},keys:{init:null,manifest:{mapped:{from:"schema",to:"key"}}},patterns:{init:null},renames:{init:null}},args:(e,t)=>e.keys(t),validate(e,{schema:t,error:r,state:n,prefs:s}){if(!e||typeof e!==t.$_property("typeof")||Array.isArray(e))return{value:e,errors:r("object.base",{type:t.$_property("typeof")})};if(!(t.$_terms.renames||t.$_terms.dependencies||t.$_terms.keys||t.$_terms.patterns||t.$_terms.externals))return;e=l.clone(e,s);const i=[];if(t.$_terms.renames&&!l.rename(t,e,n,s,i))return{value:e,errors:i};if(!t.$_terms.keys&&!t.$_terms.patterns&&!t.$_terms.dependencies)return{value:e,errors:i};const o=new Set(Object.keys(e));if(t.$_terms.keys){const r=[e,...n.ancestors];for(const a of t.$_terms.keys){const t=a.key,u=e[t];o.delete(t);const c=n.localize([...n.path,t],r,a),l=a.schema.$_validate(u,c,s);if(l.errors){if(s.abortEarly)return{value:e,errors:l.errors};void 0!==l.value&&(e[t]=l.value),i.push(...l.errors)}else"strip"===a.schema._flags.result||void 0===l.value&&void 0!==u?delete e[t]:void 0!==l.value&&(e[t]=l.value)}}if(o.size||t._flags._hasPatternMatch){const r=l.unknown(t,e,o,i,n,s);if(r)return r}if(t.$_terms.dependencies)for(const r of t.$_terms.dependencies){if(null!==r.key&&!1===l.isPresent(r.options)(r.key.resolve(e,n,s,null,{shadow:!1})))continue;const o=l.dependencies[r.rel](t,r,e,n,s);if(o){const r=t.$_createError(o.code,e,o.context,n,s);if(s.abortEarly)return{value:e,errors:r};i.push(r)}}return{value:e,errors:i}},rules:{and:{method(...e){return i.verifyFlat(e,"and"),l.dependency(this,"and",null,e)}},append:{method(e){return null==e||0===Object.keys(e).length?this:this.keys(e)}},assert:{method(e,r,n){c.isTemplate(e)||(e=o.ref(e)),t(void 0===n||"string"==typeof n,"Message must be a string"),r=this.$_compile(r,{appendPath:!0});const s=this.$_addRule({name:"assert",args:{subject:e,schema:r,message:n}});return s.$_mutateRegister(e),s.$_mutateRegister(r),s},validate(e,{error:t,prefs:r,state:n},{subject:s,schema:i,message:o}){const a=s.resolve(e,n,r),c=u.isRef(s)?s.absolute(n):[];return i.$_match(a,n.localize(c,[e,...n.ancestors],i),r)?e:t("object.assert",{subject:s,message:o})},args:["subject","schema","message"],multi:!0},instance:{method(e,r){return t("function"==typeof e,"constructor must be a function"),r=r||e.name,this.$_addRule({name:"instance",args:{constructor:e,name:r}})},validate:(e,t,{constructor:r,name:n})=>e instanceof r?e:t.error("object.instance",{type:n,value:e}),args:["constructor","name"]},keys:{method(e){t(void 0===e||"object"==typeof e,"Object schema must be a valid object"),t(!i.isSchema(e),"Object schema cannot be a joi schema");const r=this.clone();if(e)if(Object.keys(e).length){r.$_terms.keys=r.$_terms.keys?r.$_terms.keys.filter((t=>!e.hasOwnProperty(t.key))):new l.Keys;for(const t in e)i.tryWithPath((()=>r.$_terms.keys.push({key:t,schema:this.$_compile(e[t])})),t)}else r.$_terms.keys=new l.Keys;else r.$_terms.keys=null;return r.$_mutateRebuild()}},length:{method(e){return this.$_addRule({name:"length",args:{limit:e},operator:"="})},validate:(e,t,{limit:r},{name:n,operator:s,args:o})=>i.compare(Object.keys(e).length,r,s)?e:t.error("object."+n,{limit:o.limit,value:e}),args:[{name:"limit",ref:!0,assert:i.limit,message:"must be a positive integer"}]},max:{method(e){return this.$_addRule({name:"max",method:"length",args:{limit:e},operator:"<="})}},min:{method(e){return this.$_addRule({name:"min",method:"length",args:{limit:e},operator:">="})}},nand:{method(...e){return i.verifyFlat(e,"nand"),l.dependency(this,"nand",null,e)}},or:{method(...e){return i.verifyFlat(e,"or"),l.dependency(this,"or",null,e)}},oxor:{method(...e){return l.dependency(this,"oxor",null,e)}},pattern:{method(e,r,n={}){const s=e instanceof RegExp;s||(e=this.$_compile(e,{appendPath:!0})),t(void 0!==r,"Invalid rule"),i.assertOptions(n,["fallthrough","matches"]),s&&t(!e.flags.includes("g")&&!e.flags.includes("y"),"pattern should not use global or sticky mode"),r=this.$_compile(r,{appendPath:!0});const o=this.clone();o.$_terms.patterns=o.$_terms.patterns||[];const a={[s?"regex":"schema"]:e,rule:r};return n.matches&&(a.matches=this.$_compile(n.matches),"array"!==a.matches.type&&(a.matches=a.matches.$_root.array().items(a.matches)),o.$_mutateRegister(a.matches),o.$_setFlag("_hasPatternMatch",!0,{clone:!1})),n.fallthrough&&(a.fallthrough=!0),o.$_terms.patterns.push(a),o.$_mutateRegister(r),o}},ref:{method(){return this.$_addRule("ref")},validate:(e,t)=>u.isRef(e)?e:t.error("object.refType",{value:e})},regex:{method(){return this.$_addRule("regex")},validate:(e,t)=>e instanceof RegExp?e:t.error("object.regex",{value:e})},rename:{method(r,n,s={}){t("string"==typeof r||r instanceof RegExp,"Rename missing the from argument"),t("string"==typeof n||n instanceof c,"Invalid rename to argument"),t(n!==r,"Cannot rename key to same name:",r),i.assertOptions(s,["alias","ignoreUndefined","override","multiple"]);const o=this.clone();o.$_terms.renames=o.$_terms.renames||[];for(const e of o.$_terms.renames)t(e.from!==r,"Cannot rename the same key multiple times");return n instanceof c&&o.$_mutateRegister(n),o.$_terms.renames.push({from:r,to:n,options:e(l.renameDefaults,s)}),o}},schema:{method(e="any"){return this.$_addRule({name:"schema",args:{type:e}})},validate:(e,t,{type:r})=>!i.isSchema(e)||"any"!==r&&e.type!==r?t.error("object.schema",{type:r}):e},unknown:{method(e){return this.$_setFlag("unknown",!1!==e)}},with:{method(e,t,r={}){return l.dependency(this,"with",e,t,r)}},without:{method(e,t,r={}){return l.dependency(this,"without",e,t,r)}},xor:{method(...e){return i.verifyFlat(e,"xor"),l.dependency(this,"xor",null,e)}}},overrides:{default(e,t){return void 0===e&&(e=i.symbols.deepDefault),this.$_parent("default",e,t)}},rebuild(e){if(e.$_terms.keys){const t=new n.Sorter;for(const r of e.$_terms.keys)i.tryWithPath((()=>t.add(r,{after:r.schema.$_rootReferences(),group:r.key})),r.key);e.$_terms.keys=new l.Keys(...t.nodes)}},manifest:{build(e,t){if(t.keys&&(e=e.keys(t.keys)),t.dependencies)for(const{rel:r,key:n=null,peers:s,options:i}of t.dependencies)e=l.dependency(e,r,n,s,i);if(t.patterns)for(const{regex:r,schema:n,rule:s,fallthrough:i,matches:o}of t.patterns)e=e.pattern(r||n,s,{fallthrough:i,matches:o});if(t.renames)for(const{from:r,to:n,options:s}of t.renames)e=e.rename(r,n,s);return e}},messages:{"object.and":"{{#label}} contains {{#presentWithLabels}} without its required peers {{#missingWithLabels}}","object.assert":'{{#label}} is invalid because {if(#subject.key, `"` + #subject.key + `" failed to ` + (#message || "pass the assertion test"), #message || "the assertion failed")}',"object.base":"{{#label}} must be of type {{#type}}","object.instance":"{{#label}} must be an instance of {{:#type}}","object.length":'{{#label}} must have {{#limit}} key{if(#limit == 1, "", "s")}',"object.max":'{{#label}} must have less than or equal to {{#limit}} key{if(#limit == 1, "", "s")}',"object.min":'{{#label}} must have at least {{#limit}} key{if(#limit == 1, "", "s")}',"object.missing":"{{#label}} must contain at least one of {{#peersWithLabels}}","object.nand":"{{:#mainWithLabel}} must not exist simultaneously with {{#peersWithLabels}}","object.oxor":"{{#label}} contains a conflict between optional exclusive peers {{#peersWithLabels}}","object.pattern.match":"{{#label}} keys failed to match pattern requirements","object.refType":"{{#label}} must be a Joi reference","object.regex":"{{#label}} must be a RegExp object","object.rename.multiple":"{{#label}} cannot rename {{:#from}} because multiple renames are disabled and another key was already renamed to {{:#to}}","object.rename.override":"{{#label}} cannot rename {{:#from}} because override is disabled and target {{:#to}} exists","object.schema":"{{#label}} must be a Joi schema of {{#type}} type","object.unknown":"{{#label}} is not allowed","object.with":"{{:#mainWithLabel}} missing required peer {{:#peerWithLabel}}","object.without":"{{:#mainWithLabel}} conflict with forbidden peer {{:#peerWithLabel}}","object.xor":"{{#label}} contains a conflict between exclusive peers {{#peersWithLabels}}"}}),l.clone=function(e,t){if("object"==typeof e){if(t.nonEnumerables)return r(e,{shallow:!0});const n=Object.create(Object.getPrototypeOf(e));return Object.assign(n,e),n}const n=function(...t){return e.apply(this,t)};return n.prototype=r(e.prototype),Object.defineProperty(n,"name",{value:e.name,writable:!1}),Object.defineProperty(n,"length",{value:e.length,writable:!1}),Object.assign(n,e),n},l.dependency=function(e,r,n,s,a){t(null===n||"string"==typeof n,r,"key must be a strings"),a||(a=s.length>1&&"object"==typeof s[s.length-1]?s.pop():{}),i.assertOptions(a,["separator","isPresent"]),s=[].concat(s);const u=i.default(a.separator,"."),c=[];for(const e of s)t("string"==typeof e,r,"peers must be strings"),c.push(o.ref(e,{separator:u,ancestor:0,prefix:!1}));null!==n&&(n=o.ref(n,{separator:u,ancestor:0,prefix:!1}));const f=e.clone();return f.$_terms.dependencies=f.$_terms.dependencies||[],f.$_terms.dependencies.push(new l.Dependency(r,n,c,s,a)),f},l.dependencies={and(e,t,r,n,s){const i=[],o=[],a=t.peers.length,u=l.isPresent(t.options);for(const e of t.peers)!1===u(e.resolve(r,n,s,null,{shadow:!1}))?i.push(e.key):o.push(e.key);if(i.length!==a&&o.length!==a)return{code:"object.and",context:{present:o,presentWithLabels:l.keysToLabels(e,o),missing:i,missingWithLabels:l.keysToLabels(e,i)}}},nand(e,t,r,n,s){const i=[],o=l.isPresent(t.options);for(const e of t.peers)o(e.resolve(r,n,s,null,{shadow:!1}))&&i.push(e.key);if(i.length!==t.peers.length)return;const a=t.paths[0],u=t.paths.slice(1);return{code:"object.nand",context:{main:a,mainWithLabel:l.keysToLabels(e,a),peers:u,peersWithLabels:l.keysToLabels(e,u)}}},or(e,t,r,n,s){const i=l.isPresent(t.options);for(const e of t.peers)if(i(e.resolve(r,n,s,null,{shadow:!1})))return;return{code:"object.missing",context:{peers:t.paths,peersWithLabels:l.keysToLabels(e,t.paths)}}},oxor(e,t,r,n,s){const i=[],o=l.isPresent(t.options);for(const e of t.peers)o(e.resolve(r,n,s,null,{shadow:!1}))&&i.push(e.key);if(!i.length||1===i.length)return;const a={peers:t.paths,peersWithLabels:l.keysToLabels(e,t.paths)};return a.present=i,a.presentWithLabels=l.keysToLabels(e,i),{code:"object.oxor",context:a}},with(e,t,r,n,s){const i=l.isPresent(t.options);for(const o of t.peers)if(!1===i(o.resolve(r,n,s,null,{shadow:!1})))return{code:"object.with",context:{main:t.key.key,mainWithLabel:l.keysToLabels(e,t.key.key),peer:o.key,peerWithLabel:l.keysToLabels(e,o.key)}}},without(e,t,r,n,s){const i=l.isPresent(t.options);for(const o of t.peers)if(i(o.resolve(r,n,s,null,{shadow:!1})))return{code:"object.without",context:{main:t.key.key,mainWithLabel:l.keysToLabels(e,t.key.key),peer:o.key,peerWithLabel:l.keysToLabels(e,o.key)}}},xor(e,t,r,n,s){const i=[],o=l.isPresent(t.options);for(const e of t.peers)o(e.resolve(r,n,s,null,{shadow:!1}))&&i.push(e.key);if(1===i.length)return;const a={peers:t.paths,peersWithLabels:l.keysToLabels(e,t.paths)};return 0===i.length?{code:"object.missing",context:a}:(a.present=i,a.presentWithLabels=l.keysToLabels(e,i),{code:"object.xor",context:a})}},l.keysToLabels=function(e,t){return Array.isArray(t)?t.map((t=>e.$_mapLabels(t))):e.$_mapLabels(t)},l.isPresent=function(e){return"function"==typeof e.isPresent?e.isPresent:e=>void 0!==e},l.rename=function(e,t,r,n,s){const i={};for(const o of e.$_terms.renames){const a=[],u="string"!=typeof o.from;if(u)for(const e in t){if(void 0===t[e]&&o.options.ignoreUndefined)continue;if(e===o.to)continue;const r=o.from.exec(e);r&&a.push({from:e,to:o.to,match:r})}else!Object.prototype.hasOwnProperty.call(t,o.from)||void 0===t[o.from]&&o.options.ignoreUndefined||a.push(o);for(const l of a){const a=l.from;let f=l.to;if(f instanceof c&&(f=f.render(t,r,n,l.match)),a!==f){if(!o.options.multiple&&i[f]&&(s.push(e.$_createError("object.rename.multiple",t,{from:a,to:f,pattern:u},r,n)),n.abortEarly))return!1;if(Object.prototype.hasOwnProperty.call(t,f)&&!o.options.override&&!i[f]&&(s.push(e.$_createError("object.rename.override",t,{from:a,to:f,pattern:u},r,n)),n.abortEarly))return!1;void 0===t[a]?delete t[f]:t[f]=t[a],i[f]=!0,o.options.alias||delete t[a]}}}return!0},l.unknown=function(e,t,r,n,s,o){if(e.$_terms.patterns){let i=!1;const u=e.$_terms.patterns.map((e=>{if(e.matches)return i=!0,[]})),c=[t,...s.ancestors];for(const i of r){const a=t[i],l=[...s.path,i];for(let f=0;f<e.$_terms.patterns.length;++f){const p=e.$_terms.patterns[f];if(p.regex){const e=p.regex.test(i);if(s.mainstay.tracer.debug(s,"rule",`pattern.${f}`,e?"pass":"error"),!e)continue}else if(!p.schema.$_match(i,s.nest(p.schema,`pattern.${f}`),o))continue;r.delete(i);const h=s.localize(l,c,{schema:p.rule,key:i}),d=p.rule.$_validate(a,h,o);if(d.errors){if(o.abortEarly)return{value:t,errors:d.errors};n.push(...d.errors)}if(p.matches&&u[f].push(i),t[i]=d.value,!p.fallthrough)break}}if(i)for(let r=0;r<u.length;++r){const i=u[r];if(!i)continue;const l=e.$_terms.patterns[r].matches,f=s.localize(s.path,c,l),p=l.$_validate(i,f,o);if(p.errors){const r=a.details(p.errors,{override:!1});r.matches=i;const u=e.$_createError("object.pattern.match",t,r,s,o);if(o.abortEarly)return{value:t,errors:u};n.push(u)}}}if(!r.size||!e.$_terms.keys&&!e.$_terms.patterns)return;if(o.stripUnknown&&!e._flags.unknown||o.skipFunctions){const e=!!o.stripUnknown&&(!0===o.stripUnknown||!!o.stripUnknown.objects);for(const n of r)e?(delete t[n],r.delete(n)):"function"==typeof t[n]&&r.delete(n)}if(!i.default(e._flags.unknown,o.allowUnknown))for(const i of r){const r=s.localize([...s.path,i],[]),a=e.$_createError("object.unknown",t[i],{child:i},r,o,{flags:!1});if(o.abortEarly)return{value:t,errors:a};n.push(a)}},l.Dependency=class{constructor(e,t,r,n,s){this.rel=e,this.key=t,this.peers=r,this.paths=n,this.options=s}describe(){const e={rel:this.rel,peers:this.paths};return null!==this.key&&(e.key=this.key.key),"."!==this.peers[0].separator&&(e.options={...e.options,separator:this.peers[0].separator}),this.options.isPresent&&(e.options={...e.options,isPresent:this.options.isPresent}),e}},l.Keys=class extends Array{concat(e){const t=this.slice(),r=new Map;for(let e=0;e<t.length;++e)r.set(t[e].key,e);for(const n of e){const e=n.key,s=r.get(e);void 0!==s?t[s]={key:e,schema:t[s].schema.concat(n.schema)}:t.push(n)}return t}},Rh}function nd(){if(xh)return Ph;xh=1;const e=R,t=rd();return Ph=t.extend({type:"function",properties:{typeof:"function"},rules:{arity:{method(t){return e(Number.isSafeInteger(t)&&t>=0,"n must be a positive integer"),this.$_addRule({name:"arity",args:{n:t}})},validate:(e,t,{n:r})=>e.length===r?e:t.error("function.arity",{n:r})},class:{method(){return this.$_addRule("class")},validate:(e,t)=>/^\s*class\s/.test(e.toString())?e:t.error("function.class",{value:e})},minArity:{method(t){return e(Number.isSafeInteger(t)&&t>0,"n must be a strict positive integer"),this.$_addRule({name:"minArity",args:{n:t}})},validate:(e,t,{n:r})=>e.length>=r?e:t.error("function.minArity",{n:r})},maxArity:{method(t){return e(Number.isSafeInteger(t)&&t>=0,"n must be a positive integer"),this.$_addRule({name:"maxArity",args:{n:t}})},validate:(e,t,{n:r})=>e.length<=r?e:t.error("function.maxArity",{n:r})}},messages:{"function.arity":"{{#label}} must have an arity of {{#n}}","function.class":"{{#label}} must be a class","function.maxArity":"{{#label}} must have an arity lesser or equal to {{#n}}","function.minArity":"{{#label}} must have an arity greater or equal to {{#n}}"}}),Ph}function sd(){if(Bh)return Ch;Bh=1;const e=R,t=zh(),r=Yp(),n=eh(),s=Mp(),i={};return Ch=t.extend({type:"link",properties:{schemaChain:!0},terms:{link:{init:null,manifest:"single",register:!1}},args:(e,t)=>e.ref(t),validate(t,{schema:r,state:n,prefs:s}){e(r.$_terms.link,"Uninitialized link schema");const o=i.generate(r,t,n,s),a=r.$_terms.link[0].ref;return o.$_validate(t,n.nest(o,`link:${a.display}:${o.type}`),s)},generate:(e,t,r,n)=>i.generate(e,t,r,n),rules:{ref:{method(t){e(!this.$_terms.link,"Cannot reinitialize schema"),t=n.ref(t),e("value"===t.type||"local"===t.type,"Invalid reference type:",t.type),e("local"===t.type||"root"===t.ancestor||t.ancestor>0,"Link cannot reference itself");const r=this.clone();return r.$_terms.link=[{ref:t}],r}},relative:{method(e=!0){return this.$_setFlag("relative",e)}}},overrides:{concat(t){e(this.$_terms.link,"Uninitialized link schema"),e(r.isSchema(t),"Invalid schema object"),e("link"!==t.type,"Cannot merge type link with another link");const n=this.clone();return n.$_terms.whens||(n.$_terms.whens=[]),n.$_terms.whens.push({concat:t}),n.$_mutateRebuild()}},manifest:{build:(t,r)=>(e(r.link,"Invalid link description missing link"),t.ref(r.link))}}),i.generate=function(e,t,r,n){let s=r.mainstay.links.get(e);if(s)return s._generate(t,r,n).schema;const o=e.$_terms.link[0].ref,{perspective:a,path:u}=i.perspective(o,r);i.assert(a,"which is outside of schema boundaries",o,e,r,n);try{s=u.length?a.$_reach(u):a}catch(t){i.assert(!1,"to non-existing schema",o,e,r,n)}return i.assert("link"!==s.type,"which is another link",o,e,r,n),e._flags.relative||r.mainstay.links.set(e,s),s._generate(t,r,n).schema},i.perspective=function(e,t){if("local"===e.type){for(const{schema:r,key:n}of t.schemas){if((r._flags.id||n)===e.path[0])return{perspective:r,path:e.path.slice(1)};if(r.$_terms.shared)for(const t of r.$_terms.shared)if(t._flags.id===e.path[0])return{perspective:t,path:e.path.slice(1)}}return{perspective:null,path:null}}return"root"===e.ancestor?{perspective:t.schemas[t.schemas.length-1].schema,path:e.path}:{perspective:t.schemas[e.ancestor]&&t.schemas[e.ancestor].schema,path:e.path}},i.assert=function(t,r,n,i,o,a){t||e(!1,`"${s.label(i._flags,o,a)}" contains link reference "${n.display}" ${r}`)},Ch}function id(){if($h)return Lh;$h=1;const e=R,t=zh(),r=Yp(),n={numberRx:/^\s*[+-]?(?:(?:\d+(?:\.\d*)?)|(?:\.\d+))(?:e([+-]?\d+))?\s*$/i,precisionRx:/(?:\.(\d+))?(?:[eE]([+-]?\d+))?$/,exponentialPartRegex:/[eE][+-]?\d+$/,leadingSignAndZerosRegex:/^[+-]?(0*)?/,dotRegex:/\./,trailingZerosRegex:/0+$/,decimalPlaces(e){const t=e.toString(),r=t.indexOf("."),n=t.indexOf("e");return(r<0?0:(n<0?t.length:n)-r-1)+(n<0?0:Math.max(0,-parseInt(t.slice(n+1))))}};return Lh=t.extend({type:"number",flags:{unsafe:{default:!1}},coerce:{from:"string",method(e,{schema:t,error:r}){if(!e.match(n.numberRx))return;e=e.trim();const s={value:parseFloat(e)};if(0===s.value&&(s.value=0),!t._flags.unsafe)if(e.match(/e/i)){if(n.extractSignificantDigits(e)!==n.extractSignificantDigits(String(s.value)))return s.errors=r("number.unsafe"),s}else{const t=s.value.toString();if(t.match(/e/i))return s;if(t!==n.normalizeDecimal(e))return s.errors=r("number.unsafe"),s}return s}},validate(e,{schema:t,error:n,prefs:s}){if(e===1/0||e===-1/0)return{value:e,errors:n("number.infinity")};if(!r.isNumber(e))return{value:e,errors:n("number.base")};const i={value:e};if(s.convert){const e=t.$_getRule("precision");if(e){const t=Math.pow(10,e.args.limit);i.value=Math.round(i.value*t)/t}}return 0===i.value&&(i.value=0),!t._flags.unsafe&&(e>Number.MAX_SAFE_INTEGER||e<Number.MIN_SAFE_INTEGER)&&(i.errors=n("number.unsafe")),i},rules:{compare:{method:!1,validate:(e,t,{limit:n},{name:s,operator:i,args:o})=>r.compare(e,n,i)?e:t.error("number."+s,{limit:o.limit,value:e}),args:[{name:"limit",ref:!0,assert:r.isNumber,message:"must be a number"}]},greater:{method(e){return this.$_addRule({name:"greater",method:"compare",args:{limit:e},operator:">"})}},integer:{method(){return this.$_addRule("integer")},validate:(e,t)=>Math.trunc(e)-e==0?e:t.error("number.integer")},less:{method(e){return this.$_addRule({name:"less",method:"compare",args:{limit:e},operator:"<"})}},max:{method(e){return this.$_addRule({name:"max",method:"compare",args:{limit:e},operator:"<="})}},min:{method(e){return this.$_addRule({name:"min",method:"compare",args:{limit:e},operator:">="})}},multiple:{method(e){const t="number"==typeof e?n.decimalPlaces(e):null,r=Math.pow(10,t);return this.$_addRule({name:"multiple",args:{base:e,baseDecimalPlace:t,pfactor:r}})},validate:(e,t,{base:r,baseDecimalPlace:s,pfactor:i},o)=>n.decimalPlaces(e)>s?t.error("number.multiple",{multiple:o.args.base,value:e}):Math.round(i*e)%Math.round(i*r)==0?e:t.error("number.multiple",{multiple:o.args.base,value:e}),args:[{name:"base",ref:!0,assert:e=>"number"==typeof e&&isFinite(e)&&e>0,message:"must be a positive number"},"baseDecimalPlace","pfactor"],multi:!0},negative:{method(){return this.sign("negative")}},port:{method(){return this.$_addRule("port")},validate:(e,t)=>Number.isSafeInteger(e)&&e>=0&&e<=65535?e:t.error("number.port")},positive:{method(){return this.sign("positive")}},precision:{method(t){return e(Number.isSafeInteger(t),"limit must be an integer"),this.$_addRule({name:"precision",args:{limit:t}})},validate(e,t,{limit:r}){const s=e.toString().match(n.precisionRx);return Math.max((s[1]?s[1].length:0)-(s[2]?parseInt(s[2],10):0),0)<=r?e:t.error("number.precision",{limit:r,value:e})},convert:!0},sign:{method(t){return e(["negative","positive"].includes(t),"Invalid sign",t),this.$_addRule({name:"sign",args:{sign:t}})},validate:(e,t,{sign:r})=>"negative"===r&&e<0||"positive"===r&&e>0?e:t.error(`number.${r}`)},unsafe:{method(t=!0){return e("boolean"==typeof t,"enabled must be a boolean"),this.$_setFlag("unsafe",t)}}},cast:{string:{from:e=>"number"==typeof e,to:(e,t)=>e.toString()}},messages:{"number.base":"{{#label}} must be a number","number.greater":"{{#label}} must be greater than {{#limit}}","number.infinity":"{{#label}} cannot be infinity","number.integer":"{{#label}} must be an integer","number.less":"{{#label}} must be less than {{#limit}}","number.max":"{{#label}} must be less than or equal to {{#limit}}","number.min":"{{#label}} must be greater than or equal to {{#limit}}","number.multiple":"{{#label}} must be a multiple of {{#multiple}}","number.negative":"{{#label}} must be a negative number","number.port":"{{#label}} must be a valid port","number.positive":"{{#label}} must be a positive number","number.precision":"{{#label}} must have no more than {{#limit}} decimal places","number.unsafe":"{{#label}} must be a safe number"}}),n.extractSignificantDigits=function(e){return e.replace(n.exponentialPartRegex,"").replace(n.dotRegex,"").replace(n.trailingZerosRegex,"").replace(n.leadingSignAndZerosRegex,"")},n.normalizeDecimal=function(e){return(e=e.replace(/^\+/,"").replace(/\.0*$/,"").replace(/^(-?)\.([^\.]*)$/,"$10.$2").replace(/^(-?)0+([0-9])/,"$1$2")).includes(".")&&e.endsWith("0")&&(e=e.replace(/0+$/,"")),"-0"===e?"0":e},Lh}function od(){if(Dh)return Uh;Dh=1;const e=rd();return Uh=e.extend({type:"object",cast:{map:{from:e=>e&&"object"==typeof e,to:(e,t)=>new Map(Object.entries(e))}}}),Uh}function ad(){if(Mh)return jh;Mh=1;const e=R,t=pe,r=de,n=be,s=_e,i=Re,o=ve,a=zh(),u=Yp(),c={tlds:i instanceof Set&&{tlds:{allow:i,deny:null}},base64Regex:{true:{true:/^(?:[\w\-]{2}[\w\-]{2})*(?:[\w\-]{2}==|[\w\-]{3}=)?$/,false:/^(?:[A-Za-z0-9+\/]{2}[A-Za-z0-9+\/]{2})*(?:[A-Za-z0-9+\/]{2}==|[A-Za-z0-9+\/]{3}=)?$/},false:{true:/^(?:[\w\-]{2}[\w\-]{2})*(?:[\w\-]{2}(==)?|[\w\-]{3}=?)?$/,false:/^(?:[A-Za-z0-9+\/]{2}[A-Za-z0-9+\/]{2})*(?:[A-Za-z0-9+\/]{2}(==)?|[A-Za-z0-9+\/]{3}=?)?$/}},dataUriRegex:/^data:[\w+.-]+\/[\w+.-]+;((charset=[\w-]+|base64),)?(.*)$/,hexRegex:{withPrefix:/^0x[0-9a-f]+$/i,withOptionalPrefix:/^(?:0x)?[0-9a-f]+$/i,withoutPrefix:/^[0-9a-f]+$/i},ipRegex:n.regex({cidr:"forbidden"}).regex,isoDurationRegex:/^P(?!$)(\d+Y)?(\d+M)?(\d+W)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+S)?)?$/,guidBrackets:{"{":"}","[":"]","(":")","":""},guidVersions:{uuidv1:"1",uuidv2:"2",uuidv3:"3",uuidv4:"4",uuidv5:"5",uuidv6:"6",uuidv7:"7",uuidv8:"8"},guidSeparators:new Set([void 0,!0,!1,"-",":"]),normalizationForms:["NFC","NFD","NFKC","NFKD"]};return jh=a.extend({type:"string",flags:{insensitive:{default:!1},truncate:{default:!1}},terms:{replacements:{init:null}},coerce:{from:"string",method(e,{schema:t,state:r,prefs:n}){const s=t.$_getRule("normalize");s&&(e=e.normalize(s.args.form));const i=t.$_getRule("case");i&&(e="upper"===i.args.direction?e.toLocaleUpperCase():e.toLocaleLowerCase());const o=t.$_getRule("trim");if(o&&o.args.enabled&&(e=e.trim()),t.$_terms.replacements)for(const r of t.$_terms.replacements)e=e.replace(r.pattern,r.replacement);const a=t.$_getRule("hex");if(a&&a.args.options.byteAligned&&e.length%2!=0&&(e=`0${e}`),t.$_getRule("isoDate")){const t=c.isoDate(e);t&&(e=t)}if(t._flags.truncate){const s=t.$_getRule("max");if(s){let i=s.args.limit;if(u.isResolvable(i)&&(i=i.resolve(e,r,n),!u.limit(i)))return{value:e,errors:t.$_createError("any.ref",i,{ref:s.args.limit,arg:"limit",reason:"must be a positive integer"},r,n)};e=e.slice(0,i)}}return{value:e}}},validate(e,{schema:t,error:r}){if("string"!=typeof e)return{value:e,errors:r("string.base")};if(""===e){const n=t.$_getRule("min");if(n&&0===n.args.limit)return;return{value:e,errors:r("string.empty")}}},rules:{alphanum:{method(){return this.$_addRule("alphanum")},validate:(e,t)=>/^[a-zA-Z0-9]+$/.test(e)?e:t.error("string.alphanum")},base64:{method(t={}){return u.assertOptions(t,["paddingRequired","urlSafe"]),t={urlSafe:!1,paddingRequired:!0,...t},e("boolean"==typeof t.paddingRequired,"paddingRequired must be boolean"),e("boolean"==typeof t.urlSafe,"urlSafe must be boolean"),this.$_addRule({name:"base64",args:{options:t}})},validate:(e,t,{options:r})=>c.base64Regex[r.paddingRequired][r.urlSafe].test(e)?e:t.error("string.base64")},case:{method(t){return e(["lower","upper"].includes(t),"Invalid case:",t),this.$_addRule({name:"case",args:{direction:t}})},validate:(e,t,{direction:r})=>"lower"===r&&e===e.toLocaleLowerCase()||"upper"===r&&e===e.toLocaleUpperCase()?e:t.error(`string.${r}case`),convert:!0},creditCard:{method(){return this.$_addRule("creditCard")},validate(e,t){let r=e.length,n=0,s=1;for(;r--;){const t=e.charAt(r)*s;n+=t-9*(t>9),s^=3}return n>0&&n%10==0?e:t.error("string.creditCard")}},dataUri:{method(t={}){return u.assertOptions(t,["paddingRequired"]),t={paddingRequired:!0,...t},e("boolean"==typeof t.paddingRequired,"paddingRequired must be boolean"),this.$_addRule({name:"dataUri",args:{options:t}})},validate(e,t,{options:r}){const n=e.match(c.dataUriRegex);if(n){if(!n[2])return e;if("base64"!==n[2])return e;if(c.base64Regex[r.paddingRequired].false.test(n[3]))return e}return t.error("string.dataUri")}},domain:{method(e){e&&u.assertOptions(e,["allowFullyQualified","allowUnicode","maxDomainSegments","minDomainSegments","tlds"]);const t=c.addressOptions(e);return this.$_addRule({name:"domain",args:{options:e},address:t})},validate:(e,r,n,{address:s})=>t.isValid(e,s)?e:r.error("string.domain")},email:{method(t={}){u.assertOptions(t,["allowFullyQualified","allowUnicode","ignoreLength","maxDomainSegments","minDomainSegments","multiple","separator","tlds"]),e(void 0===t.multiple||"boolean"==typeof t.multiple,"multiple option must be an boolean");const r=c.addressOptions(t),n=new RegExp(`\\s*[${t.separator?s(t.separator):","}]\\s*`);return this.$_addRule({name:"email",args:{options:t},regex:n,address:r})},validate(e,t,{options:n},{regex:s,address:i}){const o=n.multiple?e.split(s):[e],a=[];for(const e of o)r.isValid(e,i)||a.push(e);return a.length?t.error("string.email",{value:e,invalids:a}):e}},guid:{alias:"uuid",method(t={}){u.assertOptions(t,["version","separator"]);let r="";if(t.version){const n=[].concat(t.version);e(n.length>=1,"version must have at least 1 valid version specified");const s=new Set;for(let t=0;t<n.length;++t){const i=n[t];e("string"==typeof i,"version at position "+t+" must be a string");const o=c.guidVersions[i.toLowerCase()];e(o,"version at position "+t+" must be one of "+Object.keys(c.guidVersions).join(", ")),e(!s.has(o),"version at position "+t+" must not be a duplicate"),r+=o,s.add(o)}}e(c.guidSeparators.has(t.separator),'separator must be one of true, false, "-", or ":"');const n=void 0===t.separator?"[:-]?":!0===t.separator?"[:-]":!1===t.separator?"[]?":`\\${t.separator}`,s=new RegExp(`^([\\[{\\(]?)[0-9A-F]{8}(${n})[0-9A-F]{4}\\2?[${r||"0-9A-F"}][0-9A-F]{3}\\2?[${r?"89AB":"0-9A-F"}][0-9A-F]{3}\\2?[0-9A-F]{12}([\\]}\\)]?)$`,"i");return this.$_addRule({name:"guid",args:{options:t},regex:s})},validate(e,t,r,{regex:n}){const s=n.exec(e);return s?c.guidBrackets[s[1]]!==s[s.length-1]?t.error("string.guid"):e:t.error("string.guid")}},hex:{method(t={}){return u.assertOptions(t,["byteAligned","prefix"]),t={byteAligned:!1,prefix:!1,...t},e("boolean"==typeof t.byteAligned,"byteAligned must be boolean"),e("boolean"==typeof t.prefix||"optional"===t.prefix,'prefix must be boolean or "optional"'),this.$_addRule({name:"hex",args:{options:t}})},validate:(e,t,{options:r})=>("optional"===r.prefix?c.hexRegex.withOptionalPrefix:!0===r.prefix?c.hexRegex.withPrefix:c.hexRegex.withoutPrefix).test(e)?r.byteAligned&&e.length%2!=0?t.error("string.hexAlign"):e:t.error("string.hex")},hostname:{method(){return this.$_addRule("hostname")},validate:(e,r)=>t.isValid(e,{minDomainSegments:1})||c.ipRegex.test(e)?e:r.error("string.hostname")},insensitive:{method(){return this.$_setFlag("insensitive",!0)}},ip:{method(e={}){u.assertOptions(e,["cidr","version"]);const{cidr:t,versions:r,regex:s}=n.regex(e),i=e.version?r:void 0;return this.$_addRule({name:"ip",args:{options:{cidr:t,version:i}},regex:s})},validate:(e,t,{options:r},{regex:n})=>n.test(e)?e:r.version?t.error("string.ipVersion",{value:e,cidr:r.cidr,version:r.version}):t.error("string.ip",{value:e,cidr:r.cidr})},isoDate:{method(){return this.$_addRule("isoDate")},validate:(e,{error:t})=>c.isoDate(e)?e:t("string.isoDate")},isoDuration:{method(){return this.$_addRule("isoDuration")},validate:(e,t)=>c.isoDurationRegex.test(e)?e:t.error("string.isoDuration")},length:{method(e,t){return c.length(this,"length",e,"=",t)},validate(e,t,{limit:r,encoding:n},{name:s,operator:i,args:o}){const a=n?Buffer&&Buffer.byteLength(e,n):e.length;return u.compare(a,r,i)?e:t.error("string."+s,{limit:o.limit,value:e,encoding:n})},args:[{name:"limit",ref:!0,assert:u.limit,message:"must be a positive integer"},"encoding"]},lowercase:{method(){return this.case("lower")}},max:{method(e,t){return c.length(this,"max",e,"<=",t)},args:["limit","encoding"]},min:{method(e,t){return c.length(this,"min",e,">=",t)},args:["limit","encoding"]},normalize:{method(t="NFC"){return e(c.normalizationForms.includes(t),"normalization form must be one of "+c.normalizationForms.join(", ")),this.$_addRule({name:"normalize",args:{form:t}})},validate:(e,{error:t},{form:r})=>e===e.normalize(r)?e:t("string.normalize",{value:e,form:r}),convert:!0},pattern:{alias:"regex",method(t,r={}){e(t instanceof RegExp,"regex must be a RegExp"),e(!t.flags.includes("g")&&!t.flags.includes("y"),"regex should not use global or sticky mode"),"string"==typeof r&&(r={name:r}),u.assertOptions(r,["invert","name"]);const n=["string.pattern",r.invert?".invert":"",r.name?".name":".base"].join("");return this.$_addRule({name:"pattern",args:{regex:t,options:r},errorCode:n})},validate:(e,t,{regex:r,options:n},{errorCode:s})=>r.test(e)^n.invert?e:t.error(s,{name:n.name,regex:r,value:e}),args:["regex","options"],multi:!0},replace:{method(t,r){"string"==typeof t&&(t=new RegExp(s(t),"g")),e(t instanceof RegExp,"pattern must be a RegExp"),e("string"==typeof r,"replacement must be a String");const n=this.clone();return n.$_terms.replacements||(n.$_terms.replacements=[]),n.$_terms.replacements.push({pattern:t,replacement:r}),n}},token:{method(){return this.$_addRule("token")},validate:(e,t)=>/^\w+$/.test(e)?e:t.error("string.token")},trim:{method(t=!0){return e("boolean"==typeof t,"enabled must be a boolean"),this.$_addRule({name:"trim",args:{enabled:t}})},validate:(e,t,{enabled:r})=>r&&e!==e.trim()?t.error("string.trim"):e,convert:!0},truncate:{method(t=!0){return e("boolean"==typeof t,"enabled must be a boolean"),this.$_setFlag("truncate",t)}},uppercase:{method(){return this.case("upper")}},uri:{method(e={}){u.assertOptions(e,["allowRelative","allowQuerySquareBrackets","domain","relativeOnly","scheme","encodeUri"]),e.domain&&u.assertOptions(e.domain,["allowFullyQualified","allowUnicode","maxDomainSegments","minDomainSegments","tlds"]);const{regex:t,scheme:r}=o.regex(e),n=e.domain?c.addressOptions(e.domain):null;return this.$_addRule({name:"uri",args:{options:e},regex:t,domain:n,scheme:r})},validate(e,r,{options:n},{regex:s,domain:i,scheme:o}){if(["http:/","https:/"].includes(e))return r.error("string.uri");let a=s.exec(e);if(!a&&r.prefs.convert&&n.encodeUri){const t=encodeURI(e);a=s.exec(t),a&&(e=t)}if(a){const s=a[1]||a[2];return!i||n.allowRelative&&!s||t.isValid(s,i)?e:r.error("string.domain",{value:s})}return n.relativeOnly?r.error("string.uriRelativeOnly"):n.scheme?r.error("string.uriCustomScheme",{scheme:o,value:e}):r.error("string.uri")}}},manifest:{build(e,t){if(t.replacements)for(const{pattern:r,replacement:n}of t.replacements)e=e.replace(r,n);return e}},messages:{"string.alphanum":"{{#label}} must only contain alpha-numeric characters","string.base":"{{#label}} must be a string","string.base64":"{{#label}} must be a valid base64 string","string.creditCard":"{{#label}} must be a credit card","string.dataUri":"{{#label}} must be a valid dataUri string","string.domain":"{{#label}} must contain a valid domain name","string.email":"{{#label}} must be a valid email","string.empty":"{{#label}} is not allowed to be empty","string.guid":"{{#label}} must be a valid GUID","string.hex":"{{#label}} must only contain hexadecimal characters","string.hexAlign":"{{#label}} hex decoded representation must be byte aligned","string.hostname":"{{#label}} must be a valid hostname","string.ip":"{{#label}} must be a valid ip address with a {{#cidr}} CIDR","string.ipVersion":"{{#label}} must be a valid ip address of one of the following versions {{#version}} with a {{#cidr}} CIDR","string.isoDate":"{{#label}} must be in iso format","string.isoDuration":"{{#label}} must be a valid ISO 8601 duration","string.length":"{{#label}} length must be {{#limit}} characters long","string.lowercase":"{{#label}} must only contain lowercase characters","string.max":"{{#label}} length must be less than or equal to {{#limit}} characters long","string.min":"{{#label}} length must be at least {{#limit}} characters long","string.normalize":"{{#label}} must be unicode normalized in the {{#form}} form","string.token":"{{#label}} must only contain alpha-numeric and underscore characters","string.pattern.base":"{{#label}} with value {:[.]} fails to match the required pattern: {{#regex}}","string.pattern.name":"{{#label}} with value {:[.]} fails to match the {{#name}} pattern","string.pattern.invert.base":"{{#label}} with value {:[.]} matches the inverted pattern: {{#regex}}","string.pattern.invert.name":"{{#label}} with value {:[.]} matches the inverted {{#name}} pattern","string.trim":"{{#label}} must not have leading or trailing whitespace","string.uri":"{{#label}} must be a valid uri","string.uriCustomScheme":"{{#label}} must be a valid uri with a scheme matching the {{#scheme}} pattern","string.uriRelativeOnly":"{{#label}} must be a valid relative uri","string.uppercase":"{{#label}} must only contain uppercase characters"}}),c.addressOptions=function(t){if(!t)return c.tlds||t;if(e(void 0===t.minDomainSegments||Number.isSafeInteger(t.minDomainSegments)&&t.minDomainSegments>0,"minDomainSegments must be a positive integer"),e(void 0===t.maxDomainSegments||Number.isSafeInteger(t.maxDomainSegments)&&t.maxDomainSegments>0,"maxDomainSegments must be a positive integer"),!1===t.tlds)return t;if(!0===t.tlds||void 0===t.tlds)return e(c.tlds,"Built-in TLD list disabled"),Object.assign({},t,c.tlds);e("object"==typeof t.tlds,"tlds must be true, false, or an object");const r=t.tlds.deny;if(r)return Array.isArray(r)&&(t=Object.assign({},t,{tlds:{deny:new Set(r)}})),e(t.tlds.deny instanceof Set,"tlds.deny must be an array, Set, or boolean"),e(!t.tlds.allow,"Cannot specify both tlds.allow and tlds.deny lists"),c.validateTlds(t.tlds.deny,"tlds.deny"),t;const n=t.tlds.allow;return n?!0===n?(e(c.tlds,"Built-in TLD list disabled"),Object.assign({},t,c.tlds)):(Array.isArray(n)&&(t=Object.assign({},t,{tlds:{allow:new Set(n)}})),e(t.tlds.allow instanceof Set,"tlds.allow must be an array, Set, or boolean"),c.validateTlds(t.tlds.allow,"tlds.allow"),t):t},c.validateTlds=function(r,n){for(const s of r)e(t.isValid(s,{minDomainSegments:1,maxDomainSegments:1}),`${n} must contain valid top level domain names`)},c.isoDate=function(e){if(!u.isIsoDate(e))return null;/.*T.*[+-]\d\d$/.test(e)&&(e+="00");const t=new Date(e);return isNaN(t.getTime())?null:t.toISOString()},c.length=function(t,r,n,s,i){return e(!i||Buffer&&Buffer.isEncoding(i),"Invalid encoding:",i),t.$_addRule({name:r,method:"length",args:{limit:n,encoding:i},operator:s})},jh}function ud(){if(Fh)return Hh;Fh=1;const e=R,t=zh(),r={};return r.Map=class extends Map{slice(){return new r.Map(this)}},Hh=t.extend({type:"symbol",terms:{map:{init:new r.Map}},coerce:{method(e,{schema:t,error:r}){const n=t.$_terms.map.get(e);return n&&(e=n),t._flags.only&&"symbol"!=typeof e?{value:e,errors:r("symbol.map",{map:t.$_terms.map})}:{value:e}}},validate(e,{error:t}){if("symbol"!=typeof e)return{value:e,errors:t("symbol.base")}},rules:{map:{method(t){t&&!t[Symbol.iterator]&&"object"==typeof t&&(t=Object.entries(t)),e(t&&t[Symbol.iterator],"Iterable must be an iterable or object");const r=this.clone(),n=[];for(const s of t){e(s&&s[Symbol.iterator],"Entry must be an iterable");const[t,i]=s;e("object"!=typeof t&&"function"!=typeof t&&"symbol"!=typeof t,"Key must not be of type object, function, or Symbol"),e("symbol"==typeof i,"Value must be a Symbol"),r.$_terms.map.set(t,i),n.push(i)}return r.valid(...n)}}},manifest:{build:(e,t)=>(t.map&&(e=e.map(t.map)),e)},messages:{"symbol.base":"{{#label}} must be a symbol","symbol.map":"{{#label}} must be one of {{#map}}"}}),Hh}function cd(){if(Xh)return Vh;Xh=1;const e=R,t=M,r=zp(),n=Yp(),s=eh(),i=Mp(),o=nh(),a=oh(),u=Wp(),c=qp(),l=ch();let f;const p={types:{alternatives:Jh(),any:zh(),array:Qh(),boolean:ed(),date:td(),function:nd(),link:sd(),number:id(),object:od(),string:ad(),symbol:ud()},aliases:{alt:"alternatives",bool:"boolean",func:"function"}};return Buffer&&(p.types.binary=function(){if(Gh)return Kh;Gh=1;const e=R,t=zh(),r=Yp();return Kh=t.extend({type:"binary",coerce:{from:["string","object"],method(e,{schema:t}){if("string"==typeof e||null!==e&&"Buffer"===e.type)try{return{value:Buffer.from(e,t._flags.encoding)}}catch(e){}}},validate(e,{error:t}){if(!Buffer.isBuffer(e))return{value:e,errors:t("binary.base")}},rules:{encoding:{method(t){return e(Buffer.isEncoding(t),"Invalid encoding:",t),this.$_setFlag("encoding",t)}},length:{method(e){return this.$_addRule({name:"length",method:"length",args:{limit:e},operator:"="})},validate:(e,t,{limit:n},{name:s,operator:i,args:o})=>r.compare(e.length,n,i)?e:t.error("binary."+s,{limit:o.limit,value:e}),args:[{name:"limit",ref:!0,assert:r.limit,message:"must be a positive integer"}]},max:{method(e){return this.$_addRule({name:"max",method:"length",args:{limit:e},operator:"<="})}},min:{method(e){return this.$_addRule({name:"min",method:"length",args:{limit:e},operator:">="})}}},cast:{string:{from:e=>Buffer.isBuffer(e),to:(e,t)=>e.toString()}},messages:{"binary.base":"{{#label}} must be a buffer or a string","binary.length":"{{#label}} must be {{#limit}} bytes","binary.max":"{{#label}} must be less than or equal to {{#limit}} bytes","binary.min":"{{#label}} must be at least {{#limit}} bytes"}}),Kh}()),p.root=function(){const t={_types:new Set(Object.keys(p.types))};for(const r of t._types)t[r]=function(...t){return e(!t.length||["alternatives","link","object"].includes(r),"The",r,"type does not allow arguments"),p.generate(this,p.types[r],t)};for(const e of["allow","custom","disallow","equal","exist","forbidden","invalid","not","only","optional","options","prefs","preferences","required","strip","valid","when"])t[e]=function(...t){return this.any()[e](...t)};Object.assign(t,p.methods);for(const e in p.aliases){const r=p.aliases[e];t[e]=t[r]}return t.x=t.expression,l.setup&&l.setup(t),t},p.methods={ValidationError:i.ValidationError,version:n.version,cache:r.provider,assert(e,t,...r){p.assert(e,t,!0,r)},attempt:(e,t,...r)=>p.assert(e,t,!1,r),build(t){return e("function"==typeof a.build,"Manifest functionality disabled"),a.build(this,t)},checkPreferences(e){n.checkPreferences(e)},compile(e,t){return s.compile(this,e,t)},defaults(t){e("function"==typeof t,"modifier must be a function");const r=Object.assign({},this);for(const s of r._types){const i=t(r[s]());e(n.isSchema(i),"modifier must return a valid schema object"),r[s]=function(...e){return p.generate(this,i,e)}}return r},expression:(...e)=>new c(...e),extend(...t){n.verifyFlat(t,"extend"),f=f||xp(),e(t.length,"You need to provide at least one extension"),this.assert(t,f.extensions);const r=Object.assign({},this);r._types=new Set(r._types);for(let n of t){"function"==typeof n&&(n=n(r)),this.assert(n,f.extension);const t=p.expandExtension(n,r);for(const n of t){e(void 0===r[n.type]||r._types.has(n.type),"Cannot override name",n.type);const t=n.base||this.any(),s=o.type(t,n);r._types.add(n.type),r[n.type]=function(...e){return p.generate(this,s,e)}}}return r},isError:i.ValidationError.isError,isExpression:c.isTemplate,isRef:u.isRef,isSchema:n.isSchema,in:(...e)=>u.in(...e),override:n.symbols.override,ref:(...e)=>u.create(...e),types(){const e={};for(const t of this._types)e[t]=this[t]();for(const t in p.aliases)e[t]=this[t]();return e}},p.assert=function(e,r,s,o){const a=o[0]instanceof Error||"string"==typeof o[0]?o[0]:null,u=null!==a?o[1]:o[0],c=r.validate(e,n.preferences({errors:{stack:!0}},u||{}));let l=c.error;if(!l)return c.value;if(a instanceof Error)throw a;const f=s&&"function"==typeof l.annotate?l.annotate():l.message;throw l instanceof i.ValidationError==!1&&(l=t(l)),l.message=a?`${a} ${f}`:f,l},p.generate=function(t,r,n){return e(t,"Must be invoked on a Joi instance."),r.$_root=t,r._definition.args&&n.length?r._definition.args(r,...n):r},p.expandExtension=function(e,t){if("string"==typeof e.type)return[e];const r=[];for(const n of t._types)if(e.type.test(n)){const s=Object.assign({},e);s.type=n,s.base=t[n](),r.push(s)}return r},Vh=p.root()}var ld=h(cd()),fd={},pd=bo.Buffer,hd=c;function dd(e){if(this.buffer=null,this.writable=!0,this.readable=!0,!e)return this.buffer=pd.alloc(0),this;if("function"==typeof e.pipe)return this.buffer=pd.alloc(0),e.pipe(this),this;if(e.length||"object"==typeof e)return this.buffer=e,this.writable=!1,process.nextTick(function(){this.emit("end",e),this.readable=!1,this.emit("close")}.bind(this)),this;throw new TypeError("Unexpected data type ("+typeof e+")")}u.inherits(dd,hd),dd.prototype.write=function(e){this.buffer=pd.concat([this.buffer,pd.from(e)]),this.emit("data",e)},dd.prototype.end=function(e){e&&this.write(e),this.emit("end",e),this.emit("close"),this.writable=!1,this.readable=!1};var md=dd,yd=t.Buffer,gd=t.SlowBuffer,bd=vd;function vd(e,t){if(!yd.isBuffer(e)||!yd.isBuffer(t))return!1;if(e.length!==t.length)return!1;for(var r=0,n=0;n<e.length;n++)r|=e[n]^t[n];return 0===r}vd.install=function(){yd.prototype.equal=gd.prototype.equal=function(e){return vd(this,e)}};var _d=yd.prototype.equal,wd=gd.prototype.equal;function Ed(e){return(e/8|0)+(e%8==0?0:1)}vd.restore=function(){yd.prototype.equal=_d,gd.prototype.equal=wd};var Sd={ES256:Ed(256),ES384:Ed(384),ES512:Ed(521)};var Ad=function(e){var t=Sd[e];if(t)return t;throw new Error('Unknown algorithm "'+e+'"')},Td=bo.Buffer,Id=Ad,Od=128;function kd(e){if(Td.isBuffer(e))return e;if("string"==typeof e)return Td.from(e,"base64");throw new TypeError("ECDSA signature must be a Base64 string or a Buffer")}function Rd(e,t,r){for(var n=0;t+n<r&&0===e[t+n];)++n;return e[t+n]>=Od&&--n,n}var Nd={derToJose:function(e,t){e=kd(e);var r=Id(t),n=r+1,s=e.length,i=0;if(48!==e[i++])throw new Error('Could not find expected "seq"');var o=e[i++];if(o===(1|Od)&&(o=e[i++]),s-i<o)throw new Error('"seq" specified length of "'+o+'", only "'+(s-i)+'" remaining');if(2!==e[i++])throw new Error('Could not find expected "int" for "r"');var a=e[i++];if(s-i-2<a)throw new Error('"r" specified length of "'+a+'", only "'+(s-i-2)+'" available');if(n<a)throw new Error('"r" specified length of "'+a+'", max of "'+n+'" is acceptable');var u=i;if(i+=a,2!==e[i++])throw new Error('Could not find expected "int" for "s"');var c=e[i++];if(s-i!==c)throw new Error('"s" specified length of "'+c+'", expected "'+(s-i)+'"');if(n<c)throw new Error('"s" specified length of "'+c+'", max of "'+n+'" is acceptable');var l=i;if((i+=c)!==s)throw new Error('Expected to consume entire buffer, but "'+(s-i)+'" bytes remain');var f=r-a,p=r-c,h=Td.allocUnsafe(f+a+p+c);for(i=0;i<f;++i)h[i]=0;e.copy(h,i,u+Math.max(-f,0),u+a);for(var d=i=r;i<d+p;++i)h[i]=0;return e.copy(h,i,l+Math.max(-p,0),l+c),h=(h=h.toString("base64")).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")},joseToDer:function(e,t){e=kd(e);var r=Id(t),n=e.length;if(n!==2*r)throw new TypeError('"'+t+'" signatures must be "'+2*r+'" bytes, saw "'+n+'"');var s=Rd(e,0,r),i=Rd(e,r,e.length),o=r-s,a=r-i,u=2+o+1+1+a,c=u<Od,l=Td.allocUnsafe((c?2:3)+u),f=0;return l[f++]=48,c?l[f++]=u:(l[f++]=1|Od,l[f++]=255&u),l[f++]=2,l[f++]=o,s<0?(l[f++]=0,f+=e.copy(l,f,0,r)):f+=e.copy(l,f,s,r),l[f++]=2,l[f++]=a,i<0?(l[f++]=0,e.copy(l,f,r)):e.copy(l,f,r+i),l}},Pd=bd,xd=bo.Buffer,Cd=r,Bd=Nd,Ld=u,$d="secret must be a string or buffer",Ud="key must be a string or a buffer",Dd="key must be a string, a buffer or an object",jd="function"==typeof Cd.createPublicKey;function Md(e){if(!xd.isBuffer(e)&&"string"!=typeof e){if(!jd)throw Gd(Ud);if("object"!=typeof e)throw Gd(Ud);if("string"!=typeof e.type)throw Gd(Ud);if("string"!=typeof e.asymmetricKeyType)throw Gd(Ud);if("function"!=typeof e.export)throw Gd(Ud)}}function Hd(e){if(!xd.isBuffer(e)&&"string"!=typeof e&&"object"!=typeof e)throw Gd(Dd)}function Fd(e){return e.replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function Kd(e){var t=4-(e=e.toString()).length%4;if(4!==t)for(var r=0;r<t;++r)e+="=";return e.replace(/\-/g,"+").replace(/_/g,"/")}function Gd(e){var t=[].slice.call(arguments,1),r=Ld.format.bind(Ld,e).apply(null,t);return new TypeError(r)}function Vd(e){var t;return t=e,xd.isBuffer(t)||"string"==typeof t||(e=JSON.stringify(e)),e}function Xd(e){return function(t,r){!function(e){if(!xd.isBuffer(e)){if("string"==typeof e)return e;if(!jd)throw Gd($d);if("object"!=typeof e)throw Gd($d);if("secret"!==e.type)throw Gd($d);if("function"!=typeof e.export)throw Gd($d)}}(r),t=Vd(t);var n=Cd.createHmac("sha"+e,r);return Fd((n.update(t),n.digest("base64")))}}function Wd(e){return function(t,r,n){var s=Xd(e)(t,n);return Pd(xd.from(r),xd.from(s))}}function qd(e){return function(t,r){Hd(r),t=Vd(t);var n=Cd.createSign("RSA-SHA"+e);return Fd((n.update(t),n.sign(r,"base64")))}}function Zd(e){return function(t,r,n){Md(n),t=Vd(t),r=Kd(r);var s=Cd.createVerify("RSA-SHA"+e);return s.update(t),s.verify(n,r,"base64")}}function Yd(e){return function(t,r){Hd(r),t=Vd(t);var n=Cd.createSign("RSA-SHA"+e);return Fd((n.update(t),n.sign({key:r,padding:Cd.constants.RSA_PKCS1_PSS_PADDING,saltLength:Cd.constants.RSA_PSS_SALTLEN_DIGEST},"base64")))}}function zd(e){return function(t,r,n){Md(n),t=Vd(t),r=Kd(r);var s=Cd.createVerify("RSA-SHA"+e);return s.update(t),s.verify({key:n,padding:Cd.constants.RSA_PKCS1_PSS_PADDING,saltLength:Cd.constants.RSA_PSS_SALTLEN_DIGEST},r,"base64")}}function Jd(e){var t=qd(e);return function(){var r=t.apply(null,arguments);return r=Bd.derToJose(r,"ES"+e)}}function Qd(e){var t=Zd(e);return function(r,n,s){return n=Bd.joseToDer(n,"ES"+e).toString("base64"),t(r,n,s)}}function em(){return function(){return""}}function tm(){return function(e,t){return""===t}}jd&&(Ud+=" or a KeyObject",$d+="or a KeyObject");var rm=function(e){var t={hs:Xd,rs:qd,ps:Yd,es:Jd,none:em},r={hs:Wd,rs:Zd,ps:zd,es:Qd,none:tm},n=e.match(/^(RS|PS|ES|HS)(256|384|512)$|^(none)$/i);if(!n)throw Gd('"%s" is not a valid algorithm.\n  Supported algorithms are:\n  "HS256", "HS384", "HS512", "RS256", "RS384", "RS512", "PS256", "PS384", "PS512", "ES256", "ES384", "ES512" and "none".',e);var s=(n[1]||n[3]).toLowerCase(),i=n[2];return{sign:t[s](i),verify:r[s](i)}},nm=t.Buffer,sm=function(e){return"string"==typeof e?e:"number"==typeof e||nm.isBuffer(e)?e.toString():JSON.stringify(e)},im=bo.Buffer,om=md,am=rm,um=c,cm=sm,lm=u;function fm(e,t){return im.from(e,t).toString("base64").replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function pm(e){var t=e.header,r=e.payload,n=e.secret||e.privateKey,s=e.encoding,i=am(t.alg),o=function(e,t,r){r=r||"utf8";var n=fm(cm(e),"binary"),s=fm(cm(t),r);return lm.format("%s.%s",n,s)}(t,r,s),a=i.sign(o,n);return lm.format("%s.%s",o,a)}function hm(e){var t=e.secret||e.privateKey||e.key,r=new om(t);this.readable=!0,this.header=e.header,this.encoding=e.encoding,this.secret=this.privateKey=this.key=r,this.payload=new om(e.payload),this.secret.once("close",function(){!this.payload.writable&&this.readable&&this.sign()}.bind(this)),this.payload.once("close",function(){!this.secret.writable&&this.readable&&this.sign()}.bind(this))}lm.inherits(hm,um),hm.prototype.sign=function(){try{var e=pm({header:this.header,payload:this.payload.buffer,secret:this.secret.buffer,encoding:this.encoding});return this.emit("done",e),this.emit("data",e),this.emit("end"),this.readable=!1,e}catch(e){this.readable=!1,this.emit("error",e),this.emit("close")}},hm.sign=pm;var dm=hm,mm=bo.Buffer,ym=md,gm=rm,bm=c,vm=sm,_m=/^[a-zA-Z0-9\-_]+?\.[a-zA-Z0-9\-_]+?\.([a-zA-Z0-9\-_]+)?$/;function wm(e){if(function(e){return"[object Object]"===Object.prototype.toString.call(e)}(e))return e;try{return JSON.parse(e)}catch(e){return}}function Em(e){var t=e.split(".",1)[0];return wm(mm.from(t,"base64").toString("binary"))}function Sm(e){return e.split(".")[2]}function Am(e){return _m.test(e)&&!!Em(e)}function Tm(e,t,r){if(!t){var n=new Error("Missing algorithm parameter for jws.verify");throw n.code="MISSING_ALGORITHM",n}var s=Sm(e=vm(e)),i=function(e){return e.split(".",2).join(".")}(e);return gm(t).verify(i,s,r)}function Im(e,t){if(t=t||{},!Am(e=vm(e)))return null;var r=Em(e);if(!r)return null;var n=function(e,t){t=t||"utf8";var r=e.split(".")[1];return mm.from(r,"base64").toString(t)}(e);return("JWT"===r.typ||t.json)&&(n=JSON.parse(n,t.encoding)),{header:r,payload:n,signature:Sm(e)}}function Om(e){var t=(e=e||{}).secret||e.publicKey||e.key,r=new ym(t);this.readable=!0,this.algorithm=e.algorithm,this.encoding=e.encoding,this.secret=this.publicKey=this.key=r,this.signature=new ym(e.signature),this.secret.once("close",function(){!this.signature.writable&&this.readable&&this.verify()}.bind(this)),this.signature.once("close",function(){!this.secret.writable&&this.readable&&this.verify()}.bind(this))}u.inherits(Om,bm),Om.prototype.verify=function(){try{var e=Tm(this.signature.buffer,this.algorithm,this.key.buffer),t=Im(this.signature.buffer,this.encoding);return this.emit("done",e,t),this.emit("data",e),this.emit("end"),this.readable=!1,e}catch(e){this.readable=!1,this.emit("error",e),this.emit("close")}},Om.decode=Im,Om.isValid=Am,Om.verify=Tm;var km=dm,Rm=Om;fd.ALGORITHMS=["HS256","HS384","HS512","RS256","RS384","RS512","PS256","PS384","PS512","ES256","ES384","ES512"],fd.sign=km.sign,fd.verify=Rm.verify,fd.decode=Rm.decode,fd.isValid=Rm.isValid,fd.createSign=function(e){return new km(e)},fd.createVerify=function(e){return new Rm(e)};var Nm=fd,Pm=function(e,t){t=t||{};var r=Nm.decode(e,t);if(!r)return null;var n=r.payload;if("string"==typeof n)try{var s=JSON.parse(n);null!==s&&"object"==typeof s&&(n=s)}catch(e){}return!0===t.complete?{header:r.header,payload:n,signature:r.signature}:n},xm=function(e,t){Error.call(this,e),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor),this.name="JsonWebTokenError",this.message=e,t&&(this.inner=t)};(xm.prototype=Object.create(Error.prototype)).constructor=xm;var Cm=xm,Bm=Cm,Lm=function(e,t){Bm.call(this,e),this.name="NotBeforeError",this.date=t};(Lm.prototype=Object.create(Bm.prototype)).constructor=Lm;var $m=Lm,Um=Cm,Dm=function(e,t){Um.call(this,e),this.name="TokenExpiredError",this.expiredAt=t};(Dm.prototype=Object.create(Um.prototype)).constructor=Dm;var jm=Dm,Mm=w,Hm=function(e,t){var r=t||Math.floor(Date.now()/1e3);if("string"==typeof e){var n=Mm(e);if(void 0===n)return;return Math.floor(r+n/1e3)}return"number"==typeof e?r+e:void 0},Fm={exports:{}};var Km={MAX_LENGTH:256,MAX_SAFE_COMPONENT_LENGTH:16,MAX_SAFE_BUILD_LENGTH:250,MAX_SAFE_INTEGER:Number.MAX_SAFE_INTEGER||9007199254740991,RELEASE_TYPES:["major","premajor","minor","preminor","patch","prepatch","prerelease"],SEMVER_SPEC_VERSION:"2.0.0",FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2};var Gm="object"==typeof process&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?(...e)=>console.error("SEMVER",...e):()=>{};!function(e,t){const{MAX_SAFE_COMPONENT_LENGTH:r,MAX_SAFE_BUILD_LENGTH:n,MAX_LENGTH:s}=Km,i=Gm,o=(t=e.exports={}).re=[],a=t.safeRe=[],u=t.src=[],c=t.t={};let l=0;const f="[a-zA-Z0-9-]",p=[["\\s",1],["\\d",s],[f,n]],h=(e,t,r)=>{const n=(e=>{for(const[t,r]of p)e=e.split(`${t}*`).join(`${t}{0,${r}}`).split(`${t}+`).join(`${t}{1,${r}}`);return e})(t),s=l++;i(e,s,t),c[e]=s,u[s]=t,o[s]=new RegExp(t,r?"g":void 0),a[s]=new RegExp(n,r?"g":void 0)};h("NUMERICIDENTIFIER","0|[1-9]\\d*"),h("NUMERICIDENTIFIERLOOSE","\\d+"),h("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${f}*`),h("MAINVERSION",`(${u[c.NUMERICIDENTIFIER]})\\.(${u[c.NUMERICIDENTIFIER]})\\.(${u[c.NUMERICIDENTIFIER]})`),h("MAINVERSIONLOOSE",`(${u[c.NUMERICIDENTIFIERLOOSE]})\\.(${u[c.NUMERICIDENTIFIERLOOSE]})\\.(${u[c.NUMERICIDENTIFIERLOOSE]})`),h("PRERELEASEIDENTIFIER",`(?:${u[c.NUMERICIDENTIFIER]}|${u[c.NONNUMERICIDENTIFIER]})`),h("PRERELEASEIDENTIFIERLOOSE",`(?:${u[c.NUMERICIDENTIFIERLOOSE]}|${u[c.NONNUMERICIDENTIFIER]})`),h("PRERELEASE",`(?:-(${u[c.PRERELEASEIDENTIFIER]}(?:\\.${u[c.PRERELEASEIDENTIFIER]})*))`),h("PRERELEASELOOSE",`(?:-?(${u[c.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${u[c.PRERELEASEIDENTIFIERLOOSE]})*))`),h("BUILDIDENTIFIER",`${f}+`),h("BUILD",`(?:\\+(${u[c.BUILDIDENTIFIER]}(?:\\.${u[c.BUILDIDENTIFIER]})*))`),h("FULLPLAIN",`v?${u[c.MAINVERSION]}${u[c.PRERELEASE]}?${u[c.BUILD]}?`),h("FULL",`^${u[c.FULLPLAIN]}$`),h("LOOSEPLAIN",`[v=\\s]*${u[c.MAINVERSIONLOOSE]}${u[c.PRERELEASELOOSE]}?${u[c.BUILD]}?`),h("LOOSE",`^${u[c.LOOSEPLAIN]}$`),h("GTLT","((?:<|>)?=?)"),h("XRANGEIDENTIFIERLOOSE",`${u[c.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),h("XRANGEIDENTIFIER",`${u[c.NUMERICIDENTIFIER]}|x|X|\\*`),h("XRANGEPLAIN",`[v=\\s]*(${u[c.XRANGEIDENTIFIER]})(?:\\.(${u[c.XRANGEIDENTIFIER]})(?:\\.(${u[c.XRANGEIDENTIFIER]})(?:${u[c.PRERELEASE]})?${u[c.BUILD]}?)?)?`),h("XRANGEPLAINLOOSE",`[v=\\s]*(${u[c.XRANGEIDENTIFIERLOOSE]})(?:\\.(${u[c.XRANGEIDENTIFIERLOOSE]})(?:\\.(${u[c.XRANGEIDENTIFIERLOOSE]})(?:${u[c.PRERELEASELOOSE]})?${u[c.BUILD]}?)?)?`),h("XRANGE",`^${u[c.GTLT]}\\s*${u[c.XRANGEPLAIN]}$`),h("XRANGELOOSE",`^${u[c.GTLT]}\\s*${u[c.XRANGEPLAINLOOSE]}$`),h("COERCEPLAIN",`(^|[^\\d])(\\d{1,${r}})(?:\\.(\\d{1,${r}}))?(?:\\.(\\d{1,${r}}))?`),h("COERCE",`${u[c.COERCEPLAIN]}(?:$|[^\\d])`),h("COERCEFULL",u[c.COERCEPLAIN]+`(?:${u[c.PRERELEASE]})?`+`(?:${u[c.BUILD]})?(?:$|[^\\d])`),h("COERCERTL",u[c.COERCE],!0),h("COERCERTLFULL",u[c.COERCEFULL],!0),h("LONETILDE","(?:~>?)"),h("TILDETRIM",`(\\s*)${u[c.LONETILDE]}\\s+`,!0),t.tildeTrimReplace="$1~",h("TILDE",`^${u[c.LONETILDE]}${u[c.XRANGEPLAIN]}$`),h("TILDELOOSE",`^${u[c.LONETILDE]}${u[c.XRANGEPLAINLOOSE]}$`),h("LONECARET","(?:\\^)"),h("CARETTRIM",`(\\s*)${u[c.LONECARET]}\\s+`,!0),t.caretTrimReplace="$1^",h("CARET",`^${u[c.LONECARET]}${u[c.XRANGEPLAIN]}$`),h("CARETLOOSE",`^${u[c.LONECARET]}${u[c.XRANGEPLAINLOOSE]}$`),h("COMPARATORLOOSE",`^${u[c.GTLT]}\\s*(${u[c.LOOSEPLAIN]})$|^$`),h("COMPARATOR",`^${u[c.GTLT]}\\s*(${u[c.FULLPLAIN]})$|^$`),h("COMPARATORTRIM",`(\\s*)${u[c.GTLT]}\\s*(${u[c.LOOSEPLAIN]}|${u[c.XRANGEPLAIN]})`,!0),t.comparatorTrimReplace="$1$2$3",h("HYPHENRANGE",`^\\s*(${u[c.XRANGEPLAIN]})\\s+-\\s+(${u[c.XRANGEPLAIN]})\\s*$`),h("HYPHENRANGELOOSE",`^\\s*(${u[c.XRANGEPLAINLOOSE]})\\s+-\\s+(${u[c.XRANGEPLAINLOOSE]})\\s*$`),h("STAR","(<|>)?=?\\s*\\*"),h("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),h("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")}(Fm,Fm.exports);var Vm=Fm.exports;const Xm=Object.freeze({loose:!0}),Wm=Object.freeze({});var qm=e=>e?"object"!=typeof e?Xm:e:Wm;const Zm=/^[0-9]+$/,Ym=(e,t)=>{const r=Zm.test(e),n=Zm.test(t);return r&&n&&(e=+e,t=+t),e===t?0:r&&!n?-1:n&&!r?1:e<t?-1:1};var zm={compareIdentifiers:Ym,rcompareIdentifiers:(e,t)=>Ym(t,e)};const Jm=Gm,{MAX_LENGTH:Qm,MAX_SAFE_INTEGER:ey}=Km,{safeRe:ty,t:ry}=Vm,ny=qm,{compareIdentifiers:sy}=zm;var iy=class e{constructor(t,r){if(r=ny(r),t instanceof e){if(t.loose===!!r.loose&&t.includePrerelease===!!r.includePrerelease)return t;t=t.version}else if("string"!=typeof t)throw new TypeError(`Invalid version. Must be a string. Got type "${typeof t}".`);if(t.length>Qm)throw new TypeError(`version is longer than ${Qm} characters`);Jm("SemVer",t,r),this.options=r,this.loose=!!r.loose,this.includePrerelease=!!r.includePrerelease;const n=t.trim().match(r.loose?ty[ry.LOOSE]:ty[ry.FULL]);if(!n)throw new TypeError(`Invalid Version: ${t}`);if(this.raw=t,this.major=+n[1],this.minor=+n[2],this.patch=+n[3],this.major>ey||this.major<0)throw new TypeError("Invalid major version");if(this.minor>ey||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>ey||this.patch<0)throw new TypeError("Invalid patch version");n[4]?this.prerelease=n[4].split(".").map((e=>{if(/^[0-9]+$/.test(e)){const t=+e;if(t>=0&&t<ey)return t}return e})):this.prerelease=[],this.build=n[5]?n[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(t){if(Jm("SemVer.compare",this.version,this.options,t),!(t instanceof e)){if("string"==typeof t&&t===this.version)return 0;t=new e(t,this.options)}return t.version===this.version?0:this.compareMain(t)||this.comparePre(t)}compareMain(t){return t instanceof e||(t=new e(t,this.options)),sy(this.major,t.major)||sy(this.minor,t.minor)||sy(this.patch,t.patch)}comparePre(t){if(t instanceof e||(t=new e(t,this.options)),this.prerelease.length&&!t.prerelease.length)return-1;if(!this.prerelease.length&&t.prerelease.length)return 1;if(!this.prerelease.length&&!t.prerelease.length)return 0;let r=0;do{const e=this.prerelease[r],n=t.prerelease[r];if(Jm("prerelease compare",r,e,n),void 0===e&&void 0===n)return 0;if(void 0===n)return 1;if(void 0===e)return-1;if(e!==n)return sy(e,n)}while(++r)}compareBuild(t){t instanceof e||(t=new e(t,this.options));let r=0;do{const e=this.build[r],n=t.build[r];if(Jm("build compare",r,e,n),void 0===e&&void 0===n)return 0;if(void 0===n)return 1;if(void 0===e)return-1;if(e!==n)return sy(e,n)}while(++r)}inc(e,t,r){switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t,r);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t,r);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t,r),this.inc("pre",t,r);break;case"prerelease":0===this.prerelease.length&&this.inc("patch",t,r),this.inc("pre",t,r);break;case"major":0===this.minor&&0===this.patch&&0!==this.prerelease.length||this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":0===this.patch&&0!==this.prerelease.length||this.minor++,this.patch=0,this.prerelease=[];break;case"patch":0===this.prerelease.length&&this.patch++,this.prerelease=[];break;case"pre":{const e=Number(r)?1:0;if(!t&&!1===r)throw new Error("invalid increment argument: identifier is empty");if(0===this.prerelease.length)this.prerelease=[e];else{let n=this.prerelease.length;for(;--n>=0;)"number"==typeof this.prerelease[n]&&(this.prerelease[n]++,n=-2);if(-1===n){if(t===this.prerelease.join(".")&&!1===r)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(e)}}if(t){let n=[t,e];!1===r&&(n=[t]),0===sy(this.prerelease[0],t)?isNaN(this.prerelease[1])&&(this.prerelease=n):this.prerelease=n}break}default:throw new Error(`invalid increment argument: ${e}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}};const oy=iy;var ay=(e,t,r=!1)=>{if(e instanceof oy)return e;try{return new oy(e,t)}catch(e){if(!r)return null;throw e}};const uy=ay;var cy=(e,t)=>{const r=uy(e,t);return r?r.version:null};const ly=ay;var fy=(e,t)=>{const r=ly(e.trim().replace(/^[=v]+/,""),t);return r?r.version:null};const py=iy;var hy=(e,t,r,n,s)=>{"string"==typeof r&&(s=n,n=r,r=void 0);try{return new py(e instanceof py?e.version:e,r).inc(t,n,s).version}catch(e){return null}};const dy=ay;var my=(e,t)=>{const r=dy(e,null,!0),n=dy(t,null,!0),s=r.compare(n);if(0===s)return null;const i=s>0,o=i?r:n,a=i?n:r,u=!!o.prerelease.length;if(!!a.prerelease.length&&!u)return a.patch||a.minor?o.patch?"patch":o.minor?"minor":"major":"major";const c=u?"pre":"";return r.major!==n.major?c+"major":r.minor!==n.minor?c+"minor":r.patch!==n.patch?c+"patch":"prerelease"};const yy=iy;var gy=(e,t)=>new yy(e,t).major;const by=iy;var vy=(e,t)=>new by(e,t).minor;const _y=iy;var wy=(e,t)=>new _y(e,t).patch;const Ey=ay;var Sy=(e,t)=>{const r=Ey(e,t);return r&&r.prerelease.length?r.prerelease:null};const Ay=iy;var Ty=(e,t,r)=>new Ay(e,r).compare(new Ay(t,r));const Iy=Ty;var Oy=(e,t,r)=>Iy(t,e,r);const ky=Ty;var Ry=(e,t)=>ky(e,t,!0);const Ny=iy;var Py=(e,t,r)=>{const n=new Ny(e,r),s=new Ny(t,r);return n.compare(s)||n.compareBuild(s)};const xy=Py;var Cy=(e,t)=>e.sort(((e,r)=>xy(e,r,t)));const By=Py;var Ly=(e,t)=>e.sort(((e,r)=>By(r,e,t)));const $y=Ty;var Uy=(e,t,r)=>$y(e,t,r)>0;const Dy=Ty;var jy=(e,t,r)=>Dy(e,t,r)<0;const My=Ty;var Hy=(e,t,r)=>0===My(e,t,r);const Fy=Ty;var Ky=(e,t,r)=>0!==Fy(e,t,r);const Gy=Ty;var Vy=(e,t,r)=>Gy(e,t,r)>=0;const Xy=Ty;var Wy=(e,t,r)=>Xy(e,t,r)<=0;const qy=Hy,Zy=Ky,Yy=Uy,zy=Vy,Jy=jy,Qy=Wy;var eg=(e,t,r,n)=>{switch(t){case"===":return"object"==typeof e&&(e=e.version),"object"==typeof r&&(r=r.version),e===r;case"!==":return"object"==typeof e&&(e=e.version),"object"==typeof r&&(r=r.version),e!==r;case"":case"=":case"==":return qy(e,r,n);case"!=":return Zy(e,r,n);case">":return Yy(e,r,n);case">=":return zy(e,r,n);case"<":return Jy(e,r,n);case"<=":return Qy(e,r,n);default:throw new TypeError(`Invalid operator: ${t}`)}};const tg=iy,rg=ay,{safeRe:ng,t:sg}=Vm;var ig=(e,t)=>{if(e instanceof tg)return e;if("number"==typeof e&&(e=String(e)),"string"!=typeof e)return null;let r=null;if((t=t||{}).rtl){const n=t.includePrerelease?ng[sg.COERCERTLFULL]:ng[sg.COERCERTL];let s;for(;(s=n.exec(e))&&(!r||r.index+r[0].length!==e.length);)r&&s.index+s[0].length===r.index+r[0].length||(r=s),n.lastIndex=s.index+s[1].length+s[2].length;n.lastIndex=-1}else r=e.match(t.includePrerelease?ng[sg.COERCEFULL]:ng[sg.COERCE]);if(null===r)return null;const n=r[2],s=r[3]||"0",i=r[4]||"0",o=t.includePrerelease&&r[5]?`-${r[5]}`:"",a=t.includePrerelease&&r[6]?`+${r[6]}`:"";return rg(`${n}.${s}.${i}${o}${a}`,t)};var og,ag,ug,cg,lg=class{constructor(){this.max=1e3,this.map=new Map}get(e){const t=this.map.get(e);return void 0===t?void 0:(this.map.delete(e),this.map.set(e,t),t)}delete(e){return!!this.map.has(e)&&(this.map.delete(e),!0)}set(e,t){if(!this.delete(e)&&void 0!==t){if(this.map.size>=this.max){const e=this.map.keys().next().value;this.delete(e)}this.map.set(e,t)}return this}};function fg(){if(ag)return og;ag=1;class e{constructor(t,s){if(s=r(s),t instanceof e)return t.loose===!!s.loose&&t.includePrerelease===!!s.includePrerelease?t:new e(t.raw,s);if(t instanceof n)return this.raw=t.value,this.set=[[t]],this.format(),this;if(this.options=s,this.loose=!!s.loose,this.includePrerelease=!!s.includePrerelease,this.raw=t.trim().split(/\s+/).join(" "),this.set=this.raw.split("||").map((e=>this.parseRange(e.trim()))).filter((e=>e.length)),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){const e=this.set[0];if(this.set=this.set.filter((e=>!h(e[0]))),0===this.set.length)this.set=[e];else if(this.set.length>1)for(const e of this.set)if(1===e.length&&d(e[0])){this.set=[e];break}}this.format()}format(){return this.range=this.set.map((e=>e.join(" ").trim())).join("||").trim(),this.range}toString(){return this.range}parseRange(e){const r=((this.options.includePrerelease&&f)|(this.options.loose&&p))+":"+e,i=t.get(r);if(i)return i;const d=this.options.loose,m=d?o[a.HYPHENRANGELOOSE]:o[a.HYPHENRANGE];e=e.replace(m,I(this.options.includePrerelease)),s("hyphen replace",e),e=e.replace(o[a.COMPARATORTRIM],u),s("comparator trim",e),e=e.replace(o[a.TILDETRIM],c),s("tilde trim",e),e=e.replace(o[a.CARETTRIM],l),s("caret trim",e);let g=e.split(" ").map((e=>y(e,this.options))).join(" ").split(/\s+/).map((e=>T(e,this.options)));d&&(g=g.filter((e=>(s("loose invalid filter",e,this.options),!!e.match(o[a.COMPARATORLOOSE]))))),s("range list",g);const b=new Map,v=g.map((e=>new n(e,this.options)));for(const e of v){if(h(e))return[e];b.set(e.value,e)}b.size>1&&b.has("")&&b.delete("");const _=[...b.values()];return t.set(r,_),_}intersects(t,r){if(!(t instanceof e))throw new TypeError("a Range is required");return this.set.some((e=>m(e,r)&&t.set.some((t=>m(t,r)&&e.every((e=>t.every((t=>e.intersects(t,r)))))))))}test(e){if(!e)return!1;if("string"==typeof e)try{e=new i(e,this.options)}catch(e){return!1}for(let t=0;t<this.set.length;t++)if(O(this.set[t],e,this.options))return!0;return!1}}og=e;const t=new lg,r=qm,n=pg(),s=Gm,i=iy,{safeRe:o,t:a,comparatorTrimReplace:u,tildeTrimReplace:c,caretTrimReplace:l}=Vm,{FLAG_INCLUDE_PRERELEASE:f,FLAG_LOOSE:p}=Km,h=e=>"<0.0.0-0"===e.value,d=e=>""===e.value,m=(e,t)=>{let r=!0;const n=e.slice();let s=n.pop();for(;r&&n.length;)r=n.every((e=>s.intersects(e,t))),s=n.pop();return r},y=(e,t)=>(s("comp",e,t),e=_(e,t),s("caret",e),e=b(e,t),s("tildes",e),e=E(e,t),s("xrange",e),e=A(e,t),s("stars",e),e),g=e=>!e||"x"===e.toLowerCase()||"*"===e,b=(e,t)=>e.trim().split(/\s+/).map((e=>v(e,t))).join(" "),v=(e,t)=>{const r=t.loose?o[a.TILDELOOSE]:o[a.TILDE];return e.replace(r,((t,r,n,i,o)=>{let a;return s("tilde",e,t,r,n,i,o),g(r)?a="":g(n)?a=`>=${r}.0.0 <${+r+1}.0.0-0`:g(i)?a=`>=${r}.${n}.0 <${r}.${+n+1}.0-0`:o?(s("replaceTilde pr",o),a=`>=${r}.${n}.${i}-${o} <${r}.${+n+1}.0-0`):a=`>=${r}.${n}.${i} <${r}.${+n+1}.0-0`,s("tilde return",a),a}))},_=(e,t)=>e.trim().split(/\s+/).map((e=>w(e,t))).join(" "),w=(e,t)=>{s("caret",e,t);const r=t.loose?o[a.CARETLOOSE]:o[a.CARET],n=t.includePrerelease?"-0":"";return e.replace(r,((t,r,i,o,a)=>{let u;return s("caret",e,t,r,i,o,a),g(r)?u="":g(i)?u=`>=${r}.0.0${n} <${+r+1}.0.0-0`:g(o)?u="0"===r?`>=${r}.${i}.0${n} <${r}.${+i+1}.0-0`:`>=${r}.${i}.0${n} <${+r+1}.0.0-0`:a?(s("replaceCaret pr",a),u="0"===r?"0"===i?`>=${r}.${i}.${o}-${a} <${r}.${i}.${+o+1}-0`:`>=${r}.${i}.${o}-${a} <${r}.${+i+1}.0-0`:`>=${r}.${i}.${o}-${a} <${+r+1}.0.0-0`):(s("no pr"),u="0"===r?"0"===i?`>=${r}.${i}.${o}${n} <${r}.${i}.${+o+1}-0`:`>=${r}.${i}.${o}${n} <${r}.${+i+1}.0-0`:`>=${r}.${i}.${o} <${+r+1}.0.0-0`),s("caret return",u),u}))},E=(e,t)=>(s("replaceXRanges",e,t),e.split(/\s+/).map((e=>S(e,t))).join(" ")),S=(e,t)=>{e=e.trim();const r=t.loose?o[a.XRANGELOOSE]:o[a.XRANGE];return e.replace(r,((r,n,i,o,a,u)=>{s("xRange",e,r,n,i,o,a,u);const c=g(i),l=c||g(o),f=l||g(a),p=f;return"="===n&&p&&(n=""),u=t.includePrerelease?"-0":"",c?r=">"===n||"<"===n?"<0.0.0-0":"*":n&&p?(l&&(o=0),a=0,">"===n?(n=">=",l?(i=+i+1,o=0,a=0):(o=+o+1,a=0)):"<="===n&&(n="<",l?i=+i+1:o=+o+1),"<"===n&&(u="-0"),r=`${n+i}.${o}.${a}${u}`):l?r=`>=${i}.0.0${u} <${+i+1}.0.0-0`:f&&(r=`>=${i}.${o}.0${u} <${i}.${+o+1}.0-0`),s("xRange return",r),r}))},A=(e,t)=>(s("replaceStars",e,t),e.trim().replace(o[a.STAR],"")),T=(e,t)=>(s("replaceGTE0",e,t),e.trim().replace(o[t.includePrerelease?a.GTE0PRE:a.GTE0],"")),I=e=>(t,r,n,s,i,o,a,u,c,l,f,p)=>`${r=g(n)?"":g(s)?`>=${n}.0.0${e?"-0":""}`:g(i)?`>=${n}.${s}.0${e?"-0":""}`:o?`>=${r}`:`>=${r}${e?"-0":""}`} ${u=g(c)?"":g(l)?`<${+c+1}.0.0-0`:g(f)?`<${c}.${+l+1}.0-0`:p?`<=${c}.${l}.${f}-${p}`:e?`<${c}.${l}.${+f+1}-0`:`<=${u}`}`.trim(),O=(e,t,r)=>{for(let r=0;r<e.length;r++)if(!e[r].test(t))return!1;if(t.prerelease.length&&!r.includePrerelease){for(let r=0;r<e.length;r++)if(s(e[r].semver),e[r].semver!==n.ANY&&e[r].semver.prerelease.length>0){const n=e[r].semver;if(n.major===t.major&&n.minor===t.minor&&n.patch===t.patch)return!0}return!1}return!0};return og}function pg(){if(cg)return ug;cg=1;const e=Symbol("SemVer ANY");class t{static get ANY(){return e}constructor(n,s){if(s=r(s),n instanceof t){if(n.loose===!!s.loose)return n;n=n.value}n=n.trim().split(/\s+/).join(" "),o("comparator",n,s),this.options=s,this.loose=!!s.loose,this.parse(n),this.semver===e?this.value="":this.value=this.operator+this.semver.version,o("comp",this)}parse(t){const r=this.options.loose?n[s.COMPARATORLOOSE]:n[s.COMPARATOR],i=t.match(r);if(!i)throw new TypeError(`Invalid comparator: ${t}`);this.operator=void 0!==i[1]?i[1]:"","="===this.operator&&(this.operator=""),i[2]?this.semver=new a(i[2],this.options.loose):this.semver=e}toString(){return this.value}test(t){if(o("Comparator.test",t,this.options.loose),this.semver===e||t===e)return!0;if("string"==typeof t)try{t=new a(t,this.options)}catch(e){return!1}return i(t,this.operator,this.semver,this.options)}intersects(e,n){if(!(e instanceof t))throw new TypeError("a Comparator is required");return""===this.operator?""===this.value||new u(e.value,n).test(this.value):""===e.operator?""===e.value||new u(this.value,n).test(e.semver):(!(n=r(n)).includePrerelease||"<0.0.0-0"!==this.value&&"<0.0.0-0"!==e.value)&&(!(!n.includePrerelease&&(this.value.startsWith("<0.0.0")||e.value.startsWith("<0.0.0")))&&(!(!this.operator.startsWith(">")||!e.operator.startsWith(">"))||(!(!this.operator.startsWith("<")||!e.operator.startsWith("<"))||(!(this.semver.version!==e.semver.version||!this.operator.includes("=")||!e.operator.includes("="))||(!!(i(this.semver,"<",e.semver,n)&&this.operator.startsWith(">")&&e.operator.startsWith("<"))||!!(i(this.semver,">",e.semver,n)&&this.operator.startsWith("<")&&e.operator.startsWith(">")))))))}}ug=t;const r=qm,{safeRe:n,t:s}=Vm,i=eg,o=Gm,a=iy,u=fg();return ug}const hg=fg();var dg=(e,t,r)=>{try{t=new hg(t,r)}catch(e){return!1}return t.test(e)};const mg=fg();var yg=(e,t)=>new mg(e,t).set.map((e=>e.map((e=>e.value)).join(" ").trim().split(" ")));const gg=iy,bg=fg();var vg=(e,t,r)=>{let n=null,s=null,i=null;try{i=new bg(t,r)}catch(e){return null}return e.forEach((e=>{i.test(e)&&(n&&-1!==s.compare(e)||(n=e,s=new gg(n,r)))})),n};const _g=iy,wg=fg();var Eg=(e,t,r)=>{let n=null,s=null,i=null;try{i=new wg(t,r)}catch(e){return null}return e.forEach((e=>{i.test(e)&&(n&&1!==s.compare(e)||(n=e,s=new _g(n,r)))})),n};const Sg=iy,Ag=fg(),Tg=Uy;var Ig=(e,t)=>{e=new Ag(e,t);let r=new Sg("0.0.0");if(e.test(r))return r;if(r=new Sg("0.0.0-0"),e.test(r))return r;r=null;for(let t=0;t<e.set.length;++t){const n=e.set[t];let s=null;n.forEach((e=>{const t=new Sg(e.semver.version);switch(e.operator){case">":0===t.prerelease.length?t.patch++:t.prerelease.push(0),t.raw=t.format();case"":case">=":s&&!Tg(t,s)||(s=t);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${e.operator}`)}})),!s||r&&!Tg(r,s)||(r=s)}return r&&e.test(r)?r:null};const Og=fg();var kg=(e,t)=>{try{return new Og(e,t).range||"*"}catch(e){return null}};const Rg=iy,Ng=pg(),{ANY:Pg}=Ng,xg=fg(),Cg=dg,Bg=Uy,Lg=jy,$g=Wy,Ug=Vy;var Dg=(e,t,r,n)=>{let s,i,o,a,u;switch(e=new Rg(e,n),t=new xg(t,n),r){case">":s=Bg,i=$g,o=Lg,a=">",u=">=";break;case"<":s=Lg,i=Ug,o=Bg,a="<",u="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(Cg(e,t,n))return!1;for(let r=0;r<t.set.length;++r){const c=t.set[r];let l=null,f=null;if(c.forEach((e=>{e.semver===Pg&&(e=new Ng(">=0.0.0")),l=l||e,f=f||e,s(e.semver,l.semver,n)?l=e:o(e.semver,f.semver,n)&&(f=e)})),l.operator===a||l.operator===u)return!1;if((!f.operator||f.operator===a)&&i(e,f.semver))return!1;if(f.operator===u&&o(e,f.semver))return!1}return!0};const jg=Dg;var Mg=(e,t,r)=>jg(e,t,">",r);const Hg=Dg;var Fg=(e,t,r)=>Hg(e,t,"<",r);const Kg=fg();var Gg=(e,t,r)=>(e=new Kg(e,r),t=new Kg(t,r),e.intersects(t,r));const Vg=dg,Xg=Ty;const Wg=fg(),qg=pg(),{ANY:Zg}=qg,Yg=dg,zg=Ty,Jg=[new qg(">=0.0.0-0")],Qg=[new qg(">=0.0.0")],eb=(e,t,r)=>{if(e===t)return!0;if(1===e.length&&e[0].semver===Zg){if(1===t.length&&t[0].semver===Zg)return!0;e=r.includePrerelease?Jg:Qg}if(1===t.length&&t[0].semver===Zg){if(r.includePrerelease)return!0;t=Qg}const n=new Set;let s,i,o,a,u,c,l;for(const t of e)">"===t.operator||">="===t.operator?s=tb(s,t,r):"<"===t.operator||"<="===t.operator?i=rb(i,t,r):n.add(t.semver);if(n.size>1)return null;if(s&&i){if(o=zg(s.semver,i.semver,r),o>0)return null;if(0===o&&(">="!==s.operator||"<="!==i.operator))return null}for(const e of n){if(s&&!Yg(e,String(s),r))return null;if(i&&!Yg(e,String(i),r))return null;for(const n of t)if(!Yg(e,String(n),r))return!1;return!0}let f=!(!i||r.includePrerelease||!i.semver.prerelease.length)&&i.semver,p=!(!s||r.includePrerelease||!s.semver.prerelease.length)&&s.semver;f&&1===f.prerelease.length&&"<"===i.operator&&0===f.prerelease[0]&&(f=!1);for(const e of t){if(l=l||">"===e.operator||">="===e.operator,c=c||"<"===e.operator||"<="===e.operator,s)if(p&&e.semver.prerelease&&e.semver.prerelease.length&&e.semver.major===p.major&&e.semver.minor===p.minor&&e.semver.patch===p.patch&&(p=!1),">"===e.operator||">="===e.operator){if(a=tb(s,e,r),a===e&&a!==s)return!1}else if(">="===s.operator&&!Yg(s.semver,String(e),r))return!1;if(i)if(f&&e.semver.prerelease&&e.semver.prerelease.length&&e.semver.major===f.major&&e.semver.minor===f.minor&&e.semver.patch===f.patch&&(f=!1),"<"===e.operator||"<="===e.operator){if(u=rb(i,e,r),u===e&&u!==i)return!1}else if("<="===i.operator&&!Yg(i.semver,String(e),r))return!1;if(!e.operator&&(i||s)&&0!==o)return!1}return!(s&&c&&!i&&0!==o)&&(!(i&&l&&!s&&0!==o)&&(!p&&!f))},tb=(e,t,r)=>{if(!e)return t;const n=zg(e.semver,t.semver,r);return n>0?e:n<0||">"===t.operator&&">="===e.operator?t:e},rb=(e,t,r)=>{if(!e)return t;const n=zg(e.semver,t.semver,r);return n<0?e:n>0||"<"===t.operator&&"<="===e.operator?t:e};var nb=(e,t,r={})=>{if(e===t)return!0;e=new Wg(e,r),t=new Wg(t,r);let n=!1;e:for(const s of e.set){for(const e of t.set){const t=eb(s,e,r);if(n=n||null!==t,t)continue e}if(n)return!1}return!0};const sb=Vm,ib=Km,ob=iy,ab=zm,ub=(e,t,r)=>{const n=[];let s=null,i=null;const o=e.sort(((e,t)=>Xg(e,t,r)));for(const e of o){Vg(e,t,r)?(i=e,s||(s=e)):(i&&n.push([s,i]),i=null,s=null)}s&&n.push([s,null]);const a=[];for(const[e,t]of n)e===t?a.push(e):t||e!==o[0]?t?e===o[0]?a.push(`<=${t}`):a.push(`${e} - ${t}`):a.push(`>=${e}`):a.push("*");const u=a.join(" || "),c="string"==typeof t.raw?t.raw:String(t);return u.length<c.length?u:t};var cb={parse:ay,valid:cy,clean:fy,inc:hy,diff:my,major:gy,minor:vy,patch:wy,prerelease:Sy,compare:Ty,rcompare:Oy,compareLoose:Ry,compareBuild:Py,sort:Cy,rsort:Ly,gt:Uy,lt:jy,eq:Hy,neq:Ky,gte:Vy,lte:Wy,cmp:eg,coerce:ig,Comparator:pg(),Range:fg(),satisfies:dg,toComparators:yg,maxSatisfying:vg,minSatisfying:Eg,minVersion:Ig,validRange:kg,outside:Dg,gtr:Mg,ltr:Fg,intersects:Gg,simplifyRange:ub,subset:nb,SemVer:ob,re:sb.re,src:sb.src,tokens:sb.t,SEMVER_SPEC_VERSION:ib.SEMVER_SPEC_VERSION,RELEASE_TYPES:ib.RELEASE_TYPES,compareIdentifiers:ab.compareIdentifiers,rcompareIdentifiers:ab.rcompareIdentifiers};var lb=cb.satisfies(process.version,">=15.7.0");var fb=cb.satisfies(process.version,">=16.9.0");const pb=lb,hb=fb,db={ec:["ES256","ES384","ES512"],rsa:["RS256","PS256","RS384","PS384","RS512","PS512"],"rsa-pss":["PS256","PS384","PS512"]},mb={ES256:"prime256v1",ES384:"secp384r1",ES512:"secp521r1"};var yb=function(e,t){if(!e||!t)return;const r=t.asymmetricKeyType;if(!r)return;const n=db[r];if(!n)throw new Error(`Unknown key type "${r}".`);if(!n.includes(e))throw new Error(`"alg" parameter for "${r}" key type must be one of: ${n.join(", ")}.`);if(pb)switch(r){case"ec":const r=t.asymmetricKeyDetails.namedCurve,n=mb[e];if(r!==n)throw new Error(`"alg" parameter "${e}" requires curve "${n}".`);break;case"rsa-pss":if(hb){const r=parseInt(e.slice(-3),10),{hashAlgorithm:n,mgf1HashAlgorithm:s,saltLength:i}=t.asymmetricKeyDetails;if(n!==`sha${r}`||s!==n)throw new Error(`Invalid key for this operation, its RSA-PSS parameters do not meet the requirements of "alg" ${e}.`);if(void 0!==i&&i>r>>3)throw new Error(`Invalid key for this operation, its RSA-PSS parameter saltLength does not meet the requirements of "alg" ${e}.`)}}},gb=cb.satisfies(process.version,"^6.12.0 || >=8.0.0");const bb=Cm,vb=$m,_b=jm,wb=Pm,Eb=Hm,Sb=yb,Ab=gb,Tb=fd,{KeyObject:Ib,createSecretKey:Ob,createPublicKey:kb}=r,Rb=["RS256","RS384","RS512"],Nb=["ES256","ES384","ES512"],Pb=["RS256","RS384","RS512"],xb=["HS256","HS384","HS512"];Ab&&(Rb.splice(Rb.length,0,"PS256","PS384","PS512"),Pb.splice(Pb.length,0,"PS256","PS384","PS512"));var Cb=1/0,Bb=9007199254740991,Lb=17976931348623157e292,$b=NaN,Ub="[object Arguments]",Db="[object Function]",jb="[object GeneratorFunction]",Mb="[object String]",Hb="[object Symbol]",Fb=/^\s+|\s+$/g,Kb=/^[-+]0x[0-9a-f]+$/i,Gb=/^0b[01]+$/i,Vb=/^0o[0-7]+$/i,Xb=/^(?:0|[1-9]\d*)$/,Wb=parseInt;function qb(e){return e!=e}function Zb(e,t){return function(e,t){for(var r=-1,n=e?e.length:0,s=Array(n);++r<n;)s[r]=t(e[r],r,e);return s}(t,(function(t){return e[t]}))}var Yb,zb,Jb=Object.prototype,Qb=Jb.hasOwnProperty,ev=Jb.toString,tv=Jb.propertyIsEnumerable,rv=(Yb=Object.keys,zb=Object,function(e){return Yb(zb(e))}),nv=Math.max;function sv(e,t){var r=av(e)||function(e){return function(e){return lv(e)&&uv(e)}(e)&&Qb.call(e,"callee")&&(!tv.call(e,"callee")||ev.call(e)==Ub)}(e)?function(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}(e.length,String):[],n=r.length,s=!!n;for(var i in e)!t&&!Qb.call(e,i)||s&&("length"==i||ov(i,n))||r.push(i);return r}function iv(e){if(!function(e){var t=e&&e.constructor,r="function"==typeof t&&t.prototype||Jb;return e===r}(e))return rv(e);var t=[];for(var r in Object(e))Qb.call(e,r)&&"constructor"!=r&&t.push(r);return t}function ov(e,t){return!!(t=null==t?Bb:t)&&("number"==typeof e||Xb.test(e))&&e>-1&&e%1==0&&e<t}var av=Array.isArray;function uv(e){return null!=e&&function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=Bb}(e.length)&&!function(e){var t=cv(e)?ev.call(e):"";return t==Db||t==jb}(e)}function cv(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function lv(e){return!!e&&"object"==typeof e}var fv=function(e,t,r,n){e=uv(e)?e:function(e){return e?Zb(e,function(e){return uv(e)?sv(e):iv(e)}(e)):[]}(e),r=r&&!n?function(e){var t=function(e){if(!e)return 0===e?e:0;if(e=function(e){if("number"==typeof e)return e;if(function(e){return"symbol"==typeof e||lv(e)&&ev.call(e)==Hb}(e))return $b;if(cv(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=cv(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(Fb,"");var r=Gb.test(e);return r||Vb.test(e)?Wb(e.slice(2),r?2:8):Kb.test(e)?$b:+e}(e),e===Cb||e===-Cb){return(e<0?-1:1)*Lb}return e==e?e:0}(e),r=t%1;return t==t?r?t-r:t:0}(r):0;var s=e.length;return r<0&&(r=nv(s+r,0)),function(e){return"string"==typeof e||!av(e)&&lv(e)&&ev.call(e)==Mb}(e)?r<=s&&e.indexOf(t,r)>-1:!!s&&function(e,t,r){if(t!=t)return function(e,t,r,n){for(var s=e.length,i=r+(n?1:-1);n?i--:++i<s;)if(t(e[i],i,e))return i;return-1}(e,qb,r);for(var n=r-1,s=e.length;++n<s;)if(e[n]===t)return n;return-1}(e,t,r)>-1},pv=Object.prototype.toString;var hv=function(e){return!0===e||!1===e||function(e){return!!e&&"object"==typeof e}(e)&&"[object Boolean]"==pv.call(e)},dv=1/0,mv=17976931348623157e292,yv=NaN,gv="[object Symbol]",bv=/^\s+|\s+$/g,vv=/^[-+]0x[0-9a-f]+$/i,_v=/^0b[01]+$/i,wv=/^0o[0-7]+$/i,Ev=parseInt,Sv=Object.prototype.toString;function Av(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}var Tv=function(e){return"number"==typeof e&&e==function(e){var t=function(e){if(!e)return 0===e?e:0;if(e=function(e){if("number"==typeof e)return e;if(function(e){return"symbol"==typeof e||function(e){return!!e&&"object"==typeof e}(e)&&Sv.call(e)==gv}(e))return yv;if(Av(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=Av(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(bv,"");var r=_v.test(e);return r||wv.test(e)?Ev(e.slice(2),r?2:8):vv.test(e)?yv:+e}(e),e===dv||e===-dv){return(e<0?-1:1)*mv}return e==e?e:0}(e),r=t%1;return t==t?r?t-r:t:0}(e)},Iv=Object.prototype.toString;var Ov=function(e){return"number"==typeof e||function(e){return!!e&&"object"==typeof e}(e)&&"[object Number]"==Iv.call(e)};var kv=Function.prototype,Rv=Object.prototype,Nv=kv.toString,Pv=Rv.hasOwnProperty,xv=Nv.call(Object),Cv=Rv.toString,Bv=function(e,t){return function(r){return e(t(r))}}(Object.getPrototypeOf,Object);var Lv=function(e){if(!function(e){return!!e&&"object"==typeof e}(e)||"[object Object]"!=Cv.call(e)||function(e){var t=!1;if(null!=e&&"function"!=typeof e.toString)try{t=!!(e+"")}catch(e){}return t}(e))return!1;var t=Bv(e);if(null===t)return!0;var r=Pv.call(t,"constructor")&&t.constructor;return"function"==typeof r&&r instanceof r&&Nv.call(r)==xv},$v=Object.prototype.toString,Uv=Array.isArray;var Dv=function(e){return"string"==typeof e||!Uv(e)&&function(e){return!!e&&"object"==typeof e}(e)&&"[object String]"==$v.call(e)},jv="Expected a function",Mv=1/0,Hv=17976931348623157e292,Fv=NaN,Kv="[object Symbol]",Gv=/^\s+|\s+$/g,Vv=/^[-+]0x[0-9a-f]+$/i,Xv=/^0b[01]+$/i,Wv=/^0o[0-7]+$/i,qv=parseInt,Zv=Object.prototype.toString;function Yv(e,t){var r;if("function"!=typeof t)throw new TypeError(jv);return e=function(e){var t=function(e){if(!e)return 0===e?e:0;if(e=function(e){if("number"==typeof e)return e;if(function(e){return"symbol"==typeof e||function(e){return!!e&&"object"==typeof e}(e)&&Zv.call(e)==Kv}(e))return Fv;if(zv(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=zv(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(Gv,"");var r=Xv.test(e);return r||Wv.test(e)?qv(e.slice(2),r?2:8):Vv.test(e)?Fv:+e}(e),e===Mv||e===-Mv){return(e<0?-1:1)*Hv}return e==e?e:0}(e),r=t%1;return t==t?r?t-r:t:0}(e),function(){return--e>0&&(r=t.apply(this,arguments)),e<=1&&(t=void 0),r}}function zv(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}var Jv=function(e){return Yv(2,e)};const Qv=Hm,e_=gb,t_=yb,r_=fd,n_=fv,s_=hv,i_=Tv,o_=Ov,a_=Lv,u_=Dv,c_=Jv,{KeyObject:l_,createSecretKey:f_,createPrivateKey:p_}=r,h_=["RS256","RS384","RS512","ES256","ES384","ES512","HS256","HS384","HS512","none"];e_&&h_.splice(3,0,"PS256","PS384","PS512");const d_={expiresIn:{isValid:function(e){return i_(e)||u_(e)&&e},message:'"expiresIn" should be a number of seconds or string representing a timespan'},notBefore:{isValid:function(e){return i_(e)||u_(e)&&e},message:'"notBefore" should be a number of seconds or string representing a timespan'},audience:{isValid:function(e){return u_(e)||Array.isArray(e)},message:'"audience" must be a string or array'},algorithm:{isValid:n_.bind(null,h_),message:'"algorithm" must be a valid string enum value'},header:{isValid:a_,message:'"header" must be an object'},encoding:{isValid:u_,message:'"encoding" must be a string'},issuer:{isValid:u_,message:'"issuer" must be a string'},subject:{isValid:u_,message:'"subject" must be a string'},jwtid:{isValid:u_,message:'"jwtid" must be a string'},noTimestamp:{isValid:s_,message:'"noTimestamp" must be a boolean'},keyid:{isValid:u_,message:'"keyid" must be a string'},mutatePayload:{isValid:s_,message:'"mutatePayload" must be a boolean'},allowInsecureKeySizes:{isValid:s_,message:'"allowInsecureKeySizes" must be a boolean'},allowInvalidAsymmetricKeyTypes:{isValid:s_,message:'"allowInvalidAsymmetricKeyTypes" must be a boolean'}},m_={iat:{isValid:o_,message:'"iat" should be a number of seconds'},exp:{isValid:o_,message:'"exp" should be a number of seconds'},nbf:{isValid:o_,message:'"nbf" should be a number of seconds'}};function y_(e,t,r,n){if(!a_(r))throw new Error('Expected "'+n+'" to be a plain object.');Object.keys(r).forEach((function(s){const i=e[s];if(i){if(!i.isValid(r[s]))throw new Error(i.message)}else if(!t)throw new Error('"'+s+'" is not allowed in "'+n+'"')}))}const g_={audience:"aud",issuer:"iss",subject:"sub",jwtid:"jti"},b_=["expiresIn","notBefore","noTimestamp","audience","issuer","subject","jwtid"];var v_={decode:Pm,verify:function(e,t,r,n){let s;if("function"!=typeof r||n||(n=r,r={}),r||(r={}),r=Object.assign({},r),s=n||function(e,t){if(e)throw e;return t},r.clockTimestamp&&"number"!=typeof r.clockTimestamp)return s(new bb("clockTimestamp must be a number"));if(void 0!==r.nonce&&("string"!=typeof r.nonce||""===r.nonce.trim()))return s(new bb("nonce must be a non-empty string"));if(void 0!==r.allowInvalidAsymmetricKeyTypes&&"boolean"!=typeof r.allowInvalidAsymmetricKeyTypes)return s(new bb("allowInvalidAsymmetricKeyTypes must be a boolean"));const i=r.clockTimestamp||Math.floor(Date.now()/1e3);if(!e)return s(new bb("jwt must be provided"));if("string"!=typeof e)return s(new bb("jwt must be a string"));const o=e.split(".");if(3!==o.length)return s(new bb("jwt malformed"));let a;try{a=wb(e,{complete:!0})}catch(e){return s(e)}if(!a)return s(new bb("invalid token"));const u=a.header;let c;if("function"==typeof t){if(!n)return s(new bb("verify must be called asynchronous if secret or public key is provided as a callback"));c=t}else c=function(e,r){return r(null,t)};return c(u,(function(t,n){if(t)return s(new bb("error in secret or public key callback: "+t.message));const c=""!==o[2].trim();if(!c&&n)return s(new bb("jwt signature is required"));if(c&&!n)return s(new bb("secret or public key must be provided"));if(!c&&!r.algorithms)return s(new bb('please specify "none" in "algorithms" to verify unsigned tokens'));if(null!=n&&!(n instanceof Ib))try{n=kb(n)}catch(e){try{n=Ob("string"==typeof n?Buffer.from(n):n)}catch(e){return s(new bb("secretOrPublicKey is not valid key material"))}}if(r.algorithms||("secret"===n.type?r.algorithms=xb:["rsa","rsa-pss"].includes(n.asymmetricKeyType)?r.algorithms=Pb:"ec"===n.asymmetricKeyType?r.algorithms=Nb:r.algorithms=Rb),-1===r.algorithms.indexOf(a.header.alg))return s(new bb("invalid algorithm"));if(u.alg.startsWith("HS")&&"secret"!==n.type)return s(new bb(`secretOrPublicKey must be a symmetric key when using ${u.alg}`));if(/^(?:RS|PS|ES)/.test(u.alg)&&"public"!==n.type)return s(new bb(`secretOrPublicKey must be an asymmetric key when using ${u.alg}`));if(!r.allowInvalidAsymmetricKeyTypes)try{Sb(u.alg,n)}catch(e){return s(e)}let l;try{l=Tb.verify(e,a.header.alg,n)}catch(e){return s(e)}if(!l)return s(new bb("invalid signature"));const f=a.payload;if(void 0!==f.nbf&&!r.ignoreNotBefore){if("number"!=typeof f.nbf)return s(new bb("invalid nbf value"));if(f.nbf>i+(r.clockTolerance||0))return s(new vb("jwt not active",new Date(1e3*f.nbf)))}if(void 0!==f.exp&&!r.ignoreExpiration){if("number"!=typeof f.exp)return s(new bb("invalid exp value"));if(i>=f.exp+(r.clockTolerance||0))return s(new _b("jwt expired",new Date(1e3*f.exp)))}if(r.audience){const e=Array.isArray(r.audience)?r.audience:[r.audience];if(!(Array.isArray(f.aud)?f.aud:[f.aud]).some((function(t){return e.some((function(e){return e instanceof RegExp?e.test(t):e===t}))})))return s(new bb("jwt audience invalid. expected: "+e.join(" or ")))}if(r.issuer){if("string"==typeof r.issuer&&f.iss!==r.issuer||Array.isArray(r.issuer)&&-1===r.issuer.indexOf(f.iss))return s(new bb("jwt issuer invalid. expected: "+r.issuer))}if(r.subject&&f.sub!==r.subject)return s(new bb("jwt subject invalid. expected: "+r.subject));if(r.jwtid&&f.jti!==r.jwtid)return s(new bb("jwt jwtid invalid. expected: "+r.jwtid));if(r.nonce&&f.nonce!==r.nonce)return s(new bb("jwt nonce invalid. expected: "+r.nonce));if(r.maxAge){if("number"!=typeof f.iat)return s(new bb("iat required when maxAge is specified"));const e=Eb(r.maxAge,f.iat);if(void 0===e)return s(new bb('"maxAge" should be a number of seconds or string representing a timespan eg: "1d", "20h", 60'));if(i>=e+(r.clockTolerance||0))return s(new _b("maxAge exceeded",new Date(1e3*e)))}if(!0===r.complete){const e=a.signature;return s(null,{header:u,payload:f,signature:e})}return s(null,f)}))},sign:function(e,t,r,n){"function"==typeof r?(n=r,r={}):r=r||{};const s="object"==typeof e&&!Buffer.isBuffer(e),i=Object.assign({alg:r.algorithm||"HS256",typ:s?"JWT":void 0,kid:r.keyid},r.header);function o(e){if(n)return n(e);throw e}if(!t&&"none"!==r.algorithm)return o(new Error("secretOrPrivateKey must have a value"));if(null!=t&&!(t instanceof l_))try{t=p_(t)}catch(e){try{t=f_("string"==typeof t?Buffer.from(t):t)}catch(e){return o(new Error("secretOrPrivateKey is not valid key material"))}}if(i.alg.startsWith("HS")&&"secret"!==t.type)return o(new Error(`secretOrPrivateKey must be a symmetric key when using ${i.alg}`));if(/^(?:RS|PS|ES)/.test(i.alg)){if("private"!==t.type)return o(new Error(`secretOrPrivateKey must be an asymmetric key when using ${i.alg}`));if(!r.allowInsecureKeySizes&&!i.alg.startsWith("ES")&&void 0!==t.asymmetricKeyDetails&&t.asymmetricKeyDetails.modulusLength<2048)return o(new Error(`secretOrPrivateKey has a minimum key size of 2048 bits for ${i.alg}`))}if(void 0===e)return o(new Error("payload is required"));if(s){try{!function(e){y_(m_,!0,e,"payload")}(e)}catch(e){return o(e)}r.mutatePayload||(e=Object.assign({},e))}else{const t=b_.filter((function(e){return void 0!==r[e]}));if(t.length>0)return o(new Error("invalid "+t.join(",")+" option for "+typeof e+" payload"))}if(void 0!==e.exp&&void 0!==r.expiresIn)return o(new Error('Bad "options.expiresIn" option the payload already has an "exp" property.'));if(void 0!==e.nbf&&void 0!==r.notBefore)return o(new Error('Bad "options.notBefore" option the payload already has an "nbf" property.'));try{!function(e){y_(d_,!1,e,"options")}(r)}catch(e){return o(e)}if(!r.allowInvalidAsymmetricKeyTypes)try{t_(i.alg,t)}catch(e){return o(e)}const a=e.iat||Math.floor(Date.now()/1e3);if(r.noTimestamp?delete e.iat:s&&(e.iat=a),void 0!==r.notBefore){try{e.nbf=Qv(r.notBefore,a)}catch(e){return o(e)}if(void 0===e.nbf)return o(new Error('"notBefore" should be a number of seconds or string representing a timespan eg: "1d", "20h", 60'))}if(void 0!==r.expiresIn&&"object"==typeof e){try{e.exp=Qv(r.expiresIn,a)}catch(e){return o(e)}if(void 0===e.exp)return o(new Error('"expiresIn" should be a number of seconds or string representing a timespan eg: "1d", "20h", 60'))}Object.keys(g_).forEach((function(t){const n=g_[t];if(void 0!==r[t]){if(void 0!==e[n])return o(new Error('Bad "options.'+t+'" option. The payload already has an "'+n+'" property.'));e[n]=r[t]}}));const u=r.encoding||"utf8";if("function"!=typeof n){let n=r_.sign({header:i,payload:e,secret:t,encoding:u});if(!r.allowInsecureKeySizes&&/^(?:RS|PS)/.test(i.alg)&&n.length<256)throw new Error(`secretOrPrivateKey has a minimum key size of 2048 bits for ${i.alg}`);return n}n=n&&c_(n),r_.createSign({header:i,privateKey:t,payload:e,encoding:u}).once("error",n).once("done",(function(e){if(!r.allowInsecureKeySizes&&/^(?:RS|PS)/.test(i.alg)&&e.length<256)return n(new Error(`secretOrPrivateKey has a minimum key size of 2048 bits for ${i.alg}`));n(null,e)}))},JsonWebTokenError:Cm,NotBeforeError:$m,TokenExpiredError:jm},__=h(v_);const w_=128;let E_,S_;function A_(e=21){!function(e){!E_||E_.length<e?(E_=Buffer.allocUnsafe(e*w_),l.getRandomValues(E_),S_=0):S_+e>E_.length&&(l.getRandomValues(E_),S_=0),S_+=e}(e-=0);let t="";for(let r=S_-e;r<S_;r++)t+="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict"[63&E_[r]];return t}const T_=ld.object({chain:ld.valid("BTC","ETH","CKB").required(),address:ld.string().required(),message:ld.string().required(),signature:ld.string().required(),challenge:ld.when("chain",{is:"CKB",then:ld.required()}),alg:ld.when("chain",{is:"CKB",then:ld.required()}),pubkey:ld.when("chain",{is:"CKB",then:ld.required()}),keyType:ld.when("chain",{is:"CKB",then:ld.required()})});var I_={id:"web3login",handler:async(t,r)=>{const{database:n,services:s,getSchema:i,env:o,logger:a}=r,{UsersService:u,ActivityService:c}=s,l=await i(),p=new u({schema:l}),h=new c({schema:l});t.post("/verify",(async(t,r,s)=>{var i;try{const{error:a,value:u}=T_.validate(t.body);if(a)return s(new A({reason:a.message}));const{address:c,chain:l,message:d,signature:m,challenge:y,alg:g,pubkey:b,keyType:v}=u;let _=!1;switch(l){case"BTC":_=((t,r,n,s)=>{try{return!!e.verifyMessageOfBIP322Simple(t,r,n,s)}catch(e){return console.log(e),!1}})(c,d,m,o.TESTNET?on.NetworkType.TESTNET:on.NetworkType.MAINNET);break;case"CKB":_=await sn({signature:m,message:d,challenge:y,alg:g,pubkey:b,keyType:v})}if(!_)return s(new A({reason:"invalid signature"}));let w=await p.readSingleton({filter:{external_identifier:{_eq:c.toLocaleLowerCase()}}});if(!w.id){const e=await p.createOne({status:"active",external_identifier:c.toLocaleLowerCase(),role:o.AUTH_WEB3_DEFAULT_ROLE_ID});w=await p.readOne(e)}if(w&&"active"!==w.status)return r.status(400).json({message:"User is inactive."});const E={id:w.id,role:w.role,app_access:!1,admin_access:!1},T=__.sign(E,o.SECRET,{expiresIn:o.ACCESS_TOKEN_TTL,issuer:"directus"}),I=A_(64),O=new Date(Date.now()+S(o.REFRESH_TOKEN_TTL)),k=t.accountability;await n("directus_sessions").insert({token:I,user:w.id,expires:O,ip:null==k?void 0:k.ip,user_agent:null==k?void 0:k.userAgent,origin:null==k?void 0:k.origin}),await n("directus_sessions").delete().where("expires","<",new Date),k&&await h.createOne({action:f.LOGIN,user:w.id,ip:k.ip,user_agent:k.userAgent,origin:k.origin,collection:"directus_users",item:w.id}),await n("directus_users").update({last_access:new Date}).where({id:w.id});const R={data:{access_token:T,expires:S(o.ACCESS_TOKEN_TTL)}},N=t.body.mode||"json";"json"===N&&(R.data.refresh_token=I);const P={httpOnly:!0,domain:o.REFRESH_TOKEN_COOKIE_DOMAIN,maxAge:S(o.REFRESH_TOKEN_TTL),secure:null!=(i=o.REFRESH_TOKEN_COOKIE_SECURE)&&i,sameSite:o.REFRESH_TOKEN_COOKIE_SAME_SITE||"strict"};return"cookie"===N&&r.cookie(o.REFRESH_TOKEN_COOKIE_NAME,I,P),r.status(200).json(R)}catch(e){return a.error(e),r.status(500).json({message:e})}}))}};export{I_ as default};
